
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Automate monitoring with Zabbix custom LLD rules. Dynamically discover devices,
filesystems, or services and create items and triggers automatically.
">
      
      
        <meta name="author" content="The Monitoring Penmasters">
      
      
        <link rel="canonical" href="https://thezabbixbook.com/fr/ch08-zabbix-lld/custom/">
      
      
        <link rel="prev" href="../chapter/">
      
      
        <link rel="next" href="../lld-with-dependent-items/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Custom LLD - Zabbix Book</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../../assets/external/fonts.googleapis.com/css.af67bdb9.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Nunito"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css?v=8e9f1ef305a011bd82d366c3ef82d26bf85e8ea7">
    
      <link rel="stylesheet" href="../../../stylesheets/linewrap.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
    
    
    

    <meta property="og:title" content="Custom LLD">
    <meta property="og:description" content="Automate monitoring with Zabbix custom LLD rules. Dynamically discover devices, filesystems, or services and create items and triggers automatically.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thezabbixbook.com/fr/ch08-zabbix-lld/custom/">
    <meta property="og:image" content="https://www.thezabbixbook.com/assets/social-card.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Custom LLD">
    <meta name="twitter:description" content="Automate monitoring with Zabbix custom LLD rules. Dynamically discover devices, filesystems, or services and create items and triggers automatically.">
    <meta name="twitter:image" content="https://www.thezabbixbook.com/assets/social-card.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="627">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#custom-low-level-discovery" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
    
    
    
        <div class="gmc-announce">
            Cette page n'a pas encore été traduite en Français, elle est donc affichée en anglais.
            <a href="/gmc/fr/contribute/#translations">Soutenez-nous et traduisez !</a>
        </div>
    
    
    <script>
        const gGMC_SELECT_VERSION = "Sélectionner la version";
        const gGMC_TRANSLATE_CTA = "Soutenez-nous et traduisez !";
        const gGMC_PAGE_LOCALE = "fr";
        const gGMC_FILE_LOCALE = "en";
        const gGMC_TRANSLATE_SVG = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.5 12c0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2 0 .37-.03.73-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10C6.47 2 2 6.5 2 12s4.5 10 10 10c.59 0 1.16-.06 1.72-.16A5.9 5.9 0 0 1 13 19c0-.29.03-.57.07-.85-.32.63-.67 1.24-1.07 1.81-.83-1.2-1.5-2.53-1.91-3.96h3.72a5.95 5.95 0 0 1 2.59-2.4c.06-.53.1-1.06.1-1.6M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2zm.82 2H8c.35 1.25.8 2.45 1.4 3.56A8 8 0 0 1 5.08 16M8 8H5.08A7.92 7.92 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m6.34 6H9.66c-.1-.66-.16-1.32-.16-2s.06-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2m.25-9.56c1.84.63 3.37 1.9 4.33 3.56h-2.95a15.7 15.7 0 0 0-1.38-3.56M23 18v2h-3v3h-2v-3h-3v-2h3v-3h2v3z"/></svg>';
    </script>
    
    

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../../" title="Zabbix Book" class="md-header__button md-logo" aria-label="Zabbix Book" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Zabbix Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Custom LLD
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Sélectionner la langue">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="fr" class="md-select__link">
              Français
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../nl/ch08-zabbix-lld/custom/" hreflang="nl" class="md-select__link">
              Nederlands
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../pt_BR/ch08-zabbix-lld/custom/" hreflang="pt_BR" class="md-select__link">
              Brazillian Portugese
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../ru/ch08-zabbix-lld/custom/" hreflang="ru" class="md-select__link">
              Russian
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../ch08-zabbix-lld/custom/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Partager" aria-label="Partager" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/penmasters/zabbix-book" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    penmasters
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../" title="Zabbix Book" class="md-nav__button md-logo" aria-label="Zabbix Book" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Zabbix Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/penmasters/zabbix-book" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    penmasters
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guidelines
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Book Tags
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Supporters-Contributors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Supporters and contributors
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch00-getting-started/initial-steps/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch01-zabbix-components/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 01 : Zabbix components
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch02-zabbix-installation/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 02 : Installation
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch03-zabbix-proxies/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 03 : Proxies and Webcomponents
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch04-zabbix-collecting-data/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 04 : Collecting data 
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch05-zabbix-triggers/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 05 : Triggers
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch06-zabbix-templates/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 06 : Templates
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch07-zabbix-alerts/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 07 : Alerting
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" checked>
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 08 : LLD
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Chapter 08 : LLD
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Low level discovery to automate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Custom LLD
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Custom LLD
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implementing-low-level-discovery-in-zabbix" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing Low-Level Discovery in Zabbix
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementing Low-Level Discovery in Zabbix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-challenge-of-manual-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      The Challenge of Manual Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discovery-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Discovery Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes-and-automation" class="md-nav__link">
    <span class="md-ellipsis">
      Prototypes and Automation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lld-macros" class="md-nav__link">
    <span class="md-ellipsis">
      LLD Macros
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-zabbix-low-level-discovery-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      The Zabbix Low-Level Discovery Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advantages-of-lld-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages of LLD Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#learning-lld-custom-script" class="md-nav__link">
    <span class="md-ellipsis">
      Learning LLD custom script
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Learning LLD custom script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-custom-script" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a custom script.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-template" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a Template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-template-for-lld-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a Template for LLD Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-user-parameter-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the User Parameter Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saving-the-template-and-preparing-the-monitored-host" class="md-nav__link">
    <span class="md-ellipsis">
      Saving the Template and Preparing the Monitored Host
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-prototype-items" class="md-nav__link">
    <span class="md-ellipsis">
      Creating prototype items.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-agent-to-listen-for-lld-items" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the Agent to Listen for LLD Items
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-our-lld-items" class="md-nav__link">
    <span class="md-ellipsis">
      Testing our lld items
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-lld-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      Adding LLD triggers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-lld-overrides" class="md-nav__link">
    <span class="md-ellipsis">
      Creating LLD overrides.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lld-with-dependent-items/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dependent LLD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch09-zabbix-extending/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 09 : Extending Zabbix
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch10-zabbix-discovery/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 10 : Discovery
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch11-zabbix-visualisation/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 11 : Visualisation
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch12-zabbix-api/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 12 : Zabbix API
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch13-advanced-security/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 13 : Advanced set up and security
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch14-zabbix-maintenance/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 14 : Maintenance
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch15-zabbix-real-world-examples/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 15 : Real world examples
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../print_page/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Print Site
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implementing-low-level-discovery-in-zabbix" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing Low-Level Discovery in Zabbix
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementing Low-Level Discovery in Zabbix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-challenge-of-manual-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      The Challenge of Manual Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discovery-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Discovery Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes-and-automation" class="md-nav__link">
    <span class="md-ellipsis">
      Prototypes and Automation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lld-macros" class="md-nav__link">
    <span class="md-ellipsis">
      LLD Macros
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-zabbix-low-level-discovery-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      The Zabbix Low-Level Discovery Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advantages-of-lld-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages of LLD Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#learning-lld-custom-script" class="md-nav__link">
    <span class="md-ellipsis">
      Learning LLD custom script
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Learning LLD custom script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-custom-script" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a custom script.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-template" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a Template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-template-for-lld-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a Template for LLD Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-user-parameter-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the User Parameter Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saving-the-template-and-preparing-the-monitored-host" class="md-nav__link">
    <span class="md-ellipsis">
      Saving the Template and Preparing the Monitored Host
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-prototype-items" class="md-nav__link">
    <span class="md-ellipsis">
      Creating prototype items.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-agent-to-listen-for-lld-items" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the Agent to Listen for LLD Items
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-our-lld-items" class="md-nav__link">
    <span class="md-ellipsis">
      Testing our lld items
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-lld-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      Adding LLD triggers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-lld-overrides" class="md-nav__link">
    <span class="md-ellipsis">
      Creating LLD overrides.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                


    <a href="../../../print_page/" title="Print Site" class="md-content__button md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 3H6v4h12m1 5a1 1 0 0 1-1-1 1 1 0 0 1 1-1 1 1 0 0 1 1 1 1 1 0 0 1-1 1m-3 7H8v-5h8m3-6H5a3 3 0 0 0-3 3v6h4v4h12v-4h4v-6a3 3 0 0 0-3-3"/></svg>
    </a>



                   
<nav class="md-tags">
  
  <span class="md-tag md-tag-icon">advanced</span>
  
</nav>


  
  
    
      
    
    <a href="https://github.com/penmasters/zabbix-book/raw/main/docs/ch08-zabbix-lld/custom.md" title="Consulter la source de cette page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="custom-low-level-discovery">Custom Low Level Discovery</h1>
<p>Zabbix's Low-Level Discovery (LLD) plays a crucial role in dynamically detecting
and managing monitored entities. While Zabbix provides built-in discovery rules,
real-world environments often demand more flexibility and customization.</p>
<p>In this chapter, we will explore custom LLD techniques, allowing you to create powerful,
tailored discovery mechanisms that go beyond standard templates. You'll learn how
to use scripts and custom rules to automatically detect and monitor services,
network interfaces, and other dynamic components within your infrastructure.</p>
<p>Whether you're monitoring cloud environments, network devices, or application-specific
metrics, mastering custom LLD will help you reduce manual work, improve accuracy,
and scale your monitoring effortlessly. Let’s dive in!</p>
<details class="note" open="open">
<summary>Note</summary>
<p>For this chapter we start with a working system with a proper configured agent
in passive mode. If you have no clue how to do this go back to chapter 01.</p>
</details>
<p>Zabbix <strong>Low-Level Discovery</strong> (LLD) provides a dynamic mechanism for automatically
creating monitoring elements based on discovered entities within your infrastructure.</p>
<p><strong>Core Functionality :</strong></p>
<p>LLD enables Zabbix to detect changes in your environment and create corresponding
items, triggers, and graphs without manual intervention. This automation is particularly
valuable when monitoring elements with fluctuating quantities or identifiers.</p>
<p><strong>Discovery Targets:</strong>
The discovery process can identify and monitor various system components including:</p>
<ul>
<li>File systems</li>
<li>CPUs</li>
<li>CPU cores</li>
<li>Network interfaces</li>
<li>SNMP OIDs</li>
<li>JMX objects</li>
<li>Windows services</li>
<li>Systemd services</li>
<li>Host interfaces</li>
<li>Anything based on custom scripts</li>
</ul>
<p>Through LLD, administrators can implement scalable monitoring solutions that automatically
adapt to infrastructure changes without requiring constant template modifications.</p>
<h2 id="implementing-low-level-discovery-in-zabbix">Implementing Low-Level Discovery in Zabbix</h2>
<h3 id="the-challenge-of-manual-configuration">The Challenge of Manual Configuration</h3>
<p>We could manually create each item but this would be a very time-consuming task
and impossible to manage in large environments. To enable automatic discovery of
our items or entities, we need discovery rules.</p>
<h3 id="discovery-rules">Discovery Rules</h3>
<p>These rules send the necessary data to Zabbix for our discovery process. There 
is no limit to the various methods we can employ, the only requirement is that
the end result must be formatted in JSON. This output information is crucial as
it forms the foundation for creating our items.</p>
<h3 id="prototypes-and-automation">Prototypes and Automation</h3>
<p>Once our discovery rule is in place, we can instruct Zabbix to automatically generate
items, triggers, graphs, and even host prototypes. These function as blueprints
directing Zabbix how to create those entities.</p>
<h3 id="lld-macros">LLD Macros</h3>
<p>To enhance flexibility, Zabbix implements LLD macros. These macros always begin
with a # character before their name (e.g., {#FSNAME}). Acting as placeholders for
the values of discovered entities, Zabbix replaces these macros with the actual
discovered names of the items during the implementation process.</p>
<h3 id="the-zabbix-low-level-discovery-workflow">The Zabbix Low-Level Discovery Workflow</h3>
<p>The workflow that Zabbix follows during Low-Level Discovery consists of four
distinct phases:</p>
<p><strong>Discovery Phase</strong>
* Zabbix executes the discovery item according to the defined discovery rule
* The item returns a JSON list of discovered entities</p>
<p><strong>Processing Phase</strong>
* Zabbix parses the JSON data and extracts the necessary information</p>
<p><strong>Creation Phase</strong>
* For each discovered entity, Zabbix creates items, triggers, and graphs based on
  the prototypes
* During this process, LLD macros are replaced with the actual discovered values</p>
<p><strong>Monitoring Phase</strong>
* Zabbix monitors the created items using standard monitoring procedures</p>
<h3 id="advantages-of-lld-implementation">Advantages of LLD Implementation</h3>
<p>The benefits of implementing Low-Level Discovery are substantial:</p>
<ul>
<li><strong>Automation</strong> - Creation of items, triggers, graphs, and hosts becomes fully
  automated</li>
<li><strong>Scalability</strong> - Enables monitoring of large numbers of hosts or items without
  manual intervention</li>
<li><strong>Adaptability</strong> - Zabbix can dynamically adjust to environmental changes by 
  creating or removing entities as needed</li>
</ul>
<h2 id="learning-lld-custom-script">Learning LLD custom script</h2>
<p>We begin our series with LLD based on custom scripts because, while it represents
one of the more complex topics, mastering this concept provides a solid foundation.
Once you understand this implementation approach, the other LLD topics will be
considerably easier to comprehend.</p>
<p>Below is a sample JSON structure that Zabbix can interpret for Low-Level Discovery:</p>
<div class="admonition info">
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p p-Indicator">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="s">&quot;data&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="p p-Indicator">{</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">      </span><span class="s">&quot;{#FSNAME}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p p-Indicator">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">      </span><span class="s">&quot;{#FSTYPE}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;ext4&quot;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="p p-Indicator">},</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="p p-Indicator">{</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">      </span><span class="s">&quot;{#FSNAME}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/boot&quot;</span><span class="p p-Indicator">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">      </span><span class="s">&quot;{#FSTYPE}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;ext4&quot;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="p p-Indicator">},</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">    </span><span class="p p-Indicator">{</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">      </span><span class="s">&quot;{#FSNAME}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/data&quot;</span><span class="p p-Indicator">,</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">      </span><span class="s">&quot;{#FSTYPE}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;xfs&quot;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="p p-Indicator">}</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">  </span><span class="p p-Indicator">]</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="p p-Indicator">}</span>
</span></code></pre></div>
</div>
<p>Upon receiving this JSON data, Zabbix processes the discovery information to identify
distinct file systems within the monitored environment. The system extracts and
maps the following elements:</p>
<ul>
<li>File system mount points: /, /boot, and /data</li>
<li>File system types: ext4 and xfs</li>
</ul>
<p>Zabbix automatically associates these discovered values with their corresponding
LLD macros {#FSNAME} for the mount points and {#FSTYPE} for the file system types.
This mapping enables dynamic creation of monitoring objects tailored to each specific
file system configuration.</p>
<h3 id="creating-a-custom-script">Creating a custom script.</h3>
<p>In this example, we will develop a custom script to monitor user login activity on
our systems. This script will track the number of users currently logged into each
monitored host and report their login status.</p>
<p>The implementation requires placing a custom script in the appropriate location on
systems running Zabbix Agent (either version 1 or 2). Create the following script
in the <code>/usr/bin/</code> directory on each agent installed system:</p>
<div class="admonition info">
<p class="admonition-title">create our script</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo vi /usr/bin/users-discovery.sh</span>
</span></code></pre></div>
</div>
<p>paste the following content in the file:</p>
<div class="admonition info">
<p class="admonition-title">users-discovery.sh</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">#!/bin/bash</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1"># Find all users with UID ≥ 1000 of UID = 0 from /etc/passwd, except &quot;nobody&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="nt">ALL_USERS=$(awk -F</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;($3</span><span class="nv"> </span><span class="s">&gt;=</span><span class="nv"> </span><span class="s">1000</span><span class="nv"> </span><span class="s">||</span><span class="nv"> </span><span class="s">$3</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">0)</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">$1</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&quot;nobody&quot;</span><span class="nv"> </span><span class="s">{print</span><span class="nv"> </span><span class="s">$1}&#39;</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/passwd)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="c1"># Find all active users</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="l l-Scalar l-Scalar-Plain">ACTIVE_USERS=$(who | awk &#39;{print $1}&#39; | sort | uniq)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="c1"># Begin JSON-output</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="l l-Scalar l-Scalar-Plain">echo -n &#39;{&quot;data&quot;:[&#39;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="l l-Scalar l-Scalar-Plain">FIRST=1</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="l l-Scalar l-Scalar-Plain">for USER in $ALL_USERS; do</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"># Check if the user is active</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">if echo &quot;$ACTIVE_USERS&quot; | grep -q &quot;^$USER$&quot;; then</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">ACTIVE=&quot;yes&quot;</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">else</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">ACTIVE=&quot;no&quot;</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">fi</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"># JSON-format</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">if [ $FIRST -eq 0 ]; then echo -n &#39;,&#39;; fi</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">echo -n &quot;{\&quot;{#USERNAME}\&quot;:\&quot;$USER\&quot;, \&quot;{#ACTIVE}\&quot;:\&quot;$ACTIVE\&quot;}&quot;</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">FIRST=0</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="l l-Scalar l-Scalar-Plain">done</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="l l-Scalar l-Scalar-Plain">echo &#39;]}&#39;</span>
</span></code></pre></div>
</div>
<p>Once you have created the script don't forget to make it executable.</p>
<div class="admonition info">
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo chmod +x /usr/bin/users-discovery.sh</span>
</span></code></pre></div>
</div>
<p>The script will be executed by the Zabbix agent and will return discovery data
about user sessions in the JSON format required for Low-Level Discovery processing.</p>
<p>Once deployed, this script will function as the data collection mechanism for our
user monitoring solution, enabling Zabbix to dynamically discover user sessions
and track login/logout activities across your infrastructure.</p>
<p><strong>User Provisioning for Testing</strong></p>
<p>Let's establish additional test user accounts on our system to ensure we have
sufficient data for validating our monitoring implementation. This will provide
a more comprehensive testing environment beyond the default root account and your
personal user account. Feel free to add as many users as you like.</p>
<div class="admonition info">
<p class="admonition-title">create some users</p>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo for user in sven brian cartman kenny; do sudo useradd $user; done</span>
</span></code></pre></div>
Create a password for every user so that we can login on the console
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo passwd &lt;user&gt;</span>
</span></code></pre></div></p>
</div>
<h3 id="creating-a-template">Creating a Template</h3>
<p>It is always considered best practice to work with a template. The first step is
to create a template for the LLD rules.  </p>
<p>Navigate to <strong>Data collection</strong>, select <strong>Templates</strong>, and click <strong>Create template</strong>
in the upper-right corner.  </p>
<p>Fill in the required information, specifying at least a <strong>template name</strong> and 
the <strong>template group</strong> it belongs to.</p>
<p><img alt="lld user template" src="../../../ch08-zabbix-lld/custom-lld/template-lld-users.png" /></p>
<p>Once the template is created click on <code>Discovery</code> in the template between <code>Dashboards</code>
and <code>Web</code>. In the upper right corner of the screen you see now a button <code>create discovery rule</code>.</p>
<p>We will nog create our discovery rule that will import the <code>JSON</code> from our script.
Click on the button.</p>
<p>Fill in the needed information like on the screenshot :</p>
<p><img alt="discovery rule" src="../../../ch08-zabbix-lld/custom-lld/template-discovery-rule.png" /></p>
<h3 id="creating-a-template-for-lld-rules">Creating a Template for LLD Rules</h3>
<ul>
<li><strong>Type</strong>: Set to <strong>Zabbix agent</strong>, as the agent is configured to work in passive
  mode. If the agent is properly configured for active mode, <strong>Zabbix agent (active)</strong>
  can be used instead. Passive mode allows polling information from the script.  </li>
<li><strong>Key</strong>: This key acts as a reference sent to the agent, instructing it on which
  script to execute.  </li>
<li><strong>Update Interval</strong>: Determines how often Zabbix executes the script. For detecting
  newly created users, an interval of <strong>one hour</strong> is a reasonable setting.</li>
</ul>
<details class="note" open="open">
<summary>Note</summary>
<p>If you put the update interval for the discovery rule too frequent like every
minute, then this will have a negative impact on the performance. In our case
it's a small JSON file but most of the time it will contain much more data.</p>
</details>
<p>Once everything is filled in we can save the template.</p>
<p>Login to your console on the host that you would like to monitor and go to the
following path. </p>
<div class="admonition info">
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="l l-Scalar l-Scalar-Plain">cd `/etc/zabbix/zabbix_agent2.d/`</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="l l-Scalar l-Scalar-Plain">or in case you are using Agent 1</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="l l-Scalar l-Scalar-Plain">cd `/etc/zabbix/zabbix_agentd.d/`</span>
</span></code></pre></div>
</div>
<h3 id="creating-the-user-parameter-configuration">Creating the User Parameter Configuration</h3>
<p>The next step is to create the <strong>userparameter-users.conf</strong> file in this directory.
This file will define the reference key <strong>users.discovery</strong> from the LLD rule and
map it to the corresponding script. By doing this, Zabbix can associate the item
key with the correct script execution.</p>
<div class="admonition info">
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="l l-Scalar l-Scalar-Plain">vi userparameter-users.conf</span>
</span></code></pre></div>
</div>
<p>Add the following line in the config file and save it.</p>
<div class="admonition info">
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>UserParameter=users.discovery,/usr/bin/users-discovery.sh
</span></code></pre></div>
</div>
<details class="note" open="open">
<summary>Note</summary>
<p>When you add a new <code>UserParameter</code> to the agent we need to restart the agent
to pick up the new config or use the config option <code>-R userparameter_reload</code>
on our agent this will apply the new configuration but only works on UserParameters
not on other changes in the agent configuration.</p>
</details>
<h3 id="saving-the-template-and-preparing-the-monitored-host">Saving the Template and Preparing the Monitored Host</h3>
<p>After entering all the required details, save the template to apply the configuration.<br />
Next, access the console of the host you want to monitor and navigate to the following
directory.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>Zabbix agent has a new option since 6.0, <code>userparameter_reload</code>. This allows
us to reload the config for the userparameters and makes a restart of the agent
not necessary.</p>
</details>
<h3 id="testing-the-configuration">Testing the Configuration</h3>
<p>With the setup complete, it is time to perform some tests.  </p>
<ol>
<li>Navigate to <strong>Data collection</strong> and select <strong>Hosts</strong>.  </li>
<li>Link the newly created template to the appropriate host in the Zabbix frontend.  </li>
<li>Once the template is linked, go to the <strong>Discovery</strong> section.  </li>
<li>Click on the discovery rule created earlier, <strong>Active users</strong>.  </li>
<li>At the bottom of the screen, locate the <strong>Test</strong> button and click on it.  </li>
<li>In the popup window, press <strong>Get value and test</strong>.  </li>
</ol>
<p>If everything is configured correctly, Zabbix will retrieve the expected value and
store it in the database.</p>
<p><img alt="lld-test" src="../../../ch08-zabbix-lld/custom-lld/lld-discovery-test.png" /></p>
<p>If all went well you should have received some data back in JSON like you see here, 
depending on the number of users you made and what name you gave them.</p>
<div class="admonition info">
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">      </span><span class="nt">&quot;{#USERNAME}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;root&quot;</span><span class="p">,</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">      </span><span class="nt">&quot;{#ACTIVE}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">      </span><span class="nt">&quot;{#USERNAME}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;brian&quot;</span><span class="p">,</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">      </span><span class="nt">&quot;{#ACTIVE}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">      </span><span class="nt">&quot;{#USERNAME}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sven&quot;</span><span class="p">,</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">      </span><span class="nt">&quot;{#ACTIVE}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">      </span><span class="nt">&quot;{#USERNAME}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cartman&quot;</span><span class="p">,</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">      </span><span class="nt">&quot;{#ACTIVE}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">      </span><span class="nt">&quot;{#USERNAME}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kenny&quot;</span><span class="p">,</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">      </span><span class="nt">&quot;{#ACTIVE}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<h3 id="creating-prototype-items">Creating prototype items.</h3>
<p>With our Low-Level Discovery (LLD) rule in place, we are ready to create our LLD
item prototype. Follow these steps to configure the item prototype correctly:</p>
<ol>
<li><strong>Navigating to Item Prototype Configuration</strong></li>
<li>Open your template in Zabbix.</li>
<li>Click on the <strong>Discovery</strong> tab.</li>
<li>Navigate to <strong>Item Prototypes</strong>.</li>
<li>
<p>Click on <strong>Create Item Prototype</strong> in the upper-right corner.</p>
</li>
<li>
<p><strong>Configuring the Item Prototype</strong>
   Several key fields must be completed for the prototype to function correctly:</p>
</li>
<li>
<p><strong>Name:</strong></p>
<ul>
<li>Use the macro <code>{#USERNAME}</code> to create dynamically generated item names.</li>
<li>Example: <code>User {#USERNAME} login status</code>.</li>
</ul>
</li>
<li>
<p><strong>Type:</strong></p>
<ul>
<li>Select <code>Zabbix agent</code> as the item type to facilitate testing.</li>
</ul>
</li>
<li>
<p><strong>Key:</strong></p>
<ul>
<li>The item key must be unique.</li>
<li>Utilize macros to ensure a unique key for each item instance.</li>
</ul>
</li>
<li>
<p><strong>Type of Information:</strong></p>
<ul>
<li>Defines the format of the received data.</li>
<li>Since our script returns <code>0</code> or <code>1</code>, set this to <code>Numeric</code>.</li>
</ul>
</li>
<li>
<p><strong>Update Interval:</strong></p>
<ul>
<li>Determines how frequently the item is checked.</li>
<li>A reasonable interval for checking user online status is <code>1m</code> (one minute).</li>
</ul>
</li>
</ol>
<p>With these configurations, your LLD item prototype is ready for deployment.</p>
<p><img alt="create lld item" src="../../../ch08-zabbix-lld/custom-lld/lld-item-create.png" /></p>
<h3 id="configuring-the-agent-to-listen-for-lld-items">Configuring the Agent to Listen for LLD Items</h3>
<p>Our LLD item will retrieve data from the key custom.user[{#USERNAME}], so the next
step is to configure the agent to listen for this key.</p>
<ul>
<li>Edit the <code>userparameter-users.conf</code> file that was created earlier on the <code>Zabbix agent</code>.</li>
<li>Add the following line to the configuration file:</li>
</ul>
<div class="admonition info">
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>UserParameter=custom.user[*],who | grep -c &quot;$1&quot;
</span></code></pre></div>
</div>
<ul>
<li>This configuration ensures that the agent listens for requests using the
  <code>custom.user[{#USERNAME}]</code> key.</li>
<li>The <code>{#USERNAME}</code> macro is dynamically replaced with usernames extracted from
  the discovery rule.</li>
</ul>
<details class="note" open="open">
<summary>Note</summary>
<p>Important: After making changes to the configuration file, restart the <code>Zabbix agent</code>
or reload the configuration to apply the new settings.</p>
</details>
<p>With these configurations in place, your LLD item prototype is fully set up and ready
for deployment.</p>
<h3 id="testing-our-lld-items">Testing our lld items</h3>
<p>Before we put things in production we can of course test it. Press the <code>test</code> button
at the bottom. Fill in the needed information: </p>
<ul>
<li><strong>Host address</strong> : the IP or DNS name where we have our scripts configured on our agent.</li>
<li><strong>Port</strong> : the agent port. This should be 10050 unless you have changed it for some reason.</li>
<li><strong>Macros</strong> : map the macro with one of the user names you have configured on your system.</li>
</ul>
<p>Press <code>Get value</code> and if all goes well Zabbix will return the value 1 or 0 depending
if the user is online or not.</p>
<p><img alt="test lld item" src="../../../ch08-zabbix-lld/custom-lld/lld-test-item.png" /></p>
<p>Apply the template to your host and have a look at the latest data. Things should
slowly start to populate.</p>
<h3 id="adding-lld-triggers">Adding LLD triggers</h3>
<p>Let's go back to our template to our <code>Discovery</code> and select <code>Trigger prototype</code>.
Click on the top right on <code>Create trigger prototype</code>.
Fill in the following fields:</p>
<ul>
<li><strong>Name</strong> : <code>User {#USERNAME} is logged in</code> Again we want our information to be
  more dynamic so we make use of our macros in the name of our trigger.</li>
<li><strong>Severity</strong> : We select the severity level here. <code>Information</code> seems high enough.</li>
<li><strong>Expression</strong> : We want to get a notification if someone is online you can
  make use of the <code>Add</code> button or just copy : <code>last(/Discover users/custom.user[{#USERNAME}])=1</code></li>
</ul>
<p><img alt="lld trigger" src="../../../ch08-zabbix-lld/custom-lld/lld-trigger.png" /></p>
<details class="note" open="open">
<summary>Note</summary>
<p>Copying the Expression will only work if you used the same name for the
template and item key.</p>
</details>
<p>You can  now log in with a user that we created before or root and have a look at
our dashboard. A notification should popup soon to inform you that a user was
logged in.</p>
<p><img alt="user root logged" src="../../../ch08-zabbix-lld/custom-lld/lld-user-root-loggedin.png" /></p>
<h3 id="creating-lld-overrides">Creating LLD overrides.</h3>
<p>Having our notifications when users log in on our systems is a nice security feature
but i'm more worried when a user logs in with root then when for example Brian
logs in. When root logs in I would like to get the alert <code>High</code> instead of <code>Information</code>.</p>
<p>This is possible in Zabbix when we make use of overrides. Overrides allow us to
change the behaviour of our triggers under certain conditions.</p>
<p>Go to the template to the discovery rule <code>Active users</code>. Click on the tab <code>Overrides</code>.
Press on the button <code>Add</code> and fill in the needed information.</p>
<ul>
<li><strong>Name</strong> : A useful name for our override in our case we call it <code>high severity for user root</code>.</li>
<li><strong>Filters</strong> : Here we filter for certain information that we find in our LLD 
  macros. In our case we look in the macro <code>{#USERNAME}</code> for the user <code>root</code>.</li>
</ul>
<p><img alt="lld override" src="../../../ch08-zabbix-lld/custom-lld/lld-override.png" /></p>
<ul>
<li><strong>Operation</strong> : Here we define what needs to happen. We want to manipulate the
  trigger so select for object <code>Trigger prototype</code> and select that we want to modify
  the <code>Severity</code> and select <code>High</code>. This will modify the severity of our trigger
  and change it to <code>High</code> if the user that is detected is the user <code>root</code>.</li>
</ul>
<p><img alt="lld override operation " src="../../../ch08-zabbix-lld/custom-lld/lld-override-operation.png" /></p>
<details class="note" open="open">
<summary>Note</summary>
<p>It can take a while before changes are applied to your host. Don't panic this
is normal the discovery rule usually only updates every hour. If you like to
force this just go to your discovery rule on the host, select it and press <code>Execute now</code>.</p>
</details>
<p>Once everything is changed you can login on your system with the user <code>root</code> and
one of the other users. As you will see both triggers will fire off but with
different severity levels.</p>
<p><img alt="lld different severity" src="../../../ch08-zabbix-lld/custom-lld/lld-users-override.png" /></p>
<h1 id="conclusion">Conclusion</h1>
<h1 id="question">Question</h1>
<h1 id="useful-urls">Useful URLs</h1>







  
  






                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Retour en haut de la page
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Stichting The Monitoring Penmasters
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.expand", "navigation.prune", "navigation.path", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.action.view", "content.tags"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": {"index": "tags.md"}, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../js/print-site.js"></script>
      
        <script src="../../../js/print-site.js"></script>
      
        <script src="../../../assets/external/cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../javascripts/tags-data-attr.js?v=8e9f1ef305a011bd82d366c3ef82d26bf85e8ea7"></script>
      
    
    
        
		
		
    

  </body>
</html>