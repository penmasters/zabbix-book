
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A free, community driven online resource to master Zabbix: built to give back, sustain the community, and help you become truly empowered with monitoring.">
      
      
        <meta name="author" content="The Monitoring Penmasters">
      
      
        <link rel="canonical" href="https://thezabbixbook.com/print_page/">
      
      
      
      
        
          <link rel="alternate" href="../fr/ch15-zabbix-real-world-examples/disk-health-windows/" hreflang="fr">
        
          <link rel="alternate" href="../nl/ch15-zabbix-real-world-examples/disk-health-windows/" hreflang="nl">
        
          <link rel="alternate" href="../pt_BR/ch15-zabbix-real-world-examples/disk-health-windows/" hreflang="pt_BR">
        
          <link rel="alternate" href="../ru/ch15-zabbix-real-world-examples/disk-health-windows/" hreflang="ru">
        
          <link rel="alternate" href="../ch15-zabbix-real-world-examples/disk-health-windows/" hreflang="en">
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Print Site - Zabbix Book</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css?v=514f4d1ef40cb7c1bed03bcbf9a447d4f11fa141">
    
      <link rel="stylesheet" href="../stylesheets/linewrap.css">
    
    <script>__md_scope=new URL("/",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
    
    

    <meta property="og:title" content="Print Site">
    <meta property="og:description" content="A free, community driven online resource to master Zabbix: built to give back, sustain the community, and help you become truly empowered with monitoring.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thezabbixbook.com/print_page/">
    <meta property="og:image" content="https://www.thezabbixbook.com/assets/social-card.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Print Site">
    <meta name="twitter:description" content="A free, community driven online resource to master Zabbix: built to give back, sustain the community, and help you become truly empowered with monitoring.">
    <meta name="twitter:image" content="https://www.thezabbixbook.com/assets/social-card.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="627">

  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#index" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
    
    
    
    
    <script>
        const gGMC_SELECT_VERSION = "Select version";
        const gGMC_TRANSLATE_CTA = "";
        const gGMC_PAGE_LOCALE = "";
        const gGMC_FILE_LOCALE = "";
        const gGMC_TRANSLATE_SVG = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.5 12c0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2 0 .37-.03.73-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10C6.47 2 2 6.5 2 12s4.5 10 10 10c.59 0 1.16-.06 1.72-.16A5.9 5.9 0 0 1 13 19c0-.29.03-.57.07-.85-.32.63-.67 1.24-1.07 1.81-.83-1.2-1.5-2.53-1.91-3.96h3.72a5.95 5.95 0 0 1 2.59-2.4c.06-.53.1-1.06.1-1.6M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2zm.82 2H8c.35 1.25.8 2.45 1.4 3.56A8 8 0 0 1 5.08 16M8 8H5.08A7.92 7.92 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m6.34 6H9.66c-.1-.66-.16-1.32-.16-2s.06-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2m.25-9.56c1.84.63 3.37 1.9 4.33 3.56h-2.95a15.7 15.7 0 0 0-1.38-3.56M23 18v2h-3v3h-2v-3h-3v-2h3v-3h2v3z"/></svg>';
    </script>
    
    

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Zabbix Book" class="md-header__button md-logo" aria-label="Zabbix Book" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Zabbix Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Print Site
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../fr/ch15-zabbix-real-world-examples/disk-health-windows/" hreflang="fr" class="md-select__link">
              Fran√ßais
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../nl/ch15-zabbix-real-world-examples/disk-health-windows/" hreflang="nl" class="md-select__link">
              Nederlands
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../pt_BR/ch15-zabbix-real-world-examples/disk-health-windows/" hreflang="pt_BR" class="md-select__link">
              Brazillian Portugese
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../ru/ch15-zabbix-real-world-examples/disk-health-windows/" hreflang="ru" class="md-select__link">
              Russian
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../ch15-zabbix-real-world-examples/disk-health-windows/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/penmasters/zabbix-book" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    penmasters
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Zabbix Book" class="md-nav__button md-logo" aria-label="Zabbix Book" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Zabbix Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/penmasters/zabbix-book" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    penmasters
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guidelines
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Book Tags
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Supporters-Contributors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Supporters and contributors
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch00-getting-started/initial-steps/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch01-zabbix-components/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 01 : Zabbix components and installation
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch02-zabbix-installation/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 02 : Zabbix Frontend
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch03-zabbix-proxies/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 03 : Proxies and Webcomponents
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch04-zabbix-collecting-data/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 04 : Collecting data 
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch05-zabbix-triggers/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 05 : Triggers
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch06-zabbix-templates/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 06 : Templates
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch07-zabbix-alerts/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 07 : Alerting
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch08-zabbix-lld/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 08 : LLD
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch09-zabbix-extending/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 09 : Extending Zabbix
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch10-zabbix-discovery/network-host-discovery/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 10 : Discovery
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch11-zabbix-visualisation/graphs/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 11 : Visualisation
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch12-zabbix-api/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 12 : Zabbix API
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch13-advanced-security/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 13 : Advanced set up and security
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch14-zabbix-maintenance/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 14 : Maintenance
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../ch15-zabbix-real-world-examples/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 15 : Real world examples
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Print Site
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Print Site
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      
        Welcome
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        Guidelines
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tags" class="md-nav__link">
    <span class="md-ellipsis">
      
        Book Tags
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supporters-contributors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Supporters and contributors
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting started
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Getting started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch00-getting-started-initial-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initial steps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch00-getting-started-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch00-getting-started-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Preparing the system for Zabbix
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 01 : Zabbix components and installation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 01 : Zabbix components and installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix components, basic functions and installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-6-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-database" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database choices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-mariadb" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing a MariaDB Database
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-postgresql" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing a PostgreSQL database
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-zabbix-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing the Zabbix server
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-zabbix-frontend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing the frontend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-ha-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        HA Setup
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-7" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 02 : Zabbix Frontend
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 02 : Zabbix Frontend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting started with the Zabbix installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-frontend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frontend explained
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-host-groups" class="md-nav__link">
    <span class="md-ellipsis">
      
        Host Groups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-user-groups" class="md-nav__link">
    <span class="md-ellipsis">
      
        User Groups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-user-roles" class="md-nav__link">
    <span class="md-ellipsis">
      
        User Roles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-7-6" class="md-nav__link">
    <span class="md-ellipsis">
      
        External Authentication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="External Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-http" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-ldap-ad" class="md-nav__link">
    <span class="md-ellipsis">
      
        LDAP / AD
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-saml" class="md-nav__link">
    <span class="md-ellipsis">
      
        SAML
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-mfa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi factor authentication
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-8" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 03 : Proxies and Webcomponents
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 03 : Proxies and Webcomponents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proxies and the Web services component
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-proxy-basics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proxy basics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-active-passive-proxies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active and Passive proxies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-proxies-as-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running Proxies as containers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-proxy-groups" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proxy groups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-web-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Web services
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-9" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 04 : Collecting data 
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 04 : Collecting data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collecting data with your Zabbix environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-dataflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-hosts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hosts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-simple-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simple checks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-host-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      
        Host Interfaces
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-zabbix-agent-passive" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix Agent installation and Passive monitoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-zabbix-agent-active" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix Agent Active monitoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-snmp-polling" class="md-nav__link">
    <span class="md-ellipsis">
      
        SNMP Polling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-snmp-trapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        SNMP Trapping
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-http" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP Items
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Preprocessing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-dependent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dependent items
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-ssh-telnet" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH / Telnet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Script item
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-jmx" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring Java Applications with JMX
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-ipmi" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPMI Monitoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-database-odbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database checks via odbc
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-database-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database checks via agent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-zabbix-trapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix trapper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-external-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        External checks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-browser" class="md-nav__link">
    <span class="md-ellipsis">
      
        Browser item
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-calculated" class="md-nav__link">
    <span class="md-ellipsis">
      
        Calculated items
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 05 : Triggers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 05 : Triggers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch05-zabbix-triggers-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting up triggers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch05-zabbix-triggers-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Triggers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch05-zabbix-triggers-advanced-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced triggers
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-11" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 06 : Templates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 06 : Templates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch06-zabbix-templates-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Building and using templates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch06-zabbix-templates-templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working with templates
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-12" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 07 : Alerting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 07 : Alerting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch07-zabbix-alerts-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sending out alerts with Zabbix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch07-zabbix-alerts-media-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Media types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch07-zabbix-alerts-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scripts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch07-zabbix-alerts-actions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Actions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-13" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 08 : LLD
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 08 : LLD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch08-zabbix-lld-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Low level discovery to automate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch08-zabbix-lld-custom" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom LLD
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch08-zabbix-lld-lld-with-dependent-items" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dependent LLD
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-14" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 09 : Extending Zabbix
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 09 : Extending Zabbix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch09-zabbix-extending-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Leveraging custom items for extending the Zabbix environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch09-zabbix-extending-frontend-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frontend Scripts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch09-zabbix-extending-user-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        User Parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-15" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 10 : Discovery
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 10 : Discovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch10-zabbix-discovery-network-host-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automating adding hosts with network discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch10-zabbix-discovery-active-agent-autoregistration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automating adding hosts with active agent autoregistration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-16" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 11 : Visualisation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 11 : Visualisation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch11-zabbix-visualisation-graphs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using the built-in Graphs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch11-zabbix-visualisation-dashboards" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting up Dashboards
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch11-zabbix-visualisation-maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Maps for better overviews
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch11-zabbix-visualisation-built-in-reports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using the Zabbix built in reports
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch11-zabbix-visualisation-automated-pdf-reports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating automated PDF reports
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-17" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 12 : Zabbix API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 12 : Zabbix API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch12-zabbix-api-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch12-zabbix-api-self-engaging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Self-engaging
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-18" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 13 : Advanced set up and security
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 13 : Advanced set up and security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced set-up and security
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-selinux-zabbix" class="md-nav__link">
    <span class="md-ellipsis">
      
        SELinux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-securing-frontend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Securing the frontend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-agent-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Securing the Zabbix agent with encryption
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-using-vault" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storing secrets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-partitioning-database" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partitioning MariaDB
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-partitioning-postgresql-database" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partitioning PostgreSQL with TimescaleDB
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-19" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 14 : Maintenance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 14 : Maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch14-zabbix-maintenance-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix maintenance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch14-zabbix-maintenance-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        maintenance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch14-zabbix-maintenance-internal-health" class="md-nav__link">
    <span class="md-ellipsis">
      
        Internal health
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch14-zabbix-maintenance-taking-backups" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch14-zabbix-maintenance-upgrades" class="md-nav__link">
    <span class="md-ellipsis">
      
        Upgrades
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-20" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 15 : Real world examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 15 : Real world examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch15-zabbix-real-world-examples-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix real world examples
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch15-zabbix-real-world-examples-disk-health-windows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disk healt on Windows
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      
        Welcome
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        Guidelines
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tags" class="md-nav__link">
    <span class="md-ellipsis">
      
        Book Tags
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supporters-contributors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Supporters and contributors
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting started
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Getting started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch00-getting-started-initial-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initial steps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch00-getting-started-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch00-getting-started-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Preparing the system for Zabbix
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 01 : Zabbix components and installation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 01 : Zabbix components and installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix components, basic functions and installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-6-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-database" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database choices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-mariadb" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing a MariaDB Database
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-postgresql" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing a PostgreSQL database
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-zabbix-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing the Zabbix server
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-zabbix-frontend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing the frontend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch01-zabbix-components-ha-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        HA Setup
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-7" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 02 : Zabbix Frontend
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 02 : Zabbix Frontend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting started with the Zabbix installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-frontend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frontend explained
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-host-groups" class="md-nav__link">
    <span class="md-ellipsis">
      
        Host Groups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-user-groups" class="md-nav__link">
    <span class="md-ellipsis">
      
        User Groups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-user-roles" class="md-nav__link">
    <span class="md-ellipsis">
      
        User Roles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-7-6" class="md-nav__link">
    <span class="md-ellipsis">
      
        External Authentication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="External Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-http" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-ldap-ad" class="md-nav__link">
    <span class="md-ellipsis">
      
        LDAP / AD
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-saml" class="md-nav__link">
    <span class="md-ellipsis">
      
        SAML
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch02-zabbix-installation-mfa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi factor authentication
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-8" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 03 : Proxies and Webcomponents
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 03 : Proxies and Webcomponents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proxies and the Web services component
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-proxy-basics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proxy basics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-active-passive-proxies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Active and Passive proxies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-proxies-as-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running Proxies as containers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-proxy-groups" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proxy groups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch03-zabbix-proxies-web-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Web services
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-9" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 04 : Collecting data 
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 04 : Collecting data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collecting data with your Zabbix environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-dataflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-hosts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hosts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-simple-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simple checks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-host-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      
        Host Interfaces
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-zabbix-agent-passive" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix Agent installation and Passive monitoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-zabbix-agent-active" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix Agent Active monitoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-snmp-polling" class="md-nav__link">
    <span class="md-ellipsis">
      
        SNMP Polling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-snmp-trapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        SNMP Trapping
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-http" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP Items
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Preprocessing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-dependent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dependent items
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-ssh-telnet" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH / Telnet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Script item
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-jmx" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring Java Applications with JMX
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-ipmi" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPMI Monitoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-database-odbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database checks via odbc
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-database-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database checks via agent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-zabbix-trapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix trapper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-external-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        External checks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-browser" class="md-nav__link">
    <span class="md-ellipsis">
      
        Browser item
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch04-zabbix-collecting-data-calculated" class="md-nav__link">
    <span class="md-ellipsis">
      
        Calculated items
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 05 : Triggers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 05 : Triggers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch05-zabbix-triggers-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting up triggers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch05-zabbix-triggers-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Triggers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch05-zabbix-triggers-advanced-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced triggers
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-11" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 06 : Templates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 06 : Templates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch06-zabbix-templates-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Building and using templates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch06-zabbix-templates-templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working with templates
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-12" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 07 : Alerting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 07 : Alerting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch07-zabbix-alerts-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sending out alerts with Zabbix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch07-zabbix-alerts-media-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Media types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch07-zabbix-alerts-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scripts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch07-zabbix-alerts-actions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Actions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-13" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 08 : LLD
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 08 : LLD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch08-zabbix-lld-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Low level discovery to automate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch08-zabbix-lld-custom" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom LLD
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch08-zabbix-lld-lld-with-dependent-items" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dependent LLD
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-14" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 09 : Extending Zabbix
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 09 : Extending Zabbix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch09-zabbix-extending-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Leveraging custom items for extending the Zabbix environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch09-zabbix-extending-frontend-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frontend Scripts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch09-zabbix-extending-user-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        User Parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-15" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 10 : Discovery
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 10 : Discovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch10-zabbix-discovery-network-host-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automating adding hosts with network discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch10-zabbix-discovery-active-agent-autoregistration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automating adding hosts with active agent autoregistration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-16" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 11 : Visualisation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 11 : Visualisation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch11-zabbix-visualisation-graphs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using the built-in Graphs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch11-zabbix-visualisation-dashboards" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting up Dashboards
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch11-zabbix-visualisation-maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Maps for better overviews
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch11-zabbix-visualisation-built-in-reports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using the Zabbix built in reports
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch11-zabbix-visualisation-automated-pdf-reports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating automated PDF reports
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-17" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 12 : Zabbix API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 12 : Zabbix API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch12-zabbix-api-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch12-zabbix-api-self-engaging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Self-engaging
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-18" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 13 : Advanced set up and security
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 13 : Advanced set up and security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced set-up and security
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-selinux-zabbix" class="md-nav__link">
    <span class="md-ellipsis">
      
        SELinux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-securing-frontend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Securing the frontend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-agent-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Securing the Zabbix agent with encryption
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-using-vault" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storing secrets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-partitioning-database" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partitioning MariaDB
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch13-advanced-security-partitioning-postgresql-database" class="md-nav__link">
    <span class="md-ellipsis">
      
        Partitioning PostgreSQL with TimescaleDB
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-19" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 14 : Maintenance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 14 : Maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch14-zabbix-maintenance-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix maintenance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch14-zabbix-maintenance-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        maintenance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch14-zabbix-maintenance-internal-health" class="md-nav__link">
    <span class="md-ellipsis">
      
        Internal health
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch14-zabbix-maintenance-taking-backups" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch14-zabbix-maintenance-upgrades" class="md-nav__link">
    <span class="md-ellipsis">
      
        Upgrades
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-20" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chapter 15 : Real world examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chapter 15 : Real world examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ch15-zabbix-real-world-examples-chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Zabbix real world examples
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ch15-zabbix-real-world-examples-disk-health-windows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disk healt on Windows
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


              
              <article class="md-content__inner md-typeset">
                




                  










<div id="print-site-page" class="print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="6">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="index" heading-number="1"><h1 id="index-welcome">Welcome</h1>
<p>This book is born from a simple desire: <strong>to give back</strong>. After years of
working with Zabbix, and authoring previous many other publications about the platform,
Patrik and Nathan felt a strong pull to share their knowledge in a way that was accessible
to everyone. That's how the initial idea of a free, online Zabbix resource was
conceived ‚Äì <strong>a community-driven project dedicated to empowering users</strong>.</p>
<p>As the online resource grew, so did the vision. We recognized the potential to create
something even more impactful. This led to the formation of a foundation, dedicated
to ensuring the long-term sustainability and growth of this community effort.
This book, a tangible culmination of that vision, represents the next step. All
profits generated from its sales will be reinvested back into the community, enabling
us to further expand and enhance the resources and support we offer. This is more
than just a book; it's a testament to the power of shared knowledge and a commitment
to fostering a thriving Zabbix community."</p>
<h2 id="index-license">License</h2>
<p>Please note: The english version is the primary source document.
Translations are provided for convenience, but this version is considered the
most accurate.</p>
<p>Please before you start take a look at our most updated license : <a href="https://github.com/penmasters/zabbix-book/blob/main/readme.md">License</a>
on Github.</p>
<p><em>The Zabbix Book</em> is a freely accessible resource designed to help users understand
and master Zabbix. Contributions are highly encouraged to improve and expand its
content. However, the book is distributed under the
<strong>Creative Commons Attribution-NonCommercial-ShareAlike 4.0 (CC BY-NC-SA 4.0)</strong>
license, meaning it is free for non-commercial use only.</p>
<p>Contributors should be aware that:</p>
<ul>
<li>By contributing to this work, you irrevocably assign and transfer all rights, title,
and interest in your contributions to <strong>The Monitoring Penmasters Foundation</strong>,
including any associated intellectual property rights, to the fullest extent permitted by law.</li>
<li><strong>The Monitoring Penmasters Foundation</strong> reserves the right to use, reproduce,
modify, distribute, and commercially exploit any contributed material in any form,
including but not limited to the publication of physical and digital books.</li>
<li>All contributors must sign a <strong>Deed of Transfer of Intellectual Property Rights</strong> before making
any contributions, ensuring the proper transfer of rights and handling of the content
by <strong>The Monitoring Penmasters Foundation</strong>. Any contributions without a signed
<strong>Deed of Transfer of Intellectual Property Rights</strong> cannot be accepted.</li>
<li>All profits generated will be used by The Monitoring Penmasters Foundation to cover
operational expenses and to sponsor other open-source projects, as determined by the foundation.</li>
</ul>
<p>Your contributions are invaluable and will help make <em>The Zabbix Book</em> an even greater
resource for the entire community!</p>
<p>Shield: <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="CC BY-NC-SA 4.0" src="https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg" /></a></p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="CC BY-NC-SA 4.0" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" /></a></p></section><section class="print-page" id="guidelines" heading-number="2"><h1 id="guidelines-guidelines">Guidelines</h1>
<h2 id="guidelines-how-to-contribute">How to contribute</h2>
<ul>
<li>Sign the <a href="https://www.thezabbixbook.com/files/form%20deed%20of%20transfer%20Book%20Zabbix.pdf">deed of transfer</a> preferable electronically</li>
<li>Clone this project to your Github account</li>
<li>
<p>Clone the repository to you pc</p>
</li>
<li>
<p>Install the needed software for Mkdocs to work,
  check the file in the root folder how-to-install-mkdocs.md</p>
</li>
<li>Create a new branch to make your changes<ul>
<li>git branch "&lt;your branch name&gt;"</li>
<li>git checkout "&lt;your branch name&gt;"</li>
</ul>
</li>
<li>Make the changes you want and commit them<ul>
<li>git add "files you changed"</li>
<li>git commit -m "add useful commit info"</li>
</ul>
</li>
<li>Return back to the main branch<ul>
<li>git checkout main</li>
</ul>
</li>
<li>Make sure you have the latest changes merged from main<ul>
<li>git pull origin main</li>
</ul>
</li>
<li>Merge your branch into the main branch<ul>
<li>git merge "&lt;your branch name&gt;"</li>
<li>git push</li>
</ul>
</li>
<li>cleanup your branch<ul>
<li>git branch -d "&lt;your branch name&gt;"</li>
</ul>
</li>
<li>Create a pull requests so that we can merge it :)</li>
<li>Follow these <a href="https://github.com/penmasters/zabbix-book/blob/main/how-to-rules-for-writing.md">guidelines</a> when you write a topic.</li>
</ul></section><section class="print-page" id="tags" heading-number="3"><h1 id="tags-tags">Tags</h1>
<p>Use tags to quickly browse per level.</p>
<ul>
<li><strong>beginner</strong> ‚Äî Assumes no or minimal prior Zabbix knowledge. Covers basic concepts, installation, simple use cases.</li>
<li><strong>advanced</strong> ‚Äî Assumes the reader is comfortable with core Zabbix features and configurations; covers more involved setups, integrations, intermediate complexity.</li>
<li><strong>expert</strong> ‚Äî Covers high-end topics: scaling, HA, deep performance tuning, custom extensions, edge cases, complex architectures, security hardening.</li>
</ul>
<h6 id="tags-tags.md:482-504/slug">tags.md:482-504/name</h6></section><section class="print-page" id="supporters-contributors" heading-number="4"><h1 id="supporters-contributors-supporters-contributors">Supporters &amp; Contributors</h1>
<p>This book would not have been possible without the dedication, generosity, and
expertise of many individuals and organizations. We extend our heartfelt thanks
to everyone who has supported this project, whether through financial contributions,
technical expertise, content reviews, or community engagement.</p>
<h2 id="supporters-contributors-our-sponsors">Our Sponsors</h2>
<p>We are deeply grateful to the sponsors who have provided financial or material
support to help bring this book to life. Their contributions have enabled us to
maintain high-quality content, support open-source initiatives, and ensure that
this book remains accessible to as many people as possible.</p>
<ul>
<li><strong>OICTS</strong> : <a href="https://oicts.com/">https://oicts.com/</a></li>
<li><strong>ZABBIX</strong> : <a href="https://www.zabbix.com/">https://www.zabbix.com/</a></li>
</ul>
<hr />
<h2 id="supporters-contributors-our-contributors">Our Contributors</h2>
<p>This book is a community effort, and we sincerely appreciate the time and knowledge
shared by our contributors. From writing and reviewing content to providing feedback
and sharing expertise, your efforts have helped shape this resource into something
valuable for the monitoring and open-source communities.</p>
<ul>
<li><strong>Patrik Uytterhoeven</strong> : <a href="http://github.com/Trikke76">http://github.com/Trikke76</a></li>
<li><strong>Nathan Liefting</strong> : <a href="https://github.com/larcorba">https://github.com/larcorba</a></li>
<li>Evgeny Yurchenko: <a href="https://github.com/BGmot">https://github.com/BGmot</a></li>
<li>Nikolas Garofil: <a href="https://github.com/ngaro">https://github.com/ngaro</a></li>
<li>Aigars Kadikis : <a href="https://github.com/aigarskadikis">https://github.com/aigarskadikis</a></li>
<li>Giedrius Stasiulionis : <a href="https://github.com/b1nary1">https://github.com/b1nary1</a></li>
<li>Leonardo Cardoso: <a href="https://github.com/leocardosoo">https://github.com/leocardosoo</a></li>
<li>Robin Roevens: <a href="https://github.com/RobinR1">https://github.com/RobinR1</a></li>
</ul>
<p>A list of all the contributors who where so kind to fix typos etc .. can be found here :
<a href="https://github.com/penmasters/zabbix-book/graphs/contributors">https://github.com/penmasters/zabbix-book/graphs/contributors</a></p>
<h3 id="supporters-contributors-translators">Translators</h3>
<ul>
<li>Nicolas Hermel : <a href="https://github.com/wityender">https://github.com/wityender</a></li>
<li>Dimitry Q : <a href="https://github.com/krotesk">https://github.com/krotesk</a></li>
<li>Leonardo Cardoso: <a href="https://github.com/leocardosoo">https://github.com/leocardosoo</a></li>
</ul>
<hr />
<h2 id="supporters-contributors-special-thanks-to-our-board-members">Special Thanks to Our Board Members</h2>
<p>A special acknowledgment goes to the members of our board, whose vision, leadership,
and dedication have guided this project from its inception. Their commitment to
open-source principles and knowledge sharing has been instrumental in making this
book a reality.</p>
<ul>
<li><strong>Patrik Uytterhoeven</strong> : http://github.com/Trikke76</li>
<li><strong>Nathan Liefting</strong> : https://github.com/larcorba</li>
<li><strong>Alexei Vladishev</strong> :</li>
</ul>
<hr />
<h2 id="supporters-contributors-every-contribution-matters">Every Contribution Matters</h2>
<p>Open-source thrives on collaboration, and even the smallest contributions help
make a difference. Whether it was reporting a typo, suggesting an improvement,
opening an issue, or simply sharing feedback, we appreciate everyone who took
the time to help refine and improve this book. Your efforts, no matter how small,
are a valuable part of this project. Check out <a href="https://github.com/penmasters/zabbix-book/issues?q=is%3Aissue%20">Everyone who created an issue</a>.</p>
<hr />
<h2 id="supporters-contributors-join-the-community">Join the Community</h2>
<p>We welcome new contributors and supporters! If you'd like to get involved whether
by contributing content, providing feedback, or supporting this initiative you can
find more details on how to participate at <a href="#guidelines">Guidelines</a>.</p>
<p>Thank you for being part of this journey and helping us build a valuable resource
for the open-source community!</p></section>
                    <section class='print-page md-section' id='section-5' heading-number='5'>
                        <h1>Getting started<a class='headerlink' href='#section-5' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch00-getting-started-initial-steps" heading-number="5.1"><h1 id="ch00-getting-started-initial-steps-getting-started-with-zabbix-unlocking-the-power-of-monitoring">Getting Started with Zabbix ‚Äì Unlocking the Power of Monitoring</h1>
<p>Welcome to the world of <strong>Zabbix</strong>, a powerful open-source monitoring solution
designed to give you comprehensive insights into your IT infrastructure.
Whether you're managing a small network or overseeing a large-scale enterprise
system, Zabbix provides the tools you need to monitor performance, detect issues,
and ensure the smooth operation of your services.</p>
<p>In this book, we focus on <strong>Zabbix LTS 8.0</strong>, the long-term support version that
ensures stability and reliability for your monitoring needs. We'll explore its
extensive feature set, including the newly introduced <strong>reporting functionality</strong>
and <strong>built-in web monitoring</strong> based on the Selenium driver, which allows for
sophisticated end-user experience monitoring through automated browser interactions.</p>
<p>Zabbix is more than just a simple monitoring tool. It offers a wide range of
features that allow you to:</p>
<ul>
<li><strong>Monitor diverse environments</strong>: Track the performance and availability of
servers, virtual machines, network devices, databases, and applications.</li>
<li><strong>Create dynamic visualizations</strong>: Use dashboards, graphs, maps, and screens
to visualize data and get an overview of your system's health at a glance.</li>
<li><strong>Set up complex alerting mechanisms</strong>: Define triggers and actions that notify
you of potential issues before they become critical, using various channels
like email, SMS, and integrations with external services.</li>
<li><strong>Automate monitoring tasks</strong>: Leverage auto-discovery and auto-registration to
keep up with changing environments without manual intervention.</li>
<li><strong>Customize and extend</strong>: Build custom scripts, templates, and integrations to
tailor Zabbix to your specific needs.</li>
</ul></section><section class="print-page" id="ch00-getting-started-requirements" heading-number="5.2"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="system-requirements">System Requirements</h1>
<h2 id="ch00-getting-started-requirements-requirements">Requirements</h2>
<p>Zabbix has specific hardware and software requirements that must be met,
and these requirements may change over time. They also depend on the size of your
setup and the software stack you select.
Before purchasing hardware or installing a database version, it's essential to
consult the Zabbix documentation for the most up-to-date requirements for the
version you plan to install.
You can find the latest requirements <a href="https://www.zabbix.com/documentation/current/en/manual/installation/requirements">https://www.zabbix.com/documentation/current/en/manual/installation/requirements</a>.
Make sure to select the correct Zabbix version from the list.</p>
<p>For smaller or test setups, Zabbix can comfortably run on a system with 2 CPUs
and 8 GB of RAM. However, your setup size, the number of items you monitor,
the triggers you create, and how long you plan to retain data will impact
resource requirements.
In today's virtualised environments, my advice is to start small and scale up
as needed.</p>
<p>You can install all components (Zabbix server, database, web server) on a single
machine or distribute them across multiple servers.
For simplicity, take note of the server details:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">IP Address</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Zabbix Server</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Database Server</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Web Server</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Zabbix package names often use dashes (<code>-</code>) in their names, such as <code>zabbix-get</code>
or <code>zabbix-sender</code>, but the binaries themselves may use underscores (<code>_</code>),
like <code>zabbix_sender</code> or <code>zabbix_server</code>. This naming discrepancy can sometimes
be confusing, particularly if you are using packages from non-official Zabbix
repositories.</p>
<p>Always check if a binary uses a dash or an underscore when troubleshooting.</p>
</details>
<details class="warning" open="open">
<summary>Warning</summary>
<p>Starting from Zabbix 7.2, only MySQL (including its forks) and PostgreSQL are
supported as back-end databases. Earlier versions of Zabbix also included support
for Oracle Database; however, this support was discontinued with Zabbix 7.0 LTS,
making it the last LTS version to officially support Oracle DB.</p>
</details>
<hr />
<h2 id="ch00-getting-started-requirements-basic-os-configuration">Basic OS Configuration</h2>
<p>Operating systems, so many choices, each with its own advantages and loyal user base.
While Zabbix can be installed on a wide range of platforms, documenting the process
for every available OS would be impractical. To keep this book focused and efficient,
we have chosen to cover only the most widely used options: Ubuntu, Red Hat and Suse 
based distributions.</p>
<p>Since not everyone has access to a Red Hat Enterprise Linux (RHEL) or a SUSE Linux
Enterprise Server (SLES) subscription even though a developer account provides limited 
access we have opted for Rocky Linux respectively openSUSE Leap as a readily available
alternative. For this book, we will be using Rocky Linux 9.x, openSUSE Leap 16 and
Ubuntu LTS 24.04.x.</p>
<ul>
<li><a href="https://rockylinux.org/">https://rockylinux.org/</a></li>
<li><a href="https://opensuse.org/">https://opensuse.org/</a></li>
<li><a href="https://ubuntu.com/">https://ubuntu.com/</a></li>
</ul>
<details class="note" open="open">
<summary>Note</summary>
<p>OS installation steps are outside the scope of this book, but a default or even a
minimal installation of your preferred OS should be sufficient. Please refrain from
installing graphical user interfaces (GUIs) or desktop environments, as they are
unnecessary for server setups and consume valuable resources.</p>
</details>
<p>Once you have your preferred OS installed, there are a few essential configurations
to perform before proceeding with the Zabbix installation. Perform the following
steps on <strong>all</strong> the servers that will host Zabbix components (i.e., Zabbix server, 
database server, and web server).</p>
<hr />
<h3 id="ch00-getting-started-requirements-update-the-system">Update the System</h3>
<p>Before installing the Zabbix components, or any new software, it's a best practice to ensure
your operating system is up-to-date with the latest patches and security fixes.
This will help maintain system stability and compatibility with the software you're
about to install.
Even if your OS installation is recent, it's still advisable to run an update
to ensure you have the latest packages.</p>
<p>To update your system, run the following command based on your OS:</p>
<div class="admonition info">
<p class="admonition-title">Update your system</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch00-getting-started-requirements-__codelineno-0-1"></a>dnf<span class="w"> </span>update
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch00-getting-started-requirements-__codelineno-1-1"></a>zypper<span class="w"> </span>refresh
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch00-getting-started-requirements-__codelineno-1-2"></a>zypper<span class="w"> </span>update
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch00-getting-started-requirements-__codelineno-2-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch00-getting-started-requirements-__codelineno-2-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>upgrade
</span></code></pre></div></p>
</div>
<details class="note" open="open">
<summary>What is apt, dnf or zypper</summary>
<ul>
<li>DNF (Dandified YUM) is a package manager used in recent Red Hat-based systems (invoked as <code>dnf</code>).</li>
<li>ZYpp (Zen / YaST Packages Patches Patterns Products) is the package manager 
used on SUSE-based systems (invoked as <code>zypper</code>) and </li>
<li>APT (Advanced Package Tool) is the package manager used on Debian/Ubuntu-based systems (invoked as <code>apt</code>). </li>
</ul>
<p>If you're using another distribution, replace <code>dnf</code>/<code>zypper</code>/<code>apt</code> with your appropriate 
package manager, such as <code>yum</code>, <code>pacman</code>, <code>emerge</code>, <code>apk</code> or ... .</p>
<p>Do note that package names may also vary from distribution to distribution.</p>
</details>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Regularly updating your system is crucial for security and performance.
Consider setting up automatic updates or scheduling regular maintenance windows
to keep your systems current.</p>
</details>
<hr />
<h3 id="ch00-getting-started-requirements-sudo">Sudo</h3>
<p>By default the Zabbix processes like the Zabbix server and agent run under their
own unprivileged user accounts (e.g., <code>zabbix</code>). However, there are scenarios where
elevated privileges are required, such as executing custom scripts or commands
that need root access.
Also throughout this book, we will perform certain administrative tasks that
require <code>sudo</code> on the system.</p>
<p>Usually, <code>sudo</code> is already present on most systems, but when you performed
a minimal installation of your OS, it might be missing. Therefore we need to
ensure it's installed.</p>
<p>This will also allow the Zabbix user to execute specific configured commands
with elevated privileges without needing to switch to the root user entirely.</p>
<div class="admonition info">
<p class="admonition-title">What is sudo</p>
<p><code>sudo</code> (short for "superuser do") is a command-line utility that allows
permitted users to execute commands with the security privileges of another
user, typically the superuser (root). It is commonly used in Unix-like
operating systems to perform administrative tasks without needing to log in
as the root user.</p>
</div>
<p>To install <code>sudo</code>, run the following command based on your OS:</p>
<div class="admonition info">
<p class="admonition-title">Install sudo</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch00-getting-started-requirements-__codelineno-3-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>sudo
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch00-getting-started-requirements-__codelineno-4-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>sudo
</span></code></pre></div></p>
<p>Ubuntu</p>
<p>On Ubuntu, <code>sudo</code> is normally installed by default. Root access is managed
through <code>sudo</code> for the initial user created during installation.</p>
</div>
<p>If <code>sudo</code> is already installed, these commands will inform you that the latest version
is already present and no further action is needed. If not, the package manager
will proceed to install it.</p>
<hr />
<h3 id="ch00-getting-started-requirements-firewall">Firewall</h3>
<p>Next, we need to ensure that the firewall is installed and configured. 
A firewall is a crucial security component that helps protect your server
from unauthorized access and potential threats by controlling incoming and
outgoing network traffic based on predetermined security rules.</p>
<p>To install and enable the firewall, run the following command:</p>
<div class="admonition info">
<p class="admonition-title">Install and enable the firewall</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch00-getting-started-requirements-__codelineno-5-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>firewalld
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch00-getting-started-requirements-__codelineno-5-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>firewalld<span class="w"> </span>--now
</span></code></pre></div>
SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch00-getting-started-requirements-__codelineno-6-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>firewalld
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch00-getting-started-requirements-__codelineno-6-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>firewalld<span class="w"> </span>--now
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch00-getting-started-requirements-__codelineno-7-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ufw
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch00-getting-started-requirements-__codelineno-7-2"></a>sudo<span class="w"> </span>ufw<span class="w"> </span><span class="nb">enable</span>
</span></code></pre></div></p>
</div>
<details class="note" open="open">
<summary>What is firewalld / ufw</summary>
<p>Firewalld is the replacement for iptables in RHEL- and SUSE-based systems and allows
changes to take effect immediately without needing to restart the service.
If your distribution does not use <a href="https://www.firewalld.org">Firewalld</a>,
refer to your OS documentation for the appropriate firewall configuration steps.
Ubuntu makes use of UFW which is merely a frontend for iptables.</p>
</details>
<p>During the Zabbix installation in the next chapters, we will need to open specific
ports in the firewall to allow communication between Zabbix components.</p>
<p>Alternatively to just opening ports, as we will do in the next chapters, you can
also choose to define dedicated firewall zones for specific use cases. This 
approach enhances security by isolating services and restricting access based on
trust levels.
For example...</p>
<div class="admonition example">
<p class="admonition-title">Create a firewalld zone for database access</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch00-getting-started-requirements-__codelineno-8-1"></a>firewall-cmd<span class="w"> </span>--new-zone<span class="o">=</span>db_zone<span class="w"> </span>--permanent
</span></code></pre></div>
</div>
<p>You can confirm the creation of the zone by executing the following command:</p>
<div class="admonition example">
<p class="admonition-title">Verify the zone creation</p>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch00-getting-started-requirements-__codelineno-9-1"></a><span class="gp">localhost:~ # </span>firewall-cmd<span class="w"> </span>--get-zones
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ch00-getting-started-requirements-__codelineno-9-2"></a><span class="go">block dmz drop external home internal nm-shared db_zone public trusted work</span>
</span></code></pre></div>
</div>
<p>Using zones in firewalld to configure firewall rules provides several
advantages in terms of security, flexibility, and ease of management.
Here‚Äôs why zones are beneficial:</p>
<ul>
<li><strong>Granular Access Control :</strong></li>
</ul>
<dl>
<dd>Firewalld zones allow different levels of trust for different network interfaces
and IP ranges. You can define which systems are allowed to connect to PostgreSQL
based on their trust level.</dd>
</dl>
<ul>
<li><strong>Simplified Rule management:</strong></li>
</ul>
<dl>
<dd>Instead of manually defining complex iptables rules, zones provide an organized
way to group and manage firewall rules based on usage scenarios.</dd>
</dl>
<ul>
<li><strong>Enhanced security:</strong></li>
</ul>
<dl>
<dd>By restricting application access to a specific zone, you prevent unauthorized
connections from other interfaces or networks.</dd>
</dl>
<ul>
<li><strong>Dynamic configuration:</strong></li>
</ul>
<dl>
<dd>Firewalld supports runtime and permanent rule configurations, allowing changes
without disrupting existing connections.</dd>
</dl>
<ul>
<li><strong>Multi-Interface support:</strong></li>
</ul>
<dl>
<dd>If the server has multiple network interfaces, zones allow different security
policies for each interface.</dd>
</dl>
<p>Bringing everything together to add a zone for, in this example, PostgreSQL it
would look like this:</p>
<div class="admonition example">
<p class="admonition-title">Firewalld with zone config for PostgreSQL database access</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch00-getting-started-requirements-__codelineno-10-1"></a>firewall-cmd<span class="w"> </span>--new-zone<span class="o">=</span>db_zone<span class="w"> </span>--permanent
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch00-getting-started-requirements-__codelineno-10-2"></a>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>db_zone<span class="w"> </span>--add-service<span class="o">=</span>postgresql<span class="w"> </span>--permanent
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ch00-getting-started-requirements-__codelineno-10-3"></a>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>db_zone<span class="w"> </span>--add-source<span class="o">=</span>xxx.xxx.xxx.xxx/32<span class="w"> </span>--permanent
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ch00-getting-started-requirements-__codelineno-10-4"></a>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div>
</div>
<p>Where the <code>source IP</code> is the only address permitted to establish a connection to
the database.</p>
<p>If you wish to use zones when using firewalld, ensure to adapt the instructions
in the following chapters accordingly.</p>
<hr />
<h3 id="ch00-getting-started-requirements-time-server">Time Server</h3>
<p>Another crucial step is configuring the time server and syncing the Zabbix server
using an NTP client.
Accurate time synchronization is vital for Zabbix, both for the server and the
devices it monitors.
If one of the hosts has an incorrect time zone, it could lead to confusion, such
as investigating an issue in Zabbix that appears to have happened hours earlier
than it actually did.</p>
<p>To install and enable chrony, our NTP client, use the following command:</p>
<div class="admonition info">
<p class="admonition-title">Install NTP client</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch00-getting-started-requirements-__codelineno-11-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>chrony
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ch00-getting-started-requirements-__codelineno-11-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>chronyd<span class="w"> </span>--now
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch00-getting-started-requirements-__codelineno-12-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>chrony
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ch00-getting-started-requirements-__codelineno-12-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>chronyd<span class="w"> </span>--now
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch00-getting-started-requirements-__codelineno-13-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>chrony
</span></code></pre></div></p>
</div>
<p>After installation, verify that Chrony is enabled and running by checking its
status with the following command:</p>
<div class="admonition info">
<p class="admonition-title">Check status chronyd</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch00-getting-started-requirements-__codelineno-14-1"></a>systemctl<span class="w"> </span>status<span class="w"> </span>chronyd
</span></code></pre></div>
</div>
<details class="note" open="open">
<summary>what is Chrony</summary>
<p>Chrony is a modern replacement for <code>ntpd</code>, offering faster and
more accurate time synchronization. If your OS does not support
<a href="https://chrony-project.org/">Chrony</a>, consider using
<code>ntpd</code> instead.</p>
</details>
<p>Once Chrony is installed, the next step is to ensure the correct time zone is set.
You can view your current time configuration using the <code>timedatectl</code> command:</p>
<div class="admonition example">
<p class="admonition-title">Check the time config</p>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch00-getting-started-requirements-__codelineno-15-1"></a><span class="gp">localhost:~ # </span>timedatectl
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#ch00-getting-started-requirements-__codelineno-15-2"></a><span class="go">               Local time: Thu 2023-11-16 15:09:14 UTC</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#ch00-getting-started-requirements-__codelineno-15-3"></a><span class="go">           Universal time: Thu 2023-11-16 15:09:14 UTC</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#ch00-getting-started-requirements-__codelineno-15-4"></a><span class="go">                 RTC time: Thu 2023-11-16 15:09:15</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#ch00-getting-started-requirements-__codelineno-15-5"></a><span class="go">                Time zone: UTC (UTC, +0000)</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#ch00-getting-started-requirements-__codelineno-15-6"></a><span class="go">System clock synchronized: yes</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#ch00-getting-started-requirements-__codelineno-15-7"></a><span class="go">              NTP service: active</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#ch00-getting-started-requirements-__codelineno-15-8"></a><span class="go">          RTC in local TZ: no</span>
</span></code></pre></div>
</div>
<p>Ensure that the Chrony service is active (refer to the previous steps if needed).
To set the correct time zone, first, you can list all available time zones with
the following command:</p>
<div class="admonition info">
<p class="admonition-title">List the timezones</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch00-getting-started-requirements-__codelineno-16-1"></a>timedatectl<span class="w"> </span>list-timezones
</span></code></pre></div>
</div>
<p>This command will display a list of available time zones, allowing you to select
the one closest to your location. For example:</p>
<div class="admonition example">
<p class="admonition-title">List of all the timezones available</p>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch00-getting-started-requirements-__codelineno-17-1"></a><span class="gp">localhost:~ # </span>timedatectl<span class="w"> </span>list-timezones
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#ch00-getting-started-requirements-__codelineno-17-2"></a><span class="go">Africa/Abidjan</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#ch00-getting-started-requirements-__codelineno-17-3"></a><span class="go">Africa/Accra</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#ch00-getting-started-requirements-__codelineno-17-4"></a><span class="go">...</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#ch00-getting-started-requirements-__codelineno-17-5"></a><span class="go">Pacific/Tongatapu</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#ch00-getting-started-requirements-__codelineno-17-6"></a><span class="go">Pacific/Wake</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#ch00-getting-started-requirements-__codelineno-17-7"></a><span class="go">Pacific/Wallis</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#ch00-getting-started-requirements-__codelineno-17-8"></a><span class="go">UTC</span>
</span></code></pre></div>
</div>
<p>Once you've identified your time zone, configure it using the following command:</p>
<div class="admonition info">
<p class="admonition-title">Set the timezone</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch00-getting-started-requirements-__codelineno-18-1"></a>timedatectl<span class="w"> </span>set-timezone<span class="w"> </span>Europe/Brussels
</span></code></pre></div>
</div>
<p>To verify that the time zone has been configured correctly, use the <code>timedatectl</code>
command again:</p>
<div class="admonition example">
<p class="admonition-title">Check the time and zone</p>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch00-getting-started-requirements-__codelineno-19-1"></a><span class="gp">localhost:~ # </span>timedatectl
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#ch00-getting-started-requirements-__codelineno-19-2"></a><span class="go">               Local time: Thu 2023-11-16 16:13:35 CET</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#ch00-getting-started-requirements-__codelineno-19-3"></a><span class="go">           Universal time: Thu 2023-11-16 15:13:35 UTC</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#ch00-getting-started-requirements-__codelineno-19-4"></a><span class="go">                 RTC time: Thu 2023-11-16 15:13:36</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#ch00-getting-started-requirements-__codelineno-19-5"></a><span class="go">                Time zone: Europe/Brussels (CET, +0100)</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#ch00-getting-started-requirements-__codelineno-19-6"></a><span class="go">System clock synchronized: yes</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#ch00-getting-started-requirements-__codelineno-19-7"></a><span class="go">              NTP service: active</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#ch00-getting-started-requirements-__codelineno-19-8"></a><span class="go">          RTC in local TZ: no</span>
</span></code></pre></div>
</div>
<details class="note" open="open">
<summary>Note</summary>
<p>Some administrators prefer installing all servers in the UTC time zone to
ensure that server logs across global deployments are synchronized.
Zabbix supports user-based time zone settings, which allows the server to
remain in UTC while individual users can adjust the time zone via the
interface if needed.</p>
</details>
<hr />
<h4 id="ch00-getting-started-requirements-verifying-chrony-synchronization">Verifying Chrony Synchronization</h4>
<p>To ensure that Chrony is synchronizing with the correct time servers, you can
run the following command:</p>
<div class="admonition info">
<p class="admonition-title">Verify chrony</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch00-getting-started-requirements-__codelineno-20-1"></a>chronyc
</span></code></pre></div>
</div>
<p>The output should resemble:</p>
<div class="admonition example">
<p class="admonition-title">Verify your chrony output</p>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch00-getting-started-requirements-__codelineno-21-1"></a><span class="gp">localhost:~ # </span>chronyc
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#ch00-getting-started-requirements-__codelineno-21-2"></a><span class="go">chrony version 4.2</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#ch00-getting-started-requirements-__codelineno-21-3"></a><span class="go">Copyright (C) 1997-2003, 2007, 2009-2021 Richard P. Curnow and others</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#ch00-getting-started-requirements-__codelineno-21-4"></a><span class="go">chrony comes with ABSOLUTELY NO WARRANTY. This is free software, and</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#ch00-getting-started-requirements-__codelineno-21-5"></a><span class="go">you are welcome to redistribute it under certain conditions. See the</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#ch00-getting-started-requirements-__codelineno-21-6"></a><span class="go">GNU General Public License version 2 for details.</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#ch00-getting-started-requirements-__codelineno-21-7"></a>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#ch00-getting-started-requirements-__codelineno-21-8"></a><span class="go">chronyc&gt;</span>
</span></code></pre></div>
</div>
<p>Once inside the Chrony prompt, type the <code>sources</code> command  to check the used time sources:</p>
<p>Example output:</p>
<div class="admonition example">
<p class="admonition-title">Check your time server sources</p>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch00-getting-started-requirements-__codelineno-22-1"></a><span class="go">chronyc&gt; sources</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#ch00-getting-started-requirements-__codelineno-22-2"></a><span class="go">MS Name/IP address         Stratum Poll Reach LastRx Last sample</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#ch00-getting-started-requirements-__codelineno-22-3"></a><span class="go">===============================================================================</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#ch00-getting-started-requirements-__codelineno-22-4"></a><span class="go">^- 51-15-20-83.rev.poneytel&gt;     2   9   377   354   +429us[ +429us] +/-  342ms</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#ch00-getting-started-requirements-__codelineno-22-5"></a><span class="go">^- 5.255.99.180                  2  10   377   620  +7424us[+7424us] +/-   37ms</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#ch00-getting-started-requirements-__codelineno-22-6"></a><span class="go">^- hachi.paina.net               2  10   377   412   +445us[ +445us] +/-   39ms</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#ch00-getting-started-requirements-__codelineno-22-7"></a><span class="go">^* leontp1.office.panq.nl        1  10   377   904  +6806ns[ +171us] +/- 2336us</span>
</span></code></pre></div>
</div>
<p>In this example, the NTP servers in use are located outside your local region.
It is recommended to switch to time servers in your country or, if available,
to a dedicated company time server. You can find local NTP servers here:
<a href="https://www.ntppool.org/">www.ntppool.org</a>.</p>
<hr />
<h4 id="ch00-getting-started-requirements-updating-time-servers">Updating Time Servers</h4>
<p>To update the time servers, modify the Chrony configuration file:</p>
<div class="admonition info">
<p class="admonition-title">Edit chrony config file</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ch00-getting-started-requirements-__codelineno-23-1"></a>vi<span class="w"> </span>/etc/chrony.conf
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ch00-getting-started-requirements-__codelineno-24-1"></a>vi<span class="w"> </span>/etc/chrony.d/pool.conf
</span></code></pre></div>
On SUSE, the pool configuration is located in a separate file. You can
edit that file directly or add a new configuration file in the same directory.
In the latter case, ensure to disable or remove the existing pool configuration
to avoid conflicts.</p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ch00-getting-started-requirements-__codelineno-25-1"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/chrony/chrony.conf
</span></code></pre></div></p>
</div>
<p>Replace the existing NTP server pool with one closer to your location.</p>
<p>Example of the current configuration:</p>
<div class="admonition example">
<p class="admonition-title">Example ntp pool config</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ch00-getting-started-requirements-__codelineno-26-1"></a># Use public servers from the pool.ntp.org project.
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#ch00-getting-started-requirements-__codelineno-26-2"></a># Please consider joining the pool (http://www.pool.ntp.org/join.html).
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#ch00-getting-started-requirements-__codelineno-26-3"></a>pool 2.centos.pool.ntp.org iburst
</span></code></pre></div>
</div>
<p>Change the pools you want to a local time server:</p>
<div class="admonition info">
<p class="admonition-title">Change ntp pool config</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#ch00-getting-started-requirements-__codelineno-27-1"></a># Use public servers from the pool.ntp.org project.
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#ch00-getting-started-requirements-__codelineno-27-2"></a># Please consider joining the pool (http://www.pool.ntp.org/join.html).
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#ch00-getting-started-requirements-__codelineno-27-3"></a>pool be.pool.ntp.org iburst
</span></code></pre></div>
</div>
<p>After making this change, restart the Chrony service to apply the new configuration:</p>
<div class="admonition info">
<p class="admonition-title">Restart the chrony service</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#ch00-getting-started-requirements-__codelineno-28-1"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>chronyd
</span></code></pre></div>
</div>
<h4 id="ch00-getting-started-requirements-verifying-updated-time-servers">Verifying Updated Time Servers</h4>
<p>Check the time sources again to ensure that the new local servers are in use:</p>
<div class="admonition info">
<p class="admonition-title">Check chrony sources</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#ch00-getting-started-requirements-__codelineno-29-1"></a>chronyc&gt; sources
</span></code></pre></div>
</div>
<p>Example of expected output with local servers:</p>
<div class="admonition example">
<p class="admonition-title">Example output</p>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#ch00-getting-started-requirements-__codelineno-30-1"></a><span class="go">chronyc&gt; sources</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#ch00-getting-started-requirements-__codelineno-30-2"></a><span class="go">MS Name/IP address         Stratum Poll Reach LastRx Last sample</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#ch00-getting-started-requirements-__codelineno-30-3"></a><span class="go">===============================================================================</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#ch00-getting-started-requirements-__codelineno-30-4"></a><span class="go">^- ntp1.unix-solutions.be        2   6    17    43   -375us[ -676us] +/-   28ms</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#ch00-getting-started-requirements-__codelineno-30-5"></a><span class="go">^* ntp.devrandom.be              2   6    17    43   -579us[ -880us] +/- 2877us</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#ch00-getting-started-requirements-__codelineno-30-6"></a><span class="go">^+ time.cloudflare.com           3   6    17    43   +328us[  +27us] +/- 2620us</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#ch00-getting-started-requirements-__codelineno-30-7"></a><span class="go">^+ time.cloudflare.com           3   6    17    43</span>
</span></code></pre></div>
</div>
<p>This confirms that the system is now using local time servers.</p>
<h2 id="ch00-getting-started-requirements-conclusion">Conclusion</h2>
<p>As we have seen, before even considering the Zabbix packages, attention must be
paid to the environment in which it will reside. A properly configured and up-to-date operating
system, an open path through the firewall, and accurate timekeeping are not mere
suggestions, but essential building blocks. Having laid this groundwork, we can
now proceed with confidence to the Zabbix installation, knowing that the underlying
system is prepared for the task.</p>
<h2 id="ch00-getting-started-requirements-questions">Questions</h2>
<ul>
<li>Why do you think accurate time synchronization is so crucial for a monitoring
  system like Zabbix?</li>
<li>Now that the groundwork is laid, what do you anticipate will be the first step
  in the actual Zabbix installation process?</li>
<li>As we move towards installing Zabbix, let's think about network communication.
  What key ports do you anticipate needing to allow through the firewall for the
  Zabbix server and agents to interact effectively?</li>
</ul>
<h2 id="ch00-getting-started-requirements-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.ntppool.org/zone">https://www.ntppool.org/zone</a></li>
<li><a href="https://www.redhat.com/en/blog/beginners-guide-firewalld">https://www.redhat.com/en/blog/beginners-guide-firewalld</a></li>
<li><a href="https://www.linuxjournal.com/content/understanding-firewalld-multi-zone-configurations">https://www.linuxjournal.com/content/understanding-firewalld-multi-zone-configurations</a></li>
</ul></section><section class="print-page" id="ch00-getting-started-preparation" heading-number="5.3"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="preparing-the-system-for-zabbix">Preparing the system for Zabbix</h1>
<p>Before installing any Zabbix component, we need to ensure that the server(s)
meet the configuration requirements outlined in the previous section: <a href="#ch00-getting-started-requirements">System Requirements</a>.</p>
<p>If you plan to install the Zabbix database, server and/or frontend on separate 
machines, prepare each server individually according to the instructions provided
here. Also servers that will host a Zabbix Proxy, need to be prepared in the same
way.</p>
<hr />
<h2 id="ch00-getting-started-preparation-disable-selinux-on-rhel">Disable SELinux on RHEL</h2>
<p>Another critical step at this stage if you use Red Hat based systems is disabling
SELinux, which can interfere with the installation and operation of Zabbix.
We will revisit SELinux at the end of this chapter once our installation is finished.</p>
<p>To check the current status of SELinux, you can use the following command: `sestatus``</p>
<div class="admonition info">
<p class="admonition-title">Selinux status</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch00-getting-started-preparation-__codelineno-0-1"></a><span class="go">~# sestatus</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch00-getting-started-preparation-__codelineno-0-2"></a><span class="go">SELinux status:                 enabled</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch00-getting-started-preparation-__codelineno-0-3"></a><span class="go">SELinuxfs mount:                /sys/fs/selinux</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch00-getting-started-preparation-__codelineno-0-4"></a><span class="go">SELinux root directory:         /etc/selinux</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch00-getting-started-preparation-__codelineno-0-5"></a><span class="go">Loaded policy name:             targeted</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch00-getting-started-preparation-__codelineno-0-6"></a><span class="go">Current mode:                   enforcing</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch00-getting-started-preparation-__codelineno-0-7"></a><span class="go">Mode from config file:          enforcing</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch00-getting-started-preparation-__codelineno-0-8"></a><span class="go">Policy MLS status:              enabled</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch00-getting-started-preparation-__codelineno-0-9"></a><span class="go">Policy deny_unknown status:     allowed</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ch00-getting-started-preparation-__codelineno-0-10"></a><span class="go">Memory protection checking:     actual (secure)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ch00-getting-started-preparation-__codelineno-0-11"></a><span class="go">Max kernel policy version:      33</span>
</span></code></pre></div>
</div>
<p>As shown, the system is currently in enforcing mode. To temporarily disable SELinux,
you can run the following command: <code>setenforce 0</code></p>
<div class="admonition info">
<p class="admonition-title">Disable SeLinux</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch00-getting-started-preparation-__codelineno-1-1"></a><span class="go">~# setenforce 0</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch00-getting-started-preparation-__codelineno-1-2"></a><span class="go">~# sestatus</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch00-getting-started-preparation-__codelineno-1-3"></a><span class="go">SELinux status:                 enabled</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch00-getting-started-preparation-__codelineno-1-4"></a><span class="go">SELinuxfs mount:                /sys/fs/selinux</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ch00-getting-started-preparation-__codelineno-1-5"></a><span class="go">SELinux root directory:         /etc/selinux</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ch00-getting-started-preparation-__codelineno-1-6"></a><span class="go">Loaded policy name:             targeted</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#ch00-getting-started-preparation-__codelineno-1-7"></a><span class="go">Current mode:                   permissive</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#ch00-getting-started-preparation-__codelineno-1-8"></a><span class="go">Mode from config file:          enforcing</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#ch00-getting-started-preparation-__codelineno-1-9"></a><span class="go">Policy MLS status:              enabled</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#ch00-getting-started-preparation-__codelineno-1-10"></a><span class="go">Policy deny_unknown status:     allowed</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#ch00-getting-started-preparation-__codelineno-1-11"></a><span class="go">Memory protection checking:     actual (secure)</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#ch00-getting-started-preparation-__codelineno-1-12"></a><span class="go">Max kernel policy version:      33</span>
</span></code></pre></div>
</div>
<p>Now, as you can see, the mode is switched to permissive. However, this change
is not persistent across reboots. To make it permanent, you need to modify the
SELinux configuration file located at <code>/etc/selinux/config</code>. Open the file and
replace enforcing with <code>permissive</code>.</p>
<p>Alternatively, you can achieve the same result more easily by running the
following command:</p>
<div class="admonition info">
<p class="admonition-title">Disable SeLinux permanent</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch00-getting-started-preparation-__codelineno-2-1"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/SELINUX=enforcing/SELINUX=permissive/g&#39;</span><span class="w"> </span>/etc/selinux/config
</span></code></pre></div></p>
</div>
<p>This line will alter the configuration file for you. So when we run <code>sestatus</code>
again we will see that we are in <code>permissive</code> mode and that our configuration
file is also in permissive mode.</p>
<div class="admonition info">
<p class="admonition-title">Verify selinux status again</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch00-getting-started-preparation-__codelineno-3-1"></a><span class="go">~# sestatus</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch00-getting-started-preparation-__codelineno-3-2"></a><span class="go">SELinux status:                 enabled</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ch00-getting-started-preparation-__codelineno-3-3"></a><span class="go">SELinuxfs mount:                /sys/fs/selinux</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ch00-getting-started-preparation-__codelineno-3-4"></a><span class="go">SELinux root directory:         /etc/selinux</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ch00-getting-started-preparation-__codelineno-3-5"></a><span class="go">Loaded policy name:             targeted</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ch00-getting-started-preparation-__codelineno-3-6"></a><span class="go">Current mode:                   permissive</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ch00-getting-started-preparation-__codelineno-3-7"></a><span class="go">Mode from config file:          permissive</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ch00-getting-started-preparation-__codelineno-3-8"></a><span class="go">Policy MLS status:              enabled</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#ch00-getting-started-preparation-__codelineno-3-9"></a><span class="go">Policy deny_unknown status:     allowed</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#ch00-getting-started-preparation-__codelineno-3-10"></a><span class="go">Memory protection checking:     actual (secure)</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#ch00-getting-started-preparation-__codelineno-3-11"></a><span class="go">Max kernel policy version:      33</span>
</span></code></pre></div>
</div>
<hr />
<h2 id="ch00-getting-started-preparation-install-the-zabbix-repository">Install the Zabbix repository</h2>
<p>From the Zabbix Download page <a href="https://www.zabbix.com/download">https://www.zabbix.com/download</a>,
select the appropriate Zabbix version you wish to install. In this case, we will
be using Zabbix 8.0 LTS. Additionally, ensure you choose the correct OS distribution
for your environment, which will be Rocky Linux 9, openSUSE Leap 16 or Ubuntu 24.04 in our case.</p>
<p>We will be installing the Zabbix Server along with NGINX as the web server for
the front-end. Make sure to download the relevant packages for your chosen configuration.</p>
<p><img alt="Zabbix Download" src="../ch00-getting-started/getting-started/ch00-getting-started-zabbixdownload.png" /></p>
<p><em>1.2 Zabbix
download</em></p>
<hr />
<h3 id="ch00-getting-started-preparation-red-hat-specific-remarks">Red Hat specific remarks</h3>
<p>If you make use of a RHEL based system like Rocky then the first step is to disable
the Zabbix packages provided by the EPEL repository, if it's installed on your system.
To do this, edit the <code>/etc/yum.repos.d/epel.repo</code> file and add the following statement
to disable the EPEL repository by default:</p>
<div class="admonition info">
<p class="admonition-title">Exclude packages</p>
<p>Red Hat
<div class="language-ini highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch00-getting-started-preparation-__codelineno-4-1"></a><span class="k">[epel]</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch00-getting-started-preparation-__codelineno-4-2"></a><span class="na">...</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch00-getting-started-preparation-__codelineno-4-3"></a><span class="na">excludepkgs</span><span class="o">=</span><span class="s">zabbix*</span>
</span></code></pre></div></p>
</div>
<details class="tip" open="open">
<summary>Tip</summary>
<p>It's considered bad practice to keep the EPEL repository enabled all the time,
as it may cause conflicts by unintentionally overwriting or installing unwanted
packages. Instead, it's safer to enable the repository only when needed, by using
the following command during installations: dnf install --enablerepo=epel <package-name>
This ensures that EPEL is only enabled when explicitly required.</p>
</details>
<hr />
<h3 id="ch00-getting-started-preparation-opensuse-specific-remarks">OpenSUSE specific remarks</h3>
<p>On openSUSE, Zabbix packages are also available in the default <code>repo-oss</code> repository. 
Unlike RHEL-based systems, openSUSE does not provide a built-in way to exclude
specific packages from individual repositories. However, the Zabbix packages
included in the default repositories are typically one to two LTS versions behind
the latest releases. As a result, they are unlikely to interfere with your
installation unless they are already installed.</p>
<p>In the next step, we will configure the official Zabbix repositories. As long
as you select a Zabbix repository version newer than the packages available in 
<code>repo-oss</code>, zypper will automatically install the most recent version.</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>If you have already installed Zabbix packages from the default repositories, 
it is recommended to either:</p>
<ul>
<li>Remove them before proceeding, or</li>
<li>Upgrade them after adding the new Zabbix repositories, using the zypper 
  option <code>--allow-vendor-change</code>.</li>
</ul>
</details>
<details class="note" open="open">
<summary>Suse Linux Enterprise Server (SLES)</summary>
<p>If you are using SLES, the Zabbix packages are not included in the default
repositories. Therefore, you can proceed to add the official Zabbix repository
without any concerns about conflicts with existing packages.</p>
</details>
<hr />
<h3 id="ch00-getting-started-preparation-adding-the-zabbix-repository">Adding the Zabbix repository</h3>
<p>Next, we will install the Zabbix repository on our operating system. After adding
the Zabbix repository, it is recommended to perform a repository cleanup to remove
old cache files and ensure the repository metadata is up to date. You can do this
by running:</p>
<div class="admonition info">
<p class="admonition-title">Add the zabbix repo</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch00-getting-started-preparation-__codelineno-5-1"></a>rpm<span class="w"> </span>-Uvh<span class="w"> </span>https://repo.zabbix.com/zabbix/8.0/release/rocky/9/noarch/zabbix-release-latest-8.0.el9.noarch.rpm
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch00-getting-started-preparation-__codelineno-5-2"></a>dnf<span class="w"> </span>clean<span class="w"> </span>all
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch00-getting-started-preparation-__codelineno-6-1"></a>rpm<span class="w"> </span>-Uvh<span class="w"> </span>--nosignature<span class="w"> </span>https://repo.zabbix.com/zabbix/8.0/release/sles/16/noarch/zabbix-release-latest-8.0.sles16.noarch.rpm
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch00-getting-started-preparation-__codelineno-6-2"></a>zypper<span class="w"> </span>--gpg-auto-import-keys<span class="w"> </span>refresh<span class="w"> </span><span class="s1">&#39;Zabbix Official Repository&#39;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch00-getting-started-preparation-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ch00-getting-started-preparation-__codelineno-6-4"></a><span class="c1"># Set the repository to auto-refresh to ensure it&#39;s always up to date</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ch00-getting-started-preparation-__codelineno-6-5"></a>zypper<span class="w"> </span>modifyrepo<span class="w"> </span>--refresh<span class="w"> </span><span class="s1">&#39;Zabbix Official Repository&#39;</span>
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch00-getting-started-preparation-__codelineno-7-1"></a>sudo<span class="w"> </span>wget<span class="w"> </span>https://repo.zabbix.com/zabbix/8.0/release/ubuntu/pool/main/z/zabbix-release/zabbix-release_latest_8.0+ubuntu24.04_all.deb
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch00-getting-started-preparation-__codelineno-7-2"></a>sudo<span class="w"> </span>dpkg<span class="w"> </span>-i<span class="w"> </span>zabbix-release_latest_8.0+ubuntu24.04_all.deb
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch00-getting-started-preparation-__codelineno-7-3"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update
</span></code></pre></div></p>
</div>
<p>This will refresh the repository metadata and prepare the system for Zabbix installation.</p>
<details class="note" open="open">
<summary>What is a repository?</summary>
<p>A repository in Linux is a configuration that allows you to access and install
software packages. You can think of it like an "app store" where you find and
download software from a trusted source, in this case, the Zabbix repository.
Many repositories are available, but it's important to only add those you trust.
The safest practice is to stick to the repositories provided by your operating
system and only add additional ones when you're sure they are both trusted and necessary.</p>
<p>For our installation, the Zabbix repository is provided by the vendor itself,
making it a trusted source. Another popular and safe repository for
Red Hat-based systems is EPEL (Extra Packages for Enterprise Linux), which is
commonly used in enterprise environments.
However, always exercise caution when adding new repositories to ensure
system security and stability.</p>
</details>
<hr />
<h2 id="ch00-getting-started-preparation-preparing-the-system-for-running-containers-using-podman">Preparing the system for running containers using Podman</h2>
<p>If you plan to run Zabbix components as containers using Podman, you need to
ensure that Podman is installed and properly configured on your system. Below
are the instructions for installing Podman on different operating systems.</p>
<p>You can skip this section if you do not plan to run any Zabbix components as containers on the current system.</p>
<details class="note" open="open">
<summary>Why Podman?</summary>
<p>Podman is a popular containerization tool that allows you to run and manage
containers without requiring a daemon like Docker. It is the recommended
container engine on most modern distributions and offers several advantages
over Docker.</p>
<p>Firstly, Podman enhances security by supporting rootless containers, allowing containers
to run under non-privileged user accounts. Secondly, it integrates seamlessly with
SELinux, enabling robust access control and policy enforcement. Thirdly, Podman
works natively with systemd, which facilitates container lifecycle management through
systemd units and quadlets.</p>
</details>
<h3 id="ch00-getting-started-preparation-installing-podman">Installing Podman</h3>
<p>To be able to run containers using Podman, we first need to install Podman and
some additional tools that will help us manage containers with SystemD.</p>
<div class="admonition info">
<p class="admonition-title">Install podman and needed tools</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch00-getting-started-preparation-__codelineno-8-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>podman<span class="w"> </span>policycoreutils-python-utils
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch00-getting-started-preparation-__codelineno-9-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>podman<span class="w"> </span>policycoreutils-python-utils
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch00-getting-started-preparation-__codelineno-10-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>podman
</span></code></pre></div></p>
</div>
<h3 id="ch00-getting-started-preparation-configure-podman-for-user-based-container-management">Configure Podman for user-based container management</h3>
<p>Next, we will create a <code>podman</code>-user which will be running the container(s). You
are free to use a different username, e.g. <code>zabbix-proxy</code> for a user that will
be running only zabbix-proxy in a container.</p>
<div class="admonition info">
<p class="admonition-title">Create and init podman user</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch00-getting-started-preparation-__codelineno-11-1"></a>sudo<span class="w"> </span>useradd<span class="w"> </span>--comment<span class="w"> </span><span class="s2">&quot;User for running container workloads&quot;</span><span class="w"> </span>podman
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ch00-getting-started-preparation-__codelineno-11-2"></a>sudo<span class="w"> </span>-i<span class="w"> </span>-u<span class="w"> </span>podman
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#ch00-getting-started-preparation-__codelineno-11-3"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.local/share/containers
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#ch00-getting-started-preparation-__codelineno-11-4"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.config/containers/systemd/
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#ch00-getting-started-preparation-__codelineno-11-5"></a><span class="nb">exit</span>
</span></code></pre></div>
</div>
<p>When your system has SELinux enabled, execute the following command as <code>root</code>. </p>
<div class="admonition info">
<p class="admonition-title">SELinux: Set file context mapping</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch00-getting-started-preparation-__codelineno-12-1"></a>semanage<span class="w"> </span>fcontext<span class="w"> </span>-a<span class="w"> </span>-e<span class="w"> </span>/var/lib/containers<span class="w"> </span>/home/podman/.local/share/containers
</span></code></pre></div>
</div>
<p>This command adds a SELinux file context mapping by creating an equivalence (-e)
between the default container storage directory <code>/var/lib/containers</code> and the user‚Äôs
Podman container storage path <code>/home/podman/.local/share/containers</code>. Essentially,
it tells SELinux to treat files in the user's container storage the same way it
treats files in the default system container storage, ensuring proper access
permissions under SELinux policy.</p>
<div class="admonition info">
<p class="admonition-title">SELinux: Apply file context mapping</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch00-getting-started-preparation-__codelineno-13-1"></a>restorecon<span class="w"> </span>-R<span class="w"> </span>-v<span class="w"> </span>/home/podman/.local/share/containers
</span></code></pre></div>
</div>
<p>After defining new SELinux contexts, this command recursively (<code>-R</code>) applies
the correct SELinux security contexts to the files in the specified directory.
The <code>-v</code> flag enables verbose output, showing what changes are made. This ensures
that all files in the container storage directory have the correct SELinux labels
as defined by the previous <code>semanage</code> commands.</p>
<div class="admonition info">
<p class="admonition-title">Enable lingering user processes</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch00-getting-started-preparation-__codelineno-14-1"></a>loginctl<span class="w"> </span>enable-linger<span class="w"> </span>podman
</span></code></pre></div>
</div>
<p>This command enables ‚Äúlinger‚Äù for the user <code>podman</code>. Linger allows user services
(such as containers managed by SystemD) to continue running even when the user
is not actively logged in. This is useful for running Podman containers in the
background and ensures that containerized proxies or other services remain active
after logout or system reboots.</p>
<p>As the final step in creating the Podman setup we need to to tell SystemD where 
the user-specific runtime files are stored:</p>
<div class="admonition info">
<p class="admonition-title">Set XDG_RUNTIME_DIR environment variable for podman user</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch00-getting-started-preparation-__codelineno-15-1"></a>sudo<span class="w"> </span>-u<span class="w"> </span>podman<span class="w"> </span>-i
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#ch00-getting-started-preparation-__codelineno-15-2"></a><span class="nb">echo</span><span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">XDG_RUNTIME_DIR</span><span class="o">=</span><span class="s2">&quot;/run/user/</span><span class="k">$(</span>id<span class="w"> </span>-u<span class="w"> </span>podman<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bash_profile<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#ch00-getting-started-preparation-__codelineno-15-3"></a><span class="w">    </span><span class="nb">source</span><span class="w"> </span>~/.bash_profile
</span></code></pre></div>
</div>
<p>This line ensures that the <code>XDG_RUNTIME_DIR</code> environment variable is correctly set
for the <code>podman</code> user and is loaded in current and next sessions. 
This variable points to the location where user-specific runtime
files are stored, including the systemd user session bus. Setting it is essential
for enabling <code>systemctl --user</code> to function properly with Podman-managed containers.</p>
<p>Your system is now prepared for running Zabbix components as containers using Podman.</p>
<details class="warning" open="open">
<summary>Known issue waiting for network-online.target</summary>
<p>In case the starting of your containers takes about 90s and then ultimately
fails to start. If you then see lines like this in your system logging 
(<code>journalctl</code>):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch00-getting-started-preparation-__codelineno-16-1"></a>systemd[1601]: Starting Wait for system level network-online.target as user....
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#ch00-getting-started-preparation-__codelineno-16-2"></a>sh[3128]: inactive
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#ch00-getting-started-preparation-__codelineno-16-3"></a>sh[3130]: inactive
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#ch00-getting-started-preparation-__codelineno-16-4"></a>sh[3132]: inactive
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#ch00-getting-started-preparation-__codelineno-16-5"></a>sh[3134]: inactive
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#ch00-getting-started-preparation-__codelineno-16-6"></a>sh[3136]: inactive
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#ch00-getting-started-preparation-__codelineno-16-7"></a>...
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#ch00-getting-started-preparation-__codelineno-16-8"></a>...
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#ch00-getting-started-preparation-__codelineno-16-9"></a>sh[3604]: inactive
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#ch00-getting-started-preparation-__codelineno-16-10"></a>sh[3606]: inactive
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#ch00-getting-started-preparation-__codelineno-16-11"></a>systemd[1601]: podman-user-wait-network-online.service: start operation timed out. Terminating.
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#ch00-getting-started-preparation-__codelineno-16-12"></a>systemd[1601]: podman-user-wait-network-online.service: Main process exited, code=killed, status=15/TERM
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#ch00-getting-started-preparation-__codelineno-16-13"></a>systemd[1601]: podman-user-wait-network-online.service: Failed with result &#39;timeout&#39;.
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#ch00-getting-started-preparation-__codelineno-16-14"></a>systemd[1601]: Failed to start Wait for system level network-online.target as user..
</span></code></pre></div>
<p>Then you are hitting a known <a href="https://github.com/containers/podman/issues/24796">problem with the Podman Quadlets</a>. </p>
<p>This is caused by the fact that the SystemD generated Quadlet service contains
a dependency to the system-wide special target <code>network-online.target</code> which
normally indicates the system's network is fully up and running. However on
certain Linux distriutions or with specific networking configurations the
system network components may not correctly notify SystemD that the network is
"online", causing <code>network-online.target</code> to never get activated. This in turn
makes that Podman will wait until it times out, thinking the network is not 
yet available.</p>
<p>As a workaround, you can create a dummy system service that will trigger 
<code>network-online.target</code>:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch00-getting-started-preparation-__codelineno-17-1"></a>vi<span class="w"> </span>/etc/systemd/system/podman-network-online-dummy.service
</span></code></pre></div>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch00-getting-started-preparation-__codelineno-18-1"></a><span class="k">[Unit]</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ch00-getting-started-preparation-__codelineno-18-2"></a><span class="na">Description</span><span class="o">=</span><span class="s">This is a dummy service to activate network-online.target</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ch00-getting-started-preparation-__codelineno-18-3"></a><span class="na">After</span><span class="o">=</span><span class="s">network-online.target</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ch00-getting-started-preparation-__codelineno-18-4"></a><span class="na">Wants</span><span class="o">=</span><span class="s">network-online.target</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#ch00-getting-started-preparation-__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#ch00-getting-started-preparation-__codelineno-18-6"></a><span class="k">[Service]</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#ch00-getting-started-preparation-__codelineno-18-7"></a><span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/echo Activating network-online.target</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#ch00-getting-started-preparation-__codelineno-18-8"></a>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#ch00-getting-started-preparation-__codelineno-18-9"></a><span class="k">[Install]</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#ch00-getting-started-preparation-__codelineno-18-10"></a><span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch00-getting-started-preparation-__codelineno-19-1"></a>systemctl<span class="w"> </span>daemon-reload
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#ch00-getting-started-preparation-__codelineno-19-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>podman-network-online-dummy.service
</span></code></pre></div></p>
</details>
<details class="warning" open="open">
<summary>Known issue waiting for network-online.target</summary>
<p>In case the starting of your containers takes about 90s and then ultimately
fail to start. If you then see lines like this in your system logging 
(<code>journalctl</code>):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch00-getting-started-preparation-__codelineno-20-1"></a>systemd[1601]: Starting Wait for system level network-online.target as user....
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#ch00-getting-started-preparation-__codelineno-20-2"></a>sh[3128]: inactive
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#ch00-getting-started-preparation-__codelineno-20-3"></a>sh[3130]: inactive
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#ch00-getting-started-preparation-__codelineno-20-4"></a>sh[3132]: inactive
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#ch00-getting-started-preparation-__codelineno-20-5"></a>sh[3134]: inactive
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#ch00-getting-started-preparation-__codelineno-20-6"></a>sh[3136]: inactive
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#ch00-getting-started-preparation-__codelineno-20-7"></a>...
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#ch00-getting-started-preparation-__codelineno-20-8"></a>...
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#ch00-getting-started-preparation-__codelineno-20-9"></a>sh[3604]: inactive
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#ch00-getting-started-preparation-__codelineno-20-10"></a>sh[3606]: inactive
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#ch00-getting-started-preparation-__codelineno-20-11"></a>systemd[1601]: podman-user-wait-network-online.service: start operation timed out. Terminating.
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#ch00-getting-started-preparation-__codelineno-20-12"></a>systemd[1601]: podman-user-wait-network-online.service: Main process exited, code=killed, status=15/TERM
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#ch00-getting-started-preparation-__codelineno-20-13"></a>systemd[1601]: podman-user-wait-network-online.service: Failed with result &#39;timeout&#39;.
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#ch00-getting-started-preparation-__codelineno-20-14"></a>systemd[1601]: Failed to start Wait for system level network-online.target as user..
</span></code></pre></div>
<p>Then you are hitting a known <a href="https://github.com/containers/podman/issues/24796">problem with the Podman Quadlets</a>. </p>
<p>This is caused by the fact that the SystemD generated Quadlet service contains
a dependency to the system-wide special target <code>network-online.target</code> which
normally indicates the system's network is fully up and running. However on
certain Linux distriutions or with specific networking configurations the
system network components may not correctly notify SystemD that the network is
"online", causing <code>network-online.target</code> to never get activated. This in turn
makes that Podman will wait until it times out, thinking the network is not 
yet available.</p>
<p>As a workaround, you can create a dummy system service that will trigger 
<code>network-online.target</code>:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch00-getting-started-preparation-__codelineno-21-1"></a>vi<span class="w"> </span>/etc/systemd/system/podman-network-online-dummy.service
</span></code></pre></div>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch00-getting-started-preparation-__codelineno-22-1"></a><span class="k">[Unit]</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#ch00-getting-started-preparation-__codelineno-22-2"></a><span class="na">Description</span><span class="o">=</span><span class="s">This is a dummy service to activate network-online.target</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#ch00-getting-started-preparation-__codelineno-22-3"></a><span class="na">After</span><span class="o">=</span><span class="s">network-online.target</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#ch00-getting-started-preparation-__codelineno-22-4"></a><span class="na">Wants</span><span class="o">=</span><span class="s">network-online.target</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#ch00-getting-started-preparation-__codelineno-22-5"></a>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#ch00-getting-started-preparation-__codelineno-22-6"></a><span class="k">[Service]</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#ch00-getting-started-preparation-__codelineno-22-7"></a><span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/echo Activating network-online.target</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#ch00-getting-started-preparation-__codelineno-22-8"></a>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#ch00-getting-started-preparation-__codelineno-22-9"></a><span class="k">[Install]</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#ch00-getting-started-preparation-__codelineno-22-10"></a><span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ch00-getting-started-preparation-__codelineno-23-1"></a>systemctl<span class="w"> </span>daemon-reload
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#ch00-getting-started-preparation-__codelineno-23-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>podman-network-online-dummy.service
</span></code></pre></div></p>
</details>
<hr />
<h2 id="ch00-getting-started-preparation-conclusion">Conclusion</h2>
<p>With the preparation of your system for Zabbix now complete, you have successfully
configured your environment for the installation of Zabbix components. We've covered 
the steps to add the official Zabbix repository to your system, preparing it for the 
installation of Zabbix server, database, and frontend components.
And we have also prepared the system for running containers using Podman, if needed.</p>
<p>Your system is now ready for the next steps. In the following chapter, we will
delve into the installation of the Zabbix components, guiding you through the
process of setting up the Zabbix server, database, and frontend. </p>
<hr />
<h2 id="ch00-getting-started-preparation-questions">Questions</h2>
<hr />
<h2 id="ch00-getting-started-preparation-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/installation/install_from_packages">https://www.zabbix.com/documentation/current/en/manual/installation/install_from_packages</a></li>
</ul></section></section>
                    <section class='print-page md-section' id='section-6' heading-number='6'>
                        <h1>Chapter 01 : Zabbix components and installation<a class='headerlink' href='#section-6' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch01-zabbix-components-chapter" heading-number="6.1"><h1 id="ch01-zabbix-components-chapter-zabbix-components-basic-functions-and-installation">Zabbix components, basic functions and installation</h1>
<p>In this chapter, we expand on the foundational knowledge from the "Getting Started"
section to provide a comprehensive guide for both beginners who are installing
Zabbix for the first time and advanced users who seek to optimize their setup.
We‚Äôll not only cover the essential steps for a basic installation but also delve
into the finer details of Zabbix architecture, components, and best practices.</p>
<p>We‚Äôll start by walking through the installation process, ensuring you have a solid
foundation to build on. From there, we'll move into the core components of
Zabbix, what each one does, how they interact, and why they are crucial to your
monitoring solution.
You'll learn about subprocesses, their roles, and how they contribute to Zabbix
efficiency and reliability.</p>
<p>Additionally, we‚Äôll explore good architectural choices that can make or break
your monitoring setup. Whether you're managing a small network or a large-scale
infrastructure, making the right design decisions early on will pay dividends
in scalability, performance, and maintenance.</p>
<p>This chapter is designed to cater to a wide range of readers.
If you're simply looking to get Zabbix up and running, you'll find clear, step-by-step
instructions. For those wanting to dive deeper, we'll provide detailed insights into
how Zabbix functions under the hood, helping you make informed choices that align
with your needs and future growth plans.</p>
<p>By the end of this chapter, you will have not only a working Zabbix installation
but also a thorough understanding of its components and architecture, empowering
you to leverage Zabbix to its fullest potential, regardless of the complexity of
your environment.</p>
<p>Let‚Äôs embark on this detailed journey into Zabbix and equip ourselves with the
knowledge to both start and optimize a powerful monitoring solution.</p></section><section class="print-page" id="ch01-zabbix-components-architecture" heading-number="6.2"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="zabbix-architecture">Zabbix architecture</h1>
<p>In this chapter, we will walk through the process of installing the Zabbix server.
There are many different ways to setup a Zabbix server. We will cover the most
common setups with MariaDB and PostgreSQL on RHEL- and SLES-based distro's and Ubuntu.</p>
<p>Before beginning the installation, it is important to understand the architecture
of Zabbix.
The Zabbix server is structured in a modular fashion, composed of three main components,
which we will discuss in detail.</p>
<ul>
<li>The Zabbix server</li>
<li>The Zabbix web server</li>
<li>The Zabbix database</li>
</ul>
<div class="admonition abstract">
<p class="admonition-title">Creation of DB users</p>
<p>In our setup we will create 2 DB users <code>zabbix-web</code> and <code>zabbix-srv</code>. The 
zabbix-web user will be used for the frontend to connect to our zabbix database.
The zabbix-srv user will be used by our zabbix server to connect to the database.
This allows us to limit the permissions for every user to only what is strictly
needed.</p>
</div>
<p><img align="left" alt="overview" src="../ch01-zabbix-components/basic-installation/ch01-basic-installation-zabbixserver.png" /></p>
<p><em>1.1 Zabbix basic
split installation</em></p>
<p>All of these components can either be installed on a single server or distributed
across three separate servers. The core of the system is the Zabbix server, often
referred to as the "brain." This component is responsible for processing trigger
calculations and sending alerts. The database serves as the storage for the Zabbix
server's configuration and all the data it collects. The web server provides the
user interface (front-end) for interacting with the system. It is important to note
that the Zabbix API is part of the front-end component, not the Zabbix server itself.</p>
<p>These components must function together seamlessly, as illustrated in the diagram
above. The Zabbix server must read configurations and store monitoring data in the
database, while the front-end needs access to read and write configuration data.
Furthermore, the front-end must be able to check the status of the Zabbix server
and retrieve additional necessary information to ensure smooth operation.</p>
<p>For our setup, we will be using two virtual machines (VMs): one VM will host both
the Zabbix server and the Zabbix web front-end, while the second VM will host the
Zabbix database.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>It is perfectly possible to install all components on one single VM or every component
on a separate VM.
The reason why we split the DB in our example is because the database will probably be
the first component giving you performance headaches. It is also the component
that needs some extra attention when we split it from the other components,
so for this reason we have chosen in this example to split the database 
from the rest of the setup.</p>
</details>
<p>We will cover the following topics:</p>
<ul>
<li>Install our Database based on MariaDB.</li>
<li>Install our Database based on PostgreSQL.</li>
<li>Installing the Zabbix server.</li>
<li>Install the frontend.</li>
</ul></section>
                    <section class='print-page md-section' id='section-6-3' heading-number='6.3'>
                        <h1>Database<a class='headerlink' href='#section-6-3' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch01-zabbix-components-database" heading-number="6.3.1"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="database-choices">Database choices</h1>
<h2 id="ch01-zabbix-components-database-choosing-a-database-backend-for-zabbix">Choosing a Database Backend for Zabbix</h2>
<p>A critical decision when managing Zabbix installations is selecting the database
backend. Zabbix supports several database options: MySQL/Percona, MariaDB, 
PostgreSQL (including TimescaleDB), and Oracle (up to Zabbix 7.0).</p>
<details class="warning" open="open">
<summary>Oracle Database deprecation</summary>
<p>Zabbix 7.0 marks the final release to offer support for Oracle Database.
Consequently, systems running Zabbix 7.0 or any prior version must undertake
a database migration to either PostgreSQL, MySQL, or a compatible fork such
as MariaDB before upgrading to a later Zabbix release. This migration is a
mandatory step to ensure continued functionality and compatibility with future
Zabbix versions.</p>
</details>
<p>All supported databases perform similarly under typical Zabbix workloads, and 
Zabbix treats them equally in terms of functionality. As such, the choice 
primarily depends on your or your team‚Äôs familiarity with a particular database system. 
One notable exception is TimescaleDB, a PostgreSQL extension optimized for 
time-series data. This makes it especially well-suited for monitoring applications 
like Zabbix, which handle large volumes of timestamped data.</p>
<p>In large-scale environments with high-frequency data collection, TimescaleDB can
deliver significant performance benefits, including improved query speeds and
built-in compression to reduce storage requirements. However, these advantages
come with added complexity during installation and a few restrictions on historical
data retention.</p>
<details class="tip" open="open">
<summary>TimescaleDB installation</summary>
<p>Given its advanced nature, TimescaleDB is not essential for most Zabbix users.
As such, its installation is beyond the scope of this chapter. If you plan to
use TimescaleDB, refer to <a href="#ch13-advanced-security-partitioning-postgresql-database">Partitioning PostgreSQL with TimescaleDB</a>
for detailed guidance after installing PostgreSQL.</p>
</details>
<hr />
<h2 id="ch01-zabbix-components-database-choosing-the-source-for-database-installation">Choosing the Source for Database Installation</h2>
<p>In this chapter we will focus on installing MariaDB and PostgreSQL, as they are
the most commonly used databases with Zabbix. For MySQL or Percona installations,
except for the package installation commands, the steps are very similar to MariaDB.</p>
<p>When installing MariaDB or PostgreSQL you must determine the source 
from which you will want to install the database server. Two primary options are 
available:</p>
<ol>
<li><strong>Vendor-Provided Packages</strong></li>
</ol>
<dl>
<dd>
<p>These are included in the software repositories of most Linux distributions 
and are maintained by the distribution vendor.</p>
<p><strong>Advantages:</strong></p>
<ul>
<li><strong>Simplified installation:</strong> Packages are readily available via the
  distribution‚Äôs package manager.</li>
<li><strong>Vendor support:</strong> For enterprise distributions (e.g., RHEL, SLES),
  active subscriptions include official support.</li>
<li><strong>Compatibility:</strong> Guaranteed integration with other system packages and
  dependencies.</li>
<li><strong>Distribution-specific optimizations:</strong> Includes tailored configurations
    (e.g., logrotate, bash completion,...).</li>
<li><strong>Long-term maintenance:</strong> Security and bug fixes are backported by the
    vendor for the duration of the distribution‚Äôs support lifecycle.</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
<li><strong>Version lock-in:</strong> Major distribution upgrades may automatically introduce
    newer database versions, potentially requiring compatibility checks with
    Zabbix.</li>
<li><strong>Vendor modifications:</strong> Default configurations, log directories, and data
    paths may be altered to align with distribution-specific standards.</li>
</ul>
</dd>
</dl>
<ol start="2">
<li><strong>Official MariaDB/PostgreSQL Repositories</strong></li>
</ol>
<dl>
<dd>
<p>These repositories provide packages directly from MariaDB/PostgreSQL and offer
access to the latest stable releases.</p>
<p><strong>Advantages:</strong></p>
<ul>
<li><strong>Up-to-date versions:</strong> Immediate access to the latest features, security
  patches, and bug fixes. However, make sure Zabbix is compatible with the
  chosen version.</li>
<li><strong>Enterprise support:</strong> Option to purchase MariaDB Enterprise or Enterprise DB
  respectively, which includes professional support and additional features.</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
<li><strong>Manual version management:</strong> Users must proactively monitor and upgrade 
  to new major versions to ensure continued security and bug fix coverage.</li>
</ul>
</dd>
</dl>
<details class="warning" open="open">
<summary>Database version compatibility</summary>
<p>Whether you plan to use the OS vendor-provided packages or the official 
database-vendor packages, ensure that the database version is supported
by your Zabbix version to avoid potential integration issues. 
Check the <a href="https://www.zabbix.com/documentation/current/en/manual/installation/requirements#required-software">Zabbix documentation</a>
for the latest supported versions.</p>
</details>
<p>Before installing the database software, ensure that the server
meets the configuration requirements and is prepared as outlined in the previous 
chapter: <a href="#ch00-getting-started-requirements"><em>Getting started</em></a>.</p>
<hr />
<h2 id="ch01-zabbix-components-database-conclusion">Conclusion</h2>
<p>We have discussed the various database backends supported by Zabbix. We've also
examined the advantages and disadvantages of using vendor-provided packages
versus official repositories for installing MariaDB and PostgreSQL.</p>
<p>Armed with this knowledge, you are now ready to proceed with the installation 
of your chosen database backend. In the following chapters, we will guide you 
through the installation process for MariaDB or PostgreSQL, ensuring that your 
Zabbix instance is equipped with a robust and efficient database system.</p>
<p>Now that you have a clear understanding of the database options available, let's
move on to the installation of your preferred database backend.</p>
<hr />
<h2 id="ch01-zabbix-components-database-questions">Questions</h2>
<ol>
<li>Should I choose MySQL or PostgreSQL as the database back-end? Why?</li>
<li>Should I use the packages provided by the OS vendor, or should I install
   database-vendor official packages? Why?</li>
</ol>
<hr />
<h2 id="ch01-zabbix-components-database-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://mariadb.org">https://mariadb.org</a></li>
<li><a href="https://mariadb.com">https://mariadb.com</a></li>
<li><a href="https://www.mysql.com">https://www.mysql.com</a></li>
<li><a href="https://www.percona.com">https://www.percona.com</a></li>
<li><a href="https://www.postgresql.org">https://www.postgresql.org</a></li>
<li><a href="https://www.tigerdata.com/timescaledb">https://www.tigerdata.com/timescaledb</a></li>
<li><a href="https://www.enterprisedb.com">https://www.enterprisedb.com</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/installation/requirements">https://www.zabbix.com/documentation/current/en/manual/installation/requirements</a></li>
</ul></section><section class="print-page" id="ch01-zabbix-components-mariadb" heading-number="6.3.2"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="installing-a-mariadb-database">Installing a MariaDB Database</h1>
<p>In this section we will install the MariaDB server and -client packages. This will
provide the necessary components to run and manage MariaDB as your Zabbix database backend.</p>
<p>If you prefer to use PostgreSQL as your database backend, you can skip this section 
and proceed to the <a href="#ch01-zabbix-components-postgresql"><em>Installing the PostgreSQL Database</em></a> section.</p>
<details class="tip" open="open">
<summary>MySQL/Percona</summary>
<p>If you prefer to use MySQL or Percona instead of MariaDB, the installation 
and configuration steps are very similar. Generally, you would replace 
<code>mariadb</code> with <code>mysql</code> in the package names and commands.</p>
</details>
<h2 id="ch01-zabbix-components-mariadb-installing-mariadb-server-and-client-from-os-vendor-provided-packages">Installing MariaDB Server and Client from OS Vendor-Provided Packages</h2>
<p>To install the distribution default MariaDB server and client, execute the 
following command:</p>
<div class="admonition info">
<p class="admonition-title">Install distribution version of Mariadb</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch01-zabbix-components-mariadb-__codelineno-0-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>mariadb-server
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch01-zabbix-components-mariadb-__codelineno-1-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>mariadb<span class="w"> </span>mariadb-client
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch01-zabbix-components-mariadb-__codelineno-2-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>mariadb-server
</span></code></pre></div></p>
</div>
<p>This command will download and install both the server and client packages, enabling
you to set up, configure, and interact with your MariaDB database. Once the
installation is complete, you can proceed to the <a href="#ch01-zabbix-components-mariadb-starting-the-mariadb-database"><em>Starting the MariaDB database</em></a> section.</p>
<hr />
<h2 id="ch01-zabbix-components-mariadb-installing-mariadb-server-and-client-from-official-mariadb-repositories">Installing MariaDB Server and Client from Official MariaDB Repositories</h2>
<p>If you prefer to install MariaDB from the official MariaDB repositories instead
of the OS vendor-provided packages, the first step is to add the MariaDB repository
to your system.</p>
<hr />
<h3 id="ch01-zabbix-components-mariadb-adding-the-mariadb-repository">Adding the MariaDB Repository</h3>
<p>To create the MariaDB repository file, execute the following command in your terminal:</p>
<div class="admonition info">
<p class="admonition-title">Define the MariaDB repository</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch01-zabbix-components-mariadb-__codelineno-3-1"></a>vi<span class="w"> </span>/etc/yum.repos.d/mariadb.repo
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch01-zabbix-components-mariadb-__codelineno-4-1"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/zypp/repos.d/mariadb.repo
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch01-zabbix-components-mariadb-__codelineno-5-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>apt-transport-https<span class="w"> </span>curl
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch01-zabbix-components-mariadb-__codelineno-5-2"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/apt/keyrings
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch01-zabbix-components-mariadb-__codelineno-5-3"></a>sudo<span class="w"> </span>curl<span class="w"> </span>-o<span class="w"> </span>/etc/apt/keyrings/mariadb-keyring.pgp<span class="w"> </span><span class="s1">&#39;https://mariadb.org/mariadb_release_signing_key.pgp&#39;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ch01-zabbix-components-mariadb-__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ch01-zabbix-components-mariadb-__codelineno-5-5"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/apt/sources.list.d/mariadb.sources
</span></code></pre></div></p>
</div>
<p>This will open a text editor where you can input the repository configuration details.
Once the repository is configured, you can proceed with the installation of MariaDB
using your package manager.</p>
<p>The latest config can be found here: <a href="https://mariadb.org/download/?t=repo-config">https://mariadb.org/download/?t=repo-config</a></p>
<p>Here's an example configuration for MariaDB 11.4 repositories:</p>
<div class="admonition example">
<p class="admonition-title">Mariadb repository configuration</p>
<p>Red Hat
<div class="language-ini highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch01-zabbix-components-mariadb-__codelineno-6-1"></a><span class="c1"># MariaDB 11.4 RedHatEnterpriseLinux repository list - created 2025-02-21 10:15 UTC</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch01-zabbix-components-mariadb-__codelineno-6-2"></a><span class="c1"># https://mariadb.org/download/</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch01-zabbix-components-mariadb-__codelineno-6-3"></a><span class="k">[mariadb]</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ch01-zabbix-components-mariadb-__codelineno-6-4"></a><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MariaDB</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ch01-zabbix-components-mariadb-__codelineno-6-5"></a><span class="c1"># rpm.mariadb.org is a dynamic mirror if your preferred mirror goes offline. See https://mariadb.org/mirrorbits/ for details.</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#ch01-zabbix-components-mariadb-__codelineno-6-6"></a><span class="c1"># baseurl = https://rpm.mariadb.org/11.4/rhel/$releasever/$basearch</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#ch01-zabbix-components-mariadb-__codelineno-6-7"></a><span class="na">baseurl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://mirror.bouwhuis.network/mariadb/yum/11.4/rhel/$releasever/$basearch</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#ch01-zabbix-components-mariadb-__codelineno-6-8"></a><span class="c1"># gpgkey = https://rpm.mariadb.org/RPM-GPG-KEY-MariaDB</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#ch01-zabbix-components-mariadb-__codelineno-6-9"></a><span class="na">gpgkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://mirror.bouwhuis.network/mariadb/yum/RPM-GPG-KEY-MariaDB</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#ch01-zabbix-components-mariadb-__codelineno-6-10"></a><span class="na">gpgcheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>
</span></code></pre></div></p>
<p>SUSE
<div class="language-ini highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch01-zabbix-components-mariadb-__codelineno-7-1"></a><span class="c1"># MariaDB 11.4 openSUSE repository list - created 2025-12-29 14:34 UTC</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch01-zabbix-components-mariadb-__codelineno-7-2"></a><span class="c1"># https://mariadb.org/download/</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch01-zabbix-components-mariadb-__codelineno-7-3"></a><span class="k">[mariadb]</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#ch01-zabbix-components-mariadb-__codelineno-7-4"></a><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MariaDB</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#ch01-zabbix-components-mariadb-__codelineno-7-5"></a><span class="c1"># rpm.mariadb.org is a dynamic mirror if your preferred mirror goes offline. See https://mariadb.org/mirrorbits/ for details.</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#ch01-zabbix-components-mariadb-__codelineno-7-6"></a><span class="c1"># baseurl = https://rpm.mariadb.org/11.4/opensuse/$releasever/$basearch</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#ch01-zabbix-components-mariadb-__codelineno-7-7"></a><span class="c1"># baseurl = https://rpm.mariadb.org/11.4/opensuse/$releasever/$basearch</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#ch01-zabbix-components-mariadb-__codelineno-7-8"></a><span class="na">baseurl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://mirror.bouwhuis.network/mariadb/yum/11.4/opensuse/$releasever/$basearch</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#ch01-zabbix-components-mariadb-__codelineno-7-9"></a><span class="c1"># gpgkey = https://rpm.mariadb.org/RPM-GPG-KEY-MariaDB</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#ch01-zabbix-components-mariadb-__codelineno-7-10"></a><span class="na">gpgkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://mirror.bouwhuis.network/mariadb/yum/RPM-GPG-KEY-MariaDB</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#ch01-zabbix-components-mariadb-__codelineno-7-11"></a><span class="na">gpgcheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch01-zabbix-components-mariadb-__codelineno-8-1"></a><span class="c1"># MariaDB 11.4 repository list - created 2025-02-21 11:42 UTC</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ch01-zabbix-components-mariadb-__codelineno-8-2"></a><span class="c1"># https://mariadb.org/download/</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ch01-zabbix-components-mariadb-__codelineno-8-3"></a><span class="nt">X-Repolib-Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MariaDB</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#ch01-zabbix-components-mariadb-__codelineno-8-4"></a><span class="nt">Types</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deb</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#ch01-zabbix-components-mariadb-__codelineno-8-5"></a><span class="c1"># deb.mariadb.org is a dynamic mirror if your preferred mirror goes offline. See https://mariadb.org/mirrorbits/ for details.</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#ch01-zabbix-components-mariadb-__codelineno-8-6"></a><span class="c1"># URIs: https://deb.mariadb.org/11.4/ubuntu</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#ch01-zabbix-components-mariadb-__codelineno-8-7"></a><span class="nt">URIs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://mirror.bouwhuis.network/mariadb/repo/11.4/ubuntu</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#ch01-zabbix-components-mariadb-__codelineno-8-8"></a><span class="nt">Suites</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">noble</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#ch01-zabbix-components-mariadb-__codelineno-8-9"></a><span class="nt">Components</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main main/debug</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#ch01-zabbix-components-mariadb-__codelineno-8-10"></a><span class="nt">Signed-By</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/apt/keyrings/mariadb-keyring.pgp</span>
</span></code></pre></div></p>
</div>
<p>After saving the file, ensure that everything is properly set up and that your
preferred MariaDB version is compatible with your Zabbix version to avoid potential
integration issues.</p>
<hr />
<h3 id="ch01-zabbix-components-mariadb-installing-mariadb-server-and-client">Installing MariaDB Server and Client</h3>
<p>With the MariaDB repository configured, you are now ready to install the MariaDB
server and client packages. This will provide the necessary components to run
and manage your database.</p>
<p>To install the MariaDB server and client, execute the following command:</p>
<div class="admonition info">
<p class="admonition-title">Install MariaDB from official repository</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch01-zabbix-components-mariadb-__codelineno-9-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>MariaDB-server
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch01-zabbix-components-mariadb-__codelineno-10-1"></a>sudo<span class="w"> </span>rpm<span class="w"> </span>--import<span class="w"> </span>https://mirror.bouwhuis.network/mariadb/yum/RPM-GPG-KEY-MariaDB
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch01-zabbix-components-mariadb-__codelineno-10-2"></a>sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>MariaDB-server<span class="w"> </span>MariaDB-client
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch01-zabbix-components-mariadb-__codelineno-11-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>mariadb-server
</span></code></pre></div></p>
</div>
<p>This command will download and install both the server and client packages, enabling
you to set up, configure, and interact with your MariaDB database. Once the
installation is complete, you can proceed to the <a href="#ch01-zabbix-components-mariadb-starting-the-mariadb-database"><em>Starting the MariaDB database</em></a> section.</p>
<hr />
<h2 id="ch01-zabbix-components-mariadb-starting-the-mariadb-database">Starting the MariaDB Database</h2>
<p>Now that MariaDB is installed, we need to enable the service to start automatically
upon boot and start it immediately. Use the following command to accomplish this:</p>
<div class="admonition info">
<p class="admonition-title">Enable MariaDB service</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch01-zabbix-components-mariadb-__codelineno-12-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>mariadb<span class="w"> </span>--now
</span></code></pre></div>
</div>
<p>This command will both enable and start the MariaDB service and since this will be
the first time the service is started, it will initialize the database directory.
With the MariaDB service now up and running, you can verify that the installation
was successful by checking the version of MariaDB using the following command:</p>
<div class="admonition info">
<p class="admonition-title">Check Mariadb version</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch01-zabbix-components-mariadb-__codelineno-13-1"></a>mariadb<span class="w"> </span>-V
</span></code></pre></div>
</div>
<p>The expected output should resemble this:</p>
<details class="example" open="open">
<summary>MariaDB version example</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch01-zabbix-components-mariadb-__codelineno-14-1"></a><span class="gp">localhost:~ $ </span>mariadb<span class="w"> </span>-V
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch01-zabbix-components-mariadb-__codelineno-14-2"></a><span class="go">mariadb  Ver 15.1 Distrib 10.11.14-MariaDB, for Linux (x86_64) using  EditLine wrapper</span>
</span></code></pre></div>
</details>
<p>To ensure that the MariaDB service is running properly, you can check its status
with the following command:</p>
<div class="admonition info">
<p class="admonition-title">Get mariadb status</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch01-zabbix-components-mariadb-__codelineno-15-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>mariadb
</span></code></pre></div>
</div>
<p>You should see an output similar to this, indicating that the MariaDB service
is active and running:</p>
<details class="example" open="open">
<summary>Mariadb service status example</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch01-zabbix-components-mariadb-__codelineno-16-1"></a><span class="gp">localhost:~ $ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>mariadb
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#ch01-zabbix-components-mariadb-__codelineno-16-2"></a><span class="go">‚óè mariadb.service - MariaDB database server</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#ch01-zabbix-components-mariadb-__codelineno-16-3"></a><span class="go">     Loaded: loaded (/usr/lib/systemd/system/mariadb.service; enabled; preset: disabled)</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#ch01-zabbix-components-mariadb-__codelineno-16-4"></a><span class="go">     Active: active (running) since Wed 2025-12-03 00:16:04 CET; 5s ago</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#ch01-zabbix-components-mariadb-__codelineno-16-5"></a><span class="go">       Docs: man:mysqld(8)</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#ch01-zabbix-components-mariadb-__codelineno-16-6"></a><span class="go">             https://mariadb.com/kb/en/library/systemd/</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#ch01-zabbix-components-mariadb-__codelineno-16-7"></a><span class="go">    Process: 11148 ExecStartPre=/usr/lib/mysql/mysql-systemd-helper install (code=exited, status=0/SUCCESS)</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#ch01-zabbix-components-mariadb-__codelineno-16-8"></a><span class="go">    Process: 11155 ExecStartPre=/usr/lib/mysql/mysql-systemd-helper upgrade (code=exited, status=0/SUCCESS)</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#ch01-zabbix-components-mariadb-__codelineno-16-9"></a><span class="go">   Main PID: 11162 (mysqld)</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#ch01-zabbix-components-mariadb-__codelineno-16-10"></a><span class="go">     Status: &quot;Taking your SQL requests now...&quot;</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#ch01-zabbix-components-mariadb-__codelineno-16-11"></a><span class="go">      Tasks: 18 (limit: 4670)</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#ch01-zabbix-components-mariadb-__codelineno-16-12"></a><span class="go">        CPU: 340ms</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#ch01-zabbix-components-mariadb-__codelineno-16-13"></a><span class="go">     CGroup: /system.slice/mariadb.service</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#ch01-zabbix-components-mariadb-__codelineno-16-14"></a><span class="go">             ‚îî‚îÄ11162 /usr/sbin/mysqld --defaults-file=/etc/my.cnf --user=mysql --socket=/run/mysql/mysql.sock</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#ch01-zabbix-components-mariadb-__codelineno-16-15"></a>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#ch01-zabbix-components-mariadb-__codelineno-16-16"></a><span class="go">Dec 03 00:16:04 localhost.localdomain systemd[1]: [Note] Plugin &#39;FEEDBACK&#39; is disabled.</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#ch01-zabbix-components-mariadb-__codelineno-16-17"></a><span class="go">Dec 03 00:16:04 localhost.localdomain systemd[1]: [Note] InnoDB: Loading buffer pool(s) from /var/lib/mysql/ib_buffer_pool</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#ch01-zabbix-components-mariadb-__codelineno-16-18"></a><span class="go">Dec 03 00:16:04 localhost.localdomain systemd[1]: [Note] Server socket created on IP: &#39;127.0.0.1&#39;, port: &#39;3306&#39;.</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#ch01-zabbix-components-mariadb-__codelineno-16-19"></a><span class="go">Dec 03 00:16:04 localhost.localdomain systemd[1]: [Note] /usr/sbin/mysqld: ready for connections.</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#ch01-zabbix-components-mariadb-__codelineno-16-20"></a><span class="go">Dec 03 00:16:04 localhost.localdomain systemd[1]: Version: &#39;10.11.14-MariaDB&#39;  socket: &#39;/run/mysql/mysql.sock&#39;  port: 3306  MariaDB package</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#ch01-zabbix-components-mariadb-__codelineno-16-21"></a><span class="go">Dec 03 00:16:04 localhost.localdomain systemd[1]: [Note] InnoDB: Buffer pool(s) load completed at 251203  0:16:04</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#ch01-zabbix-components-mariadb-__codelineno-16-22"></a><span class="go">Dec 03 00:16:04 localhost.localdomain systemd[1]: Started MariaDB database server.</span>
</span></code></pre></div>
</details>
<p>This confirms that your MariaDB server is up and running, ready for further configuration.</p>
<hr />
<h2 id="ch01-zabbix-components-mariadb-securing-the-mariadb-database">Securing the MariaDB Database</h2>
<p>To enhance the security of your MariaDB server, it's essential to remove unnecessary
test databases, anonymous users, and set a root password. This can be done using
the mariadb-secure-installation script, which provides a step-by-step guide to
securing your database.</p>
<p>Run the following command:</p>
<div class="admonition info">
<p class="admonition-title">Secure Mariadb setup</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch01-zabbix-components-mariadb-__codelineno-17-1"></a>sudo<span class="w"> </span>mariadb-secure-installation
</span></code></pre></div>
</div>
<p>The mariadb-secure-installation script will guide you through several key steps:</p>
<ol>
<li>Set a root password if one isn't already set.</li>
<li>Remove anonymous users.</li>
<li>Disallow remote root logins.</li>
<li>Remove the test database.</li>
<li>Reload the privilege tables to ensure the changes take effect.</li>
</ol>
<p>Once complete, your MariaDB instance will be significantly more secure. </p>
<div class="admonition example">
<p class="admonition-title">mariadb-secure-installation example output</p>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch01-zabbix-components-mariadb-__codelineno-18-1"></a><span class="gp">localhost:~ $ </span>sudo<span class="w"> </span>mariadb-secure-installation
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ch01-zabbix-components-mariadb-__codelineno-18-2"></a><span class="go">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ch01-zabbix-components-mariadb-__codelineno-18-3"></a><span class="go">      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ch01-zabbix-components-mariadb-__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#ch01-zabbix-components-mariadb-__codelineno-18-5"></a><span class="go">In order to log into MariaDB to secure it, we&#39;ll need the current</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#ch01-zabbix-components-mariadb-__codelineno-18-6"></a><span class="go">password for the root user. If you&#39;ve just installed MariaDB, and</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#ch01-zabbix-components-mariadb-__codelineno-18-7"></a><span class="go">haven&#39;t set the root password yet, you should just press enter here.</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#ch01-zabbix-components-mariadb-__codelineno-18-8"></a>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#ch01-zabbix-components-mariadb-__codelineno-18-9"></a><span class="go">Enter current password for root (enter for none):</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#ch01-zabbix-components-mariadb-__codelineno-18-10"></a><span class="go">OK, successfully used password, moving on...</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#ch01-zabbix-components-mariadb-__codelineno-18-11"></a>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#ch01-zabbix-components-mariadb-__codelineno-18-12"></a><span class="go">Setting the root password or using the unix_socket ensures that nobody</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#ch01-zabbix-components-mariadb-__codelineno-18-13"></a><span class="go">can log into the MariaDB root user without the proper authorisation.</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#ch01-zabbix-components-mariadb-__codelineno-18-14"></a>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#ch01-zabbix-components-mariadb-__codelineno-18-15"></a><span class="go">You already have your root account protected, so you can safely answer &#39;n&#39;.</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#ch01-zabbix-components-mariadb-__codelineno-18-16"></a>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#ch01-zabbix-components-mariadb-__codelineno-18-17"></a><span class="go">Switch to unix_socket authentication [Y/n] n</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#ch01-zabbix-components-mariadb-__codelineno-18-18"></a><span class="go"> ... skipping.</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#ch01-zabbix-components-mariadb-__codelineno-18-19"></a>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#ch01-zabbix-components-mariadb-__codelineno-18-20"></a><span class="go">You already have your root account protected, so you can safely answer &#39;n&#39;.</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#ch01-zabbix-components-mariadb-__codelineno-18-21"></a>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#ch01-zabbix-components-mariadb-__codelineno-18-22"></a><span class="go">Change the root password? [Y/n] y</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#ch01-zabbix-components-mariadb-__codelineno-18-23"></a><span class="go">New password:</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#ch01-zabbix-components-mariadb-__codelineno-18-24"></a><span class="go">Re-enter new password:</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#ch01-zabbix-components-mariadb-__codelineno-18-25"></a><span class="go">Password updated successfully!</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#ch01-zabbix-components-mariadb-__codelineno-18-26"></a><span class="go">Reloading privilege tables..</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#ch01-zabbix-components-mariadb-__codelineno-18-27"></a><span class="go"> ... Success!</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#ch01-zabbix-components-mariadb-__codelineno-18-28"></a>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#ch01-zabbix-components-mariadb-__codelineno-18-29"></a>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#ch01-zabbix-components-mariadb-__codelineno-18-30"></a><span class="go">By default, a MariaDB installation has an anonymous user, allowing anyone</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#ch01-zabbix-components-mariadb-__codelineno-18-31"></a><span class="go">to log into MariaDB without having to have a user account created for</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#ch01-zabbix-components-mariadb-__codelineno-18-32"></a><span class="go">them.  This is intended only for testing, and to make the installation</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#ch01-zabbix-components-mariadb-__codelineno-18-33"></a><span class="go">go a bit smoother.  You should remove them before moving into a</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#ch01-zabbix-components-mariadb-__codelineno-18-34"></a><span class="go">production environment.</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#ch01-zabbix-components-mariadb-__codelineno-18-35"></a>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#ch01-zabbix-components-mariadb-__codelineno-18-36"></a><span class="go">Remove anonymous users? [Y/n] y</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#ch01-zabbix-components-mariadb-__codelineno-18-37"></a><span class="go"> ... Success!</span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#ch01-zabbix-components-mariadb-__codelineno-18-38"></a>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#ch01-zabbix-components-mariadb-__codelineno-18-39"></a><span class="go">Normally, root should only be allowed to connect from &#39;localhost&#39;.  This</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#ch01-zabbix-components-mariadb-__codelineno-18-40"></a><span class="go">ensures that someone cannot guess at the root password from the network.</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#ch01-zabbix-components-mariadb-__codelineno-18-41"></a>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#ch01-zabbix-components-mariadb-__codelineno-18-42"></a><span class="go">Disallow root login remotely? [Y/n] y</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#ch01-zabbix-components-mariadb-__codelineno-18-43"></a><span class="go"> ... Success!</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#ch01-zabbix-components-mariadb-__codelineno-18-44"></a>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#ch01-zabbix-components-mariadb-__codelineno-18-45"></a><span class="go">By default, MariaDB comes with a database named &#39;test&#39; that anyone can</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#ch01-zabbix-components-mariadb-__codelineno-18-46"></a><span class="go">access.  This is also intended only for testing, and should be removed</span>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#ch01-zabbix-components-mariadb-__codelineno-18-47"></a><span class="go">before moving into a production environment.</span>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#ch01-zabbix-components-mariadb-__codelineno-18-48"></a>
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49" href="#ch01-zabbix-components-mariadb-__codelineno-18-49"></a><span class="go">Remove test database and access to it? [Y/n] y</span>
</span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50" href="#ch01-zabbix-components-mariadb-__codelineno-18-50"></a><span class="go"> - Dropping test database...</span>
</span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51" href="#ch01-zabbix-components-mariadb-__codelineno-18-51"></a><span class="go"> ... Success!</span>
</span><span id="__span-18-52"><a id="__codelineno-18-52" name="__codelineno-18-52" href="#ch01-zabbix-components-mariadb-__codelineno-18-52"></a><span class="go"> - Removing privileges on test database...</span>
</span><span id="__span-18-53"><a id="__codelineno-18-53" name="__codelineno-18-53" href="#ch01-zabbix-components-mariadb-__codelineno-18-53"></a><span class="go"> ... Success!</span>
</span><span id="__span-18-54"><a id="__codelineno-18-54" name="__codelineno-18-54" href="#ch01-zabbix-components-mariadb-__codelineno-18-54"></a>
</span><span id="__span-18-55"><a id="__codelineno-18-55" name="__codelineno-18-55" href="#ch01-zabbix-components-mariadb-__codelineno-18-55"></a><span class="go">Reloading the privilege tables will ensure that all changes made so far</span>
</span><span id="__span-18-56"><a id="__codelineno-18-56" name="__codelineno-18-56" href="#ch01-zabbix-components-mariadb-__codelineno-18-56"></a><span class="go">will take effect immediately.</span>
</span><span id="__span-18-57"><a id="__codelineno-18-57" name="__codelineno-18-57" href="#ch01-zabbix-components-mariadb-__codelineno-18-57"></a>
</span><span id="__span-18-58"><a id="__codelineno-18-58" name="__codelineno-18-58" href="#ch01-zabbix-components-mariadb-__codelineno-18-58"></a><span class="go">Reload privilege tables now? [Y/n] y</span>
</span><span id="__span-18-59"><a id="__codelineno-18-59" name="__codelineno-18-59" href="#ch01-zabbix-components-mariadb-__codelineno-18-59"></a><span class="go"> ... Success!</span>
</span><span id="__span-18-60"><a id="__codelineno-18-60" name="__codelineno-18-60" href="#ch01-zabbix-components-mariadb-__codelineno-18-60"></a>
</span><span id="__span-18-61"><a id="__codelineno-18-61" name="__codelineno-18-61" href="#ch01-zabbix-components-mariadb-__codelineno-18-61"></a><span class="go">Cleaning up...</span>
</span><span id="__span-18-62"><a id="__codelineno-18-62" name="__codelineno-18-62" href="#ch01-zabbix-components-mariadb-__codelineno-18-62"></a>
</span><span id="__span-18-63"><a id="__codelineno-18-63" name="__codelineno-18-63" href="#ch01-zabbix-components-mariadb-__codelineno-18-63"></a><span class="go">All done!  If you&#39;ve completed all of the above steps, your MariaDB</span>
</span><span id="__span-18-64"><a id="__codelineno-18-64" name="__codelineno-18-64" href="#ch01-zabbix-components-mariadb-__codelineno-18-64"></a><span class="go">installation should now be secure.</span>
</span><span id="__span-18-65"><a id="__codelineno-18-65" name="__codelineno-18-65" href="#ch01-zabbix-components-mariadb-__codelineno-18-65"></a>
</span><span id="__span-18-66"><a id="__codelineno-18-66" name="__codelineno-18-66" href="#ch01-zabbix-components-mariadb-__codelineno-18-66"></a><span class="go">Thanks for using MariaDB!</span>
</span></code></pre></div>
</div>
<p>You are now ready to configure the database for Zabbix.</p>
<hr />
<h2 id="ch01-zabbix-components-mariadb-creating-the-zabbix-database-instance">Creating the Zabbix database instance</h2>
<p>With MariaDB now set up and secured, we can move on to creating the database for
Zabbix. This database will store all the necessary data related to your Zabbix server,
including configuration information and monitoring data.</p>
<p>Follow these steps to create the Zabbix database:</p>
<p>Log in to the MariaDB shell as the root user:
You'll be prompted to enter the root password that you set during the mariadb-secure-installation
process.</p>
<div class="admonition info">
<p class="admonition-title">Enter Mariadb as user root</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch01-zabbix-components-mariadb-__codelineno-19-1"></a>mariadb<span class="w"> </span>-uroot<span class="w"> </span>-p
</span></code></pre></div>
</div>
<p>Once you're logged into the MariaDB shell, run the following command to create a
database for Zabbix:</p>
<div class="admonition info">
<p class="admonition-title">Create the database</p>
<div class="language-mysql highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch01-zabbix-components-mariadb-__codelineno-20-1"></a><span class="n">MariaDB</span><span class="w"> </span><span class="err">[</span><span class="p">(</span><span class="k">none</span><span class="p">)</span><span class="err">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">zabbix</span><span class="w"> </span><span class="k">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">utf8mb4</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="n">utf8mb4_bin</span><span class="p">;</span>
</span></code></pre></div>
</div>
<details class="note" open="open">
<summary>What is utf8mb4</summary>
<p>utf8mb4 is a proper implementation of UTF-8 in MySQL/MariaDB, supporting all
 Unicode characters, including emojis. The older utf8 charset in MySQL/MariaDB
 only supports up to three bytes per character and is not a true UTF-8 implementation,
 which is why utf8mb4 is recommended.</p>
</details>
<p>This command creates a new database named <code>zabbix</code> with the UTF-8 character set,
which is required for Zabbix.</p>
<p>Create a dedicated user for Zabbix and grant the necessary privileges: Next, you
need to create a user that Zabbix will use to access the database. Replace <code>&lt;password&gt;</code>
with a strong password of your choice.</p>
<div class="admonition info">
<p class="admonition-title">Create users and grant privileges</p>
<div class="language-mysql highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch01-zabbix-components-mariadb-__codelineno-21-1"></a><span class="n">MariaDB</span><span class="w"> </span><span class="err">[</span><span class="p">(</span><span class="k">none</span><span class="p">)</span><span class="err">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;zabbix-web&#39;</span><span class="nv">@&#39;&lt;zabbix frontend ip&gt;&#39;</span><span class="w"> </span><span class="k">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;&lt;password&gt;&#39;</span><span class="p">;</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#ch01-zabbix-components-mariadb-__codelineno-21-2"></a><span class="n">MariaDB</span><span class="w"> </span><span class="err">[</span><span class="p">(</span><span class="k">none</span><span class="p">)</span><span class="err">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;zabbix-srv&#39;</span><span class="nv">@&#39;&lt;zabbix server ip&gt;&#39;</span><span class="w"> </span><span class="k">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;&lt;password&gt;&#39;</span><span class="p">;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#ch01-zabbix-components-mariadb-__codelineno-21-3"></a><span class="n">MariaDB</span><span class="w"> </span><span class="err">[</span><span class="p">(</span><span class="k">none</span><span class="p">)</span><span class="err">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">zabbix</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;zabbix-srv&#39;</span><span class="nv">@&#39;&lt;zabbix server ip&gt;&#39;</span><span class="p">;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#ch01-zabbix-components-mariadb-__codelineno-21-4"></a><span class="n">MariaDB</span><span class="w"> </span><span class="err">[</span><span class="p">(</span><span class="k">none</span><span class="p">)</span><span class="err">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="k">UPDATE</span><span class="p">,</span><span class="w"> </span><span class="k">DELETE</span><span class="p">,</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">zabbix</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;zabbix-web&#39;</span><span class="nv">@&#39;&lt;zabbix server ip&gt;&#39;</span><span class="p">;</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#ch01-zabbix-components-mariadb-__codelineno-21-5"></a><span class="n">MariaDB</span><span class="w"> </span><span class="err">[</span><span class="p">(</span><span class="k">none</span><span class="p">)</span><span class="err">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span>
</span></code></pre></div>
<ul>
<li>Replace <code>&lt;zabbix server ip&gt;</code> with the actual IP address of your server
  where the Zabbix server  will be installed.</li>
<li>Replace <code>&lt;zabbix frontend ip&gt;</code> with the actual IP address of your server
  where the Zabbix frontend will be installed.</li>
</ul>
<p>If both components are installed on the same server, use the same IP address.</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>If your Zabbix server, frontend and database are on the same machine, you can replace
<code>&lt;zabbix server ip&gt;</code> and <code>&lt;zabbix frontend ip&gt;</code> with <code>localhost</code> or <code>127.0.0.1</code>.</p>
</details>
</div>
<p>This creates new users <code>zabbix-web</code> and <code>zabbix-srv</code>, grants them access to the
Zabbix database, and ensures that the privileges are applied immediately.</p>
<p>At this point, your Zabbix database is ready, but before it can actually be used by
Zabbix, we still need to populate the database with the necessary tables and initial data,
but that will be covered in the next section when we install the Zabbix server.</p>
<p>If you intent to install Zabbix server on a different machine than the one hosting
the database you will need to open the host firewall to allow incoming connections
to the database server. By default, MariaDB listens on port 3306.</p>
<div class="admonition info">
<p class="admonition-title">Add firewall rules</p>
<p>Red Hat / SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch01-zabbix-components-mariadb-__codelineno-22-1"></a>firewall-cmd<span class="w"> </span>--add-service<span class="o">=</span>mysql<span class="w"> </span>--permanent
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#ch01-zabbix-components-mariadb-__codelineno-22-2"></a>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ch01-zabbix-components-mariadb-__codelineno-23-1"></a>sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">3306</span>/tcp
</span></code></pre></div></p>
</div>
<hr />
<h2 id="ch01-zabbix-components-mariadb-populate-the-zabbix-database">Populate the Zabbix database</h2>
<p>During the installation of the database software earlier, we created the 
necessary users and database for Zabbix, however, Zabbix expects certain tables,
schemas, images, and other elements to be present in the database.
To set up the database correctly, we need to populate it with the required schema.</p>
<p>First we need to install the Zabbix SQL scripts that contain the required
import scripts for the database.</p>
<div class="admonition info">
<p class="admonition-title">Install SQL scripts</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ch01-zabbix-components-mariadb-__codelineno-24-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>zabbix-sql-scripts
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ch01-zabbix-components-mariadb-__codelineno-25-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>zabbix-sql-scripts
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ch01-zabbix-components-mariadb-__codelineno-26-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>zabbix-sql-scripts
</span></code></pre></div></p>
</div>
<details class="warning" open="open">
<summary>Warning</summary>
<p>When using a recent version of MySQL or MariaDB as the database backend for 
Zabbix, you may encounter issues related to the creation of triggers during
the schema import process. This is particularly relevant if binary logging
is enabled on your database server. (Binary logging is often enabled by default)
To address this, you need to set the <code>log_bin_trust_function_creators</code> option to <code>1</code>
in the MySQL/MariaDB configuration file or temporarily at runtime.
This allows non-root users to create stored functions and triggers without requiring
<code>SUPER</code> privileges, which are restricted when binary logging is enabled.</p>
<p>Normally we won't need the setting after the initial import of the Zabbix schema is done,
so we will disable it again after the import is complete.</p>
<div class="admonition info">
<p class="admonition-title">Activate temporarily extra privileges for non root users</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#ch01-zabbix-components-mariadb-__codelineno-27-1"></a>mariadb<span class="w"> </span>-uroot<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;SET GLOBAL log_bin_trust_function_creators = 1;&quot;</span>
</span></code></pre></div>
</div>
</details>
<p>Now lets upload the data from zabbix (db structure, images, user, ... )
for this we make use of the user <code>zabbix-srv</code> and we upload it all in our DB <code>zabbix</code>.</p>
<div class="admonition info">
<p class="admonition-title">Populate the database</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#ch01-zabbix-components-mariadb-__codelineno-28-1"></a>sudo<span class="w"> </span>zcat<span class="w"> </span>/usr/share/zabbix/sql-scripts/mysql/server.sql.gz<span class="w"> </span><span class="p">|</span><span class="w"> </span>mariadb<span class="w"> </span>--default-character-set<span class="o">=</span>utf8mb4<span class="w"> </span>-uroot<span class="w"> </span>-p<span class="w"> </span>zabbix
</span></code></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Depending on the speed of your hardware or virtual machine, the process may
take anywhere from a few seconds to several minutes without any visual feedback
after entering the root password.</p>
<p>Please be patient and avoid cancelling the operation; just wait for the linux 
prompt to reappear.</p>
</div>
<details class="note" open="open">
<summary>Note</summary>
<p>Zabbix seems to like to change the locations of the script to populate the
DB every version or even in between versions. If you encounter an error take a
look at the Zabbix documentation, there is a good chance that some location was
changed.</p>
</details>
<p>Once the import of the Zabbix schema is complete, you should no longer need the
<code>log_bin_trust_function_creators</code> global parameter. It is a good practice to remove
it for security reasons.</p>
<p>To revert the global parameter back to 0, use the following command in the 
MySQL/MariaDB shell:</p>
<div class="admonition info">
<p class="admonition-title">Disable function log_bin_trust again</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#ch01-zabbix-components-mariadb-__codelineno-29-1"></a>mariadb<span class="w"> </span>-uroot<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;SET GLOBAL log_bin_trust_function_creators = 0;&quot;</span>
</span></code></pre></div>
</div>
<p>This command will disable the setting, ensuring that the servers security
posture remains robust.</p>
<p>This concludes our installation of the MariaDB. You can now proceed to <a href="#ch00-getting-started-preparation">Preparing the Zabbix server</a>.</p>
<hr />
<h2 id="ch01-zabbix-components-mariadb-conclusion">Conclusion</h2>
<p>With the successful installation and configuration of MariaDB as the database 
backend for Zabbix, you now have a robust foundation for your monitoring solution.
We've covered the installation of MariaDB from both vendor-provided packages and
official repositories, securing the database, creating the necessary Zabbix 
database and users, and populating the database with the required schema and 
initial data.</p>
<p>Your Zabbix environment is now ready for the next stages of setup and configuration.</p>
<hr />
<h2 id="ch01-zabbix-components-mariadb-questions">Questions</h2>
<ol>
<li>What version of MariaDB should I install for compatibility and stability?</li>
<li>What port does my DB use ?</li>
<li>Which database users did I create and why?</li>
</ol>
<hr />
<h2 id="ch01-zabbix-components-mariadb-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://mariadb.org/download/">https://mariadb.org/download/</a></li>
<li><a href="https://mariadb.com/docs/server/server-usage/stored-routines/binary-logging-of-stored-routines">https://mariadb.com/docs/server/server-usage/stored-routines/binary-logging-of-stored-routines</a></li>
</ul></section><section class="print-page" id="ch01-zabbix-components-postgresql" heading-number="6.3.3"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="installing-a-postgresql-database">Installing a PostgreSQL database</h1>
<p>Alternatively to MariaDB/MySQL, you can choose to use PostgreSQL as the database backend for Zabbix.
Similar to MariaDB, PostgreSQL can be installed using either the OS vendor-provided
packages or the official PostgreSQL repositories.</p>
<p>If you already have installed MariaDB in the previous section, you can skip this section.</p>
<p>As of writing PostgreSQL 13-18 are supported by Zabbix. Check the Zabbix documentation
for an up-to-date list of supported versions for your Zabbix version. Usually it's
a good idea to go with the latest version that is supported by Zabbix. </p>
<details class="tip" open="open">
<summary>TimescaleDB extension</summary>
<p>Zabbix also supports the extension TimescaleDB but due to its advanced nature, 
we won't cover it in this chapter. Refer to <a href="#ch13-advanced-security-partitioning-postgresql-database"><em>Partitioning PostgreSQL with TimescaleDB</em></a>
for detailed instructions on that topic. </p>
<p>Do note that if you want to use TimescaleDB RPM packages provided
by Timescale, you will need to install PostgreSQL from the official
PostgreSQL repositories instead of the OS vendor-provided packages.
If you choose to install PostgreSQL from the OS vendor-provided packages,
you will need to compile and install the TimescaleDB extension from source.</p>
</details>
<hr />
<h2 id="ch01-zabbix-components-postgresql-installing-postgresql-server-and-client-from-os-vendor-provided-packages">Installing PostgreSQL Server and Client from OS Vendor-Provided Packages</h2>
<p>To install the distribution default PostgreSQL server, execute the following 
commands:</p>
<div class="admonition info">
<p class="admonition-title">Install the Postgres server</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch01-zabbix-components-postgresql-__codelineno-0-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>postgresql-server<span class="w"> </span>postgresql-client<span class="w"> </span>postgresql-contrib
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch01-zabbix-components-postgresql-__codelineno-1-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>postgresql-server<span class="w"> </span>postgresql<span class="w"> </span>postgresql-contrib
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch01-zabbix-components-postgresql-__codelineno-2-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>postgresql<span class="w"> </span>postgresql-client<span class="w"> </span>postgresql-contrib
</span></code></pre></div></p>
</div>
<p>This command will download and install both the server and client packages, enabling
you to set up, configure, and interact with your PostgreSQL database.</p>
<div class="admonition warning">
<p class="admonition-title">Database initialization required on Red Hat</p>
<p>Due to policies for Red Hat family distributions, the PostgreSQL service
does not initialize an empty database required for PostgreSQL to function.
So for Red Hat we need to initialize an empty database before continuing:</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch01-zabbix-components-postgresql-__codelineno-3-1"></a>postgresql-setup<span class="w"> </span>--initdb<span class="w"> </span>--unit<span class="w"> </span>postgresql
</span></code></pre></div></p>
<p>On SUSE and Ubuntu the OS provided SystemD service will automatically initialize
an empty database on first startup.</p>
</div>
<p>Once the installation is complete, you can proceed to the <a href="#ch01-zabbix-components-postgresql-starting-the-postgresql-database"><em>Starting the PostgreSQL Database</em></a> section.</p>
<hr />
<h2 id="ch01-zabbix-components-postgresql-installing-postgresql-from-official-postgresql-repositories">Installing PostgreSQL from Official PostgreSQL Repositories</h2>
<p>If you prefer to install PostgreSQL from the official PostgreSQL repositories instead
of the OS vendor-provided packages, the first step is to add the PostgreSQL repository
to your system.</p>
<hr />
<h3 id="ch01-zabbix-components-postgresql-adding-the-postgresql-repository">Adding the PostgreSQL Repository</h3>
<p>Set up the PostgreSQL repository with the following commands:</p>
<p>Check <a href="https://www.postgresql.org/download/linux/">https://www.postgresql.org/download/linux/</a>
for more information.</p>
<div class="admonition info">
<p class="admonition-title">Add PostgreSQL repo</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch01-zabbix-components-postgresql-__codelineno-4-1"></a><span class="c1"># Install the repository RPM:</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch01-zabbix-components-postgresql-__codelineno-4-2"></a>dnf<span class="w"> </span>install<span class="w"> </span>https://download.postgresql.org/pub/repos/yum/reporpms/EL-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch01-zabbix-components-postgresql-__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch01-zabbix-components-postgresql-__codelineno-4-4"></a><span class="c1"># Disable the built-in PostgreSQL module:</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ch01-zabbix-components-postgresql-__codelineno-4-5"></a>dnf<span class="w"> </span>-qy<span class="w"> </span>module<span class="w"> </span>disable<span class="w"> </span>postgresql
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch01-zabbix-components-postgresql-__codelineno-5-1"></a><span class="c1"># Import the repository signing key:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch01-zabbix-components-postgresql-__codelineno-5-2"></a>rpm<span class="w"> </span>--import<span class="w"> </span>https://zypp.postgresql.org/keys/PGDG-RPM-GPG-KEY-SLES16
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch01-zabbix-components-postgresql-__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ch01-zabbix-components-postgresql-__codelineno-5-4"></a><span class="c1"># Install the repository RPM:</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ch01-zabbix-components-postgresql-__codelineno-5-5"></a>zypper<span class="w"> </span>install<span class="w"> </span>https://download.postgresql.org/pub/repos/zypp/reporpms/SLES-16-x86_64/pgdg-suse-repo-latest.noarch.rpm
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#ch01-zabbix-components-postgresql-__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#ch01-zabbix-components-postgresql-__codelineno-5-7"></a><span class="c1"># Update the package lists:</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#ch01-zabbix-components-postgresql-__codelineno-5-8"></a>zypper<span class="w"> </span>refresh
</span></code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">openSUSE Leap</p>
<p>Since the official PostgreSQL packages are specifically built for use on 
SUSE Linux Enterprise Server (SLES), you will get an error trying to install the
repository on openSUSE Leap. We can however safely ignore this problem by
choosing to "break the package by ignoring some of its dependencies" as
long as you match the SLES version with your openSUSE version:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch01-zabbix-components-postgresql-__codelineno-6-1"></a>Problem: 1: nothing provides &#39;sles-release&#39; needed by the to be installed pgdg-suse-repo-42.0-48PGDG.noarch
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch01-zabbix-components-postgresql-__codelineno-6-2"></a> Solution 1: do not install pgdg-suse-repo-42.0-48PGDG.noarch
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch01-zabbix-components-postgresql-__codelineno-6-3"></a> Solution 2: break pgdg-suse-repo-42.0-48PGDG.noarch by ignoring some of its dependencies
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ch01-zabbix-components-postgresql-__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ch01-zabbix-components-postgresql-__codelineno-6-5"></a>Choose from above solutions by number or cancel [1/2/c/d/?] (c): 2
</span></code></pre></div>
</div>
<details class="note" open="open">
<summary>Suse Linux Enterprise Server</summary>
<p>On SUSE Linux Enterprise Server (SLES), ensure you are subscribed to the
"SUSE Package Hub extension" repository to access necessary dependency
packages required for the Official PostgreSQL installation. On SLES 15
you will also need the "Desktop Applications Module":</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch01-zabbix-components-postgresql-__codelineno-7-1"></a><span class="c1"># On SLES 16</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch01-zabbix-components-postgresql-__codelineno-7-2"></a>suseconnect<span class="w"> </span>-p<span class="w"> </span>PackageHub/16.0/x86_64
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch01-zabbix-components-postgresql-__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#ch01-zabbix-components-postgresql-__codelineno-7-4"></a><span class="c1"># On SLES 15</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#ch01-zabbix-components-postgresql-__codelineno-7-5"></a>SUSEConnect<span class="w"> </span>-p<span class="w"> </span>sle-module-desktop-applications/15.7/x86_64
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#ch01-zabbix-components-postgresql-__codelineno-7-6"></a>SUSEConnect<span class="w"> </span>-p<span class="w"> </span>PackageHub/15.7/x86_64
</span></code></pre></div>
</details>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch01-zabbix-components-postgresql-__codelineno-8-1"></a><span class="c1"># Import the repository signing key:</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ch01-zabbix-components-postgresql-__codelineno-8-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>curl<span class="w"> </span>ca-certificates
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ch01-zabbix-components-postgresql-__codelineno-8-3"></a>sudo<span class="w"> </span>install<span class="w"> </span>-d<span class="w"> </span>/usr/share/postgresql-common/pgdg
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#ch01-zabbix-components-postgresql-__codelineno-8-4"></a>sudo<span class="w"> </span>curl<span class="w"> </span>-o<span class="w"> </span>/usr/share/postgresql-common/pgdg/apt.postgresql.org.asc<span class="w"> </span>--fail<span class="w"> </span>https://www.postgresql.org/media/keys/ACCC4CF8.asc
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#ch01-zabbix-components-postgresql-__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#ch01-zabbix-components-postgresql-__codelineno-8-6"></a><span class="c1"># Create the repository configuration file:</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#ch01-zabbix-components-postgresql-__codelineno-8-7"></a>sudo<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;echo &quot;deb [signed-by=/usr/share/postgresql-common/pgdg/apt.postgresql.org.asc] https://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&quot; &gt; /etc/apt/sources.list.d/pgdg.list&#39;</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#ch01-zabbix-components-postgresql-__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#ch01-zabbix-components-postgresql-__codelineno-8-9"></a><span class="c1"># Update the package lists:</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#ch01-zabbix-components-postgresql-__codelineno-8-10"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update
</span></code></pre></div></p>
</div>
<hr />
<h3 id="ch01-zabbix-components-postgresql-installing-the-postgresql-server-and-client">Installing the PostgreSQL Server and Client</h3>
<p>With the PostgreSQL repositories configured, you are now ready to install the PostgreSQL
server and client packages. This will provide the necessary components to run
and manage your database.</p>
<div class="admonition info">
<p class="admonition-title">Install PostgreSQL from official repositories</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch01-zabbix-components-postgresql-__codelineno-9-1"></a><span class="c1"># Install Postgres server:</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ch01-zabbix-components-postgresql-__codelineno-9-2"></a>dnf<span class="w"> </span>install<span class="w"> </span>postgresql17<span class="w"> </span>postgresql17-server<span class="w"> </span>postgresql17-contrib
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch01-zabbix-components-postgresql-__codelineno-10-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>postgresql17<span class="w"> </span>postgresql17-server<span class="w"> </span>postgresql17-contrib
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch01-zabbix-components-postgresql-__codelineno-11-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>postgresql-17<span class="w"> </span>postgresql-client-17
</span></code></pre></div></p>
</div>
<p>This command will download and install both the server and client packages, enabling
you to set up, configure, and interact with your PostgreSQL database. </p>
<p>Next, before we can start the PostgreSQL server we need to initialize a new
empty database:</p>
<div class="admonition info">
<p class="admonition-title">Initialize empty PostgreSQL database</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch01-zabbix-components-postgresql-__codelineno-12-1"></a>sudo /usr/pgsql-17/bin/postgresql-17-setup initdb
</span></code></pre></div>
</div>
<p>Once the installation is complete, you can proceed to the <a href="#ch01-zabbix-components-postgresql-starting-the-postgresql-database">Starting the PostgreSQL Database</a> section.</p>
<hr />
<h2 id="ch01-zabbix-components-postgresql-starting-the-postgresql-database">Starting the PostgreSQL Database</h2>
<p>Now that PostgreSQL is installed, we need to enable the service to start automatically
upon boot as well as start it immediately. Use the following command to accomplish this:</p>
<div class="admonition info">
<p class="admonition-title">Enable and start PostgreSQL service</p>
<p>for OS-provided packages
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch01-zabbix-components-postgresql-__codelineno-13-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>postgresql<span class="w"> </span>--now
</span></code></pre></div></p>
<p>for official PostgreSQL packages:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch01-zabbix-components-postgresql-__codelineno-14-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>postgresql-17<span class="w"> </span>--now
</span></code></pre></div></p>
</div>
<p>This command will both enable and start the PostgreSQL service.
With the service now up and running, you can verify that the installation
was successful by checking the version of PostgreSQL using the following command:</p>
<div class="admonition info">
<p class="admonition-title">Check PostgreSQL version</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch01-zabbix-components-postgresql-__codelineno-15-1"></a>psql<span class="w"> </span>-V
</span></code></pre></div>
</div>
<p>The expected output should resemble this:</p>
<details class="example" open="open">
<summary>PostgreSQL version example</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch01-zabbix-components-postgresql-__codelineno-16-1"></a><span class="gp">localhost:~ $ </span>psql<span class="w"> </span>-V
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#ch01-zabbix-components-postgresql-__codelineno-16-2"></a><span class="go">psql (PostgreSQL) 17.7</span>
</span></code></pre></div>
</details>
<p>To ensure that the PostgreSQL service is running properly, you can check its status
with the following command:</p>
<div class="admonition info">
<p class="admonition-title">Get PostgreSQL status</p>
<p>for OS-provided packages
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch01-zabbix-components-postgresql-__codelineno-17-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>postgresql
</span></code></pre></div></p>
<p>for official PostgreSQL packages:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch01-zabbix-components-postgresql-__codelineno-18-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>postgresql-17
</span></code></pre></div></p>
</div>
<p>You should see an output similar to this, indicating that the PostgreSQL service
is active and running:</p>
<details class="example" open="open">
<summary>PostgreSQL service status example</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch01-zabbix-components-postgresql-__codelineno-19-1"></a><span class="gp">localhost:~ $ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>postgresql-17
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#ch01-zabbix-components-postgresql-__codelineno-19-2"></a><span class="go">‚óè postgresql-17.service - PostgreSQL 17 database server</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#ch01-zabbix-components-postgresql-__codelineno-19-3"></a><span class="go">    Loaded: loaded (/usr/lib/systemd/system/postgresql-17.service; enabled; preset: disabled)</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#ch01-zabbix-components-postgresql-__codelineno-19-4"></a><span class="go">    Active: active (running) since Mon 2025-12-29 17:24:07 CET; 6s ago</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#ch01-zabbix-components-postgresql-__codelineno-19-5"></a><span class="go">Invocation: 43ba47dfee5b415db223e3452c3cfacc</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#ch01-zabbix-components-postgresql-__codelineno-19-6"></a><span class="go">    Docs: https://www.postgresql.org/docs/17/static/</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#ch01-zabbix-components-postgresql-__codelineno-19-7"></a><span class="go">    Process: 11131 ExecStartPre=/usr/pgsql-17/bin/postgresql-17-check-db-dir ${PGDATA} (code=exited, status=0/SUCCESS)</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#ch01-zabbix-components-postgresql-__codelineno-19-8"></a><span class="go">Main PID: 11137 (postgres)</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#ch01-zabbix-components-postgresql-__codelineno-19-9"></a><span class="go">    Tasks: 7 (limit: 4672)</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#ch01-zabbix-components-postgresql-__codelineno-19-10"></a><span class="go">        CPU: 471ms</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#ch01-zabbix-components-postgresql-__codelineno-19-11"></a><span class="go">    CGroup: /system.slice/postgresql-17.service</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#ch01-zabbix-components-postgresql-__codelineno-19-12"></a><span class="go">            ‚îú‚îÄ11137 /usr/pgsql-17/bin/postgres -D /var/lib/pgsql/17/data/</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#ch01-zabbix-components-postgresql-__codelineno-19-13"></a><span class="go">            ‚îú‚îÄ11138 &quot;postgres: logger &quot;</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#ch01-zabbix-components-postgresql-__codelineno-19-14"></a><span class="go">            ‚îú‚îÄ11139 &quot;postgres: checkpointer &quot;</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#ch01-zabbix-components-postgresql-__codelineno-19-15"></a><span class="go">            ‚îú‚îÄ11140 &quot;postgres: background writer &quot;</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#ch01-zabbix-components-postgresql-__codelineno-19-16"></a><span class="go">            ‚îú‚îÄ11142 &quot;postgres: walwriter &quot;</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#ch01-zabbix-components-postgresql-__codelineno-19-17"></a><span class="go">            ‚îú‚îÄ11143 &quot;postgres: autovacuum launcher &quot;</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#ch01-zabbix-components-postgresql-__codelineno-19-18"></a><span class="go">            ‚îî‚îÄ11144 &quot;postgres: logical replication launcher &quot;</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#ch01-zabbix-components-postgresql-__codelineno-19-19"></a>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#ch01-zabbix-components-postgresql-__codelineno-19-20"></a><span class="go">Dec 29 17:24:07 localhost.localdomain systemd[1]: Starting PostgreSQL 17 database server...</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#ch01-zabbix-components-postgresql-__codelineno-19-21"></a><span class="go">Dec 29 17:24:07 localhost.localdomain postgres[11137]: 2025-12-29 17:24:07.650 CET [11137] LOG:  redirecting log output to logging co&gt;</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#ch01-zabbix-components-postgresql-__codelineno-19-22"></a><span class="go">Dec 29 17:24:07 localhost.localdomain postgres[11137]: 2025-12-29 17:24:07.650 CET [11137] HINT:  Future log output will appear in di&gt;</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#ch01-zabbix-components-postgresql-__codelineno-19-23"></a><span class="go">Dec 29 17:24:07 localhost.localdomain systemd[1]: Started PostgreSQL 17 database server.</span>
</span></code></pre></div>
</details>
<p>This confirms that your PostgreSQL server is up and running, ready for further configuration.</p>
<hr />
<h2 id="ch01-zabbix-components-postgresql-securing-the-postgresql-database">Securing the PostgreSQL database</h2>
<p>PostgreSQL handles access permissions differently from MySQL and MariaDB.
PostgreSQL relies on a file called <code>pg_hba.conf</code> to manage who can access the database,
from where, and what encryption method is allowed for authentication.</p>
<details class="note" open="open">
<summary>About pg_hba.conf</summary>
<p>Client authentication in PostgreSQL is configured through the <code>pg_hba.conf</code>
file, where "HBA" stands for Host-Based Authentication. This file specifies
which users can access the database, from which hosts, and how they are authenticated.
For further details, you can refer to the official PostgreSQL documentation."
<a href="https://www.postgresql.org/docs/current/auth-pg-hba-conf.html">https://www.postgresql.org/docs/current/auth-pg-hba-conf.html</a></p>
</details>
<p>Add the following lines, the order here is important.</p>
<div class="admonition info">
<p class="admonition-title">Edit the pg_hba file</p>
<p>Red Hat / SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch01-zabbix-components-postgresql-__codelineno-20-1"></a><span class="c1"># for OS-provided packages</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#ch01-zabbix-components-postgresql-__codelineno-20-2"></a>vi<span class="w"> </span>/var/lib/pgsql/data/pg_hba.conf
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#ch01-zabbix-components-postgresql-__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#ch01-zabbix-components-postgresql-__codelineno-20-4"></a><span class="c1"># for official packages</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#ch01-zabbix-components-postgresql-__codelineno-20-5"></a>vi<span class="w"> </span>/var/lib/pgsql/17/data/pg_hba.conf
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch01-zabbix-components-postgresql-__codelineno-21-1"></a><span class="c1"># for OS-provided packages</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#ch01-zabbix-components-postgresql-__codelineno-21-2"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/postgresql/current/main/pg_hba.conf
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#ch01-zabbix-components-postgresql-__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#ch01-zabbix-components-postgresql-__codelineno-21-4"></a><span class="c1"># for official packages</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#ch01-zabbix-components-postgresql-__codelineno-21-5"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/postgresql/17/main/pg_hba.conf
</span></code></pre></div></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Location of pg_hba file</p>
<p>If you don't find the <code>pg_hba.conf</code> and <code>postgres.conf</code> files in the above 
mentioned location you can ask PostgreSQL itself for the location using
this command (provided that PostgreSQL is currently running):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch01-zabbix-components-postgresql-__codelineno-22-1"></a>sudo<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>psql<span class="w"> </span>-t<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;show hba_file&#39;</span><span class="p">;</span>
</span></code></pre></div>
</div>
<p>The resulting pg_hba file should look like :</p>
<div class="admonition example">
<p class="admonition-title">Pg_hba example</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ch01-zabbix-components-postgresql-__codelineno-23-1"></a># &quot;local&quot; is for Unix domain socket connections only
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#ch01-zabbix-components-postgresql-__codelineno-23-2"></a>local    zabbix     zabbix-srv                                 scram-sha-256
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#ch01-zabbix-components-postgresql-__codelineno-23-3"></a>local    all        all                                        peer
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#ch01-zabbix-components-postgresql-__codelineno-23-4"></a># IPv4 local connections
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#ch01-zabbix-components-postgresql-__codelineno-23-5"></a>host     zabbix         zabbix-srv      &lt;ip from zabbix server/24&gt;     scram-sha-256
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#ch01-zabbix-components-postgresql-__codelineno-23-6"></a>host     zabbix         zabbix-web      &lt;ip from zabbix server/24&gt;     scram-sha-256
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#ch01-zabbix-components-postgresql-__codelineno-23-7"></a>host     all            all             127.0.0.1/32                   scram-sha-256
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#ch01-zabbix-components-postgresql-__codelineno-23-8"></a># IPv6 local connections:
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#ch01-zabbix-components-postgresql-__codelineno-23-9"></a>host    zabbix          zabbix-srv      ::1/128                 scram-sha-256
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#ch01-zabbix-components-postgresql-__codelineno-23-10"></a>host    zabbix          zabbix-web      ::1/128                 scram-sha-256
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#ch01-zabbix-components-postgresql-__codelineno-23-11"></a>host    all             all             ::1/128                 ident
</span></code></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Ensure to keep the order of the entries</p>
<p>The order of the entries in the <code>pg_hba.conf</code> file is crucial, as PostgreSQL
processes these rules sequentially. Ensure that the specific rules for the
<code>zabbix-srv</code> and <code>zabbix-web</code> users are placed before any broader rules like
the default <code>all</code> user rules that could potentially override them.</p>
</div>
<p>After we changed the <code>pg_hba.conf</code> file don't forget to restart postgres otherwise the settings
will not be applied. But before we restart, let us also edit the file <code>postgresql.conf</code>
and allow our database to listen on our network interface for incoming connections
from the Zabbix server. PostgreSQL will by default only allow connections from a unix socket.</p>
<div class="admonition info">
<p class="admonition-title">Edit postgresql.conf file</p>
<p>Red Hat / SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ch01-zabbix-components-postgresql-__codelineno-24-1"></a><span class="c1"># for OS-provided packages</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#ch01-zabbix-components-postgresql-__codelineno-24-2"></a>vi<span class="w"> </span>/var/lib/pgsql/data/postgresql.conf
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#ch01-zabbix-components-postgresql-__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#ch01-zabbix-components-postgresql-__codelineno-24-4"></a><span class="c1"># for official packages</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#ch01-zabbix-components-postgresql-__codelineno-24-5"></a>vi<span class="w"> </span>/var/lib/pgsql/17/data/postgresql.conf
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ch01-zabbix-components-postgresql-__codelineno-25-1"></a><span class="c1"># for OS-provided packages</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#ch01-zabbix-components-postgresql-__codelineno-25-2"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/postgresql/current/main/postgresql.conf
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#ch01-zabbix-components-postgresql-__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#ch01-zabbix-components-postgresql-__codelineno-25-4"></a><span class="c1"># for official packages</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#ch01-zabbix-components-postgresql-__codelineno-25-5"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/postgresql/17/main/postgresql.conf
</span></code></pre></div></p>
</div>
<p>Locate the following line:</p>
<div class="admonition info">
<div class="language-ini highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ch01-zabbix-components-postgresql-__codelineno-26-1"></a><span class="c1">#listen_addresses = &#39;localhost&#39;</span>
</span></code></pre></div>
</div>
<p>and replace it with:</p>
<div class="admonition info">
<div class="language-ini highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#ch01-zabbix-components-postgresql-__codelineno-27-1"></a><span class="na">listen_addresses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
</span></code></pre></div>
</div>
<details class="note" open="open">
<summary>Note</summary>
<p>This will enable PostgreSQL to accept connections from any network interface,
not just the local machine. In production it's probably a good idea to limit
who can connect to the DB.</p>
</details>
<p>After making this change, restart the PostgreSQL service to apply the new settings:</p>
<div class="admonition info">
<p class="admonition-title">Restart the DB server</p>
<p>for OS-provided packages
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#ch01-zabbix-components-postgresql-__codelineno-28-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>postgresql
</span></code></pre></div></p>
<p>for official packages
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#ch01-zabbix-components-postgresql-__codelineno-29-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>postgresql-17
</span></code></pre></div></p>
</div>
<details class="tip" open="open">
<summary>Tip</summary>
<p>If the service fails to restart, review the <code>pg_hba.conf</code> file for any syntax errors,
as incorrect entries here may prevent PostgreSQL from starting.</p>
</details>
<hr />
<h2 id="ch01-zabbix-components-postgresql-creating-the-zabbix-database-instance">Creating the Zabbix database instance</h2>
<p>With the necessary packages installed, you are now ready to create the Zabbix 
database and users for both the server and frontend.</p>
<p>The PostgreSQL packages automatically create a default <code>postgres</code> linux-user 
during installation which has administrative privileges on the PostgreSQL instance.
To administer the database, you will need to execute commands as the <code>postgres</code> user.</p>
<p>First, create the Zabbix server database user (also referred to as a "role" in PostgreSQL):</p>
<div class="admonition info">
<p class="admonition-title">Create server users</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#ch01-zabbix-components-postgresql-__codelineno-30-1"></a>sudo<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>createuser<span class="w"> </span>--pwprompt<span class="w"> </span>zabbix-srv
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#ch01-zabbix-components-postgresql-__codelineno-30-2"></a>Enter<span class="w"> </span>password<span class="w"> </span><span class="k">for</span><span class="w"> </span>new<span class="w"> </span>role:<span class="w"> </span>&lt;server-password&gt;
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#ch01-zabbix-components-postgresql-__codelineno-30-3"></a>Enter<span class="w"> </span>it<span class="w"> </span>again:<span class="w"> </span>&lt;server-password&gt;
</span></code></pre></div>
</div>
<p>Next, create the Zabbix frontend user, which will be used to connect to the database:</p>
<div class="admonition info">
<p class="admonition-title">Create front-end user</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#ch01-zabbix-components-postgresql-__codelineno-31-1"></a>sudo<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>createuser<span class="w"> </span>--pwprompt<span class="w"> </span>zabbix-web
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#ch01-zabbix-components-postgresql-__codelineno-31-2"></a>Enter<span class="w"> </span>password<span class="w"> </span><span class="k">for</span><span class="w"> </span>new<span class="w"> </span>role:<span class="w"> </span>&lt;frontend-password&gt;
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#ch01-zabbix-components-postgresql-__codelineno-31-3"></a>Enter<span class="w"> </span>it<span class="w"> </span>again:<span class="w"> </span>&lt;frontend-password&gt;
</span></code></pre></div>
</div>
<p>Now with the users created, the next step is to create the Zabbix database.
Execute the following command to create the database <code>zabbix</code> with the owner set to 
<code>zabbix-srv</code> and the character encoding set to <code>Unicode</code> as required by Zabbix:</p>
<div class="admonition info">
<p class="admonition-title">Create DB</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#ch01-zabbix-components-postgresql-__codelineno-32-1"></a>sudo<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>createdb<span class="w"> </span>-E<span class="w"> </span>Unicode<span class="w"> </span>-T<span class="w"> </span>template0<span class="w"> </span>-O<span class="w"> </span>zabbix-srv<span class="w"> </span>zabbix
</span></code></pre></div>
</div>
<details class="note" open="open">
<summary>What is this 'template0'?</summary>
<p>In PostgreSQL, <code>template0</code> is a default database template that serves as a pristine
copy of the database system. When creating a new database using <code>template0</code>,
it ensures that the new database starts with a clean slate, without any
pre-existing objects or configurations that might be present in other templates.
This is particularly useful when you want to create a database with specific
settings or extensions without inheriting any unwanted elements from other templates.</p>
</details>
<p>Once the database is created, you should verify the connection and ensure that
the correct user session is active. To do this, log into the zabbix database using
the <code>zabbix-srv</code> user:</p>
<div class="admonition info">
<p class="admonition-title">Login as user zabbix-srv</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#ch01-zabbix-components-postgresql-__codelineno-33-1"></a>psql<span class="w"> </span>-d<span class="w"> </span>zabbix<span class="w"> </span>-U<span class="w"> </span>zabbix-srv
</span></code></pre></div>
</div>
<p>After logging in, run the following SQL query to confirm that both the <code>session_user</code>
and <code>current_user</code> are set to <code>zabbix-srv</code>:</p>
<div class="admonition info">
<div class="language-psql highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#ch01-zabbix-components-postgresql-__codelineno-34-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">session_user</span><span class="p">,</span><span class="w"> </span><span class="k">current_user</span><span class="p">;</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#ch01-zabbix-components-postgresql-__codelineno-34-2"></a><span class="go"> session_user | current_user</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#ch01-zabbix-components-postgresql-__codelineno-34-3"></a><span class="go">--------------+--------------</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#ch01-zabbix-components-postgresql-__codelineno-34-4"></a><span class="go"> zabbix-srv   | zabbix-srv</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#ch01-zabbix-components-postgresql-__codelineno-34-5"></a><span class="go">(1 row)</span>
</span></code></pre></div>
</div>
<p>If the output matches, you are successfully connected to the database with the correct
user.</p>
<p>PostgreSQL differs significantly from MySQL or MariaDB in several aspects,
and one of the key features that sets it apart is its use of schemas. Unlike MySQL,
where databases are more standalone, PostgreSQL's schema system provides a structured,
multi-user environment within a single database.</p>
<p>Schemas act as logical containers within a database, enabling multiple users or
applications to access and manage data independently without conflicts. This feature
is especially valuable in environments where several users or applications need to
interact with the same database server concurrently. Each user or application can have
its own schema, preventing accidental interference with each other's data.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>PostgreSQL comes with a default schema, typically called <code>public</code>, but in
general, it's a best practice to create custom schemas to better organize and separate
database objects, especially in complex or multi-user environments.</p>
<p>For more in-depth information, I recommend checking out the detailed guide at
this URI, <a href="https://hevodata.com/learn/postgresql-schema/#schema">https://hevodata.com/learn/postgresql-schema/#schema</a>
which explains the benefits and use cases for schemas in PostgreSQL.</p>
</details>
<p>To finalize the initial database setup for Zabbix, we need to configure schema permissions
for both the <code>zabbix-srv</code> and <code>zabbix-web</code> users.</p>
<p>First, we create a custom schema named <code>zabbix_server</code> and assign ownership to
the <code>zabbix-srv</code> user:</p>
<div class="admonition info">
<p class="admonition-title">Create the db schema</p>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#ch01-zabbix-components-postgresql-__codelineno-35-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">zabbix_server</span><span class="w"> </span><span class="k">AUTHORIZATION</span><span class="w"> </span><span class="s s-Name">&quot;zabbix-srv&quot;</span><span class="p">;</span>
</span></code></pre></div>
</div>
<p>Next, we set the <code>search path</code> to <code>zabbix_server</code> schema so that it's the default
for the current session:</p>
<div class="admonition info">
<p class="admonition-title">Set search path</p>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#ch01-zabbix-components-postgresql-__codelineno-36-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s s-Name">&quot;zabbix_server&quot;</span><span class="p">;</span>
</span></code></pre></div>
</div>
<details class="tip" open="open">
<summary>Tip</summary>
<p>If you prefer not to set the search path manually each time you log in as the
<code>zabbix-srv</code> user, you can configure PostgreSQL to automatically use the desired
search path. Run the following SQL command to set the default search path for
the <code>zabbix-srv</code> role:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#ch01-zabbix-components-postgresql-__codelineno-37-1"></a><span class="n">zabbix</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="ss">&quot;zabbix-srv&quot;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zabbix_server</span><span class="p">;</span>
</span></code></pre></div>
<p>This command ensures that every time the <code>zabbix-srv</code> user connects to the
database, the <code>search_path</code> is automatically set to <code>zabbix_server</code>.</p>
</details>
<p>To confirm the schema setup, you can list the existing schemas:</p>
<div class="admonition example">
<p class="admonition-title">Verify schema access</p>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#ch01-zabbix-components-postgresql-__codelineno-38-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="kp">\dn</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#ch01-zabbix-components-postgresql-__codelineno-38-2"></a><span class="go">          List of schemas</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#ch01-zabbix-components-postgresql-__codelineno-38-3"></a><span class="go">     Name      |       Owner</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#ch01-zabbix-components-postgresql-__codelineno-38-4"></a><span class="go">---------------+-------------------</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#ch01-zabbix-components-postgresql-__codelineno-38-5"></a><span class="go"> public        | pg_database_owner</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#ch01-zabbix-components-postgresql-__codelineno-38-6"></a><span class="go"> zabbix_server | zabbix-srv</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#ch01-zabbix-components-postgresql-__codelineno-38-7"></a><span class="go">(2 rows)</span>
</span></code></pre></div>
</div>
<p>At this point, the <code>zabbix-srv</code> user has full access to the schema, but the <code>zabbix-web</code>
user still needs appropriate permissions to connect and interact with the database.
First, we grant <code>USAGE</code> privileges on the schema to allow <code>zabbix-web</code> to connect:</p>
<div class="admonition info">
<p class="admonition-title">Grant access to schema for user zabbix-web</p>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#ch01-zabbix-components-postgresql-__codelineno-39-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="n">USAGE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">zabbix_server</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s s-Name">&quot;zabbix-web&quot;</span><span class="p">;</span>
</span></code></pre></div>
</div>
<p>Now, the <code>zabbix-web</code> user has appropriate access to interact with the schema
while maintaining security by limiting permissions to essential operations.</p>
<p>If you are ready you can exit the database and return to your linux shell.</p>
<div class="admonition info">
<p class="admonition-title">Exit the database shell</p>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#ch01-zabbix-components-postgresql-__codelineno-40-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="kp">\q</span>
</span></code></pre></div>
</div>
<p>At this point, your Zabbix database is ready, but before it can actually be used by
Zabbix, we still need to populate the database with the necessary tables and initial data,
but that will be covered in the next section when we install the Zabbix server.</p>
<p>If you intent to install Zabbix server on a different machine than the one hosting
the database you will need to open the host firewall to allow incoming connections
to the database server. By default, PostgreSQL listens on port 5432.</p>
<div class="admonition info">
<p class="admonition-title">Add firewall rules</p>
<p>Red Hat / SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#ch01-zabbix-components-postgresql-__codelineno-41-1"></a>firewall-cmd<span class="w"> </span>--add-service<span class="o">=</span>postgresql<span class="w"> </span>--permanent
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#ch01-zabbix-components-postgresql-__codelineno-41-2"></a>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#ch01-zabbix-components-postgresql-__codelineno-42-1"></a>sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">5432</span>/tcp
</span></code></pre></div></p>
</div>
<hr />
<h2 id="ch01-zabbix-components-postgresql-populate-the-zabbix-database">Populate the Zabbix database</h2>
<p>During the installation of the database software earlier, we created the 
necessary users, database and schema for Zabbix, however, Zabbix expects certain tables,
schemas, images, and other elements to be present in the database.
To set up the database correctly, we need to populate it with the required schema.</p>
<p>First we need to install the Zabbix SQL scripts that contain the required
import scripts for the database.</p>
<div class="admonition info">
<p class="admonition-title">Install SQL scripts</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#ch01-zabbix-components-postgresql-__codelineno-43-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>zabbix-sql-scripts
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#ch01-zabbix-components-postgresql-__codelineno-44-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>zabbix-sql-scripts
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#ch01-zabbix-components-postgresql-__codelineno-45-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>zabbix-sql-scripts
</span></code></pre></div></p>
</div>
<p>Next you need to prepare the database schema: unzip the necessary schema files 
by running the following command:</p>
<div class="admonition info">
<p class="admonition-title">Unzip the DB patch</p>
<p>Red Hat / SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#ch01-zabbix-components-postgresql-__codelineno-46-1"></a>gzip<span class="w"> </span>-d<span class="w"> </span>/usr/share/zabbix/sql-scripts/postgresql/server.sql.gz
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#ch01-zabbix-components-postgresql-__codelineno-47-1"></a>sudo<span class="w"> </span>gzip<span class="w"> </span>-d<span class="w"> </span>/usr/share/zabbix/sql-scripts/postgresql/server.sql.gz
</span></code></pre></div></p>
</div>
<details class="note" open="open">
<summary>Note</summary>
<p>Zabbix seems to like to change the locations of the script to populate the
DB every version or even in between versions. If you encounter an error take a
look at the Zabbix documentation, there is a good chance that some location was
changed.</p>
</details>
<p>This will extract the database schema required for the Zabbix server.</p>
<p>Now we will execute the SQL file to populate the database. Open a <code>psql</code> shell:</p>
<div class="admonition info">
<p class="admonition-title">Open psql shell</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#ch01-zabbix-components-postgresql-__codelineno-48-1"></a>psql<span class="w"> </span>-d<span class="w"> </span>zabbix<span class="w"> </span>-U<span class="w"> </span>zabbix-srv
</span></code></pre></div>
</div>
<details class="warning" open="open">
<summary>Ensure correct search_path is set</summary>
<p>Make sure you performed previous steps as outlined in <a href="#ch01-zabbix-components-postgresql-creating-the-zabbix-database-instance">Creating the Zabbix database instance with PostgreSQL</a>
carefully so that you have set the correct <code>search_path</code>.</p>
<p>If you did not set the default <code>search_path</code> for the <code>zabbix-srv</code> user,
ensure you set it manually in the current session before proceeding:
<div class="language-psql highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#ch01-zabbix-components-postgresql-__codelineno-49-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s s-Name">&quot;zabbix_server&quot;</span><span class="p">;</span>
</span></code></pre></div></p>
</details>
<p>Upload the DB schema to the database using the following commands:</p>
<div class="admonition info">
<p class="admonition-title">Upload the DB schema to db zabbix</p>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#ch01-zabbix-components-postgresql-__codelineno-50-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="kp">\i</span><span class="w"> </span><span class="ss">/usr/share/zabbix/sql-scripts/postgresql/server.sql</span>
</span></code></pre></div>
</div>
<details class="warning" open="open">
<summary>Warning</summary>
<p>Depending on your hardware or VM performance, this process can take anywhere
from a few seconds to several minutes. Please be patient and avoid cancelling
the operation.</p>
</details>
<p>Monitor the progress as the script runs. You will see output similar to:</p>
<div class="admonition example">
<p class="admonition-title">Output example</p>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#ch01-zabbix-components-postgresql-__codelineno-51-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="kp">\i</span><span class="w"> </span><span class="ss">/usr/share/zabbix/sql-scripts/postgresql/server.sql</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#ch01-zabbix-components-postgresql-__codelineno-51-2"></a><span class="go">CREATE TABLE</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#ch01-zabbix-components-postgresql-__codelineno-51-3"></a><span class="go">CREATE INDEX</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#ch01-zabbix-components-postgresql-__codelineno-51-4"></a><span class="go">CREATE TABLE</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#ch01-zabbix-components-postgresql-__codelineno-51-5"></a><span class="go">CREATE INDEX</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#ch01-zabbix-components-postgresql-__codelineno-51-6"></a><span class="go">CREATE TABLE</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#ch01-zabbix-components-postgresql-__codelineno-51-7"></a><span class="go">...</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#ch01-zabbix-components-postgresql-__codelineno-51-8"></a><span class="go">...</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#ch01-zabbix-components-postgresql-__codelineno-51-9"></a><span class="go">...</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#ch01-zabbix-components-postgresql-__codelineno-51-10"></a><span class="go">INSERT 0 10444</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#ch01-zabbix-components-postgresql-__codelineno-51-11"></a><span class="go">DELETE 90352</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#ch01-zabbix-components-postgresql-__codelineno-51-12"></a><span class="go">COMMIT</span>
</span></code></pre></div>
</div>
<p>Once the script completes and you return to the <code>zabbix=&gt;</code> prompt, the database
should be successfully populated with all the required tables, schemas,
images, and other elements needed for Zabbix.</p>
<p>However, <code>zabbix-web</code> still cannot perform any operations on the tables or sequences.
To allow basic data interaction without giving too many privileges, grant the
following permissions:</p>
<ul>
<li>For tables: SELECT, INSERT, UPDATE, and DELETE.</li>
<li>For sequences: SELECT and UPDATE.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Grant rights on the schema to user zabbix-web</p>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#ch01-zabbix-components-postgresql-__codelineno-52-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="k">INSERT</span><span class="p">,</span><span class="w"> </span><span class="k">UPDATE</span><span class="p">,</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">TABLES</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">zabbix_server</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#ch01-zabbix-components-postgresql-__codelineno-52-2"></a><span class="k">TO</span><span class="w"> </span><span class="s s-Name">&quot;zabbix-web&quot;</span><span class="p">;</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#ch01-zabbix-components-postgresql-__codelineno-52-3"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SEQUENCES</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">zabbix_server</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s s-Name">&quot;zabbix-web&quot;</span><span class="p">;</span>
</span></code></pre></div>
</div>
<p>Verify if the rights are correct on the schema :</p>
<div class="admonition example">
<p class="admonition-title">Example schema rights</p>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#ch01-zabbix-components-postgresql-__codelineno-53-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="kp">\dn+</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#ch01-zabbix-components-postgresql-__codelineno-53-2"></a><span class="go">                                           List of schemas</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#ch01-zabbix-components-postgresql-__codelineno-53-3"></a><span class="go">     Name      |       Owner       |           Access privileges            |      Description</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#ch01-zabbix-components-postgresql-__codelineno-53-4"></a><span class="go">---------------+-------------------+----------------------------------------+------------------------</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#ch01-zabbix-components-postgresql-__codelineno-53-5"></a><span class="go"> public        | pg_database_owner | pg_database_owner=UC/pg_database_owner+| standard public schema</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#ch01-zabbix-components-postgresql-__codelineno-53-6"></a><span class="go">               |                   | =U/pg_database_owner                   |</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#ch01-zabbix-components-postgresql-__codelineno-53-7"></a><span class="go"> zabbix_server | zabbix-srv        | &quot;zabbix-srv&quot;=UC/&quot;zabbix-srv&quot;          +|</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#ch01-zabbix-components-postgresql-__codelineno-53-8"></a><span class="go">               |                   | &quot;zabbix-web&quot;=U/&quot;zabbix-srv&quot;            |</span>
</span></code></pre></div>
</div>
<details class="note" open="open">
<summary>Note</summary>
<p>If you encounter the following error during the SQL import:
<code>vbnet psql:/usr/share/zabbix/sql-scripts/postgresql/server.sql:7: ERROR: no
    schema has been selected to create in</code> It indicates that the <code>search_path</code> setting
might not have been correctly applied. This setting is crucial because it specifies
the schema where the tables and other objects should be created. By correctly
setting the search path, you ensure that the SQL script will create tables
and other objects in the intended schema.</p>
</details>
<p>To ensure that the Zabbix tables were created successfully and have the correct
permissions, you can verify the table list and their ownership using the <code>psql</code> command:</p>
<ul>
<li>List the Tables: Use the following command to list all tables in the <code>zabbix_server</code> schema:</li>
</ul>
<div class="admonition info">
<p class="admonition-title">List tables</p>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#ch01-zabbix-components-postgresql-__codelineno-54-1"></a><span class="gp">zabbix=#</span><span class="w"> </span><span class="kp">\dt</span>
</span></code></pre></div>
</div>
<p>You should see a list of tables with their schema, name, type, and owner.
For example:</p>
<details class="example" open="open">
<summary>List table with relations</summary>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#ch01-zabbix-components-postgresql-__codelineno-55-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="kp">\dt</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#ch01-zabbix-components-postgresql-__codelineno-55-2"></a><span class="go">                        List of relations</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#ch01-zabbix-components-postgresql-__codelineno-55-3"></a><span class="go">    Schema     |            Name            | Type  |   Owner</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#ch01-zabbix-components-postgresql-__codelineno-55-4"></a><span class="go">---------------+----------------------------+-------+------------</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#ch01-zabbix-components-postgresql-__codelineno-55-5"></a><span class="go"> zabbix_server | acknowledges               | table | zabbix-srv</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#ch01-zabbix-components-postgresql-__codelineno-55-6"></a><span class="go"> zabbix_server | actions                    | table | zabbix-srv</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#ch01-zabbix-components-postgresql-__codelineno-55-7"></a><span class="go"> zabbix_server | alerts                     | table | zabbix-srv</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#ch01-zabbix-components-postgresql-__codelineno-55-8"></a><span class="go"> zabbix_server | auditlog                   | table | zabbix-srv</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#ch01-zabbix-components-postgresql-__codelineno-55-9"></a><span class="go"> zabbix_server | autoreg_host               | table | zabbix-srv</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#ch01-zabbix-components-postgresql-__codelineno-55-10"></a><span class="go"> zabbix_server | changelog                  | table | zabbix-srv</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#ch01-zabbix-components-postgresql-__codelineno-55-11"></a><span class="go"> zabbix_server | conditions                 | table | zabbix-srv</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#ch01-zabbix-components-postgresql-__codelineno-55-12"></a><span class="go">...</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#ch01-zabbix-components-postgresql-__codelineno-55-13"></a><span class="go">...</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#ch01-zabbix-components-postgresql-__codelineno-55-14"></a><span class="go">...</span>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#ch01-zabbix-components-postgresql-__codelineno-55-15"></a><span class="go"> zabbix_server | valuemap                   | table | zabbix-srv</span>
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#ch01-zabbix-components-postgresql-__codelineno-55-16"></a><span class="go"> zabbix_server | valuemap_mapping           | table | zabbix-srv</span>
</span><span id="__span-55-17"><a id="__codelineno-55-17" name="__codelineno-55-17" href="#ch01-zabbix-components-postgresql-__codelineno-55-17"></a><span class="go"> zabbix_server | widget                     | table | zabbix-srv</span>
</span><span id="__span-55-18"><a id="__codelineno-55-18" name="__codelineno-55-18" href="#ch01-zabbix-components-postgresql-__codelineno-55-18"></a><span class="go"> zabbix_server | widget_field               | table | zabbix-srv</span>
</span><span id="__span-55-19"><a id="__codelineno-55-19" name="__codelineno-55-19" href="#ch01-zabbix-components-postgresql-__codelineno-55-19"></a><span class="go">(203 rows)</span>
</span></code></pre></div>
</details>
<ul>
<li>Verify Permissions: Confirm that the zabbix-srv user owns the tables and has
  the necessary permissions. You can check permissions for specific tables using
  the \dp command:</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Verify table permissions</p>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#ch01-zabbix-components-postgresql-__codelineno-56-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="kp">\dp</span><span class="w"> </span><span class="ss">zabbix_server.*</span>
</span></code></pre></div>
</div>
<details class="example" open="open">
<summary>Example output</summary>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#ch01-zabbix-components-postgresql-__codelineno-57-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="kp">\dp</span><span class="w"> </span><span class="ss">zabbix_server.*</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#ch01-zabbix-components-postgresql-__codelineno-57-2"></a><span class="go">                                                     Access privileges</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#ch01-zabbix-components-postgresql-__codelineno-57-3"></a><span class="go">    Schema     |            Name            |   Type   |         Access privileges          | Column privileges | Policies</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#ch01-zabbix-components-postgresql-__codelineno-57-4"></a><span class="go">---------------+----------------------------+----------+------------------------------------+-------------------+----------</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#ch01-zabbix-components-postgresql-__codelineno-57-5"></a><span class="go"> zabbix_server | acknowledges               | table    | &quot;zabbix-srv&quot;=arwdDxtm/&quot;zabbix-srv&quot;+|                   |</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#ch01-zabbix-components-postgresql-__codelineno-57-6"></a><span class="go">               |                            |          | &quot;zabbix-web&quot;=arwd/&quot;zabbix-srv&quot;     |                   |</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#ch01-zabbix-components-postgresql-__codelineno-57-7"></a><span class="go"> zabbix_server | actions                    | table    | &quot;zabbix-srv&quot;=arwdDxtm/&quot;zabbix-srv&quot;+|                   |</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#ch01-zabbix-components-postgresql-__codelineno-57-8"></a><span class="go">               |                            |          | &quot;zabbix-web&quot;=arwd/&quot;zabbix-srv&quot;     |                   |</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#ch01-zabbix-components-postgresql-__codelineno-57-9"></a><span class="go"> zabbix_server | alerts                     | table    | &quot;zabbix-srv&quot;=arwdDxtm/&quot;zabbix-srv&quot;+|                   |</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#ch01-zabbix-components-postgresql-__codelineno-57-10"></a><span class="go">               |                            |          | &quot;zabbix-web&quot;=arwd/&quot;zabbix-srv&quot;     |                   |</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#ch01-zabbix-components-postgresql-__codelineno-57-11"></a><span class="go"> zabbix_server | auditlog                   | table    | &quot;zabbix-srv&quot;=arwdDxtm/&quot;zabbix-srv&quot;+|                   |</span>
</span></code></pre></div>
</details>
<p>This will display the access privileges for all tables in the <code>zabbix_server</code>
schema. Ensure that <code>zabbix-srv</code> has the required privileges.</p>
<p>If everything looks correct, your tables are properly created and the <code>zabbix-srv</code>
user has the appropriate ownership and permissions. If you need to adjust any
permissions, you can do so using the GRANT commands as needed.</p>
<p>This concludes our installation of the PostgreSQL database.</p>
<hr />
<h2 id="ch01-zabbix-components-postgresql-conclusion">Conclusion</h2>
<p>With the installation and configuration of PostgreSQL as the database backend for
Zabbix complete, you now have a powerful and efficient database system ready for
your monitoring needs. We've covered the installation of PostgreSQL from both
vendor-provided packages and official repositories, securing the database, creating
the necessary Zabbix database and users, and populating the database with the
required schema and initial data.</p>
<p>Your Zabbix environment is now ready for the next stages of setup and configuration.</p>
<hr />
<h2 id="ch01-zabbix-components-postgresql-questions">Questions</h2>
<ol>
<li>What version of PostgreSQL should I install for compatibility and stability?</li>
<li>What port does my DB use ?</li>
<li>Which database users did I create and why?</li>
</ol>
<hr />
<h2 id="ch01-zabbix-components-postgresql-useful-urls">Useful URLs</h2>
<ul>
<li><a href="#ch01-zabbix-components-postgresql-ttps:-yum.postgresql.org">https://yum.postgresql.org</a></li>
<li><a href="https://zypp.postgresql.org/howtozypp/">https://zypp.postgresql.org/howtozypp/</a></li>
<li><a href="https://wiki.postgresql.org/wiki/Apt">https://wiki.postgresql.org/wiki/Apt</a></li>
<li><a href="https://en.opensuse.org/SDB:PostgreSQL">https://en.opensuse.org/SDB:PostgreSQL</a></li>
<li><a href="https://help.ubuntu.com/community/PostgreSQL">https://help.ubuntu.com/community/PostgreSQL</a></li>
<li><a href="https://www.postgresql.org/docs/current/ddl-priv.html">https://www.postgresql.org/docs/current/ddl-priv.html</a></li>
</ul></section></section><section class="print-page" id="ch01-zabbix-components-zabbix-server" heading-number="6.4"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="installing-the-zabbix-server">Installing the Zabbix server</h1>
<p>Now that we've added the Zabbix repository with the necessary software, we are
ready to install both the Zabbix server and the web server. Keep in mind that the
web server doesn't need to be installed on the same machine as the Zabbix server;
they can be hosted on separate systems if desired.</p>
<p>To install the Zabbix server components, run the following command:</p>
<div class="admonition info">
<p class="admonition-title">Install the zabbix server</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-0-1"></a><span class="c1"># For MySQL/MariaDB backend:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch01-zabbix-components-zabbix-server-__codelineno-0-2"></a>dnf<span class="w"> </span>install<span class="w"> </span>zabbix-server-mysql
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch01-zabbix-components-zabbix-server-__codelineno-0-3"></a><span class="c1"># For PostgreSQL backend:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch01-zabbix-components-zabbix-server-__codelineno-0-4"></a>dnf<span class="w"> </span>install<span class="w"> </span>zabbix-server-pgsql
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-1-1"></a><span class="c1"># For MySQL/MariaDB backend:</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch01-zabbix-components-zabbix-server-__codelineno-1-2"></a>zypper<span class="w"> </span>install<span class="w"> </span>zabbix-server-mysql
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch01-zabbix-components-zabbix-server-__codelineno-1-3"></a><span class="c1"># For PostgreSQL backend:</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch01-zabbix-components-zabbix-server-__codelineno-1-4"></a>zypper<span class="w"> </span>install<span class="w"> </span>zabbix-server-pgsql
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-2-1"></a><span class="c1"># For MySQL/MariaDB backend:</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch01-zabbix-components-zabbix-server-__codelineno-2-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>zabbix-server-mysql
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ch01-zabbix-components-zabbix-server-__codelineno-2-3"></a><span class="c1"># For PostgreSQL backend:</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ch01-zabbix-components-zabbix-server-__codelineno-2-4"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>zabbix-server-pgsql
</span></code></pre></div></p>
</div>
<p>After successfully installing the Zabbix server package, we need to
configure the Zabbix server to connect to the database. This requires modifying the
Zabbix server configuration file.</p>
<p>The Zabbix server configuration file offers an option to include additional
configuration files for custom parameters. For a production environment, it's
often best to avoid altering the original configuration file directly. Instead,
you can create and include separate configuration files for any additional or
modified parameters. This approach ensures that your original configuration
file remains untouched, which is particularly useful when performing upgrades
or managing configurations with tools like Ansible, Puppet, or SaltStack.</p>
<p>On SUSE 16 and later, this feature is already enabled and configured by default.
(see also <a href="https://documentation.suse.com/sles/16.0/html/SLE-differences-faq/index.html#sle16-differences-faq-basesystem-etc">SUSE documentation</a>).
Hence, on SUSE systems, the Zabbix server configuration file is located at
<code>/usr/etc/zabbix/zabbix_server.conf</code>, and it is set up to include all <code>.conf</code> files from
the <code>/etc/zabbix_server/zabbix_server.d/</code> directory.</p>
<p>On other distributions, you may need to enable it manually:</p>
<p>To enable this feature, ensure the next line exists and is not commented 
(with a <code>#</code> in front of it) in <code>/etc/zabbix/zabbix_server.conf</code>:</p>
<div class="admonition info">
<div class="language-ini highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-3-1"></a><span class="c1"># Include=/usr/local/etc/zabbix_server.conf.d/*.conf</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch01-zabbix-components-zabbix-server-__codelineno-3-2"></a><span class="na">Include</span><span class="o">=</span><span class="s">/etc/zabbix/zabbix_server.d/*.conf</span>
</span></code></pre></div>
</div>
<p>The path <code>/etc/zabbix/zabbix_server.d/</code> should already be created by the
installed package, but ensure it really exists.</p>
<p>Now we will create a custom configuration file <code>database.conf</code> in the <code>/etc/zabbix/zabbix_server.d/</code>
directory that will hold our database connection settings:</p>
<div class="admonition info">
<p class="admonition-title">Add Zabbix database connection settings</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-4-1"></a>vi<span class="w"> </span>/etc/zabbix/zabbix_server.d/database.conf
</span></code></pre></div>
<p>Add the following lines in the configuration file to match your database setup:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-5-1"></a><span class="c1"># Zabbix database configuration</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch01-zabbix-components-zabbix-server-__codelineno-5-2"></a><span class="na">DBHost</span><span class="o">=</span><span class="s">&lt;database-host&gt;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch01-zabbix-components-zabbix-server-__codelineno-5-3"></a><span class="na">DBName</span><span class="o">=</span><span class="s">&lt;database-name&gt;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ch01-zabbix-components-zabbix-server-__codelineno-5-4"></a><span class="na">DBSchema</span><span class="o">=</span><span class="s">&lt;database-schema&gt;</span><span class="w">  </span><span class="c1"># Only for PostgreSQL</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ch01-zabbix-components-zabbix-server-__codelineno-5-5"></a><span class="na">DBUser</span><span class="o">=</span><span class="s">&lt;database-user&gt;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#ch01-zabbix-components-zabbix-server-__codelineno-5-6"></a><span class="na">DBPassword</span><span class="o">=</span><span class="s">&lt;database-password&gt;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#ch01-zabbix-components-zabbix-server-__codelineno-5-7"></a><span class="na">DBPort</span><span class="o">=</span><span class="s">&lt;database-port&gt;</span>
</span></code></pre></div>
</div>
<p>Replace <code>&lt;database-host&gt;</code>, <code>&lt;database-name&gt;</code>, <code>&lt;database-schema&gt;</code>, <code>&lt;database-user&gt;</code>,
<code>&lt;database-password&gt;</code>, and <code>&lt;database-port&gt;</code> with the appropriate values for your
setup. This ensures that the Zabbix server can communicate with your database.</p>
<p>Ensure that there is no <code>#</code> (comment symbol) in front of the configuration parameters,
as Zabbix will treat lines beginning with <code>#</code> as comments, ignoring them during execution.
Additionally, double-check for duplicate configuration lines; if there are multiple
lines with the same parameter, Zabbix will use the value from the last occurrence.</p>
<p>For our setup, the configuration will look like this:</p>
<div class="admonition example">
<p class="admonition-title">Example database.conf</p>
<p>MariaDB/MySQL:
<div class="language-ini highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-6-1"></a><span class="c1"># MariaDB database configuration</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch01-zabbix-components-zabbix-server-__codelineno-6-2"></a><span class="na">DBHost</span><span class="o">=</span><span class="s">&lt;ip or dns of your MariaDB server&gt;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch01-zabbix-components-zabbix-server-__codelineno-6-3"></a><span class="na">DBName</span><span class="o">=</span><span class="s">zabbix</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ch01-zabbix-components-zabbix-server-__codelineno-6-4"></a><span class="na">DBUser</span><span class="o">=</span><span class="s">zabbix-srv</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ch01-zabbix-components-zabbix-server-__codelineno-6-5"></a><span class="na">DBPassword</span><span class="o">=</span><span class="s">&lt;your super secret password&gt;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#ch01-zabbix-components-zabbix-server-__codelineno-6-6"></a><span class="na">DBPort</span><span class="o">=</span><span class="s">3306</span>
</span></code></pre></div></p>
<p>PostgreSQL:
<div class="language-ini highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-7-1"></a><span class="c1"># PostgreSQL database configuration</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch01-zabbix-components-zabbix-server-__codelineno-7-2"></a><span class="na">DBHost</span><span class="o">=</span><span class="s">&lt;ip or dns of your PostgreSQL server&gt;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch01-zabbix-components-zabbix-server-__codelineno-7-3"></a><span class="na">DBName</span><span class="o">=</span><span class="s">zabbix</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#ch01-zabbix-components-zabbix-server-__codelineno-7-4"></a><span class="na">DBSchema</span><span class="o">=</span><span class="s">zabbix_server</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#ch01-zabbix-components-zabbix-server-__codelineno-7-5"></a><span class="na">DBUser</span><span class="o">=</span><span class="s">zabbix-srv</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#ch01-zabbix-components-zabbix-server-__codelineno-7-6"></a><span class="na">DBPassword</span><span class="o">=</span><span class="s">&lt;your super secret password&gt;</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#ch01-zabbix-components-zabbix-server-__codelineno-7-7"></a><span class="na">DBPort</span><span class="o">=</span><span class="s">5432</span>
</span></code></pre></div></p>
</div>
<p>In this example:</p>
<ul>
<li>DBHost refers to the host where your database is running (use localhost if it's
  on the same machine).</li>
<li>DBName is the name of the Zabbix database.</li>
<li>DBSchema is the schema name used in PostgreSQL (only needed for PostgreSQL).</li>
<li>DBUser is the database user.</li>
<li>DBPassword is the password for the database user.</li>
<li>DBPort is the port number on which your database server is listening (default for
  MySQL/MariaDB is 3306 and PostgreSQL is 5432).</li>
</ul>
<p>Make sure the settings reflect your environment's database configuration.</p>
<hr />
<h2 id="ch01-zabbix-components-zabbix-server-configure-firewall-to-allow-zabbix-trapper-connections">Configure firewall to allow Zabbix trapper connections</h2>
<p>Back on your Zabbix server machine, we need to ensure that the firewall is configured
to allow incoming connections to the Zabbix server.</p>
<p>Your Zabbix server needs to accept incoming connections from Zabbix agents, senders,
and proxies. By default, Zabbix uses port <code>10051/tcp</code> for these connections.
To allow these connections, you need to open this port in your firewall.</p>
<div class="admonition info">
<p class="admonition-title">Open firewall for zabbix-trapper</p>
<p>Red Hat / SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-8-1"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--add-service<span class="o">=</span>zabbix-trapper<span class="w"> </span>--permanent
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ch01-zabbix-components-zabbix-server-__codelineno-8-2"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-9-1"></a>sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">10051</span>/tcp
</span></code></pre></div></p>
</div>
<p>If the service is not recognized using <code>firewall-cmd --add-service</code>, you can
manually specify the port:</p>
<div class="admonition info">
<p class="admonition-title">Add port instead of the service name</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-10-1"></a>firewall-cmd<span class="w"> </span>--add-port<span class="o">=</span><span class="m">10051</span>/tcp<span class="w"> </span>--permanent
</span></code></pre></div>
</div>
<hr />
<h2 id="ch01-zabbix-components-zabbix-server-starting-the-zabbix-server">Starting the Zabbix server</h2>
<p>With the Zabbix server configuration updated to connect to your database, you
can now start and enable the Zabbix server service. Run the following command
to enable the Zabbix server and ensure it starts automatically on boot:</p>
<details class="note" open="open">
<summary>Note</summary>
<p>Before restarting the Zabbix server after modifying its configuration, it is
considered best practice to validate the configuration to prevent potential
issues. Running a configuration check ensures that any errors are detected
beforehand, avoiding downtime caused by an invalid configuration. This can
be accomplished using the following command: <code>zabbix-server -T</code></p>
</details>
<div class="admonition info">
<p class="admonition-title">Enable and start zabbix-server service</p>
<p>Red Hat, SUSE and Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-11-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>zabbix-server<span class="w"> </span>--now
</span></code></pre></div></p>
</div>
<p>This command will start the Zabbix server service immediately and configure it
to launch on system startup. To verify that the Zabbix server is running correctly,
check the log file for any messages. You can view the latest entries in the
<code>Zabbix server</code> log file using:</p>
<div class="admonition info">
<p class="admonition-title">Check the log file</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-12-1"></a>tail<span class="w"> </span>/var/log/zabbix/zabbix_server.log
</span></code></pre></div>
</div>
<p>Look for messages indicating that the server has started successfully. If there
are any issues, the log file will provide details to help with troubleshooting.</p>
<div class="admonition example">
<p class="admonition-title">Example output</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-1"></a>12074:20250225:145333.529 Starting Zabbix Server. Zabbix 7.2.4 (revision c34078a4563).
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-2"></a>12074:20250225:145333.530 ****** Enabled features ******
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-3"></a>12074:20250225:145333.530 SNMP monitoring:           YES
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-4"></a>12074:20250225:145333.530 IPMI monitoring:           YES
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-5"></a>12074:20250225:145333.530 Web monitoring:            YES
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-6"></a>12074:20250225:145333.530 VMware monitoring:         YES
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-7"></a>12074:20250225:145333.530 SMTP authentication:       YES
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-8"></a>12074:20250225:145333.530 ODBC:                      YES
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-9"></a>12074:20250225:145333.530 SSH support:               YES
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-10"></a>12074:20250225:145333.530 IPv6 support:              YES
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-11"></a>12074:20250225:145333.530 TLS support:               YES
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-12"></a>12074:20250225:145333.530 ******************************
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-13"></a>12074:20250225:145333.530 using configuration file: /etc/zabbix/zabbix_server.conf
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-14"></a>12074:20250225:145333.545 current database version (mandatory/optional): 07020000/07020000
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-15"></a>12074:20250225:145333.545 required mandatory version: 07020000
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-16"></a>12075:20250225:145333.557 starting HA manager
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-17"></a>12075:20250225:145333.566 HA manager started in active mode
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-18"></a>12074:20250225:145333.567 server #0 started [main process]
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-19"></a>12076:20250225:145333.567 server #1 started [service manager #1]
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-20"></a>12077:20250225:145333.567 server #2 started [configuration syncer #1]
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-21"></a>12078:20250225:145333.718 server #3 started [alert manager #1]
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-22"></a>12079:20250225:145333.719 server #4 started [alerter #1]
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-23"></a>12080:20250225:145333.719 server #5 started [alerter #2]
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-24"></a>12081:20250225:145333.719 server #6 started [alerter #3]
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-25"></a>12082:20250225:145333.719 server #7 started [preprocessing manager #1]
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#ch01-zabbix-components-zabbix-server-__codelineno-13-26"></a>12083:20250225:145333.719 server #8 started [lld manager #1]
</span></code></pre></div>
</div>
<p>If there was an error and the server was not able to connect to the database you
would see something like this in the server log file :</p>
<div class="admonition example">
<p class="admonition-title">Example log with errors</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-1"></a>12068:20250225:145309.018 Starting Zabbix Server. Zabbix 7.2.4 (revision c34078a4563).
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-2"></a>12068:20250225:145309.018 ****** Enabled features ******
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-3"></a>12068:20250225:145309.018 SNMP monitoring:           YES
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-4"></a>12068:20250225:145309.018 IPMI monitoring:           YES
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-5"></a>12068:20250225:145309.018 Web monitoring:            YES
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-6"></a>12068:20250225:145309.018 VMware monitoring:         YES
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-7"></a>12068:20250225:145309.018 SMTP authentication:       YES
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-8"></a>12068:20250225:145309.018 ODBC:                      YES
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-9"></a>12068:20250225:145309.018 SSH support:               YES
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-10"></a>12068:20250225:145309.018 IPv6 support:              YES
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-11"></a>12068:20250225:145309.018 TLS support:               YES
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-12"></a>12068:20250225:145309.018 ******************************
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-13"></a>12068:20250225:145309.018 using configuration file: /etc/zabbix/zabbix_server.conf
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-14"></a>12068:20250225:145309.027 [Z3005] query failed: [1146] Table &#39;zabbix.users&#39; doesn&#39;t exist [select userid from users limit 1]
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#ch01-zabbix-components-zabbix-server-__codelineno-14-15"></a>12068:20250225:145309.027 cannot use database &quot;zabbix&quot;: database is not a Zabbix database
</span></code></pre></div>
</div>
<p>If that is the case, double-check your database connection settings in the
<code>/etc/zabbix/zabbix_server.d/database.conf</code> file and ensure that the database
is properly populated as described in the previous steps. Also check firewall rules
and when using PostgreSQL make sure that <code>pg_hba.conf</code> is correctly configured 
to allow connections from the Zabbix server.</p>
<p>Let's check the Zabbix server service to see if it's enabled so that it survives
a reboot</p>
<div class="admonition info">
<p class="admonition-title">check status of zabbix-server service</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-15-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>zabbix-server
</span></code></pre></div>
</div>
<details class="example" open="open">
<summary>Example output</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-1"></a><span class="go">localhost:~&gt; sudo systemctl status zabbix-server</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-3"></a><span class="go">‚óè zabbix-server.service - Zabbix Server</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-4"></a><span class="go">     Loaded: loaded (/usr/lib/systemd/system/zabbix-server.service; enabled; preset: disabled)</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-5"></a><span class="go">     Active: active (running) since Tue 2025-02-25 14:53:33 CET; 26min ago</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-6"></a><span class="go">   Main PID: 12074 (zabbix_server)</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-7"></a><span class="go">      Tasks: 77 (limit: 24744)</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-8"></a><span class="go">     Memory: 71.5M</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-9"></a><span class="go">        CPU: 18.535s</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-10"></a><span class="go">     CGroup: /system.slice/zabbix-server.service</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-11"></a><span class="go">             ‚îú‚îÄ12074 /usr/sbin/zabbix_server -c /etc/zabbix/zabbix_server.conf</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-12"></a><span class="go">             ‚îú‚îÄ12075 &quot;/usr/sbin/zabbix_server: ha manager&quot;</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-13"></a><span class="go">             ‚îú‚îÄ12076 &quot;/usr/sbin/zabbix_server: service manager #1 [processed 0 events, updated 0 event tags, deleted 0 problems, synced 0 service updates, idle 5.027667 sec during 5.042628 sec]&quot;</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-14"></a><span class="go">             ‚îú‚îÄ12077 &quot;/usr/sbin/zabbix_server: configuration syncer [synced configuration in 0.051345 sec, idle 10 sec]&quot;</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-15"></a><span class="go">             ‚îú‚îÄ12078 &quot;/usr/sbin/zabbix_server: alert manager #1 [sent 0, failed 0 alerts, idle 5.030391 sec during 5.031944 sec]&quot;</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-16"></a><span class="go">             ‚îú‚îÄ12079 &quot;/usr/sbin/zabbix_server: alerter #1 started&quot;</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-17"></a><span class="go">             ‚îú‚îÄ12080 &quot;/usr/sbin/zabbix_server: alerter #2 started&quot;</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-18"></a><span class="go">             ‚îú‚îÄ12081 &quot;/usr/sbin/zabbix_server: alerter #3 started&quot;</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-19"></a><span class="go">             ‚îú‚îÄ12082 &quot;/usr/sbin/zabbix_server: preprocessing manager #1 [queued 0, processed 0 values, idle 5.023818 sec during 5.024830 sec]&quot;</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-20"></a><span class="go">             ‚îú‚îÄ12083 &quot;/usr/sbin/zabbix_server: lld manager #1 [processed 0 LLD rules, idle 5.017278sec during 5.017574 sec]&quot;</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-21"></a><span class="go">             ‚îú‚îÄ12084 &quot;/usr/sbin/zabbix_server: lld worker #1 [processed 1 LLD rules, idle 21.031209 sec during 21.063879 sec]&quot;</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-22"></a><span class="go">             ‚îú‚îÄ12085 &quot;/usr/sbin/zabbix_server: lld worker #2 [processed 1 LLD rules, idle 43.195541 sec during 43.227934 sec]&quot;</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-23"></a><span class="go">             ‚îú‚îÄ12086 &quot;/usr/sbin/zabbix_server: housekeeper [startup idle for 30 minutes]&quot;</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-24"></a><span class="go">             ‚îú‚îÄ12087 &quot;/usr/sbin/zabbix_server: timer #1 [updated 0 hosts, suppressed 0 events in 0.017595 sec, idle 59 sec]&quot;</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-25"></a><span class="go">             ‚îú‚îÄ12088 &quot;/usr/sbin/zabbix_server: http poller #1 [got 0 values in 0.000071 sec, idle 5 sec]&quot;</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-26"></a><span class="go">             ‚îú‚îÄ12089 &quot;/usr/sbin/zabbix_server: browser poller #1 [got 0 values in 0.000066 sec, idle 5 sec]&quot;</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-27"></a><span class="go">             ‚îú‚îÄ12090 &quot;/usr/sbin/zabbix_server: discovery manager #1 [processing 0 rules, 0 unsaved checks]&quot;</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-28"></a><span class="go">             ‚îú‚îÄ12091 &quot;/usr/sbin/zabbix_server: history syncer #1 [processed 4 values, 3 triggers in 0.027382 sec, idle 1 sec]&quot;</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-29"></a><span class="go">             ‚îú‚îÄ12092 &quot;/usr/sbin/zabbix_server: history syncer #2 [processed 0 values, 0 triggers in 0.000077 sec, idle 1 sec]&quot;</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-30"></a><span class="go">             ‚îú‚îÄ12093 &quot;/usr/sbin/zabbix_server: history syncer #3 [processed 0 values, 0 triggers in 0.000076 sec, idle 1 sec]&quot;</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-31"></a><span class="go">             ‚îú‚îÄ12094 &quot;/usr/sbin/zabbix_server: history syncer #4 [processed 0 values, 0 triggers in 0.000020 sec, idle 1 sec]&quot;</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-32"></a><span class="go">             ‚îú‚îÄ12095 &quot;/usr/sbin/zabbix_server: escalator #1 [processed 0 escalations in 0.011627 sec, idle 3 sec]&quot;</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-33"></a><span class="go">             ‚îú‚îÄ12096 &quot;/usr/sbin/zabbix_server: proxy poller #1 [exchanged data with 0 proxies in 0.000081 sec, idle 5 sec]&quot;</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34" href="#ch01-zabbix-components-zabbix-server-__codelineno-16-34"></a><span class="go">             ‚îú‚îÄ12097 &quot;/usr/sbin/zabbix_server: self-monitoring [processed data in 0.000068 sec, idle 1 sec]&quot;</span>
</span></code></pre></div>
</details>
<p>This concludes our chapter on installing and configuring the Zabbix server.</p>
<hr />
<h2 id="ch01-zabbix-components-zabbix-server-conclusion">Conclusion</h2>
<p>With the successful installation and configuration of the Zabbix server, you have
now established the core component of your monitoring system. We've covered the
installation of the Zabbix server package, configuration of the database connection
settings, and setup of the firewall to allow incoming connections to the Zabbix
server. Additionally, we've started the Zabbix server service and verified its
operation.</p>
<p>Your Zabbix server is now ready to communicate with Zabbix agents, senders, and
proxies. The next step is to install and configure the Zabbix frontend, which
will provide the user interface for interacting with your monitoring system.</p>
<p>Let's proceed to the next chapter to set up the Zabbix frontend.</p>
<hr />
<h2 id="ch01-zabbix-components-zabbix-server-questions">Questions</h2>
<ol>
<li>What version of Zabbix should I install for compatibility and stability?</li>
<li>What Zabbix logs should I check for troubleshooting common issues?</li>
</ol>
<hr />
<h2 id="ch01-zabbix-components-zabbix-server-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual">https://www.zabbix.com/documentation/current/en/manual</a></li>
<li><a href="#ch01-zabbix-components-zabbix-server-ttps:-www.zabbix.com-documentation-current-en-manual-installation-requirements">https://www.zabbix.com/documentation/current/en/manual/installation/requirements</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/installation/install_from_packages">https://www.zabbix.com/documentation/current/en/manual/installation/install_from_packages</a></li>
</ul></section><section class="print-page" id="ch01-zabbix-components-zabbix-frontend" heading-number="6.5"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="installing-the-frontend">Installing the frontend</h1>
<p>Before configuring the Zabbix frontend, ensure the system meets the requirements
and is prepared as outlined in the previous chapter: <a href="#ch00-getting-started-requirements"><em>Getting started</em></a>. This server can be the same one where 
the Zabbix server packages were previously installed, or it can be a separate
machine. </p>
<p>Perform all subsequent steps on the server designated for the frontend.</p>
<hr />
<h2 id="ch01-zabbix-components-zabbix-frontend-installing-the-frontend-with-nginx">Installing the frontend with NGINX</h2>
<div class="admonition info">
<p class="admonition-title">install frontend packages</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-0-1"></a><span class="c1"># When using MySQL/MariaDB</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-0-2"></a>dnf<span class="w"> </span>install<span class="w"> </span>zabbix-nginx-conf<span class="w"> </span>zabbix-web-mysql
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-0-3"></a><span class="c1"># or when using PostgreSQL</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-0-4"></a>dnf<span class="w"> </span>install<span class="w"> </span>zabbix-nginx-conf<span class="w"> </span>zabbix-web-pgsql
</span></code></pre></div>
SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-1-1"></a><span class="c1"># When using MySQL/MariaDB</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-1-2"></a>zypper<span class="w"> </span>install<span class="w"> </span>zabbix-nginx-conf<span class="w"> </span>zabbix-web-mysql<span class="w"> </span>php8-openssl<span class="w"> </span>php8-xmlreader<span class="w"> </span>php8-xmlwriter
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-1-3"></a><span class="c1"># or when using PostgreSQL</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-1-4"></a>zypper<span class="w"> </span>install<span class="w"> </span>zabbix-nginx-conf<span class="w"> </span>zabbix-web-pgsql<span class="w"> </span>php8-openssl<span class="w"> </span>php8-xmlreader<span class="w"> </span>php8-xmlwriter
</span></code></pre></div></p>
<details class="note" open="open">
<summary>Suse Linux Enterprise Server</summary>
<p>On SUSE Linux Enterprise Server (SLES), ensure you are subscribed to the
"SUSE Linux Enterprise Module Web and Scripting" repository to access
the necessary PHP 8 packages required for the Zabbix frontend installation:
(on SLES versions &lt; 16, the command is "<code>SUSEConnect</code>" instead of "<code>suseconnect</code>")</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-2-1"></a>suseconnect<span class="w"> </span>-p<span class="w"> </span>sle-module-web-scripting/16/x86_64
</span></code></pre></div>
The actual URL for web scripting module may be different depending on particular service pack. Use the following command to determine the right one.
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-3-1"></a>suseconnect<span class="w"> </span>--list-extensions
</span></code></pre></div></p>
</details>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-4-1"></a><span class="c1"># When using MySQL/MariaDB</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-4-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>zabbix-frontend-php<span class="w"> </span>php8.3-mysql<span class="w"> </span>zabbix-nginx-conf
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-4-3"></a><span class="c1"># or when using PostgreSQL</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-4-4"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>zabbix-frontend-php<span class="w"> </span>php8.3-pgsql<span class="w"> </span>zabbix-nginx-conf
</span></code></pre></div></p>
</div>
<p>This command will install the front-end packages along with the required dependencies
for Nginx. </p>
<p>As of SUSE 16 SELinux is now the default security module instead of AppArmor.
By default PHP-FPM is not allowed by SELinux on SUSE to 
- map exec memory required for PHP JIT compilation,
- connect to Zabbix server or
- connect to the database server over TCP.
We need to tell SELinux to allow all this:</p>
<div class="admonition info">
<p class="admonition-title">SELinux: Allow PHP-FPM to map exec memory</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-5-1"></a>setsebool<span class="w"> </span>-P<span class="w"> </span>httpd_execmem<span class="w"> </span><span class="m">1</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-5-2"></a>setsebool<span class="w"> </span>-P<span class="w"> </span>httpd_can_connect_zabbix<span class="w"> </span><span class="m">1</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-5-3"></a>setsebool<span class="w"> </span>-P<span class="w"> </span>httpd_can_network_connect_db<span class="w"> </span><span class="m">1</span>
</span></code></pre></div>
</div>
<details class="tip" open="open">
<summary>Tip</summary>
<p>To troubleshoot SELinux issues, it is recommended to install the <code>setroubleshoot</code>
package which will log any SELinux denials in the system log and provide
suggestions on how to resolve them.</p>
</details>
<p>Depending on your Linux distribution defaults, PHP-FPM may by default not be 
allowed by SystemD to write to the <code>/etc/zabbix/web</code> directory required for the
Zabbix frontend setup. To enable this we need to create a drop-in file to allow this:</p>
<div class="admonition info">
<p class="admonition-title">SystemD: Allow PHP-FPM to write to /etc/zabbix/web</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-6-1"></a>systemctl<span class="w"> </span>edit<span class="w"> </span>php-fpm
</span></code></pre></div>
<p>This will open an editor to create a drop-in file <code>/etc/systemd/system/php-fpm.service.d/override.conf</code>
which will override or extend the existing service file.</p>
<p>Add the following lines to the file:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-7-1"></a><span class="k">[Service]</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-7-2"></a><span class="na">ReadWritePaths</span><span class="o">=</span><span class="s">/etc/zabbix/web</span>
</span></code></pre></div>
<p>Then exit the editor and reload the SystemD configuration:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-8-1"></a>systemctl<span class="w"> </span>daemon-reload
</span></code></pre></div>
</div>
<details class="note" open="open">
<summary>How is SystemD preventing PHP-FPM from writing to /etc/zabbix/web?</summary>
<p>On many modern Linux distributions, SystemD employs a security feature known as
sandboxing to restrict the capabilities of services. This is done to enhance
security by limiting the access of services to only the resources they need to function.
By default, PHP-FPM may be restricted from writing to certain directories,
including <code>/etc/zabbix/web</code>, to prevent potential security vulnerabilities.
This is enforced through SystemD's <code>ProtectSystem</code> and <code>ReadWritePaths</code> directives, which
control the file system access of services.</p>
</details>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Normally write access to <code>/etc/zabbix/web</code> is only needed during the initial setup
of the Zabbix frontend. After the setup is complete you can remove the drop-in
file again to further harden the security of your system.</p>
</details>
<p>First thing we have to do is alter the Nginx configuration file so that we don't
use the standard config and serve the Zabbix frontend on port 80.</p>
<div class="admonition info">
<p class="admonition-title">Edit nginx config for Red Hat</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-9-1"></a>vi<span class="w"> </span>/etc/nginx/nginx.conf
</span></code></pre></div>
</div>
<p>In this configuration file look for the following block that starts with <code>server {</code>:</p>
<div class="admonition example">
<p class="admonition-title">Original config</p>
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-10-1"></a><span class="k">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-10-2"></a><span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-10-3"></a><span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="s">[::]:80</span><span class="p">;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-10-4"></a><span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">*</span><span class="p">;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-10-5"></a><span class="kn">...</span>
</span></code></pre></div>
<details class="tip" open="open">
<summary>Tip</summary>
<p>This block may be different depending on your distribution and Nginx version.</p>
</details>
</div>
<p>Then, comment out the any <code>listen</code> and <code>server_name</code> directives to disable the default
http server configuration. You can do this by adding a <code>#</code> at the beginning of
each line, like in the example below:</p>
<div class="admonition example">
<p class="admonition-title">Config after edit</p>
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-11-1"></a><span class="k">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-11-2"></a><span class="w">    </span><span class="c1">#listen 80;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-11-3"></a><span class="w">    </span><span class="c1">#listen [::]:80;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-11-4"></a><span class="w">    </span><span class="c1">#server_name *;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-11-5"></a><span class="kn">...</span>
</span></code></pre></div>
</div>
<p>The Zabbix configuration file must now be modified to take over the default 
service on port 80 we just disabled.
Open the following file for editing:</p>
<div class="admonition info">
<p class="admonition-title">Edit Zabbix config for nginx</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-12-1"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/nginx/conf.d/zabbix.conf
</span></code></pre></div>
</div>
<p>And alter the following lines:</p>
<div class="admonition example">
<p class="admonition-title">Original config</p>
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-13-1"></a><span class="k">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-13-2"></a><span class="c1">#       listen          8080;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-13-3"></a><span class="c1">#       server_name     example.com;</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-13-5"></a><span class="w">        </span><span class="kn">root</span><span class="w">    </span><span class="s">/usr/share/zabbix</span><span class="p">;</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-13-6"></a>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-13-7"></a><span class="w">        </span><span class="kn">index</span><span class="w">   </span><span class="s">index.php</span><span class="p">;</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-13-8"></a><span class="kn">...</span>
</span></code></pre></div>
</div>
<p>Remove the <code>#</code> in front of the first 2 lines and modify them with the correct 
port and domain for your front-end. </p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>In case you don't have a domain you can replace <code>servername</code> with <code>_</code> 
like in the example below:</p>
</details>
<div class="admonition example">
<p class="admonition-title">Config after the edit</p>
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-14-1"></a><span class="k">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-14-2"></a><span class="w">        </span><span class="kn">listen</span><span class="w">          </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-14-3"></a><span class="w">        </span><span class="kn">server_name</span><span class="w">     </span><span class="s">_</span><span class="p">;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-14-5"></a><span class="w">         </span><span class="kn">root</span><span class="w">    </span><span class="s">/usr/share/zabbix</span><span class="p">;</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-14-7"></a><span class="w">         </span><span class="kn">index</span><span class="w">   </span><span class="s">index.php</span><span class="p">;</span>
</span></code></pre></div>
</div>
<p>The web server and PHP-FPM service are now ready for activation and persistent
startup. Execute the following commands to enable and start them immediately:</p>
<div class="admonition info">
<p class="admonition-title">Restart the front-end services</p>
<p>Red Hat / SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-15-1"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>nginx<span class="w"> </span>php-fpm<span class="w"> </span>--now
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-16-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>nginx<span class="w"> </span>php8.3-fpm<span class="w"> </span>--now
</span></code></pre></div></p>
</div>
<p>Let's verify if the service is properly started and enabled so that it survives
our reboot next time.</p>
<div class="admonition info">
<p class="admonition-title">Check if the service is running</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-17-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nginx
</span></code></pre></div>
</div>
<details class="example" open="open">
<summary>Example output</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-1"></a><span class="go">localhost:~&gt; sudo systemctl status nginx</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-2"></a><span class="go">‚óè nginx.service - The nginx HTTP and reverse proxy server</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-3"></a><span class="go">      Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; preset: disabled)</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-4"></a><span class="go">     Drop-In: /usr/lib/systemd/system/nginx.service.d</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-5"></a><span class="go">              ‚îî‚îÄphp-fpm.conf</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-6"></a><span class="go">      Active: active (running) since Mon 2023-11-20 11:42:18 CET; 30min ago</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-7"></a><span class="go">    Main PID: 1206 (nginx)</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-8"></a><span class="go">       Tasks: 2 (limit: 12344)</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-9"></a><span class="go">      Memory: 4.8M</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-10"></a><span class="go">         CPU: 38ms</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-11"></a><span class="go">      CGroup: /system.slice/nginx.service</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-12"></a><span class="go">              ‚îú‚îÄ1206 &quot;nginx: master process /usr/sbin/nginx&quot;</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-13"></a><span class="go">              ‚îî‚îÄ1207 &quot;nginx: worker process&quot;</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-14"></a>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-15"></a><span class="go">Nov 20 11:42:18 zabbix-srv systemd[1]: Starting The nginx HTTP and reverse proxy server...</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-16"></a><span class="go">Nov 20 11:42:18 zabbix-srv nginx[1204]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-17"></a><span class="go">Nov 20 11:42:18 zabbix-srv nginx[1204]: nginx: configuration file /etc/nginx/nginx.conf test is successful</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-18-18"></a><span class="go">Nov 20 11:42:18 zabbix-srv systemd[1]: Started The nginx HTTP and reverse proxy server.</span>
</span></code></pre></div>
</details>
<p>With the service operational and configured for automatic startup, the final preparatory
step involves adjusting the firewall to permit inbound HTTP traffic. Execute the
following commands:</p>
<div class="admonition info">
<p class="admonition-title">Configure the firewall</p>
<p>Red Hat / SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-19-1"></a>firewall-cmd<span class="w"> </span>--add-service<span class="o">=</span>http<span class="w"> </span>--permanent
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-19-2"></a>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-20-1"></a>sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">80</span>/tcp
</span></code></pre></div></p>
</div>
<p>Open your browser and go to the url or ip of your front-end :</p>
<div class="admonition info">
<p class="admonition-title">Front-end configuration</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-21-1"></a>http://&lt;ip or dns of the zabbix frontend server&gt;/
</span></code></pre></div>
</div>
<p>If all goes well you should be greeted with a Zabbix welcome page. In case you
have an error check the configuration again or have a look at the nginx log file
<code>/var/log/nginx/error.log</code> or run the following command :</p>
<div class="admonition info">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-22-1"></a>journalctl<span class="w"> </span>-xeu<span class="w"> </span>nginx
</span></code></pre></div>
</div>
<p>This should help you in locating the errors you made.</p>
<p>Upon accessing the appropriate URL, a page resembling the one illustrated below
should appear:</p>
<p><img align="left" alt="overview" src="../ch01-zabbix-components/basic-installation/ch01-basic-installation-setup.png" /></p>
<p><em>1.4 Zabbix
welcome</em></p>
<p>The Zabbix frontend presents a limited array of available localizations, as shown.</p>
<p><img align="left" alt="overview language" src="../ch01-zabbix-components/basic-installation/ch01-basic-installation-setuplanguage.png" /></p>
<p><em>!.5 Zabbix welcome language
choice</em></p>
<p>What if we want to install Chinese as language or another language from the list?
Run the next command to get a list of all locales available for your OS.</p>
<div class="admonition info">
<p class="admonition-title">Install language packs</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-23-1"></a>dnf<span class="w"> </span>list<span class="w"> </span>glibc-langpack-*
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-24-1"></a>localectl<span class="w"> </span>list-locales
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-25-1"></a>apt-cache<span class="w"> </span>search<span class="w"> </span>language-pack
</span></code></pre></div></p>
</div>
<p>Users on Ubuntu will probably notice following error `"Locale for language "en_US"
is not found on the web server."``</p>
<div class="admonition info">
<p class="admonition-title">This can be solved easy with the following commands.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-26-1"></a>sudo<span class="w"> </span>locale-gen<span class="w"> </span>en_US.UTF-8
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-26-2"></a>sudo<span class="w"> </span>update-locale
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-26-3"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx<span class="w"> </span>php8.3-fpm
</span></code></pre></div>
</div>
<p>This will give you a list like:</p>
<details class="example" open="open">
<summary>Example output</summary>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-27-1"></a>Installed Packages
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-27-2"></a>glibc-langpack-en.x86_64
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-27-3"></a>Available Packages
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-27-4"></a>glibc-langpack-aa.x86_64
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-27-5"></a>---
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-27-6"></a>glibc-langpack-zu.x86_64
</span></code></pre></div></p>
<p>SUSE
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-28-1"></a>C.UTF-8
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-28-2"></a>aa_DJ.UTF-8
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-28-3"></a>af_ZA.UTF-8
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-28-4"></a>an_ES.UTF-8
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-28-5"></a>---
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-28-6"></a>zh_SG.UTF-8
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-28-7"></a>zh_TW.UTF-8
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-28-8"></a>zu_ZA.UTF-8
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-29-1"></a>language-pack-kab - translation updates for language Kabyle
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-29-2"></a>language-pack-kab-base - translations for language Kabyle
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-29-3"></a>language-pack-kn - translation updates for language Kannada
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-29-4"></a>language-pack-kn-base - translations for language Kannada
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-29-5"></a>---
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-29-6"></a>language-pack-ko - translation updates for language Korean
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-29-7"></a>language-pack-ko-base - translations for language Korean
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-29-8"></a>language-pack-ku - translation updates for language Kurdish
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-29-9"></a>language-pack-ku-base - translations for language Kurdish
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-29-10"></a>language-pack-lt - translation updates for language Lithuanian
</span></code></pre></div></p>
</details>
<p>Let's search for our Chinese locale to see if it is available. As you can see
the code starts with zh.</p>
<div class="admonition info">
<p class="admonition-title">search for language pack</p>
<p>Red Hat
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-30-1"></a><span class="go">~# dnf list glibc-langpack-* | grep zh</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-30-2"></a><span class="go">glibc-langpack-zh.x86_64</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-30-3"></a><span class="go">glibc-langpack-lzh.x86_64</span>
</span></code></pre></div></p>
<p>SUSE
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-31-1"></a><span class="go">~&gt; localectl list-locales | grep zh</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-31-2"></a><span class="go">zh_CN.UTF-8</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-31-3"></a><span class="go">zh_HK.UTF-8</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-31-4"></a><span class="go">zh_SG.UTF-8</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-31-5"></a><span class="go">zh_TW.UTF-8</span>
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-32-1"></a>sudo<span class="w"> </span>apt-cache<span class="w"> </span>search<span class="w"> </span>language-pack<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>zh
</span></code></pre></div></p>
</div>
<p>On RedHat and Ubuntu, the command outputs two lines; however, given the identified language code,
'zh_CN,' only the first package requires installation.
on SUSE either only locales <code>C.UTF-8</code> and <code>en_US.UTF-8</code> are install or all
available locales are installed, depending on whether the package <code>glibc-locale</code>
is installed or not. </p>
<div class="admonition info">
<p class="admonition-title">Install the locale package</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-33-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>glibc-langpack-zh.x86_64
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-33-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx<span class="w"> </span>php-fpm
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-34-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>glibc-locale
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-34-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx<span class="w"> </span>php-fpm
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-35-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>language-pack-zh-hans
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#ch01-zabbix-components-zabbix-frontend-__codelineno-35-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx<span class="w"> </span>php8.3-fpm
</span></code></pre></div></p>
</div>
<p>When we return now to our front-end we are able to select the Chinese language,
after a reload of our browser.</p>
<p><img align="left" alt="select language" src="../ch01-zabbix-components/basic-installation/ch01-basic-installation-selectlanguage.png" /></p>
<p><em>1.6 Zabbix select
language</em></p>
<details class="note" open="open">
<summary>Note</summary>
<p>If your preferred language is not available in the Zabbix front-end, don't
worry, it simply means that the translation is either incomplete or not yet
available. Zabbix is an open-source project that relies on community contributions
for translations, so you can help improve it by contributing your own translations.</p>
</details>
<p>Visit the translation page at <a href="https://translate.zabbix.com/">https://translate.zabbix.com/</a>
to assist with the translation efforts. Once your translation is complete and reviewed,
it will be included in the next minor patch version of Zabbix.
Your contributions help make Zabbix more accessible and improve the overall
user experience for everyone.</p>
<p>When you're satisfied with the available translations, click <code>Next</code>. You will
then be taken to a screen to verify that all prerequisites are satisfied. If any
prerequisites are not fulfilled, address those issues first. However, if everything
is in order, you should be able to proceed by clicking <code>Next</code>.</p>
<p><img align="left" alt="pre-requisites" src="../ch01-zabbix-components/basic-installation/ch01-basic-installation-prerequisites.png" /></p>
<p><em>1.7 Zabbix
pre-requisites</em></p>
<p>On the next page, you'll configure the database connection parameters:</p>
<ol>
<li><code>Select the Database Type</code>: Choose either MySQL or PostgreSQL depending on your
   setup.</li>
<li><code>Enter the Database Host</code>: Provide the IP address or DNS name of your database
   server. Use port 3306 for MariaDB/MySQL or 5432 for PostgreSQL.</li>
<li><code>Enter the Database Name</code>: Specify the name of your database. In our case, it
   is zabbix. If you are using PostgreSQL, you will also need to provide the schema
   name, which is zabbix_server in our case.</li>
<li><code>Enther the Database Schema</code>: Only for PostgreSQL users, enter the schema name
   created for Zabbix server, which is <code>zabbix_server</code> in our case.</li>
<li><code>Enter the Database User</code>: Input the database user created for the web front-end,
   remember in our basic installation guide we created 2 users <code>zabbix-web</code> and <code>zabbix-srv</code>.
   One for the frontend and the other one for our zabbix server so here we will use 
   the user <code>zabbix-web</code>. Enter the corresponding password for this user.</li>
</ol>
<p>Ensure that the <code>Database TLS encryption</code> option is not selected, and then click
<code>Next step</code> to proceed.</p>
<p><img align="left" alt="dbconnection" src="../ch01-zabbix-components/basic-installation/ch01-basic-installation-dbconnection.png" /></p>
<p><em>1.8 Zabbix
connections</em></p>
<p>You're almost finished with the setup! The final steps involve:</p>
<ol>
<li><code>Assigning an Instance Name</code>: Choose a descriptive name for your Zabbix instance.</li>
<li><code>Selecting the Timezone</code>: Choose the timezone that matches your location or 
   your preferred time zone for the Zabbix interface.</li>
<li><code>Setting the Default Time Format</code>: Select the default time format you prefer to use.</li>
<li><strong>Encrypt connections from Web interface</strong>: I marked this box but you should
   not. This box is to encrypt communications between Zabbix frontend and your
   browser. We will cover this later.
   Once these settings are configured, you can complete the setup and proceed with any final configuration steps as needed.</li>
</ol>
<details class="note" open="open">
<summary>Note</summary>
<p>It's a good practice to set your Zabbix server to the UTC timezone, especially
when managing systems across multiple timezones. Using UTC helps ensure consistency
in time-sensitive actions and events, as the server‚Äôs timezone is often used for
calculating and displaying time-related information.</p>
</details>
<p><img align="left" alt="settings" src="../ch01-zabbix-components/basic-installation/ch01-basic-installation-settings.png" /></p>
<p><em>1.9 Zabbix
summary</em></p>
<p>After clicking <code>Next step</code> again, you'll be taken to a page confirming that the
configuration was successful. Click <code>Finish</code> to complete the setup process.</p>
<p><img align="left" alt="settings" src="../ch01-zabbix-components/basic-installation/ch01-basic-installation-final.png" /></p>
<p><em>1.10 Zabbix
install</em></p>
<p>We are now ready to login :</p>
<p><img alt="settings" src="../ch01-zabbix-components/basic-installation/ch01-basic-installation-login.png" /></p>
<p><em>1.11 Zabbix
login</em></p>
<ul>
<li>Login : Admin</li>
<li>Password : zabbix</li>
</ul>
<p>This concludes our topic on setting up the Zabbix server. If you're interested in
securing your front-end, I recommend checking out the topic Securing Zabbix for
additional guidance and best practices.</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>If you are not able to save your configuration at the end, make sure you
executed the SELinux related instructions or have SELinux disabled.
Also check if the <code>/etc/zabbix/web</code> directory is writable by the webservice
user (usually <code>wwwrun</code> or <code>www</code>)</p>
</details>
<hr />
<h2 id="ch01-zabbix-components-zabbix-frontend-conclusion">Conclusion</h2>
<p>With the installation and configuration of the Zabbix frontend now complete,
you have successfully set up the user interface for your Zabbix monitoring system.
This process included installing the necessary packages, configuring a web server and
PHP engine, setting up the database connection, and customizing the frontend settings.</p>
<p>At this stage, your Zabbix instance is operational, providing the foundation for
advanced monitoring and alerting. In the upcoming chapters, we will delve into
fine-tuning Zabbix, optimizing performance, and exploring key features that transform
it into a powerful observability platform.</p>
<p>Now that your Zabbix environment is up and running, let‚Äôs take it to the next level.</p>
<hr />
<h2 id="ch01-zabbix-components-zabbix-frontend-questions">Questions</h2>
<hr />
<h2 id="ch01-zabbix-components-zabbix-frontend-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual">https://www.zabbix.com/documentation/current/en/manual</a></li>
<li><a href="#ch01-zabbix-components-zabbix-frontend-ttps:-www.zabbix.com-documentation-current-en-manual-installation-requirements">https://www.zabbix.com/documentation/current/en/manual/installation/requirements</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/installation/install_from_packages">https://www.zabbix.com/documentation/current/en/manual/installation/install_from_packages</a></li>
</ul></section><section class="print-page" id="ch01-zabbix-components-ha-setup" heading-number="6.6"><nav class='md-tags'><span class='md-tag'>expert</span></nav><h1 id="ha-setup">HA Setup</h1>
<p>In this section, we will set up Zabbix in a High Availability (HA) configuration.
This native feature, introduced in Zabbix 6, is a crucial enhancement that ensures continued
monitoring even if a Zabbix server fails. With HA, when one Zabbix server goes down,
another can take over seamlessly.</p>
<p>For this guide, we will use two Zabbix servers and one database, but the setup allows
for adding more zabbix servers if necessary.</p>
<p><img alt="HA-Setup" src="../ch01-zabbix-components/ha-setup/ch01-HA-setup.png" /></p>
<p><em>1.1 HA
Setup</em></p>
<p>It's important to note that Zabbix HA setup is straightforward, providing redundancy
without complex features like load balancing. Only one node will be an active node, 
all other nodes will be on standby. All standby Zabbix servers in the HA cluster will
monitor the active node through heartbeats using the shared database. It does not
require any additional clustering software or even firewall ports for the Zabbix
server itself. However, for the frontend, we will use Keepalived to provide a 
Virtual IP (VIP) for failover purposes.</p>
<p>Just as in our basic configuration, we will document key details for the servers
in this HA setup. Below is the list of servers and some place to add their
respective IP addresses for your convenience :</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Server</th>
<th style="text-align: left;">IP Address</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Zabbix Server 1</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Zabbix Server 2</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Database</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Virtual IP</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<details class="note" open="open">
<summary>Note</summary>
<p>Our database (DB) in this setup is not configured for HA. Since it's not a
Zabbix component, you will need to implement your own solution for database
HA, such as a HA SAN or a database cluster setup. A DB cluster configuration
is out of the scope of this guide and unrelated to Zabbix, so it will not be
covered here.</p>
</details>
<hr />
<h2 id="ch01-zabbix-components-ha-setup-installing-the-database">Installing the Database</h2>
<p>Refer to the <a href="#ch01-zabbix-components-database"><em>Zabbix components: Database</em></a> chapter for detailed
instructions on setting up the database. That chapter provides step-by-step guidance
on installing either a PostgreSQL or MariaDB database on a dedicated node running
Ubuntu, SUSE or Rocky Linux. The same installation steps apply when configuring the
database for this setup.</p>
<hr />
<h2 id="ch01-zabbix-components-ha-setup-installing-the-zabbix-cluster">Installing the Zabbix cluster</h2>
<p>Setting up a Zabbix cluster involves configuring multiple Zabbix servers to work
together, providing high availability. While the process is similar to setting up
a single Zabbix server, there are additional configuration steps required to
enable HA (High Availability).</p>
<p>Start by preparing the systems for- and installing Zabbix server on all systems 
by following the steps in the <a href="#ch00-getting-started-preparation"><em>Preparing the server for Zabbix</em></a> and
<a href="#ch01-zabbix-components-zabbix-server"><em>Installing Zabbix server</em></a> sections of the <em>Zabbix components</em>
chapter. </p>
<p>Do note that:</p>
<ul>
<li>you need to skip the database population step on all but the first Zabbix server as
  the database is shared between all Zabbix servers.</li>
<li>you need to skip the enabling and starting of the zabbix-server service on all
  servers as we will start it later after the HA configuration is done.</li>
<li>you make sure that all Zabbix servers can connect to the database server.
  For example, if you are using PostgreSQL, ensure that the <code>pg_hba.conf</code> file 
  is configured to allow connections from all Zabbix servers.</li>
<li>all Zabbix servers should use the same database name, user, and password
  to connect to the database.</li>
<li>all Zabbix servers should be of the same major version.</li>
</ul>
<p>When all Zabbix servers are installed and configured to access the database,
we can proceed with the HA configuration.</p>
<hr />
<h3 id="ch01-zabbix-components-ha-setup-configuring-zabbix-server-1">Configuring Zabbix Server 1</h3>
<p>Add a new configuration file for the HA setup on the first Zabbix server:</p>
<div class="admonition info">
<p class="admonition-title">Add High Availability Zabbix server configuration</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch01-zabbix-components-ha-setup-__codelineno-0-1"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/zabbix/zabbix_server.d/high-availability.conf
</span></code></pre></div>
<p>Insert the following line into the configuration file to enable HA mode.</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch01-zabbix-components-ha-setup-__codelineno-1-1"></a><span class="na">HANodeName</span><span class="o">=</span><span class="s">zabbix1</span><span class="w">  </span><span class="c1"># or choose a name you prefer</span>
</span></code></pre></div>
<p>Specify the frontend node address for failover scenarios:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch01-zabbix-components-ha-setup-__codelineno-2-1"></a><span class="na">NodeAddress</span><span class="o">=</span><span class="s">&lt;Zabbix server 1 ip&gt;:10051</span>
</span></code></pre></div>
</div>
<details class="warning" open="open">
<summary>Warning</summary>
<p>The <code>NodeAddress</code> must match the IP or FQDN name of the Zabbix server node.
Without this parameter the Zabbix front-end is unable to connect to the active
node. The result will be that the frontend is unable to display the status
the queue and other information.</p>
</details>
<hr />
<h3 id="ch01-zabbix-components-ha-setup-configuring-zabbix-server-2">Configuring Zabbix Server 2</h3>
<p>Repeat the configuration steps for the second Zabbix server. Adjust the <code>HANodeName</code>
and <code>NodeAddress</code> as necessary for this server.</p>
<details class="example" open="open">
<summary>Zabbix server 2 HA configuration high-availability.conf</summary>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch01-zabbix-components-ha-setup-__codelineno-3-1"></a><span class="na">HANodeName</span><span class="o">=</span><span class="s">zabbix2</span><span class="w">  </span><span class="c1"># or choose a name you prefer</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch01-zabbix-components-ha-setup-__codelineno-3-2"></a><span class="na">NodeAddress</span><span class="o">=</span><span class="s">&lt;Zabbix server 2 ip&gt;:10051</span>
</span></code></pre></div>
</details>
<p>You can add more servers by repeating the same steps, ensuring each server has a unique
<code>HANodeName</code> and the correct <code>NodeAddress</code> set.</p>
<hr />
<h3 id="ch01-zabbix-components-ha-setup-starting-zabbix-server">Starting Zabbix Server</h3>
<p>After configuring both servers, enable and start the zabbix-server service on each:</p>
<div class="admonition info">
<p class="admonition-title">Enable and start zabbix-server service</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch01-zabbix-components-ha-setup-__codelineno-4-1"></a>sudo systemctl enable zabbix-server --now
</span></code></pre></div>
</div>
<hr />
<h3 id="ch01-zabbix-components-ha-setup-verifying-the-configuration">Verifying the Configuration</h3>
<p>Check the log files on both servers to ensure they have started correctly and
are operating in their respective HA modes.</p>
<p>On the first server:</p>
<div class="admonition info">
<p class="admonition-title">Check logs for HA messages</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch01-zabbix-components-ha-setup-__codelineno-5-1"></a>sudo<span class="w"> </span>grep<span class="w"> </span>HA<span class="w"> </span>/var/log/zabbix/zabbix_server.log
</span></code></pre></div>
</div>
<p>In the system logs, you should observe the following entries, indicating the initialization
of the High Availability (HA) manager:</p>
<details class="example" open="open">
<summary>HA log messages on active node</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch01-zabbix-components-ha-setup-__codelineno-6-1"></a><span class="go">localhost:~&gt; sudo grep HA /var/log/zabbix/zabbix_server.log</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch01-zabbix-components-ha-setup-__codelineno-6-2"></a><span class="go">22597:20240309:155230.353 starting HA manager</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch01-zabbix-components-ha-setup-__codelineno-6-3"></a><span class="go">22597:20240309:155230.362 HA manager started in active mode</span>
</span></code></pre></div>
</details>
<p>These log messages confirm that the HA manager process has started and has assumed
the active role. This means that the Zabbix instance is now the primary node in
the HA cluster, handling all monitoring operations. If a failover event occurs,
another standby node will take over based on the configured HA strategy.</p>
<p>Running the same command on the second server (and any additional nodes):</p>
<details class="example" open="open">
<summary>HA log messages on standby node</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch01-zabbix-components-ha-setup-__codelineno-7-1"></a><span class="go">localhost:~&gt; sudo grep HA /var/log/zabbix/zabbix_server.log</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch01-zabbix-components-ha-setup-__codelineno-7-2"></a><span class="go">22304:20240309:155331.163 starting HA manager</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch01-zabbix-components-ha-setup-__codelineno-7-3"></a><span class="go">22304:20240309:155331.174 HA manager started in standby mode</span>
</span></code></pre></div>
</details>
<p>These messages confirm that the HA manager process was invoked and
successfully launched in standby mode. This suggests that the node is operational
but not currently acting as the active HA instance, awaiting further state transitions
based on the configured HA strategy.</p>
<p>At this stage, your Zabbix cluster is successfully configured for High Availability
(HA). The system logs confirm that the HA manager has been initialized and is running
in standby mode, indicating that failover mechanisms are in place. This setup ensures
uninterrupted monitoring, even in the event of a server failure, by allowing automatic
role transitions based on the HA configuration.</p>
<hr />
<h2 id="ch01-zabbix-components-ha-setup-installing-the-frontend">Installing the frontend</h2>
<p>Before proceeding with the installation and configuration of the web server, it
is essential to install some sort of clustering software or use a load-balancer
in front of the Zabbix frontends to be able to have a shared Virtual IP (VIP).</p>
<details class="note" open="open">
<summary>Note</summary>
<p>There are several options available for clustering software and load-balancers,
including Pacemaker, Corosync, HAProxy, F5 Big-Ip, Citrix NetScaler, and various cloud
load balancers. Each of these solutions offers a range of features and capabilities
beyond just providing a VIP for failover purposes. But for the purpose of this guide,
we will focus on a minimalistic approach to achieve high availability for the Zabbix
frontend using Keepalived.</p>
</details>
<p>Keepalived is like a helper that makes sure one computer takes over if another
one stops working. It gives them a shared magic IP address so users don't notice
when a server fails. If the main one breaks, the backup jumps in right away by
taking over the IP.</p>
<p>Keepalived is a minimal type of clustering software that enables the use of 
a (VIP) for frontend services, ensuring seamless failover and service continuity.</p>
<div class="admonition warning">
<p class="admonition-title">High Availability on SUSE Linux Enterprise Server (SLES)</p>
<p>On SUSE Linux Enterprise Server (SLES), Keepalived is not included in the
default subscription hence unavailable in the default repositories.</p>
<p>To be able to install and use Keepalived on SLES in a supported way, you
will need to obtain the additional 'SUSE Linux Enterprise High Availability
Extension' subscription (SLE HA). This subscription provides access to the necessary
packages and updates required for Keepalived and other high availability
components.
After obtaining the subscription, you can enable the appropriate
repositories and proceed with the installation of Keepalived as outlined
in this guide:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch01-zabbix-components-ha-setup-__codelineno-8-1"></a>SUSEConnect<span class="w"> </span>-p<span class="w"> </span>sle-ha/16/x86_64<span class="w"> </span>-r<span class="w"> </span>ADDITIONAL_REGCODE
</span></code></pre></div>
Where <code>ADDITIONAL_REGCODE</code> is the registration code provided with your
'SUSE Linux Enterprise High Availability Extension' subscription.</p>
</div>
<hr />
<h3 id="ch01-zabbix-components-ha-setup-setting-up-keepalived">Setting up keepalived</h3>
<p>On all Servers that will host the Zabbix fronted we have to install keepalived.
As mentioned before, this can be done on separate servers to split up the server 
and frontend roles, but in this guide we will install keepalived on both Zabbix
servers to ensure high availability of both the frontend and the server.</p>
<div class="admonition info">
<p class="admonition-title">Install keepalived</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch01-zabbix-components-ha-setup-__codelineno-9-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>keepalived
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch01-zabbix-components-ha-setup-__codelineno-10-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>keepalived
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch01-zabbix-components-ha-setup-__codelineno-11-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>keepalived
</span></code></pre></div></p>
</div>
<p>Next, we need to modify the Keepalived configuration on all servers. While the
configurations will be similar, each server requires slight adjustments. We will
begin with Server 1. To edit the Keepalived configuration file, use the following
command:</p>
<div class="admonition info">
<p class="admonition-title">Edit the keepalived config</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch01-zabbix-components-ha-setup-__codelineno-12-1"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/keepalived/keepalived.conf
</span></code></pre></div>
</div>
<p>If the file contains any existing content, it should be cleared and replaced
with the following lines:</p>
<div class="admonition info">
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch01-zabbix-components-ha-setup-__codelineno-13-1"></a>vrrp_track_process track_nginx {
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#ch01-zabbix-components-ha-setup-__codelineno-13-2"></a>    process nginx
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#ch01-zabbix-components-ha-setup-__codelineno-13-3"></a>    weight 10
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#ch01-zabbix-components-ha-setup-__codelineno-13-4"></a>}
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#ch01-zabbix-components-ha-setup-__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#ch01-zabbix-components-ha-setup-__codelineno-13-6"></a>vrrp_instance VI_1 {
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#ch01-zabbix-components-ha-setup-__codelineno-13-7"></a>    state MASTER
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#ch01-zabbix-components-ha-setup-__codelineno-13-8"></a>    interface enp0s1
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#ch01-zabbix-components-ha-setup-__codelineno-13-9"></a>    virtual_router_id 51
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#ch01-zabbix-components-ha-setup-__codelineno-13-10"></a>    priority 244
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#ch01-zabbix-components-ha-setup-__codelineno-13-11"></a>    advert_int 1
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#ch01-zabbix-components-ha-setup-__codelineno-13-12"></a>    authentication {
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#ch01-zabbix-components-ha-setup-__codelineno-13-13"></a>        auth_type PASS
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#ch01-zabbix-components-ha-setup-__codelineno-13-14"></a>        auth_pass 12345
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#ch01-zabbix-components-ha-setup-__codelineno-13-15"></a>    }
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#ch01-zabbix-components-ha-setup-__codelineno-13-16"></a>    virtual_ipaddress {
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#ch01-zabbix-components-ha-setup-__codelineno-13-17"></a>        xxx.xxx.xxx.xxx
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#ch01-zabbix-components-ha-setup-__codelineno-13-18"></a>    }
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#ch01-zabbix-components-ha-setup-__codelineno-13-19"></a>    track_process {
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#ch01-zabbix-components-ha-setup-__codelineno-13-20"></a>         track_nginx
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#ch01-zabbix-components-ha-setup-__codelineno-13-21"></a>      }
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#ch01-zabbix-components-ha-setup-__codelineno-13-22"></a>}
</span></code></pre></div>
</div>
<details class="warning" open="open">
<summary>Warning</summary>
<p>Replace <code>enp0s1</code> with the interface name of your machine and replace the <code>password</code>
with something secure. For the <code>virtual_ipaddress</code> use a free IP from your network.
This will be used as our VIP.</p>
</details>
<p>We can now do the same modification on our second or any subsequent Zabbix server. 
Delete again everything in the <code>/etc/keepalived/keepalived.conf</code> file like we did 
before and replace it with following lines:</p>
<div class="admonition info">
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch01-zabbix-components-ha-setup-__codelineno-14-1"></a>vrrp_track_process track_nginx {
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch01-zabbix-components-ha-setup-__codelineno-14-2"></a>      process nginx
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#ch01-zabbix-components-ha-setup-__codelineno-14-3"></a>      weight 10
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#ch01-zabbix-components-ha-setup-__codelineno-14-4"></a>}
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#ch01-zabbix-components-ha-setup-__codelineno-14-5"></a>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#ch01-zabbix-components-ha-setup-__codelineno-14-6"></a>vrrp_instance VI_1 {
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#ch01-zabbix-components-ha-setup-__codelineno-14-7"></a>    state BACKUP
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#ch01-zabbix-components-ha-setup-__codelineno-14-8"></a>    interface enp0s1
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#ch01-zabbix-components-ha-setup-__codelineno-14-9"></a>    virtual_router_id 51
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#ch01-zabbix-components-ha-setup-__codelineno-14-10"></a>    priority 243
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#ch01-zabbix-components-ha-setup-__codelineno-14-11"></a>    advert_int 1
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#ch01-zabbix-components-ha-setup-__codelineno-14-12"></a>    authentication {
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#ch01-zabbix-components-ha-setup-__codelineno-14-13"></a>        auth_type PASS
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#ch01-zabbix-components-ha-setup-__codelineno-14-14"></a>        auth_pass 12345
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#ch01-zabbix-components-ha-setup-__codelineno-14-15"></a>    }
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#ch01-zabbix-components-ha-setup-__codelineno-14-16"></a>    virtual_ipaddress {
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#ch01-zabbix-components-ha-setup-__codelineno-14-17"></a>       xxx.xxx.xxx.xxx
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#ch01-zabbix-components-ha-setup-__codelineno-14-18"></a>    }
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#ch01-zabbix-components-ha-setup-__codelineno-14-19"></a>    track_process {
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#ch01-zabbix-components-ha-setup-__codelineno-14-20"></a>         track_nginx
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#ch01-zabbix-components-ha-setup-__codelineno-14-21"></a>      }
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#ch01-zabbix-components-ha-setup-__codelineno-14-22"></a>}
</span></code></pre></div>
</div>
<p>Just as with our 1st Zabbix server, replace <code>enp0s1</code> with the interface name of
your machine and replace the <code>password</code> with your password and fill in the
<code>virtual_ipaddress</code> as done before.</p>
<p>Make sure that the firewall allows Keepalived traffic on all servers. The VRRP
protocol is different than the standard IP protocol and uses multicast address
<code>224.0.0.18</code>. Therefore, we need to explicitly allow this traffic through the 
firewall. Perform the following commands on all servers:</p>
<div class="admonition info">
<p class="admonition-title">Allow keepalived traffic through the firewall</p>
<p>Red Hat / SUSE
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch01-zabbix-components-ha-setup-__codelineno-15-1"></a><span class="l l-Scalar l-Scalar-Plain">firewall-cmd --add-rich-rule=&#39;rule protocol value=&quot;vrrp&quot; accept&#39; --permanent</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#ch01-zabbix-components-ha-setup-__codelineno-15-2"></a><span class="l l-Scalar l-Scalar-Plain">firewall-cmd --reload</span>
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch01-zabbix-components-ha-setup-__codelineno-16-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo ufw allow to 224.0.0.18 comment ‚Äòkeepalived multicast‚Äô</span>
</span></code></pre></div></p>
</div>
<p>This ends the configuration of Keepalived. We can now continue adapting the frontend.</p>
<hr />
<h3 id="ch01-zabbix-components-ha-setup-install-and-configure-the-frontend">Install and configure the frontend</h3>
<p>Install the Zabbix frontend on all Zabbix servers, part of the cluster by
following the steps outlined in the <a href="#ch01-zabbix-components-zabbix-frontend"><em>Installing the frontend</em></a> section.</p>
<details class="warning" open="open">
<summary>Warning</summary>
<p>Ubuntu users need to use the VIP in the setup of Nginx, together with the local
IP in the listen directive of the config.</p>
</details>
<details class="note" open="open">
<summary>Note</summary>
<p>Don't forget to configure both front-ends. Also this is a new setup. Keep in
mind that with an existing setup we need to comment out the lines  <code>$ZBX_SERVER</code>
and <code>$ZBX_SERVER_PORT</code> in <code>/etc/zabbix/web/zabbix.conf.php</code>. Our frontend 
will check what node is active by reading the node table in the database.</p>
</details>
<p>You can verify which node is active by querying the <code>ha_node</code> table in the
Zabbix database. This table contains information about all nodes in the HA
cluster, including their status. To check the status of the nodes, you can run
the following SQL query:</p>
<div class="admonition info">
<div class="language-sql highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch01-zabbix-components-ha-setup-__codelineno-17-1"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">ha_node</span><span class="p">;</span>
</span></code></pre></div>
</div>
<details class="example" open="open">
<summary>Check the ha_node table in a PostgreSQL database</summary>
<div class="language-psql highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch01-zabbix-components-ha-setup-__codelineno-18-1"></a><span class="gp">zabbix=&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">ha_node</span><span class="p">;</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ch01-zabbix-components-ha-setup-__codelineno-18-2"></a><span class="go">         ha_nodeid         |  name   |   address       | port  | lastaccess | status |       ha_sessionid</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ch01-zabbix-components-ha-setup-__codelineno-18-3"></a><span class="go">---------------------------+---------+-----------------+-------+------------+--------+---------------------------</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ch01-zabbix-components-ha-setup-__codelineno-18-4"></a><span class="go"> cm8agwr2b0001h6kzzsv19ng6 | zabbix1 | xxx.xxx.xxx.xxx | 10051 | 1742133911 |      0 | cm8apvb0c0000jkkzx1ojuhst</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#ch01-zabbix-components-ha-setup-__codelineno-18-5"></a><span class="go"> cm8agyv830001ell0m2nq5o6n | zabbix2 | localhost       | 10051 | 1742133911 |      3 | cm8ap7b8u0000jil0845p0w51</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#ch01-zabbix-components-ha-setup-__codelineno-18-6"></a><span class="go">(2 rows)</span>
</span></code></pre></div>
</details>
<p>In this instance, the node <code>zabbix2</code> is identified as the active node, as indicated
by its status value of <code>3</code>, which designates an active state. The possible status
values are as follows:</p>
<ul>
<li><code>0</code> ‚Äì Multiple nodes can remain in standby mode.</li>
<li><code>1</code> ‚Äì A previously detected node has been shut down.</li>
<li><code>2</code> ‚Äì A node was previously detected but became unavailable without a proper shutdown.</li>
<li><code>3</code> ‚Äì The node is currently active.</li>
</ul>
<p>This classification allows for effective monitoring and state management within the
cluster.</p>
<p>Once the frontend is installed on all servers, we need to start and enable
the Keepalived service to ensure it starts automatically on boot and begins
managing the VIP:</p>
<div class="admonition info">
<p class="admonition-title">Start and enable keepalived</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch01-zabbix-components-ha-setup-__codelineno-19-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo systemctl enable keepalived nginx --now</span>
</span></code></pre></div>
</div>
<hr />
<h3 id="ch01-zabbix-components-ha-setup-verify-the-correct-working">Verify the correct working</h3>
<p>To verify that the setup is functioning correctly, access your Zabbix server
using the Virtual IP (VIP). Navigate to Reports ‚Üí System Information in the menu.
At the bottom of the page, you should see a list of servers, with at least one
marked as active. The number of servers displayed will depend on the total configured
in your HA setup.</p>
<p><img alt="1st active frontend" src="../ch01-zabbix-components/ha-setup/ch01-HA-check1.png" /></p>
<p><em>1.2 verify
HA</em></p>
<p>Shut down or reboot the active frontend server and observe that the Zabbix frontend
remains accessible. Upon reloading the page, you will notice that the other frontend
server has taken over as the active instance, ensuring an almost seamless failover
and high availability.</p>
<p><img alt="2st active frontend" src="../ch01-zabbix-components/ha-setup/ch01-HA-check2.png" /></p>
<p><em>1.3 verify
HA</em></p>
<p>In addition to monitoring the status of HA nodes, Zabbix provides several runtime
commands that allow administrators to manage failover settings and remove inactive
nodes dynamically.</p>
<p>One such command is:</p>
<div class="admonition info">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch01-zabbix-components-ha-setup-__codelineno-20-1"></a>zabbix_server<span class="w"> </span>-R<span class="w"> </span><span class="nv">ha_set_failover_delay</span><span class="o">=</span>10m
</span></code></pre></div>
</div>
<p>This command adjusts the failover delay, which defines how long Zabbix waits before
promoting a standby node to active status. The delay can be set within a range of
<strong>10 seconds</strong> to <strong>15 minutes</strong>.</p>
<p>To remove a node that is either <strong>stopped</strong> or <strong>unreachable</strong>, the following
runtime command must be used:</p>
<div class="admonition info">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch01-zabbix-components-ha-setup-__codelineno-21-1"></a>sudo<span class="w"> </span>zabbix_server<span class="w"> </span>-R<span class="w"> </span><span class="nv">ha_remove_node</span><span class="o">=</span><span class="sb">`</span>zabbix1<span class="sb">`</span>
</span></code></pre></div>
</div>
<p>Executing this command removes the node from the HA cluster. Upon successful
removal, the output confirms the action:</p>
<div class="admonition example">
<p class="admonition-title">Removal of a node</p>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch01-zabbix-components-ha-setup-__codelineno-22-1"></a><span class="gp">localhost:~ # </span>zabbix_server<span class="w"> </span>-R<span class="w"> </span><span class="nv">ha_remove_node</span><span class="o">=</span><span class="sb">`</span>zabbix1<span class="sb">`</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#ch01-zabbix-components-ha-setup-__codelineno-22-2"></a><span class="go">Removed node &quot;zabbix1&quot; with ID &quot;cm8agwr2b0001h6kzzsv19ng6&quot;</span>
</span></code></pre></div>
</div>
<p>If the removed node becomes available again, it can be added back automatically
when it reconnects to the cluster. These runtime commands provide flexibility for
managing high availability in Zabbix without requiring a full restart of the
<code>zabbix_server</code> process.</p>
<hr />
<h2 id="ch01-zabbix-components-ha-setup-conclusion">Conclusion</h2>
<p>In this chapter, we have successfully set up a high-availability (HA) Zabbix
environment by configuring both the Zabbix server and frontend for redundancy.
We first established HA for the Zabbix server, ensuring that monitoring services
remain available even in the event of a failure. Next, we focused on the frontend,
implementing a Virtual IP (VIP) with Keepalived to provide seamless failover and
continuous accessibility.</p>
<p>Additionally, we configured the firewall to allow Keepalived traffic and ensured
that the service starts automatically after a reboot. With this setup, the Zabbix
frontend can dynamically switch between servers, minimizing downtime and improving
reliability.</p>
<p>While database HA is an important consideration, it falls outside the scope of
this setup. However, this foundation provides a robust starting point for building
a resilient monitoring infrastructure that can be further enhanced as needed.</p>
<hr />
<h2 id="ch01-zabbix-components-ha-setup-questions">Questions</h2>
<ol>
<li>What is Zabbix High Availability (HA), and why is it important?</li>
<li>How does Zabbix determine which node is active in an HA setup?</li>
<li>Can multiple Zabbix nodes be active simultaneously in an HA cluster? Why or
   why not?</li>
<li>What configuration file(s) are required to enable HA in Zabbix?</li>
</ol>
<hr />
<h2 id="ch01-zabbix-components-ha-setup-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.redhat.com/sysadmin/advanced-keepalived">https://www.redhat.com/sysadmin/advanced-keepalived</a></li>
<li><a href="https://keepalived.readthedocs.io/en/latest/introduction.html">https://keepalived.readthedocs.io/en/latest/introduction.html</a></li>
<li><a href="https://www.zabbix.com/documentation/7.2/en/manual/concepts/server/ha">https://www.zabbix.com/documentation/7.2/en/manual/concepts/server/ha</a></li>
</ul></section></section>
                    <section class='print-page md-section' id='section-7' heading-number='7'>
                        <h1>Chapter 02 : Zabbix Frontend<a class='headerlink' href='#section-7' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch02-zabbix-installation-chapter" heading-number="7.1"><h1 id="ch02-zabbix-installation-chapter-getting-started-with-the-zabbix-installation">Getting started with the Zabbix installation</h1>
<p>We begin this chapter with a <strong>deep dive into the Zabbix frontend</strong>, the central hub
where all monitoring and configuration tasks come together. Alongside the basic
introduction to navigating the frontend, this chapter also covers <strong>user and group
setup</strong>, focusing on creating a secure and efficient user management system.</p>
<p>We'll walk through setting up <strong>internal authentication</strong> with best practices for
security, including <strong>dual-factor authentication</strong>. For those needing advanced integration,
we'll explore options like <strong>SAML, LDAP</strong>, and other external authentication methods.</p>
<p>This chapter strikes a balance between a straightforward overview ‚Äúthis is the frontend‚Äù
and a more in depth look at the <strong>advanced choices</strong> you can make to enhance your system's
security and manageability. Whether you're just getting started or looking to implement
robust security measures, there's something here for everyone.</p>
<p>By the end, you'll be well equipped to navigate the Zabbix frontend with confidence
and set up a secure, scalable user management system tailored to your organization's needs.</p></section><section class="print-page" id="ch02-zabbix-installation-frontend" heading-number="7.2"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="frontend-explained">Frontend explained</h1>
<p>This chapter is going to cover the basics we need to know when it comes to the
Zabbix user interface and the thing we need to know before we can start to fully
dive into our monitoring tool. We will see how the user interface works how to add
a host, groups users, items ... so that we have a good understanding of the basics.
This is something that is sometimes missed and can lead to frustrations not knowing
why things don't work like we had expected them to work. So even if you are an
advanced user it may be useful to have a look into this chapter.</p>
<p>Let's get started</p>
<hr />
<h2 id="ch02-zabbix-installation-frontend-overview-of-the-interface">Overview of the interface</h2>
<p>With Zabbix 7 the user interface after logging in is a bit changed. Our menu on
the left side of the screen has has a small overhaul. Let's dive into it.
When we login into our Zabbix setup the first time with our Admin user we see a page</p>
<p>like this where we have our <code>main window</code> in <font color='green'>green</font>
our <code>main menu</code> marked in
<font color='red'>red</font> and our <code>links</code> marked in <font color='gold'>yellow</font>.</p>
<p><img alt="Overview" src="../ch02-zabbix-installation/frontend/ch02-frontend-overview.png" /></p>
<p><em>2.1
Overview</em></p>
<p>The main menu can be hidden by collapsing it completely or to reduce it to a set
of small icons. When we click on the button with the 2 arrows to the left:</p>
<p><img alt="Collapse" src="../ch02-zabbix-installation/frontend/ch02-frontend-collapse.png" /></p>
<p><em>2.2
Collapse</em></p>
<p>You will see that the menu collapses to a set of small icons. Pressing "&gt;&gt;" will
bring the <code>main menu</code> back to it's original state.</p>
<p>When you click on the icon that looks like a box with an arrow sticking out, next
to the "&lt;&lt;" button will hide the <code>main menu</code> completely.</p>
<p><img alt="Hide" src="../ch02-zabbix-installation/frontend/ch02-frontend-hide.png" /></p>
<p><em>2.3
Hide</em></p>
<p>To bring back our <code>main menu</code> is rather easy, we just look for the button on the
left with three horizontal lines and click on it. This will show the <code>main menu</code>
but it won't stay. When we click on the box with the arrow now pointing to the bottom
right it will keep the <code>main menu</code> back in it's position.</p>
<p>Yet another way to make the screen bigger that is quite useful for monitors in <code>NOK
teams</code> for example is the <code>kiosk mode</code> button. This one however is located on the
left side of your screen and looks like 4 arrows pointing to every corner of the
screen. Pressing this button will remove all the menus and leave only the <code>main window</code>
to focus on.</p>
<p><img alt="Expand" src="../ch02-zabbix-installation/frontend/ch02-frontend-expand.png" /></p>
<p><em>2.4
Expand</em></p>
<p>When we want to leave the kiosk mode, the button will be changed to 2 arrows pointing
to the inside of the screen. Pressing this button will revert us back to the original
state.</p>
<p><img alt="Expand" src="../ch02-zabbix-installation/frontend/ch02-frontend-shrink.png" /></p>
<p><em>2.5
Shrink</em></p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>We can also enter and exit kiosk mode by making use of parameters in our Zabbix
url: <code>/zabbix.php?action=dashboard.view&amp;kiosk=1</code> - activate kiosk mode or
<code>/zabbix.php?action=dashboard.view&amp;kiosk=0</code> - activate normal mode.</p>
</details>
<details class="note" open="open">
<summary>Note</summary>
<p>There are many other page parameters we can use. A full list can be found at
<a href="https://www.zabbix.com/documentation/7.4/en/manual/web_interface/page_parameters">https://www.zabbix.com/documentation/7.4/en/manual/web_interface/page_parameters</a>
Zabbix also has a global search menu that we can use to find hosts, host groups
and templates.</p>
</details>
<p>If we type in the search box the word <code>server</code> you will see that we get an overview
of all <code>templates</code>, <code>host groups</code> and <code>hosts</code> with the name server in it. That's
why this is called the <code>global search</code> box.</p>
<p><img alt="Global search" src="../ch02-zabbix-installation/frontend/ch02-global-search.png" /></p>
<p><em>2.6 Global
search</em></p>
<p>This is our result after we looked for the word <code>server</code>. If you have a standard
Zabbix setup your page should look more or less the same.</p>
<p><img alt="Global search result" src="../ch02-zabbix-installation/frontend/ch02-global-search-result.png" /></p>
<p><em>2.7 Global search
result</em></p>
<hr />
<h2 id="ch02-zabbix-installation-frontend-main-menu">Main menu</h2>
<p>We shall now briefly examine the constituent sections of the primary application
menu. The <code>main menu</code>, situated on the left hand interface, comprises a total
of nine distinct sections:</p>
<table>
<thead>
<tr>
<th>Menu Name</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dashboards</td>
<td>Contains an overview of all the dashboards we have access to.</td>
</tr>
<tr>
<td>Monitoring</td>
<td>Shows us the hosts, problems, latest data, maps, ...</td>
</tr>
<tr>
<td>Services</td>
<td>An overview of all the Services and SLA settings.</td>
</tr>
<tr>
<td>Inventory</td>
<td>An overview of our collected inventory data.</td>
</tr>
<tr>
<td>Reports</td>
<td>Shows us the system information, scheduled reports, audit logs, action logs, etc .</td>
</tr>
<tr>
<td>Data collection</td>
<td>Contains all things related to collecting data like hosts, templates, maintenance, discovery, ...</td>
</tr>
<tr>
<td>Alert</td>
<td>The configuration of our media types, scripts and actions</td>
</tr>
<tr>
<td>Users</td>
<td>User configuration like user roles, user groups, authentication, API tokes, ...</td>
</tr>
<tr>
<td>Administration</td>
<td>The administration part containing all global settings, housekeeper, proxies, queue, ...</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ch02-zabbix-installation-frontend-links-menu">Links menu</h2>
<p>Immediately subjacent to the primary application menu on the left-hand interface
resides the <code>Links</code> menu. This module furnishes a collection of pertinent hyperlinks
for user access.</p>
<table>
<thead>
<tr>
<th>Menu name</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>Support</td>
<td>This brings us to the technical support page that you can buy from Zabbix. Remember that your local partner is also able to sell these contracts and can help you in your own language. <a href="https://www.zabbix.com/distributors">Your local distributors</a></td>
</tr>
<tr>
<td>Integrations</td>
<td>The official zabbix <a href="https://www.zabbix.com/integrations">integration page</a></td>
</tr>
<tr>
<td>Help</td>
<td>The link to the documentation of your <a href="https://www.zabbix.com/documentation/7.0/">Zabbix version</a></td>
</tr>
<tr>
<td>User settings</td>
<td>The user profile settings.</td>
</tr>
<tr>
<td>Sign out</td>
<td>Log out of the current session.</td>
</tr>
</tbody>
</table>
<p>A few interactive elements remains to be addressed on the right-hand portion of the
display.</p>
<p><img alt="Edit dashboard" src="../ch02-zabbix-installation/frontend/ch02-edit-dashboard.png" /></p>
<p><em>2.8 Edit
dashboard</em></p>
<p>The <code>Edit dashboard</code> button facilitates modification of the user's dashboard configuration,
a feature that will be elaborated upon in subsequent sections. Located on the extreme
left margin is a query mark icon ('?'), activation of which redirects the user to
the Zabbix documentation portal providing comprehensive details regarding
dashboard functionalities. Conversely, the control situated on the right margin,
represented by three horizontal lines, provides access to operations such as sharing,
renaming, and deletion of user defined dashboards.</p>
<hr />
<h2 id="ch02-zabbix-installation-frontend-system-information">System information</h2>
<p>The dashboard also features a dedicated panel labeled <code>System Information</code>. This
widget provides a real-time overview of the operational status of the Zabbix deployment.
We will now examine the individual data points presented within this panel, as their
interpretation is crucial for system comprehension.</p>
<p></br></p>
<p><img alt="System Information" src="../ch02-zabbix-installation/frontend/ch02-system-information.png" /></p>
<p><em>2.9 System
Information</em></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zabbix server is running</td>
<td>The status of our zabbix server if it is running yes or no and if it is running on our localhost or another IP and on what port the zabbix server is listening. If no trapper is listening the rest of the information can not be displayed</td>
<td>IP and port of the Zabbix server</td>
</tr>
<tr>
<td>Zabbix server version</td>
<td>This shows us the version of the <code>Zabbix server</code> so the version you see at the bottom of your screen is the one from the Zabbix frontend and can be different but should be in the same major version.</td>
<td>Version Number</td>
</tr>
<tr>
<td>Zabbix frontend version</td>
<td>This is the version of the frontend and should match with what you see at the bottom of your screen.</td>
<td>Version Number</td>
</tr>
<tr>
<td>Number of hosts (enabled/disabled)</td>
<td>The total number of hosts configured on our system</td>
<td>How many of those are enabled and disabled</td>
</tr>
<tr>
<td>Number of templates</td>
<td>The number of templates installed on our Zabbix server.</td>
<td></td>
</tr>
<tr>
<td>Number of items (enabled/disabled/not supported)</td>
<td>This line shows us the number of items we have configured in total in this case 99</td>
<td>90 are enabled and 0 are disabled but 9 of them are unsupported. This last number is important as those are items not working. We will look into this later why it happens and how to fix it. For now remember that a high number of unsupported items is not a good idea.</td>
</tr>
<tr>
<td>Number of triggers (Enabled/disabled[problem/ok])</td>
<td>The number of triggers configured</td>
<td>Number of enabled and disabled triggers. Just as with items we also see if there are triggers that are in a problem state or ok state. A trigger in a problem state is a non working trigger something we need to monitor and fix. We will cover this also later.</td>
</tr>
<tr>
<td>Number of users (online)</td>
<td>Here we see the number of users that are configured on our system</td>
<td>The number of users currently online.</td>
</tr>
<tr>
<td>Required server performance, nvps</td>
<td>The number of new values per second that Zabbix will process per second.</td>
<td>This is just an estimated number as some values we get are unknown so the real value is probably higher. So we can have some indication about how many IOPS we need and how busy our database is. A better indication is probably the internal item <code>zabbix[wcache,values,all]</code></td>
</tr>
<tr>
<td>Global scripts on Zabbix server</td>
<td>It notifies us that the Global scripts are enabled or disabled in the server config.</td>
<td>Global scripts can be used in our frontend, actions, ... but need to be activated first</td>
</tr>
<tr>
<td>High availability cluster</td>
<td>It will show us if Zabbix HA cluster is disabled or not</td>
<td>Failover delay once HA is activated</td>
</tr>
</tbody>
</table>
<details class="note" open="open">
<summary>Enabling Global script execution</summary>
<p><code>Global script</code> execution on Zabbix server can be enabled by setting 
<code>EnableGlobalScripts=1</code> in the Zabbix server configuration at <code>/etc/zabbix/zabbix_server.d/</code>.
For new installations, since Zabbix 7.0, global script execution is
disabled by default.</p>
</details>
<details class="tip" open="open">
<summary>Tip</summary>
<p>System information may display some additional warnings like:</p>
<ul>
<li>when your database doesn't have the correct character set or collation UTF-8.</li>
<li>when the database you used is lower or higher then the recommended version or</li>
<li>when there are misconfigurations on housekeeper or TimescaleDB.</li>
</ul>
<p>Another warning you can see is about database history tables that aren't
upgraded or primary keys that have not been set. This is possible if you are
coming from an older version before Zabbix 6 and never did the upgrade.</p>
</details>
<hr />
<h2 id="ch02-zabbix-installation-frontend-the-main-menu-explained">The main menu explained</h2>
<p>It's important to know that we have seen so far our dashboard with the Admin user
and that this user is a <code>Zabbix Super Admin</code> user. This has a serious impact on
what we can see and do in Zabbix as this user has no restrictions. Zabbix works
with 3 different levels of users we have the regular <code>users</code>, <code>Zabbix Admin</code> and
<code>Zabbix Super Admin</code> users. Let's have a deeper look at the differences :</p>
<p><img alt="Main Menu sections" src="../ch02-zabbix-installation/frontend/ch02-main-menu.png" width="20%" /></p>
<p><em>2.10 Main
menu sections</em></p>
<ul>
<li>A <code>Zabbix User</code> will only see the <font color='red'>red</font> part of our
  <code>main menu</code> and will only be able to see our collected data.</li>
<li>A <code>Zabbix Admin</code> will see the red part and the <font color='gold'>yellow</font>
  part of the <code>main menu</code> and is able to change our configuration.</li>
<li>A <code>Zabbix Super Admin</code> will see the complete <code>main menu</code> and so is able
  to change the configuration and all the global settings.</li>
</ul>
<hr />
<p><img alt="Monitoring Menu" src="../ch02-zabbix-installation/frontend/ch02-monitoring-menu.png" width="20%" /></p>
<p><em>2.11 Monitoring
menu</em></p>
<ul>
<li><strong>Problems</strong>: This page will give us an overview of all the problems.
  With filter we can look at recent problems past problems and problems
  that are active now. There are many more filters tor drill down more.</li>
<li><strong>Hosts</strong>: This will give us a quick overview page with what's happening
  on our hosts and allows us to quickly go to the latest data, graphs and dashboards.</li>
<li><strong>Latest data</strong>: This page I probably use the most, it shows us all the information
  collected from all our hosts.</li>
<li><strong>Maps</strong>: The location where we can create map that are an overview of our
  IT infrastructure very useful to get a high level overview of the network.</li>
<li><strong>Discovery</strong>: When we run a network discovery this is the place where we can find
  the results.</li>
</ul>
<hr />
<p><img alt="Services menu" src="../ch02-zabbix-installation/frontend/ch02-services-menu.png" width="20%" /></p>
<p><em>2.12 Services
menu</em></p>
<ul>
<li><strong>Services</strong>: This page will give us a high level overview of all services
  configured in Zabbix.</li>
<li><strong>SLA</strong>: An overview of all the SLAs configured in Zabbix.</li>
<li><strong>SLA Report</strong>: Here we can watch all SLA reports based on our filters.</li>
</ul>
<hr />
<p><img alt="Inventory menu" src="../ch02-zabbix-installation/frontend/ch02-inventory-menu.png" width="20%" /></p>
<p><em>2.13 Inventory
menu</em></p>
<ul>
<li><strong>Overview</strong>: A place where we can watch all our inventory data that
  we have retrieved from our hosts.</li>
<li><strong>Hosts</strong>: Here we can filter by host and watch all inventory data for the
  hosts we have selected.</li>
</ul>
<hr />
<p><img alt="Reports menu" src="../ch02-zabbix-installation/frontend/ch02-reports-menu.png" width="20%" /></p>
<p><em>2.14 Inventory
menu</em></p>
<ul>
<li><strong>System information</strong>: System information is a summary of key Zabbix server
  and system data.</li>
<li><strong>Scheduled reports</strong>: The place where we can schedule our reports, a <code>pdf</code> of
  the dashboard that will be sent at a specified time and date.</li>
<li><strong>Availability report</strong>: A nice overview where we can see what trigger has
  been in <code>ok</code>/<code>nok</code> state for how much % of the time</li>
<li><strong>Top 100 triggers</strong>: Another page I visit a lot here we have our top list
  with triggers that have been in a <code>NOK</code> state.</li>
<li><strong>Audit log</strong>: An overview of the user activity that happened on our system.
  Useful if we want to know who did what and when.</li>
<li><strong>Action log</strong>: A detailed overview of our actions can be found here.
  What mail was sent to who and when ...?</li>
<li><strong>Notifications</strong>: A quick overview of the number of notifications sent to each
  user.</li>
</ul>
<hr />
<p><img alt="Data collection" src="../ch02-zabbix-installation/frontend/ch02-datacollection-menu.png" width="20%" /></p>
<p><em>2.15 Data
collection</em></p>
<ul>
<li><strong>Template groups</strong>: A place to logical group all templates together in different
  groups. Before it was mixed together with hosts in host groups.</li>
<li><strong>Host groups</strong>: A logical collection of different hosts put together.
  Host groups are used for our permissions.</li>
<li><strong>Templates</strong>: A set off entities like items and triggers can be grouped together
  on a template, A template can be applied to one or more hosts.</li>
<li><strong>Hosts</strong>: What we need in Zabbix to monitor A host, application, service ...</li>
<li><strong>Maintenance</strong>: The place to configure our maintenance windows. A maintenance
  can be planned in this location.</li>
<li><strong>Event correlation</strong>: When we have multiple events that fires triggers related
  we can configure correlations in this place.</li>
<li><strong>Discovery</strong>: Sometimes we like to use Zabbix to discover devices, services,...
  on our network. This can be done here.</li>
</ul>
<hr />
<p><img alt="Alerts menu" src="../ch02-zabbix-installation/frontend/ch02-alerts-menu.png" width="20%" /></p>
<p><em>2.16 Alerts
menu</em></p>
<ul>
<li><strong>Actions</strong>: This menu allows us to configure actions based on <code>events</code> in
  Zabbix. We can create such actions for triggers, services, discovery,
  autoregistration and internal events.</li>
<li><strong>Media types</strong>: Zabbix can sent messages, emails etc ... based on the actions
  we have configured. Those media types need templates and need to be activated.</li>
<li><strong>Scripts</strong>: In Zabbix it's possible to make use of scripts in our actions and
  frontend. Those actions need to be created here first and configured.</li>
</ul>
<hr />
<p><img alt="Users menu" src="../ch02-zabbix-installation/frontend/ch02-users-menu.png" width="20%" /></p>
<p><em>2.17 Users
menu</em></p>
<ul>
<li><strong>User groups</strong>: The <code>User groups</code> menu section enables the creation and management of user groupings for streamlined access and permission control.</li>
<li><strong>User roles</strong>: The <code>User roles</code> menu section defines sets of permissions that can be assigned to individual users, limiting their allowed actions based on the user type they have within the system.</li>
<li><strong>Users</strong>: The <code>Users</code> menu section provides the interface for managing individual user accounts, including creation and modification settings.</li>
<li><strong>API tokens</strong>: The <code>API tokens</code> menu section manages authentication credentials specifically designed for programmatic access to the system's Application Programming Interface (API), enabling secure automation and integration with external applications.</li>
<li><strong>Authentication</strong>: The <code>Authentication</code> menu section configures the methods and settings used to verify user identities and control access to the system.</li>
</ul>
<hr />
<p><img alt="Administration menu" src="../ch02-zabbix-installation/frontend/ch02-administration-menu.png" width="20%" /></p>
<p><em>2.18 Administration
menu</em></p>
<ul>
<li><strong>General</strong>: The <code>General</code> menu section within administration allows configuration of core system-wide settings and parameters.</li>
<li><strong>Audit log</strong>: The <code>Audit log</code> menu section provides a chronological record of system activities and user actions for security monitoring and troubleshooting.</li>
<li><strong>Housekeeping</strong>: The <code>Housekeeping</code> menu section configures automated maintenance tasks for managing historical data and system performance.</li>
<li><strong>Proxies</strong>: The <code>Proxies</code> menu section manages the configuration and monitoring of proxy servers used for communication with managed hosts in distributed environments.</li>
<li><strong>Macros</strong>: The <code>Macros</code> menu section allows the definition and management of global variables for flexible system configuration.</li>
<li><strong>Queue</strong>: The <code>Queue</code> menu section provides real-time insight into the processing status of internal system tasks and data handling.</li>
</ul>
<hr />
<details class="info" open="open">
<summary>Info</summary>
<p>More information can be found in the online Zabbix documentation <a href="https://www.zabbix.com/documentation/7.0/en/manual/web_interface/frontend_sections">here</a></p>
</details>
<details class="tip movable modal forms" open="open">
<summary>Tip</summary>
<p>You will see that Zabbix is using modal forms in the frontend on many places.
The problem is that they are not movable. <a href="https://github.com/gr8b/zabbix-module-uitwix/">This</a>
module created by one of the Zabbix developers <code>UI Twix</code> will solve this problem
for you.</p>
</details>
<details class="warning" open="open">
<summary>Warning</summary>
<p>At time of writing there is no Dashboard import/export functionality in zabbix.
So when upgrading dashboards it needs to be created by hand. It was on the roadmap
for 7 but didn't made it so feel free to vote <a href="https://support.zabbix.com/browse/ZBXNEXT-5419">https://support.zabbix.com/browse/ZBXNEXT-5419</a></p>
</details>
<h2 id="ch02-zabbix-installation-frontend-conclusion">Conclusion</h2>
<p>The Zabbix frontend serves as the central command center for monitoring, configuration,
and system awareness. In this chapter, you explored how to navigate its interface
from dashboards and the customizable main menu to powerful tools like system information
and global search. You learned how each menu section (Monitoring, Data Collection,
Alerts, Users, Administration, and more) aligns with distinct functions, and how
kiosk mode and layout controls help optimize visibility during daily operations.</p>
<p>Additionally, the system information widget stands out as a real time diagnostic
snapshot, revealing critical metrics such as server status, number of hosts, templates,
items, triggers, and user activity all of which aid rapid troubleshooting and performance
assessment.</p>
<p>By mastering these frontend components, you're now better equipped to confidently
navigate Zabbix, manage user access, interpret monitoring data, and maintain your
environment more effectively. This foundational knowledge lays the groundwork for
deeper exploration into host configuration, authentication mechanisms, and advanced
monitoring workflows in the chapters that follow.</p>
<h2 id="ch02-zabbix-installation-frontend-questions">Questions</h2>
<ul>
<li>
<p>Which frontend section (Monitoring, Data Collection, Alerts, Users, or Administration)
  do you think you'll use most often in your daily work, and why?</p>
</li>
<li>
<p>How can kiosk mode be useful in a real-world monitoring environment, and what
  types of dashboards would you display with it?</p>
</li>
<li>
<p>What insights can the system information widget provide during troubleshooting,
  and how might it help identify issues with server performance?</p>
</li>
<li>
<p>Why is it important to understand the difference between data displayed in ‚ÄúMonitoring‚Äù
  and configuration options found in ‚ÄúData Collection‚Äù?</p>
</li>
<li>
<p>If you were onboarding a new team member, which parts of the frontend would you
  show them first, and why?</p>
</li>
</ul>
<h2 id="ch02-zabbix-installation-frontend-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/web_interface/frontend_sections/dashboards">https://www.zabbix.com/documentation/current/en/manual/web_interface/frontend_sections/dashboards</a></li>
<li><a href="https://blog.zabbix.com/handy-tips-6-organize-your-dashboards-and-create-slideshows-with-dashboard-pages/17511/">https://blog.zabbix.com/handy-tips-6-organize-your-dashboards-and-create-slideshows-with-dashboard-pages/17511/</a></li>
<li><a href="https://blog.zabbix.com/interactive-dashboard-creation-for-large-organizations-and-msps/30132/">https://blog.zabbix.com/interactive-dashboard-creation-for-large-organizations-and-msps/30132/</a></li>
</ul></section><section class="print-page" id="ch02-zabbix-installation-host-groups" heading-number="7.3"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="host-groups">Host Groups</h1>
<p>In Zabbix, <strong>host groups</strong> serve as a foundational mechanism for organizing monitored
entities. They allow you to logically categorize hosts for easier management, simplified
permissions, and streamlined configuration, especially useful in larger environments.</p>
<p>Common examples include:</p>
<ul>
<li>Grouping all <strong>Linux servers</strong> together.</li>
<li>Separating <strong>database servers</strong> (e.g., PostgreSQL, MySQL).</li>
<li>Organizing hosts by <strong>team</strong>, <strong>location</strong>, or <strong>function</strong>.</li>
</ul>
<p>Host groups are not only for structuring your monitored hosts, they also play an
important role in assigning templates, setting up user permissions, and filtering
hosts in dashboards or maps.</p>
<h2 id="ch02-zabbix-installation-host-groups-accessing-host-groups">Accessing Host Groups</h2>
<p>You can manage host groups by navigating to:</p>
<p><strong>Menu ‚Üí Data collection
‚Üí Host groups</strong></p>
<p><img alt="Host Groups Menu Screenshot" src="../ch02-zabbix-installation/host-groups/ch02-host-grouops.png" /></p>
<p><em>2.19 Host
Groups menu</em></p>
<p>In this menu under <code>Data collection</code>, you'll notice two distinct sections:</p>
<ul>
<li><strong>Host groups</strong>: Groups that contain hosts.</li>
<li><strong>Template groups</strong>: A newer addition, specifically created for organizing templates.</li>
</ul>
<details class="info" open="open">
<summary>Migrating from an older Zabbix version</summary>
<p>In previous versions, templates and hosts were often placed in the same groups.
This led to confusion, particularly for new users, as templates don't technically
belong to host groups in Zabbix. As of recent versions (starting from Zabbix
6.x), template groups are separated out for better clarity.</p>
</details>
<h2 id="ch02-zabbix-installation-host-groups-understanding-the-host-groups-overview">Understanding the Host Groups Overview</h2>
<p>When you open the <strong>Host groups</strong> menu, you'll see a list of predefined groups.
Each group entry includes:</p>
<ul>
<li><strong>Group name</strong> (e.g., <code>Linux servers</code>)</li>
<li><strong>Number of hosts</strong> in the group (displayed as a number in front)</li>
<li><strong>Host names</strong> currently assigned to that group</li>
</ul>
<p>Clicking on a host name will take you directly to the host's configuration screen,
providing a convenient way to manage settings without navigating through multiple
menus.</p>
<h2 id="ch02-zabbix-installation-host-groups-creating-a-host-group">Creating a Host Group</h2>
<p>There are two main ways to create host groups:</p>
<h3 id="ch02-zabbix-installation-host-groups-1-during-host-creation">1. During Host Creation</h3>
<p>When adding a new host:</p>
<ol>
<li>Go to <strong>Data collection ‚Üí Hosts</strong>.</li>
<li>Click <strong>Create host</strong> (top right).</li>
<li>In the <strong>Host groups</strong> field, select an existing group or type a new name to
   create one on the fly.</li>
</ol>
<h3 id="ch02-zabbix-installation-host-groups-2-from-the-host-groups-page">2. From the Host Groups Page</h3>
<ol>
<li>Navigate to <strong>Data collection ‚Üí Host groups</strong>.</li>
<li>Click <strong>Create host group</strong> in the top right.</li>
<li>Enter a <strong>Group name</strong> and click <strong>Add</strong>.</li>
</ol>
<p><img alt="Create new host group" src="../ch02-zabbix-installation/host-groups/ch02-new-host-group.png" /></p>
<p><em>2.20 Create new
host groups</em></p>
<h2 id="ch02-zabbix-installation-host-groups-nested-host-groups">Nested Host Groups</h2>
<p>Zabbix supports <strong>nested host groups</strong> using forward slashes (<code>/</code>) in group names.
This allows you to represent hierarchies such as:</p>
<ul>
<li><code>Europe/Belgium</code></li>
<li><code>Europe/France</code></li>
<li><code>Datacenters/US/Chicago</code></li>
</ul>
<p>These nested group names are <strong>just names</strong> Zabbix does not require that parent
folders (e.g., <code>Europe</code>) physically exist as separate groups unless you explicitly
create them.</p>
<details class="warning" open="open">
<summary>Warning</summary>
<ul>
<li>You cannot escape the <code>/</code> character.</li>
<li>Group names <strong>cannot</strong> contain leading/trailing slashes or multiple consecutive
  slashes.</li>
<li><code>/</code> is reserved for nesting and cannot be used in regular group names.</li>
</ul>
</details>
<h2 id="ch02-zabbix-installation-host-groups-applying-permissions-and-tag-filters-to-nested-groups">Applying Permissions and Tag Filters to Nested Groups</h2>
<p>Once you've created nested groups, the <strong>Host group overview</strong> screen provides
an option to apply permissions and tag filters to all subgroups:</p>
<ol>
<li>Click on a parent group (e.g., <code>Europe</code>).</li>
<li>A box appears: <strong>Apply permissions and tag filters to all subgroups</strong>.</li>
<li>Enabling this will cascade any rights assigned to the parent group down to its
   subgroups.</li>
</ol>
<p><img alt="Apply subgroup permissions" src="../ch02-zabbix-installation/host-groups/ch02-sub-groups.png" /></p>
<p><em>2.21 subgroup
permissions</em></p>
<p>This is especially useful for user groups. For example:</p>
<ul>
<li>If <strong>Brian</strong> is in a user group with access to <code>Europe/Belgium</code>, enabling this
  option allows Brian to see all hosts in subgroups like <code>Europe/Belgium/Gent</code>
  or <code>Europe/Belgium/Brussels</code>, including their tags and data.</li>
</ul>
<h2 id="ch02-zabbix-installation-host-groups-best-practices">Best Practices</h2>
<ul>
<li>Use a consistent naming convention: <code>Location/Function</code>, <code>Team/Environment</code>, etc.</li>
<li>Assign hosts to <strong>multiple groups</strong> if they logically belong in more than one.</li>
<li>Avoid overly deep nesting keep it readable and manageable.</li>
<li>Regularly review group usage and clean up unused or outdated groups.</li>
</ul>
<details class="tip" open="open">
<summary>Tip</summary>
<p>You can even try adding <strong>emojis</strong> to group names for a fun visual touch! üéâ
For example: <code>üåç Europe/üáßüá™ Belgium</code> or <code>üì¶ Containers/Docker</code>.</p>
</details>
<h2 id="ch02-zabbix-installation-host-groups-conclusion">Conclusion</h2>
<p>Host groups are a key organizational tool in Zabbix. With the introduction of <strong>template
groups</strong>, clearer group separation, and support for <strong>nested structures</strong>, modern
versions of Zabbix offer great flexibility for tailoring your monitoring setup
to your organization's structure and workflows.</p>
<h2 id="ch02-zabbix-installation-host-groups-questions">Questions</h2>
<ul>
<li>What are host groups used for in Zabbix?</li>
<li>Can you assign a host to more than one group?</li>
<li>How are nested groups created in Zabbix?</li>
<li>What happens when you apply permissions to subgroups?</li>
<li>Why are slashes (/) special in host group names?</li>
<li>Can a parent group exist only logically (i.e., not created in Zabbix)?</li>
</ul>
<h2 id="ch02-zabbix-installation-host-groups-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/hosts/host_groups">https://www.zabbix.com/documentation/current/en/manual/config/hosts/host_groups</a></li>
</ul></section><section class="print-page" id="ch02-zabbix-installation-user-groups" heading-number="7.4"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="user-groups">User Groups</h1>
<p>In any enterprise monitoring platform, establishing <strong>role-based access control
(RBAC)</strong> is critical for maintaining both security and clarity of operational
responsibility. For Zabbix, this control is built upon the fundamental concept
of <strong>User Groups</strong>.</p>
<p>In Zabbix 8.0, user groups serve as the primary mechanism for assigning permissions
and structuring access to the monitored data and configuration entities. This
chapter details the function of user groups, guides you through their configuration,
and outlines best practices for applying them in a robust, real world deployment.</p>
<hr />
<h2 id="ch02-zabbix-installation-user-groups-the-role-of-a-user-group">The Role of a User Group</h2>
<p>A <strong>User Group</strong> in Zabbix is a logical collection of individual user accounts.
Rather than managing permissions for hundreds of users individually, Zabbix requires
that users be assigned to one or more groups. Access rights, such as the ability
to view host groups, configure templates, or see specific problem tags are then
granted at the <strong>group level</strong>.</p>
<p>This group centric architecture provides several major benefits:</p>
<ul>
<li><strong>Simplified Management:</strong> Access rights are managed by <strong>role</strong> (e.g., "Network Engineers,"
  "Database Administrators") instead of by individual user.</li>
<li><strong>Consistency:</strong> Ensures that all users within the same role possess a consistent,
  standardized set of permissions.</li>
<li><strong>Segregation of Duties:</strong> Enables clear separation between viewing (read-only)
  and configuration (read-write) access.</li>
</ul>
<blockquote>
<p><strong>Technical Definition:</strong>
User groups allow grouping users for both organizational purposes and for assigning
  permissions to data. Permissions to viewing and configuring data of host groups
  and template groups are assigned to user groups, not individual users. A user
  can belong to any number of groups.</p>
</blockquote>
<hr />
<h2 id="ch02-zabbix-installation-user-groups-configuring-a-user-group">Configuring a User Group</h2>
<p>In Zabbix, user groups are defined and maintained solely via the web frontend.
The procedure has remained largely unchanged between version 8.0 and previous
generations, ensuring a familiar configuration experience for administrators.</p>
<h3 id="ch02-zabbix-installation-user-groups-group-creation-and-general-attributes">Group Creation and General Attributes</h3>
<ol>
<li>Navigate to <strong>Administration</strong> ‚Üí  <strong>User groups</strong>.</li>
<li>Click <strong>Create user group</strong> (or select an existing group to modify).</li>
<li>The configuration form is divided into four critical tabs: <strong>User group</strong>,
   <strong>Template permissions</strong>, <strong>Host permissions</strong>, and <strong>Problem tag filter</strong>.</li>
</ol>
<p><img alt="user-groups/../ch02-zabbix-installation/user-groups/ch02.20_user-groups_menu.png" src="../ch02-zabbix-installation/user-groups/ch02.20_user-groups_menu.png" /></p>
<p><em>2.20 user group menu</em></p>
<h4 id="ch02-zabbix-installation-user-groups-the-user-group-tab">The <code>User group</code> Tab</h4>
<p>This initial tab defines the group's general properties and its membership:</p>
<ul>
<li><strong>Group name:</strong> A unique, descriptive identifier (e.g., <code>NOC-RO</code>, <code>System-Admins-RW</code>).</li>
<li><strong>Users:</strong> Add existing users to this group. A user can be a member of multiple
  groups.</li>
<li><strong>Frontend access:</strong> Controls the authentication method for group members. Options
  include <code>System default</code>, <code>Internal</code>, <code>LDAP</code>, or <code>Disabled</code> (useful for API-only
  accounts or for temporarily locking frontend access for a role).</li>
<li><strong>LDAP server:</strong> If <code>LDAP</code> access is chosen, select the specific LDAP server
  configuration to be used for members of this group.</li>
<li><strong>Multi-factor authentication (MFA):</strong> Select the method to be enforced for the
  group. If a user is a member of multiple groups, the most secure MFA setting
  will typically apply.</li>
<li><strong>Enabled:</strong> The master switch to activate or deactivate the group and its members.</li>
<li><strong>Debug mode:</strong> A powerful, optional setting that enables detailed debug logging
  for all group members in the Zabbix frontend.</li>
</ul>
<details class="tip" open="open">
<summary>The Debug User Group</summary>
<p>Zabbix includes a dedicated <code>Debug</code> user group out-of-the-box. Instead of activating
the debug option for an existing production group, it is cleaner practice to
simply add the required user to the pre-existing <code>Debug</code> group.</p>
</details>
<hr />
<h3 id="ch02-zabbix-installation-user-groups-permission-tabs-host-groups-and-template-groups">Permission Tabs: Host Groups and Template Groups</h3>
<p>Permissions are configured by assigning access levels to <strong>Host Groups</strong> and
<strong>Template Groups</strong>. These entities act as containers, meaning the permissions
assigned to the group apply to all nested groups and all entities within them.</p>
<h4 id="ch02-zabbix-installation-user-groups-template-permissions-tab">Template Permissions Tab</h4>
<p>This section controls access to the configuration elements of templates (items,
triggers, graphs, etc.) via their Template Groups.</p>
<p>For each assigned Template Group, one of the following permissions must be selected:</p>
<ul>
<li><strong>Read-only:</strong> Users can view the template configuration and see data derived
  from it, but they <strong>cannot</strong> modify or link the template.</li>
<li><strong>Read-write:</strong> Users can view, modify, and link/unlink the template and its
  entities (items, triggers, etc.).</li>
<li><strong>Deny:</strong> Explicitly blocks all access.</li>
</ul>
<h4 id="ch02-zabbix-installation-user-groups-host-permissions-tab">Host Permissions Tab</h4>
<p>This tab works identically to the Template Permissions tab but applies the access
levels to <strong>Host Groups</strong> and the hosts contained within them.</p>
<h4 id="ch02-zabbix-installation-user-groups-problem-tag-filters-granular-alert-access">Problem Tag Filters: Granular Alert Access</h4>
<p>The final configuration tab, <strong>Problem tag filter</strong>, allows for fine-grained control
over which problems (alerts) a user group can see.</p>
<p>This is invaluable for enterprise environments where users should only be alerted
to issues relevant to their domain. For instance, a Database Administrator should
not be distracted by network switch problems.</p>
<p>Filters are applied to specific host groups and can be configured to display:</p>
<ul>
<li>All tags for the specified hosts.</li>
<li>Only problems matching specific tag name/value pairs.</li>
</ul>
<p>When a user is a member of multiple groups, the tag filters apply with <strong>OR logic</strong>.
If any of the user's groups allows visibility of a specific problem based on its
tags, the user will see it.</p>
<details class="example" open="open">
<summary>Example: Database Administrator Filter</summary>
<p>To ensure a Database Administrator group only sees relevant issues, the problem
tag filter would be configured to specify:</p>
<ul>
<li><strong>Tag name:</strong> <code>service</code></li>
<li><strong>Value:</strong> <code>mysql</code></li>
</ul>
<p>This ensures the user only sees problems tagged with <code>service:mysql</code> on the
host groups they have permission to view.</p>
</details>
<hr />
<h3 id="ch02-zabbix-installation-user-groups-template-permissions-frontend-behavior-and-editing-limitations">Template Permissions ‚Äî Frontend Behavior and Editing Limitations</h3>
<p>The behavior of the Data collection ‚Üí Templates view and host configuration screens
is strictly tied to the user‚Äôs permission level on template groups.
Zabbix intentionally hides templates from users who have only Read-only access.
This is by design, as described in <a href="https://support.zabbix.com/browse/ZBXNEXT-1070">https://support.zabbix.com/browse/ZBXNEXT-1070</a></p>
<table>
<thead>
<tr>
<th><strong>Action or Screen Element</strong></th>
<th><strong>Read-only</strong></th>
<th><strong>Read-write</strong></th>
<th><strong>Description / Impact</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>View <em>Data collection ‚Üí Templates</em></td>
<td>‚ùå</td>
<td>‚úÖ</td>
<td>Users with Read-only access do <strong>not see any templates</strong>. Template groups are only visible to users with Read-write rights. (<a href="https://support.zabbix.com/browse/ZBXNEXT-1070">ZBXNEXT-1070</a>)</td>
</tr>
<tr>
<td>Open template configuration</td>
<td>‚ùå</td>
<td>‚úÖ</td>
<td>Not available for Read-only users ‚Äî templates are hidden entirely</td>
</tr>
</tbody>
</table>
<h2 id="ch02-zabbix-installation-user-groups-the-rule-of-precedence-deny-always-wins">The Rule of Precedence: Deny Always Wins</h2>
<p>A user's effective permission is the result of combining the rights from <strong>all</strong>
groups they belong to. Zabbix resolves these overlapping permissions by applying
a simple, strict hierarchy based on the most restrictive level, unless a <code>Deny</code>
is present.</p>
<h3 id="ch02-zabbix-installation-user-groups-hierarchy-of-precedence">Hierarchy of Precedence</h3>
<p>The order of precedence is absolute: <strong>Deny</strong> is the highest, followed by
<strong>Read-write</strong>, and finally <strong>Read-only</strong>.</p>
<pre  class="mermaid"><code>flowchart TB
    A["Deny (highest precedence)"]:::deny
    B["Read-write (overrides Read-only)"]:::rw
    C["Read-only (lowest precedence)"]:::ro

    A --> B
    B --> C

    classDef deny fill:#f87171,stroke:#7f1d1d,stroke-width:2px,color:white;
    classDef rw fill:#60a5fa,stroke:#1e3a8a,stroke-width:2px,color:white;
    classDef ro fill:#a7f3d0,stroke:#065f46,stroke-width:2px,color:black;
</code></pre>
<p>This precedence can be summarized by two core rules:</p>
<ol>
<li><strong>Deny Always Overrides:</strong> If any group grants <strong>Deny</strong> access to a host or
   template group, that user <strong>will not</strong> have access, regardless of any other
   <code>Read-only</code> or <code>Read-write</code> permissions.</li>
<li><strong>Most Permissive Wins (Otherwise):</strong> If no <code>Deny</code> is present, the most permissive
   right applies. <strong>Read-write</strong> always overrides <strong>Read-only</strong>.</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align: left;">Scenario</th>
<th style="text-align: left;">Group A</th>
<th style="text-align: left;">Group B</th>
<th style="text-align: left;">Effective Permission</th>
<th style="text-align: left;">Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>RW Over RO</strong></td>
<td style="text-align: left;">Read-only</td>
<td style="text-align: left;">Read-write</td>
<td style="text-align: left;"><strong>Read-write</strong></td>
<td style="text-align: left;">The most permissive right wins when <strong>Deny</strong> is absent.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deny Over RO</strong></td>
<td style="text-align: left;">Read-only</td>
<td style="text-align: left;">Deny</td>
<td style="text-align: left;"><strong>Deny</strong></td>
<td style="text-align: left;"><strong>Deny</strong> always takes precedence and blocks all access.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deny Over RW</strong></td>
<td style="text-align: left;">Read-write</td>
<td style="text-align: left;">Deny</td>
<td style="text-align: left;"><strong>Deny</strong></td>
<td style="text-align: left;">The most restrictive right (Deny) overrides the most permissive.</td>
</tr>
</tbody>
</table>
<h3 id="ch02-zabbix-installation-user-groups-permissions-in-the-update-problem-dialog">Permissions in the "Update Problem" Dialog</h3>
<p>In Zabbix 8.0, the actions available in the <strong>Monitoring</strong> ‚Üí <strong>Problems</strong>
view (via the <em>Update problem</em> dialog) are controlled by two distinct mechanisms
working in tandem:</p>
<ol>
<li><strong>Host/Template Permissions:</strong> Governs basic access to the problem and whether
   configuration-level changes can be made.</li>
<li><strong>User Role Capabilities:</strong> Governs which specific administrative actions (like
   acknowledging, changing severity, or closing) are enabled.</li>
</ol>
<p>The table below clarifies the minimum required permissions to perform actions on
an active problem:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Action in ‚ÄúUpdate problem‚Äù dialog</th>
<th style="text-align: left;">Required Host Permission</th>
<th style="text-align: left;">Required Template Permission</th>
<th style="text-align: left;">Required Role Capability / Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Message</strong> (add comment)</td>
<td style="text-align: left;">Read-only or Read-write</td>
<td style="text-align: left;">Same level as host</td>
<td style="text-align: left;">Requires the role capability <strong>Acknowledge problems</strong>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Acknowledge</strong></td>
<td style="text-align: left;">Read-only or Read-write</td>
<td style="text-align: left;">Same level as host</td>
<td style="text-align: left;">Requires <strong>Acknowledge problems</strong>. Read-only access is sufficient.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Change severity</strong></td>
<td style="text-align: left;"><strong>Read-write</strong> required</td>
<td style="text-align: left;"><strong>Read-write</strong> if template trigger</td>
<td style="text-align: left;">Requires the <strong>Change problem severity</strong> capability.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Suppress</strong> / <strong>Unsuppress</strong></td>
<td style="text-align: left;"><strong>Read-write</strong> required</td>
<td style="text-align: left;"><strong>Read-write</strong> if template trigger</td>
<td style="text-align: left;">Requires the <strong>Suppress problems</strong> capability.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Convert to cause</strong></td>
<td style="text-align: left;"><strong>Read-write</strong> required</td>
<td style="text-align: left;"><strong>Read-write</strong> if template trigger</td>
<td style="text-align: left;">Requires <strong>Manage problem correlations</strong> capability.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Close problem</strong></td>
<td style="text-align: left;"><strong>Read-write</strong> required</td>
<td style="text-align: left;"><strong>Read-write</strong> if template trigger</td>
<td style="text-align: left;">Requires <strong>Close problems manually</strong> capability.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ch02-zabbix-installation-user-groups-best-practices-for-enterprise-access-control">Best Practices for Enterprise Access Control</h2>
<p>Building a maintainable, secure Zabbix environment requires discipline in defining
groups and permissions.</p>
<ol>
<li><strong>Adopt Role-Based Naming:</strong> Use clear, standardized names that reflect the
   user's role and their access level, such as <code>Ops-RW</code> (Operations Read/Write)
   or <code>NOC-RO</code> (NOC Read-Only).</li>
<li><strong>Grant Access via Groups Only:</strong> Never assign permissions directly to an individual
   user; always rely on <strong>group membership</strong>. This ensures auditability and maintainability.</li>
<li><strong>Principle of Least Privilege:</strong> Start with the most restrictive access (<strong>Read-only</strong>)
   and only escalate to <strong>Read-write</strong> when configuration-level changes are an
   absolute requirement of the user's role.</li>
<li><strong>Align with Organizational Structure:</strong> Ensure your Host Groups and Template
   Groups mirror your organization's teams or asset categories (e.g., <code>EU-Network</code>,
   <code>US-Database</code>, <code>Finance-Templates</code>). This makes permission assignment intuitive.</li>
<li><strong>Regular Review and Audit:</strong> Periodically review group memberships and permissions.
   A user's role may change, and their access in Zabbix must be adjusted accordingly.</li>
<li><strong>Test Restricted Views:</strong> After creating a group, always log in as a test user
   belonging to that group to verify that dashboards, widgets, and configuration
   pages display the correct restricted view.</li>
</ol>
<hr />
<h2 id="ch02-zabbix-installation-user-groups-example-user-permissions">Example : User permissions</h2>
<p>This exercise will demonstrate how Zabbix calculates a user's effective
permissions when they belong to multiple User Groups, focusing exclusively on the
core access levels: Read-only, Read-write, and Deny.</p>
<h3 id="ch02-zabbix-installation-user-groups-our-scenario">Our Scenario</h3>
<p>You are managing access rights for a large Zabbix deployment. You need to grant
general viewing access to all Linux servers but specifically prevent a junior team
from even seeing, let alone modifying, your highly critical database servers.</p>
<p>You will have to configure two overlapping User Groups to demonstrate the
precedence rules:</p>
<ul>
<li>Group A (Junior Monitoring): Grants general Read-only access to a wide host scope.</li>
<li>Group B (Critical Exclusion): Applies an explicit Deny to a specific, critical
  host subset.</li>
</ul>
<h4 id="ch02-zabbix-installation-user-groups-host-group-preparation">Host Group Preparation</h4>
<p>Ensure the following Host Groups exist in your Zabbix environment:</p>
<ul>
<li>HG_All_Linux_Servers (The wide scope of hosts)</li>
<li>HG_Critical_Databases (A subset of servers that is also within HG_All_Linux_Servers)</li>
</ul>
<p>You can create them under <code>Data collection</code> ‚Üí <code>Host groups</code>.</p>
<h4 id="ch02-zabbix-installation-user-groups-configuring-the-user-groups">Configuring the User Groups</h4>
<ul>
<li>Create Group A: 'Junior Monitoring'<ul>
<li>Navigate to Users ‚Üí User groups.</li>
<li>Create a new group named 'Junior Monitoring'.</li>
<li>In the Host permissions tab, assign the following right:</li>
<li>HG_All_Linux_Servers: Read-only (Read)</li>
<li>HG_Critical_Databases: Read-only (Read)</li>
</ul>
</li>
</ul>
<p><img alt="user-groups/../ch02-zabbix-installation/user-groups/ch02.21_junior-monitoring.png" src="../ch02-zabbix-installation/user-groups/ch02.21_junior-monitoring.png" />
<em>2.21 Junior monitoring</em></p>
<ul>
<li>Create Group B: 'Critical Exclusion'<ul>
<li>Create a second group named 'Critical Exclusion'.</li>
<li>In the Host permissions tab, assign the following right:</li>
<li>HG_Critical_Databases: Deny</li>
</ul>
</li>
</ul>
<p><img alt="user-groups/../ch02-zabbix-installation/user-groups/ch02.22_critical-exclusioin.png" src="../ch02-zabbix-installation/user-groups/ch02.22_critical-exclusioin.png" />
<em>ch02.22 Critical exclusion</em></p>
<h4 id="ch02-zabbix-installation-user-groups-creating-the-test-user">Creating the Test User</h4>
<p>We will create the user first, then assign them to the groups.</p>
<ul>
<li>Navigate to User Creation: Go to Users ‚Üí Users in the Zabbix frontend.</li>
<li>Click Create user.</li>
<li>Details:<ul>
<li>Username: test_junior</li>
<li>Name &amp; Surname: (Optional)</li>
<li>Password: Set a strong password and confirm it.</li>
<li>Language &amp; Theme: Set as desired.</li>
<li>Permissions: Select role <code>User role</code> as this has the type User (This is important,
  as 'Super Admin' bypasses all group restrictions).</li>
<li>Add the user to both group <code>Junior Monitoring</code> and <code>Critical Exclusion</code>.</li>
</ul>
</li>
<li>Save: Click Add.</li>
</ul>
<p><img alt="user-groups/../ch02-zabbix-installation/user-groups/ch02.23_test-junior.png" src="../ch02-zabbix-installation/user-groups/ch02.23_test-junior.png" />
<em>ch02.23 test user</em></p>
<h4 id="ch02-zabbix-installation-user-groups-create-the-hosts">Create the hosts</h4>
<p>We will create 2 host a linux server and a db server.</p>
<ul>
<li>Navigate to <code>Data collection</code> ‚Üí <code>Hosts</code>.</li>
<li>Click on create  host.</li>
<li>Details:<ul>
<li>Host name: Linux server</li>
<li>Templates: Linux by Zabbix agent</li>
<li>Host groups: HG_All_Linux_Servers</li>
<li>Interfaces: Agent with IP 127.0.0.1</li>
</ul>
</li>
<li>Save: Click Add.</li>
</ul>
<p><img alt="user-groups/../ch02-zabbix-installation/user-groups/ch02.24_hosts.png" src="../ch02-zabbix-installation/user-groups/ch02.24_hosts.png" />
<em>ch02.24 Add hosts</em></p>
<p>Add a DB server exact as above but change :</p>
<ul>
<li>Host name: DB server</li>
<li>Host groups: HG_Critical_Databases</li>
<li>Save: Click Add.</li>
</ul>
<p>This should work as long as you have your zabbix agent installed reporting back
on <code>127.0.0.1</code>. This is how it's configured when you first setup the Zabbix
server with an agent.</p>
<h4 id="ch02-zabbix-installation-user-groups-test-the-outcome">Test the Outcome</h4>
<p>Logout as the <code>Super admin</code> user and log back in as user <code>test_junior</code>.</p>
<p>When we now  navigate to <code>Monitoring</code> ‚Üí <code>Hosts</code>, we see that only the <code>Linux server</code>
is visible in the list of hosts. When we click on <code>Select</code> behind <code>Host groups</code>
we will only be able to see the group <code>HG_All_Linux_Servers</code>.</p>
<p>This table outlines the combined, <strong>effective rights</strong> for the user <strong><code>test_junior</code></strong>
(who is a member of both User Groups).</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Host Group (HG)</th>
<th style="text-align: left;">Permission via 'Junior Monitoring'</th>
<th style="text-align: left;">Permission via 'Critical Exclusion'</th>
<th style="text-align: left;"><strong>Effective Permission</strong></th>
<th style="text-align: left;">Outcome</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong><code>HG_All_Linux_Servers</code></strong></td>
<td style="text-align: left;">Read-only</td>
<td style="text-align: left;"><em>No Explicit Rule</em></td>
<td style="text-align: left;"><strong>Read-only</strong></td>
<td style="text-align: left;">Access to view data is <strong>Allowed</strong>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>HG_Critical_Databases</code></strong></td>
<td style="text-align: left;">Read-only</td>
<td style="text-align: left;">Deny</td>
<td style="text-align: left;"><strong>Deny</strong></td>
<td style="text-align: left;">Access is <strong>Blocked</strong> (host is hidden).</td>
</tr>
</tbody>
</table>
<h2 id="ch02-zabbix-installation-user-groups-conclusion">Conclusion</h2>
<p>Because test_junior belongs to a group that explicitly denies access to the Critical
Databases, the host is hidden entirely, proving that Deny Always Wins regardless
of other permissions. So we can conclude that user groups form the essential foundation
of access control in Zabbix 8.0. They define <em>what</em> each user can see and configure
(via host/template permissions).</p>
<h2 id="ch02-zabbix-installation-user-groups-questions">Questions</h2>
<ul>
<li>If a user only has Read-only permissions assigned to a Template Group, will they
  be able to see those templates listed under Data collection ‚Üí Templates?</li>
<li>Scenario: A user, Bob, is a member of two User Groups: 'NOC Viewers' (which
  has Read-only access to HG_Routers) and 'Tier 2 Techs' (which has Read-write
  access to the same HG_Routers). 
  Question: Can Bob modify the configuration of the routers in Zabbix, or is he
  limited to viewing data? Explain your answer based on Zabbix's precedence rules.</li>
<li>Scenario: A user, Alice, is a member of two User Groups: 'Ops Team' (which has
  Read-write access to the Host Group HG_Webservers) and 'Security Lockdown' (which
  has Deny access to the exact same HG_Webservers).
  Question: What are Alice's effective permissions for the hosts in HG_Webservers?
  Can she view or modify them, and why?</li>
</ul>
<h2 id="ch02-zabbix-installation-user-groups-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/users_and_usergroups/usergroup">https://www.zabbix.com/documentation/current/en/manual/config/users_and_usergroups/usergroup</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/users_and_usergroups/permissions">https://www.zabbix.com/documentation/current/en/manual/config/users_and_usergroups/permissions</a></li>
</ul></section><section class="print-page" id="ch02-zabbix-installation-user-roles" heading-number="7.5"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="user-roles">User Roles</h1>
<p>The Zabbix <em>User Role</em> system, introduced in Zabbix 5.2, defines what a user is
allowed to do within the Zabbix frontend and via the API. Unlike User Groups which
control data visibility Ex: (which hosts a user can see and/or manage), User Roles
control application functionality (what buttons a user can click).</p>
<h2 id="ch02-zabbix-installation-user-roles-the-role-hierarchy">The role hierarchy</h2>
<p>Every User Role, whether default or custom, is fundamentally based on one of the
classic User Types (Super Admin, Admin or User). This User Type serves as the maximum
allowed privilege for the role.</p>
<h2 id="ch02-zabbix-installation-user-roles-default-menu-access-by-user-type">Default Menu Access by User Type</h2>
<p><code>User Roles</code> can be created in the menu under the <code>Users</code> ‚Üí <code>User roles</code> menu. Or they can be
set per user in
the menu <code>Users</code> ‚Üí <code>Users</code> ‚Üí "some user" ‚Üí <code>Permissions</code>.</p>
<p>This table illustrates the default access rights granted to users based on their
initial <strong>User Type</strong> before any <strong>Custom User Role</strong> adjustments are made.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Menu Section</th>
<th style="text-align: center;">User</th>
<th style="text-align: center;">Admin</th>
<th style="text-align: center;">Super Admin</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Monitoring</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: left;">Dashboards</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Problems</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Hosts</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Latest data</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Maps</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Discovery</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Services</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">SLA</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">SLA report</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Inventory</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: left;">Overview</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Hosts</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Reports</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: left;">System information</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Scheduled reports</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Availability report</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Top 100 triggers</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Audit log</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Action log</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Notifications</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: left;">Data collection</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Template groups</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Host groups</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Templates</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Hosts</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Maintenance</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Event correlation</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Discovery</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerts (Actions)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: left;">Trigger actions</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Service actions</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Discovery actions</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Autoregistration actions</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Internal actions</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Administration</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: left;">Media types</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Scripts</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Users</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">User groups</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">User roles</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">API tokens</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Authentication</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">General</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Audit log</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Housekeeping</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Proxy groups</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Proxies</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Macros</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Queue</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">‚úÖ</td>
</tr>
</tbody>
</table>
<h2 id="ch02-zabbix-installation-user-roles-customizing-role-permissions">Customizing Role Permissions</h2>
<p>When defining a custom role (based on <code>Admin</code> or <code>User</code>), the Zabbix administrator
can selectively <strong>revoke</strong> or <strong>grant</strong> specific rights within the scope of the
base User Type. Customization is split into three main areas:</p>
<h3 id="ch02-zabbix-installation-user-roles-ui-elements-frontend-menu-access-permissions">UI Elements (Frontend Menu Access Permissions)</h3>
<p>This section controls the visibility of menu items. By default, a role based on
the <code>Admin</code> type can see the <code>Data collection</code> menu. This allows you to hide specific
configuration sections from them.</p>
<ul>
<li><strong>Example Use:</strong> You can create an <code>Admin</code> role called <strong>"Template Editor"</strong>
that is allowed to see and modify <strong>Templates</strong>, but deny access to the <strong>Hosts</strong>
configuration to prevent accidental host changes.</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Permission</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Frontend access</strong></td>
<td style="text-align: left;">Allows or denies access to the entire Zabbix frontend (vs. API-only access).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Visibility</strong></td>
<td style="text-align: left;">Toggle access to specific sections like <code>Monitoring</code>, <code>Data collection</code>, <code>Reports</code>, or even sub-menus like <code>Trigger Actions</code> or <code>Hosts</code>.</td>
</tr>
</tbody>
</table>
<h3 id="ch02-zabbix-installation-user-roles-action-permissions-functionality-control">Action Permissions (Functionality Control)</h3>
<p>This is perhaps the most critical section, defining <strong>operational capabilities</strong>.
These permissions control what actions a user can perform on existing data, regardless
of which menu they are in.</p>
<ul>
<li><strong>Example Use (NOC):</strong> Allow a <strong>NOC Operator</strong> role (based on <code>User</code>) to
  <strong>Acknowledge problems</strong> and <strong>Close problems manually</strong>, but <em>deny</em> them the
  right to <strong>Execute scripts</strong> to prevent unauthorized command execution.</li>
<li><strong>Example Use 2 (Dashboard):</strong> Allow a <strong>Manager</strong> role (based on <code>User</code>) to
  <strong>Create and edit dashboards</strong> so they can customize their view, but deny them
  the ability to <strong>Acknowledge problems</strong>.</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Permission</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Acknowledge problems</strong></td>
<td style="text-align: left;">The ability to add comments to and acknowledge active problems.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Close problems manually</strong></td>
<td style="text-align: left;">The ability to force-close a problem, even if the underlying issue is unresolved.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Create and edit dashboards</strong></td>
<td style="text-align: left;">Controls the ability to build and modify frontend dashboards.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Execute scripts</strong></td>
<td style="text-align: left;">Controls the ability to execute global scripts (e.g., remote commands, inventory updates).</td>
</tr>
</tbody>
</table>
<h3 id="ch02-zabbix-installation-user-roles-api-permissions">API Permissions</h3>
<p>For advanced or integration purposes, the role can specify which Zabbix API methods
are accessible. This is typically used to restrict custom scripts or integrations
to only the necessary read/write operations (e.g., allow <code>host.get</code> but deny
<code>host.create</code>).</p>
<h2 id="ch02-zabbix-installation-user-roles-operational-authority-for-problem-handling">Operational Authority for Problem Handling</h2>
<p>The authority to manage problems and respond to incidents is critically tied to
a user's access rights over the underlying Triggers and Host Groups, which are
governed by their User Groups. These rules define a user's capabilities within
the Monitoring sections of the Zabbix frontend:</p>
<ul>
<li>
<p><strong>To Acknowledge Events and Add Comments:</strong> To acknowledge (events) and provide
  comments on problems, a user must possess at least Read permission for the
  triggers that generated the event. This action is purely informative and does
  not alter the core status or configuration of the problem.</p>
</li>
<li>
<p><strong>To Change Problem Severity or Close Problems:</strong> To change the severity of a
  problem or to manually close (close problem) it, the user requires Read-write
  permission for the corresponding triggers. These actions impact the status
  and state of the problem and therefore necessitate a higher, more decisive
  level of authority.</p>
</li>
</ul>
<h2 id="ch02-zabbix-installation-user-roles-practical-user-role-scenarios">Practical User Role Scenarios</h2>
<p>Providing distinct custom role examples helps illustrate the flexibility of the system.</p>
<h3 id="ch02-zabbix-installation-user-roles-scenario-1-template-maintainer-role">Scenario 1: Template Maintainer Role</h3>
<p><strong>Objective:</strong></p>
<p>Create a custom role for a technical administrator who manages templates but should
not modify host configurations or system settings.</p>
<p><strong>Base Role:</strong></p>
<ul>
<li><strong>Based on:</strong> Admin</li>
<li><strong>Goal:</strong> Limit exposure to production hosts while maintaining full template management.</li>
</ul>
<p><strong>Configuration Steps:</strong></p>
<ol>
<li><strong>Administration ‚Üí Users ‚Üí User roles ‚Üí Create role</strong></li>
<li><strong>General</strong><ul>
<li><strong>Role name:</strong> <code>Template Maintainer</code></li>
<li><strong>Base role:</strong> <code>Admin</code></li>
<li><strong>Frontend access:</strong> ‚úÖ Enabled</li>
</ul>
</li>
<li><strong>UI element permissions</strong><ul>
<li>‚úÖ <strong>Data collection ‚Üí Templates</strong></li>
<li>‚úÖ <strong>Data collection ‚Üí Template Groups</strong></li>
<li>‚ùå <strong>Data collection ‚Üí Hosts</strong></li>
<li>‚ùå <strong>Users</strong> (entire section)</li>
<li>‚ùå <strong>Alerts</strong> (entire section)</li>
<li>‚ùå <strong>Administration</strong> (entire section)</li>
</ul>
</li>
<li><strong>Action permissions</strong><ul>
<li>‚ùå <strong>Acknowledge problems</strong></li>
<li>‚ùå <strong>Close problems manually</strong></li>
<li>‚úÖ <strong>Create and edit dashboards</strong> (optional, for testing/POCs)</li>
<li>‚ùå <strong>Execute scripts</strong></li>
</ul>
</li>
<li><strong>API permissions (examples)</strong><ul>
<li><strong>Allow:</strong> <code>template.get</code>, <code>template.update</code>, <code>template.create</code></li>
<li><strong>Deny:</strong> Host/system/user-management calls (e.g., <code>host.create</code>, <code>user.update</code>, etc.)</li>
</ul>
</li>
</ol>
<p><strong>Testing:</strong></p>
<ul>
<li>Log in as the user: you should see <strong>Data collection ‚Üí Templates</strong> only
  (within config areas), while <strong>Hosts</strong>, <strong>Alerts</strong>, <strong>Users</strong>, and
  <strong>Administration</strong> are hidden.</li>
<li>Direct URL access to hidden sections should return <em>Permission denied</em>.</li>
</ul>
<p><strong>Use Case:</strong></p>
<p>Ideal in environments with <strong>segregated duties</strong>, e.g., one team maintains templates
while another handles discovery and host setup.</p>
<p><img alt="user-roles/../ch02-zabbix-installation/user-roles/ch02.25_template_maintainer.png" src="../ch02-zabbix-installation/user-roles/ch02.25_template_maintainer.png" /></p>
<hr />
<h3 id="ch02-zabbix-installation-user-roles-scenario-2-noc-operator-role">Scenario 2: NOC Operator Role</h3>
<p><em><em>Objective</em>:</em></p>
<p>Create a role for a 24/7 Network Operations Center (NOC) operator who monitors
problems and acknowledges them, but cannot alter configuration.</p>
<p><strong>Base Role:</strong></p>
<ul>
<li><strong>Based on:</strong> User  </li>
<li><strong>Goal:</strong> Empower NOC operators to handle incident acknowledgment without
  configuration access.</li>
</ul>
<p><strong>Configuration Steps:</strong></p>
<ol>
<li>Go to <strong>Administration ‚Üí User roles ‚Üí Create role</strong></li>
<li>Set:<ul>
<li><strong>Role name:</strong> <code>NOC Operator</code></li>
<li><strong>Base role:</strong> <code>User</code></li>
</ul>
</li>
<li><strong>UI element permissions (7.4 menu)</strong><ul>
<li>‚úÖ <strong>Monitoring ‚Üí Dashboards / Problems / Hosts / Latest data</strong></li>
<li>‚úÖ <strong>Services ‚Üí SLA report</strong></li>
<li>‚úÖ <strong>Reports ‚Üí Availability report</strong> (if used)</li>
<li>‚ùå <strong>Data collection</strong> (entire section)</li>
<li>‚ùå <strong>Users</strong> (entire section)</li>
<li>‚ùå <strong>Alerts</strong> (entire section)</li>
<li>‚ùå <strong>Administration</strong> (entire section)</li>
</ul>
</li>
<li><strong>Action permissions</strong><ul>
<li>‚úÖ <strong>Acknowledge problems</strong></li>
<li>‚úÖ <strong>Close problems manually</strong> <em>(optional enable only if your workflow requires it)</em></li>
<li>‚ùå <strong>Execute scripts</strong></li>
<li>‚ùå <strong>Create and edit dashboards</strong> <em>(or enable if they must tweak NOC views)</em></li>
</ul>
</li>
<li><strong>API permissions (examples)</strong><ul>
<li><strong>Allow:</strong> <code>problem.get</code>, <code>event.acknowledge</code>, <code>trigger.get</code></li>
<li><strong>Deny:</strong> configuration-related APIs</li>
</ul>
</li>
</ol>
<p><strong>User Group Binding:</strong></p>
<p>Assign this role to a <strong>User Group</strong> with <code>Read</code> access to specific Host Groups
(e.g., <em>Production Routers</em>, <em>Datacenter Switches</em>).</p>
<p><strong>This ensures:</strong></p>
<ul>
<li>The operator can view and acknowledge only relevant alerts.</li>
<li>No risk of unauthorized system modifications.</li>
</ul>
<p><strong>Use Case:</strong></p>
<p>Used by <strong>first-line support teams</strong> who handle incident acknowledgment and
escalation during live monitoring.</p>
<p><img alt="user-roles/../ch02-zabbix-installation/user-roles/ch02.26_noc_operator.png" src="../ch02-zabbix-installation/user-roles/ch02.26_noc_operator.png" /></p>
<hr />
<h2 id="ch02-zabbix-installation-user-roles-summary-role-vs-group">Summary: Role vs. Group</h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Zabbix's User Roles and <strong>User Groups</strong> work together to enforce both
<strong>security</strong> and <strong>usability</strong>. Roles define <strong>what you can do</strong>, while Groups
define <strong>what you can see</strong> ‚Äî giving administrators fine-grained control over
both the <em>interface</em> and <em>data scope</em> in multi-team monitoring environments.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since Zabbix 7.4 there is now the <strong>Action option</strong> <code>Create and edit own media</code>
available. This option allows users to manage their own media something
that wasn't possible before.</p>
</div>
<p>It is crucial to understand that these two systems work in tandem:</p>
<ul>
<li><strong>User Role:</strong> Controls the <strong>Zabbix application and UI</strong>. <em>Can you click the
  "Data collection" menu?</em></li>
<li><strong>User Group:</strong> Controls the <strong>Host/Item data</strong>. <em>If you click "Data
  collection, " which hosts do you see?</em></li>
</ul>
<p>A user with the <strong>Config Admin Role</strong> will see the <code>Data collection</code> menu, but if
their <strong>User Group</strong> has no permissions to any <strong>Host Groups</strong>, they will see an
empty host list. This layered approach ensures both security and a tailored
user experience.</p>
<h2 id="ch02-zabbix-installation-user-roles-conclusion">Conclusion</h2>
<p>Zabbix's <strong>User Roles</strong> and <strong>User Groups</strong> together form the foundation of a secure
and flexible access control model. User Roles define <strong>what a person can do</strong>
in the frontend and API shaping the available menus, actions, and privileges.
While User Groups define <strong>what data that person can see</strong>, such as hosts, templates,
and triggers.</p>
<p>By carefully combining these two layers, administrators can tailor Zabbix to match
real operational responsibilities: from read-only NOC operators to full template
maintainers or automation accounts. This separation of function and visibility
not only strengthens security but also creates a cleaner, more focused user experience
for every role within the monitoring ecosystem.</p>
<h2 id="ch02-zabbix-installation-user-roles-questions">Questions</h2>
<ul>
<li>What is the key difference between a <strong>User Role</strong> and a <strong>User Group</strong> in Zabbix?</li>
<li>How does the base <strong>User Type</strong> (User, Admin, Super Admin) limit what a custom role can achieve?</li>
<li>Why might you assign different User Groups to users who share the same User Role?</li>
<li>How can role-based API permissions help reduce risk in automation or DevOps workflows?</li>
</ul>
<h2 id="ch02-zabbix-installation-user-roles-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/users_and_usergroups/permissions#user-types">https://www.zabbix.com/documentation/current/en/manual/config/users_and_usergroups/permissions#user-types</a></li>
</ul></section>
                    <section class='print-page md-section' id='section-7-6' heading-number='7.6'>
                        <h1>External Authentication<a class='headerlink' href='#section-7-6' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch02-zabbix-installation-http" heading-number="7.6.1"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="http">HTTP</h1>
<p>HTTP authentication is one of external authentication methods provided by
Zabbix and can be used to additionally secure your Zabbix WebUI with
basic authentication mechanism at HTTP server level.</p>
<p>Basic HTTP authentication protects Website (Zabbix WebUI) resources with a
username and password. When a user attempts to access Zabbix WebUI, the
browser pops up a dialog asking for credentials before sending anything over
to Zabbix WebUI php code.</p>
<p>An HTTP server has a file with credentials that is used to authenticate users.</p>
<p>First let's see how we can configure basic authentication in HTTP server.</p>
<details class="warning" open="open">
<summary>Warning</summary>
<p>The examples below provide just minimum set of options to configure
basic authentication. Please refer to respective HTTP server documentation
for more details</p>
</details>
<h2 id="ch02-zabbix-installation-http-basic-authentication">Basic authentication</h2>
<p>To enable basic authentication, we first need a "password-file" containing all
usernames and passwords that are allowed to access the frontend.</p>
<div class="admonition warning">
<p class="admonition-title">Important</p>
<p>Usernames configured for basic authentication in HTTP server
must exist in Zabbix. But only passwords configured in HTTP server are used
for users authentication.</p>
</div>
<p>To create this file we need the command <code>htpasswd</code>. Execute following commands
to ensure we have this utility:</p>
<div class="admonition info">
<p class="admonition-title">Install htpasswd utility</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch02-zabbix-installation-http-__codelineno-0-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>httpd-utils
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch02-zabbix-installation-http-__codelineno-1-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>apache2-utils
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch02-zabbix-installation-http-__codelineno-2-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>apache2-utils
</span></code></pre></div></p>
</div>
<p>Next we will create the required file and the <code>Admin</code> user in it:</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>NGINX
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch02-zabbix-installation-http-__codelineno-3-1"></a>sudo<span class="w"> </span>htpasswd<span class="w"> </span>-c<span class="w"> </span>/etc/nginx/httpauth<span class="w"> </span>Admin
</span></code></pre></div></p>
<p>Apache on Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch02-zabbix-installation-http-__codelineno-4-1"></a>sudo<span class="w"> </span>htpasswd<span class="w"> </span>-c<span class="w"> </span>/etc/httpd/.htpasswd<span class="w"> </span>Admin
</span></code></pre></div></p>
<p>Apache on SUSE / Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch02-zabbix-installation-http-__codelineno-5-1"></a>sudo<span class="w"> </span>htpasswd<span class="w"> </span>-c<span class="w"> </span>/etc/apache2/.htpasswd<span class="w"> </span>Admin
</span></code></pre></div></p>
</div>
<p>This command will request you to input the desired password for the <code>Admin</code> user
and will then create the specified password-file with the username and encrypted
password in it.</p>
<p>For any additional user we can use the same command but without the <code>-c</code> option
as the file is now already created:</p>
<details class="example" open="open">
<summary>Add additional users</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch02-zabbix-installation-http-__codelineno-6-1"></a><span class="go">localhost:~&gt; sudo htpasswd /etc/nginx/httpauth user1</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch02-zabbix-installation-http-__codelineno-6-2"></a><span class="go">New password: </span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch02-zabbix-installation-http-__codelineno-6-3"></a><span class="go">Re-type new password: </span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ch02-zabbix-installation-http-__codelineno-6-4"></a><span class="go">Adding password for user user1</span>
</span></code></pre></div>
</details>
<p>Which will add <code>user1</code> to the <code>/etc/nginx/httpauth</code>-file. Replace this path with
the path of this file on your distribution/webserver.</p>
<p>In the end the password-file should look something like:</p>
<details class="example" open="open">
<summary>Example password-file</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch02-zabbix-installation-http-__codelineno-7-1"></a><span class="go">localhost:~&gt; sudo cat /etc/nginx/httpauth</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch02-zabbix-installation-http-__codelineno-7-2"></a><span class="gp">Admin:$1$8T6SbR/N$</span>rgANUPGvFh7H.R1Mffexh.
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch02-zabbix-installation-http-__codelineno-7-3"></a><span class="gp">user1:$1$GXoDIOCA$</span>u/n1kkDeFwcI4KhyHkY6p/
</span></code></pre></div>
</details>
<p>Now that we have a password-file, we can continue to configure the web-browser
to actually perform basic authentication, using this file.</p>
<h3 id="ch02-zabbix-installation-http-configure-authentication-file-on-nginx">Configure authentication file on Nginx</h3>
<p>Find <code>location / {</code> block in Nginx configuration file that defines your Zabbix
WebUI (if you followed the installation steps as described in earlier chapters,
this should be in <code>/etc/nginx/conf.d/zabbix.conf</code>) and add these two lines:</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch02-zabbix-installation-http-__codelineno-8-1"></a>    location / {
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ch02-zabbix-installation-http-__codelineno-8-2"></a>        ...
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ch02-zabbix-installation-http-__codelineno-8-3"></a>        auth_basic &quot;Basic Auth Protected Site&quot;;
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#ch02-zabbix-installation-http-__codelineno-8-4"></a>        auth_basic_user_file /etc/nginx/httpauth;
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#ch02-zabbix-installation-http-__codelineno-8-5"></a>    }
</span></code></pre></div>
</div>
<p>Do not forget to restart Nginx service after making this change.</p>
<h2 id="ch02-zabbix-installation-http-configure-authentication-file-on-apache-httpd">Configure authentication file on Apache HTTPD</h2>
<p>Find <code>&lt;Directory "/usr/share/zabbix"&gt;</code> block in Apache HTTPD configuration file
that defines your Zabbix WebUI (in my case it is <code>/etc/zabbix/apache.conf</code>) and
add these lines:</p>
<details class="note" open="open">
<summary>Note</summary>
<p>By default configuration has <code>Require all granted</code>, remove this line.</p>
</details>
<details class="example" open="open">
<summary>Example</summary>
<p>RedHat:
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch02-zabbix-installation-http-__codelineno-9-1"></a>    &lt;Directory &quot;/usr/share/zabbix&quot;&gt;
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ch02-zabbix-installation-http-__codelineno-9-2"></a>        ...
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#ch02-zabbix-installation-http-__codelineno-9-3"></a>        AuthType Basic
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#ch02-zabbix-installation-http-__codelineno-9-4"></a>        AuthName &quot;Restricted Content&quot;
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#ch02-zabbix-installation-http-__codelineno-9-5"></a>        AuthUserFile /etc/httpd/.htpasswd
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#ch02-zabbix-installation-http-__codelineno-9-6"></a>        Require valid-user
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#ch02-zabbix-installation-http-__codelineno-9-7"></a>    &lt;/Directory&gt;
</span></code></pre></div></p>
<p>Ubuntu / SUSE
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch02-zabbix-installation-http-__codelineno-10-1"></a>    &lt;Directory &quot;/usr/share/zabbix&quot;&gt;
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch02-zabbix-installation-http-__codelineno-10-2"></a>        ...
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ch02-zabbix-installation-http-__codelineno-10-3"></a>        AuthType Basic
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ch02-zabbix-installation-http-__codelineno-10-4"></a>        AuthName &quot;Restricted Content&quot;
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#ch02-zabbix-installation-http-__codelineno-10-5"></a>        AuthUserFile /etc/apache2/.htpasswd
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#ch02-zabbix-installation-http-__codelineno-10-6"></a>        Require valid-user
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#ch02-zabbix-installation-http-__codelineno-10-7"></a>    &lt;/Directory&gt;
</span></code></pre></div></p>
</details>
<p>Do not forget to restart apache2 or httpd service after making this change.</p>
<h2 id="ch02-zabbix-installation-http-zabbix-configuration-for-http-authentication">Zabbix configuration for HTTP authentication</h2>
<p>When we have a WEB server configured with basic authentication it is high time
to configure Zabbix server. In Zabbix menu select <code>Users | Authentication |
HTTP settings</code> and check <code>Enable HTTP authentication</code> check-box. Click <code>Update</code>
and confirm the changes by clicking <code>OK</code> button.</p>
<p><img align="center" alt="HTTP users authentication" src="../ch02-zabbix-installation/external-auth/ch02.1-http-auth-settings.png" /></p>
<p><em>2.1 HTTP users authentication</em></p>
<p><code>Remove domain name</code> field should have a comma separated list of domains that
Zabbix will remove from provided username, e.g. if a user enters
"test@myzabbix" or "myzabbix\test" and we have "myzabbix" in this field then
the user will be logged in with username "test".</p>
<p>Unchecking <code>Case-sensitive login</code> check-box will tell Zabbix to not pay
attention to capital/small letters in usernames, e.g. "tEst" and "test" will
become equally legitimate usernames even if in Zabbix we have only "test"
user configured.</p>
<p>Note that <code>Default login form</code> is set to "Zabbix login form". Now if you sign
out you will see "Sign in with HTTP" link below Username and Password fields.
If you click on the link you will be automatically logged in into Zabbix WebUI
with the same username you previously used. Or you can enter different
Username and Password and normally log in into Zabbix WebUI as different user.</p>
<p><img align="center" alt="HTTP users authentication login" src="../ch02-zabbix-installation/external-auth/ch02.2-http-auth-login.png" /></p>
<p><em>2.2 HTTP users authentication login form</em></p>
<p>If you select "HTTP login form" in <code>Default login form</code> drop-down you won't see
standard Zabbix login form when you try to log out. You actually won't be able
to sign out unless your authentication session expires. The only way to sign out
is to clear cookies in your browser. Then you'll have to go through the Web
server basic authentication procedure again.</p>
<hr />
<h2 id="ch02-zabbix-installation-http-conclusion">Conclusion</h2>
<p>Configuring HTTP level authentication adds a critical layer of access control to
your Zabbix Web UI by leveraging your web server's native authentication mechanisms.
Whether using Nginx or Apache, this approach ensures that users are prompted for
credentials before even reaching Zabbix, effectively guarding against unauthorized
access at the HTTP entry point. Key considerations include ensuring that usernames
used in the HTTP authentication are already defined within Zabbix itself only the
password from the web server matters for credential checks and correctly setting
up Zabbix's HTTP authentication settings (such as domain removal and case sensitivity
options). By coordinating web server authentication settings with Zabbix's internal
configuration, you can achieve seamless and secure user login workflows that blend
frontend usability with robust protective measures.</p>
<hr />
<h2 id="ch02-zabbix-installation-http-questions">Questions</h2>
<ul>
<li>
<p>What advantage does HTTP (web server based) authentication provide compared to
  Zabbix's internal authentication mechanism? (Consider protection at the web
  server layer before the user even reaches the Zabbix UI.)</p>
</li>
<li>
<p>Why is it essential that a user must exist in Zabbix even when HTTP authentication
  is enabled and why does the Zabbix password become irrelevant in that case?</p>
</li>
<li>
<p>What are the configuration options in Zabbix's frontend under ‚ÄúAdministration
  ‚Üí Authentication‚Äù for HTTP authentication, and how might each affect login behavior?
  Examples include enabling/disabling case sensitivity, domain stripping, and choice
  of login form. </p>
</li>
<li>
<p>Suppose you disable case sensitive logins and maintain both 'Admin' and 'admin'
  accounts in Zabbix. How will HTTP authentication behave, and what outcome should
  you expect?</p>
</li>
<li>
<p>Imagine troubleshooting a login failure when using HTTP authentication: What
  steps would you take to ensure the web server‚Äôs authentication is configured
  correctly before examining Zabbix settings?</p>
</li>
<li>
<p>From a security standpoint, when would HTTP authentication alone be
  insufficient and what other authentication methods (e.g., LDAP, SAML, MFA) might
  you layer on top for added security?</p>
</li>
</ul>
<h2 id="ch02-zabbix-installation-http-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/web_interface/frontend_sections/users/authentication/http">https://www.zabbix.com/documentation/current/en/manual/web_interface/frontend_sections/users/authentication/http</a></li>
</ul></section><section class="print-page" id="ch02-zabbix-installation-ldap-ad" heading-number="7.6.2"><nav class='md-tags'><span class='md-tag'>expert</span></nav><h1 id="ldap-ad">LDAP / AD</h1>
<p>As any modern system Zabbix can perform users authentication using Lightweight
Directory Access Protocol (LDAP). In theory LDAP is very well defined open
protocol that should be vendor independent but its relative complexity plays a
role in every LDAP server implementation. Zabbix is known to work well with
Microsoft Active Directory and OpenLDAP server.</p>
<p>LDAP authentication can be configured in two modes:</p>
<ul>
<li>Users authentication</li>
<li>Users authentication with users provisioning</li>
</ul>
<h2 id="ch02-zabbix-installation-ldap-ad-users-authentication-mode">Users authentication mode</h2>
<p>The process of the authenticating users follows this diagram.</p>
<p><img align="center" alt="LDAP users authentication" src="../ch02-zabbix-installation/external-auth/ch02.3-ldap-auth-diagram.png" /></p>
<p><em>2.3 LDAP users authentication</em></p>
<p>As shown on the diagram a user that tries to log in must be pre-created in
Zabbix to be able to log in using LDAP. The database user records do not have
any fields "saying" that the user will be authenticated via LDAP, it's just
users' passwords stored in the database are ignored, instead, Zabbix goes to
a LDAP server to verify whether:</p>
<ul>
<li>user with a given username exists</li>
<li>user provided the correct password</li>
</ul>
<p>no other attributes configured for the user on the LDAP server side are taken
into account.</p>
<p>So when Zabbix is used by many users and groups, user management becomes not a
very trivial task as new people join different teams (or leave). This problem
is addressed by "users provisioning" and we'll cover this topic a bit later.
For now let's take a look at how to configure LDAP authentication.</p>
<h2 id="ch02-zabbix-installation-ldap-ad-configure-ldap">Configure LDAP</h2>
<p>In this section, we will be using a custom demo LDAP server with pre-loaded
data. You can set this demo environment up to check out the Zabbix LDAP authentication
possibilities. Or you can skip the setup of the demo environment if you just want
to connect your Zabbix instance to your existing LDAP or AD server.</p>
<h3 id="ch02-zabbix-installation-ldap-ad-set-up-local-demo-ldap-server">Set up local demo LDAP server</h3>
<p>We believe that it is better to learn this topic by example so we'll be using
our own LDAP server that you can spin up in a container for demo purposes.
First we will need to ensure that we have a container engine installed. </p>
<div class="admonition info">
<p class="admonition-title">Install Podman container engine</p>
</div>
<p>Red Hat
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch02-zabbix-installation-ldap-ad-__codelineno-0-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>podman
</span></code></pre></div></p>
<p>SUSE
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch02-zabbix-installation-ldap-ad-__codelineno-1-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>podman
</span></code></pre></div></p>
<p>Ubuntu
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch02-zabbix-installation-ldap-ad-__codelineno-2-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>podman
</span></code></pre></div></p>
<details class="note" open="open">
<summary>What is Podman</summary>
</details>
<p>Podman is a container engine designed as a drop-in replacement for Docker, 
  but with a daemonless architecture. This means it runs containers directly 
  under the user‚Äôs control, improving security and simplicity. Podman is fully 
  compatible with Docker‚Äôs CLI and supports rootless containers, making it ideal 
  for development, testing, and production environments where security and 
  isolation are priorities.</p>
<details class="tip" open="open">
<summary>Tip</summary>
</details>
<p>If you want to use Docker instead of Podman, you can just replace any 
  occurrences of <code>podman</code> in following instructions by <code>docker</code>.</p>
<p>Now we can start containers. Start an OpenLDAP server in a container:</p>
<div class="admonition info">
<p class="admonition-title">Start an OpenLDAP server in a container with pre-loaded data</p>
</div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch02-zabbix-installation-ldap-ad-__codelineno-3-1"></a>podman<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span><span class="m">3389</span>:389<span class="w"> </span>-p<span class="w"> </span><span class="m">6636</span>:636<span class="w"> </span>--name<span class="w"> </span>openldap-server<span class="w"> </span>--detach<span class="w"> </span>bgmot42/openldap-server:0.1.1
</span></code></pre></div>
<p>For simplicity, all users (including <code>ldap_search</code>) in this test LDAP server
have the word <code>password</code> as their passwords.</p>
<p>Users <code>user1</code> and <code>user2</code> is a member of <code>zabbix-admins</code> LDAP group. User
<code>user3</code> is a member of <code>zabbix-users</code> LDAP group.</p>
<p>???+ tip Tip: use phpLdapAdmin as an LDAP GUI</p>
<div class="language-text highlight"><pre><span></span><code>To visually see LDAP server data (and add your own configuration like users
and groups) you can start this standard container:

```bash
podman run -p 8081:80 -p 4443:443 --name phpldapadmin --hostname phpldapadmin\
  --link openldap-server:ldap-host --env PHPLDAPADMIN_LDAP_HOSTS=ldap-host\
  --detach osixia/phpldapadmin:0.9.0
```
Now you can access this LDAP server via https://&lt;ip_address&gt;:4443 (or any
other port you configure to access this Docker container), click Login,
enter ‚Äúcn=admin,dc=example,dc=org‚Äù in Login DN field and ‚Äúpassword‚Äù in
Password field, click Authenticate. You should see the following structure
of the LDAP server (picture shows ‚Äòzabbix-admins‚Äô group configuration):

![LDAP server data](external-auth/ch02.4-ldap-ldap-server-data.png){ align=center }

_2.4 LDAP server data_
</code></pre></div>
<h3 id="ch02-zabbix-installation-ldap-ad-configure-zabbix-ldap-authentication">Configure Zabbix LDAP authentication</h3>
<p>Let's configure LDAP server settings in Zabbix. In Zabbix menu select
<code>Users | Authentication | LDAP settings</code>, then check the check-box
<code>Enable LDAP authentication</code> and click <code>Add</code> under <code>Servers</code> (change IP address
of your LDAP server and port number according to your set up):</p>
<p><img align="center" alt="LDAP server settings in Zabbix" src="../ch02-zabbix-installation/external-auth/ch02.5-ldap-server-settings-in-zabbix.png" /></p>
<p><em>2.5 LDAP server settings in Zabbix</em></p>
<p>Following diagram can help you understand how to configure LDAP server in
Zabbix based on your LDAP server data structure:</p>
<p><img align="center" alt="LDAP server to Zabbix" src="../ch02-zabbix-installation/external-auth/ch02.6-ldap-server-to-zabbix.png" /></p>
<p><em>2.6 LDAP server to Zabbix</em></p>
<p>‚ÄúSpecial‚Äù <em>Distinguished Name</em> (DN) <em>cn=ldap_search,dc=example,dc=org</em> is used
for searching, i.e. Zabbix uses this DN to connect to LDAP server and of course
when you connect to LDAP server you need to be authenticated ‚Äì this is why you
need to provide <em>Bind password</em>. This DN should have access to a sub-tree in
LDAP data hierarchy where all your users are configured. In our case all the
users configured ‚Äúunder‚Äù <em>ou=Users,dc=example,dc=org</em>, this DN is called base
DN and used by Zabbix as so to say ‚Äústarting point‚Äù to start searching.</p>
<details class="warning" open="open">
<summary>Anonymous LDAP binding</summary>
<p>Technically it is possible to bind to the LDAP server anonymously, without
providing a password but this is a huge breach in security as the whole
users sub-tree becomes available for anonymous (unauthenticated) search,
i.e. effectively exposed to any LDAP client that can connect to LDAP server
over TCP. The LDAP server we deployed previously in Docker container does
not provide this functionality.</p>
</details>
<p>Click <code>Test</code> button and enter <code>user1</code> and <code>password</code> in the respective fields, the
test should be successful confirming Zabbix can authenticate users against LDAP
server.</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>We can add multiple LDAP servers and use them for different <code>User groups</code>.</p>
</details>
<p>To test real users login using LDAP authentication we need to create user
groups and users in Zabbix. In Zabbix menu select <code>Users | User groups</code>. Make
sure <code>Zabbix administrators</code> group exists (we'll need it later) and create new
group <code>Zabbix users</code> by clicking <code>Create user group</code> button. Enter "Zabbix
users" in <code>Group name</code> field, select "LDAP" in <code>Frontend access</code> drop-down that
will make Zabbix to authenticate users belonging to this group against LDAP
server and in <code>LDAP server</code> drop-down select LDAP server we earlier configured
"Test LDAP server". Click <code>Add</code> button to create this User group:</p>
<p><img align="center" alt="Add user group in zabbix" src="../ch02-zabbix-installation/external-auth/ch02.7-ldap-add-user-group-in-zabbix.png" /></p>
<p><em>2.7 Add user group in zabbix</em></p>
<p>Now we need to create our test user. In Zabbix menu select <code>Users | Users</code> and
click <code>Create user</code> button. Then enter "user3" in <code>Username</code> field. Select
"Zabbix users" in <code>Groups</code> field. What you enter in <code>Password</code> and <code>Password
(once again)</code> fields does not matter as Zabbix will not try to use this
password, instead it will go to LDAP server to authenticate this user since
it's a member of the User group that has authentication method <code>LDAP</code>, just
make sure you enter the same string in these two fields and it satisfied your
password strength policy defined in <code>Users | Authentication</code>.</p>
<p><img align="center" alt="Add user in Zabbix" src="../ch02-zabbix-installation/external-auth/ch02.8-ldap-add-user-in-zabbix.png" /></p>
<p><em>2.8 Add user in Zabbix</em></p>
<p>Then click <code>Permissions</code> tab and select "User role" in <code>Role</code> field:</p>
<p><img align="center" alt="Add user in Zabbix - permissions" src="../ch02-zabbix-installation/external-auth/ch02.9-ldap-add-user-in-zabbix-permissions.png" /></p>
<p><em>2.9 Add user in Zabbix - permissions</em></p>
<p>Click <code>Add</code> button to create the user.</p>
<p>We are ready to test our LDAP server authentication! Click <code>Sign out</code> in Zabbix
menu and login with "user3" as Username and "password" as <code>Password</code>, if you
carefully followed the steps above you should successfully login with User role
permissions.</p>
<p>Click <code>Sign out</code> again and login as Admin again to proceed.</p>
<h2 id="ch02-zabbix-installation-ldap-ad-just-in-time-user-provisioning">Just-in-Time user provisioning</h2>
<p>Now let's talk about really cool feature Zabbix provides - "Just-in-Time user
provisioning (JIT) available since Zabbix 6.4.</p>
<p>This picture illustrates on high level how it works:
<img align="center" alt="LDAP JIT explained" src="../ch02-zabbix-installation/external-auth/ch02.10-ldap-jit-explained.png" /></p>
<p><em>2.10 LDAP JIT explained</em></p>
<p>Here when Zabbix gets a username and password from the Zabbix Login form it
goes to the LDAP server and gets all the information available for this user
including his/her LDAP groups membership and e-mail address. Obviously, it
gets all that only if the correct (from LDAP server perspective) username and
password were provided. Then Zabbix goes through pre-configured mapping that
defines users from which <code>LDAP group</code> goes to which <code>Zabbix user group</code>. If at
least one match is found then a <code>Zabbix user</code> is created in the Zabbix database
belonging to a <code>Zabbix user group</code> and having a <code>Zabbix user role</code> according to
configured ‚Äúmatch‚Äù. So far sounds pretty simple, right? Now let‚Äôs go into
details about how all this should be configured.</p>
<p>In <code>Users | Authentication</code> we need to do two things:</p>
<ul>
<li>
<p>Set <code>Default authentication</code> to <em>LDAP</em>. When JIT is turned off then type of
  authentication is defined based on the <em>User group</em> a user that tries to login
  belongs to. In case of JIT the user does not exist in Zabbix yet thus obviously
  does not belong to any <em>User group</em> so <em>Default</em> method authentication is used
  and we want it to be <em>LDAP</em>.</p>
</li>
<li>
<p>Provide <code>Deprovisioned users group</code>. This group must be literally <em>disabled</em>
  otherwise you won't be able to select it here. This is the Zabbix user group
  where all <em>de-provisioned</em> users will be put into so effectively will get
  disabled from accessing Zabbix.</p>
</li>
</ul>
<p><img align="center" alt="Default authentication" src="../ch02-zabbix-installation/external-auth/ch02.11-ldap-default-authentication.png" /></p>
<p><em>2.11 Default authentication</em></p>
<p>Click <code>Update</code> button`.</p>
<ul>
<li>Enable JIT provisioning check-box which obviously needs to be checked for this
  feature to work. It's done in our <em>Test LDAP server</em> configuration - select
  <code>Users | Authentication | LDAP settings</code> and click on our server in <code>Servers</code>
  section. After enabling this check-box we'll see some other fields related to
  JIT to be filled in and what we put in there depends on the method we choose to
  perform JIT.</li>
</ul>
<h3 id="ch02-zabbix-installation-ldap-ad-group-configuration-method-memberof">Group configuration method ‚ÄúmemberOf‚Äù</h3>
<p>All users in our LDAP server have <em>memberOf</em> attribute which defines what LDAP
groups every user belongs to, e.g. if we perform a LDAP query for <em>user1</em> user
we‚Äôll get that its <em>memberOf</em> attribute has this value:</p>
<p><strong>memberOf</strong>: cn=<strong>zabbix-admins</strong>,ou=Group,dc=example,dc=org</p>
<p>Note, that your real LDAP server can have totally different LDAP attribute that
provides users‚Äô group membership, and of course, you can easily configure what
attribute to use when searching for user‚Äôs LDAP groups by putting it into <code>User
group membership attribute</code> field:</p>
<p><img align="center" alt="LDAP groups mapping" src="../ch02-zabbix-installation/external-auth/ch02.12-ldap-groups-mapping.png" /></p>
<p><em>2.12 LDAP groups mapping</em></p>
<p>In the picture above we are telling Zabbix to use <em>memberOf</em> attribute to
extract DN defining user‚Äôs group membership (in this case it is
<em>cn=zabbix-admins,out=Group,dc=example,dc=org</em>) and take only <em>cn</em> attribute
from that DN (in this case it is <em>zabbix-admins</em>) to use in searching for a
match in User group mapping rules. Then we define as many mapping rules as we
want. In the picture above we have two rules:</p>
<ul>
<li>All users belonging to <em>zabbix-users</em> LDAP group will be created in Zabbix as
  members of <em>Zabbix users group</em> with <em>User</em> role</li>
<li>All users belonging to <em>zabbix-admins</em> LDAP group will be created in Zabbix
  as members of <em>Zabbix administrators</em> group with <em>Super admin</em> role</li>
</ul>
<h3 id="ch02-zabbix-installation-ldap-ad-group-configuration-method-groupofnames">Group configuration method ‚ÄúgroupOfNames‚Äù</h3>
<p>There is another method of finding users‚Äô group membership called
‚ÄúgroupOfNames‚Äù it is not as efficient as ‚ÄúmemberOf‚Äù method but can provide much
more flexibility if needed. Here Zabbix is not querying LDAP server for a user
instead it is searching for LDAP groups based on a given criterion (filter).
It‚Äôs easier to explain with pictures depicting an example:</p>
<p><img align="center" alt="LDAP server group of names" src="../ch02-zabbix-installation/external-auth/ch02.13-ldap-group-of-names.png" /></p>
<p><em>2.13 LDAP server groupOfNames</em></p>
<p>Firstly we define LDAP ‚Äúsub-tree‚Äù where Zabbix will be searching for LDAP
groups ‚Äì note <em>ou=Group,dc=example,dc=org</em> in Group base DN field. Then in the
field <code>Group name attribute</code> field we what attribute to use when we search in
mapping rules (in this case we take <em>cn</em>, i.e. only <em>zabbix-admins</em> from full
DN <em>cn=zabbix-admins,ou=Group,dc=example,dc=org</em>). Each LDAP group in our LDAP
server has <em>member</em> attribute that has all users that belong to this LDAP group
(look at the right picture) so we put <em>member</em> in <code>Group member attribute</code>
field. Each user‚Äôs DN will help us construct <code>Group filter</code> field. Now pay
attention: <code>Reference attribute</code> field defines what LDAP user‚Äôs attribute
Zabbix will use in the <code>Group filter</code>, i.e. <em>%{ref}</em> will be replaced with the
value of this attribute (here we are talking about the user‚Äôs attributes ‚Äì we
already authenticated this user, i.e. got all its attributes from LDAP server).
To sum up what I've said above Zabbix:</p>
<ol>
<li>Authenticates the user with entered Username and Password against LDAP
   server getting all user‚Äôs LDAP attributes</li>
<li>Uses <code>Reference attribute</code> and <code>Group filter</code> fields to construct a filter
   (when user1 logs in the filter will be (<em>member=uid=user1,ou=Users,dc=example,
   dc=org</em>)</li>
<li>Performs LDAP query to get all LDAP groups with member attribute (configured
   in <code>Group member attribute</code> field) containing constructed in step 2) filter</li>
<li>Goes through all LDAP groups received in step 3) and picks <code>cn</code> attribute
   (configured in <code>Group name attribute</code> field) and finds a match in User group
   mapping rules</li>
</ol>
<p>Looks a bit complicated but all you really need to know is the structure of
your LDAP data.</p>
<h3 id="ch02-zabbix-installation-ldap-ad-ready-to-test">Ready to test</h3>
<p>Now when you login with <em>user1</em> or <em>user2</em> username then these users will be
created by Zabbix and put into <em>Zabbix administrators</em> user group, when you
login with <em>user3</em> username then this user will be created by Zabbix and put
into <em>Zabbix users</em> user group:</p>
<p><img align="center" alt="Test user1" src="../ch02-zabbix-installation/external-auth/ch02.14-ldap-jit-test-user1.png" /></p>
<p><em>2.14 Test user1</em></p>
<p><img align="center" alt="Test user3" src="../ch02-zabbix-installation/external-auth/ch02.15-ldap-jit-test-user3.png" /></p>
<p><em>2.15 Test user3</em></p>
<hr />
<h2 id="ch02-zabbix-installation-ldap-ad-conclusion">Conclusion</h2>
<p>Integrating Zabbix with LDAP‚Äîor specifically, Active Directory elevates your system's
authentication capabilities by leveraging existing organizational credentials. It
allows users to log in using familiar domain credentials, while Zabbix offloads
the password verification process to a trusted external directory. Notably, even
when configuring LDAP authentication, corresponding user accounts must still exist
within Zabbix though their internal passwords become irrelevant once external authentication
is active.</p>
<p>Particularly powerful is the Just-In-Time (JIT) provisioning feature: this enables
Zabbix to dynamically create user accounts upon first successful LDAP login streamlining
onboarding and reducing manual administration. Beyond that, JIT supports ongoing
synchronization updating user roles, group memberships, or even user removals in
Zabbix to mirror changes in LDAP‚Äîeither when a user logs in or during configured
provisioning intervals.</p>
<p>Important configuration details such as case sensitivity, authentication binding
methods, search filters, and group mapping need careful attention to ensure reliable
and secure operation. And while LDAP offers seamless integration, Zabbix still
maintains control over roles, permissions, and access behavior through its own
user and user group models Zabbix.</p>
<p>In sum, LDAP/AD authentication offers a scalable, secure, and enterprise-aligned
approach to centralizing identity management in Zabbix. With flexible provisioning
and synchronization, organizations can reduce administrative load while reinforcing
consistency across their access control and authentication strategy.</p>
<h2 id="ch02-zabbix-installation-ldap-ad-questions">Questions</h2>
<ul>
<li>
<p>What are the main benefits of integrating Zabbix authentication with LDAP or Active
  Directory compared to using only internal Zabbix accounts?</p>
</li>
<li>
<p>Why must a user still exist in Zabbix even when LDAP authentication is enabled,
  and what role does the internal password play in that case?</p>
</li>
<li>
<p>How does Just-In-Time (JIT) provisioning simplify user management in Zabbix,
  and what potential risks or caveats should an administrator consider when
  enabling it?</p>
</li>
<li>
<p>What is the difference between user authentication and user authorization in
  the context of LDAP integration with Zabbix? (Hint: Authentication verifies
  credentials, while authorization determines permissions inside Zabbix.)</p>
</li>
<li>
<p>Imagine an administrator incorrectly configures the LDAP search filter. What issues
  might users encounter when attempting to log in, and how could you troubleshoot
  the problem?</p>
</li>
<li>
<p>How could LDAP group mappings be used to streamline permission assignment in
  Zabbix? Can you think of an example from your own environment?</p>
</li>
<li>
<p>If an organization disables a user account in Active Directory, how does JIT
  provisioning ensure that Zabbix access is also updated? What would happen if
  JIT was not enabled?</p>
</li>
</ul>
<h2 id="ch02-zabbix-installation-ldap-ad-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/web_interface/frontend_sections/users/authentication/ldap">https://www.zabbix.com/documentation/current/en/manual/web_interface/frontend_sections/users/authentication/ldap</a></li>
</ul></section><section class="print-page" id="ch02-zabbix-installation-saml" heading-number="7.6.3"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="saml">SAML</h1>
<h2 id="ch02-zabbix-installation-saml-google">Google</h2>
<p>Integrating Security Assertion Markup Language (SAML) for authentication within
Zabbix presents a non-trivial configuration challenge. This process necessitates
meticulous management of cryptographic certificates and the precise definition
of attribute filters. Furthermore, the official Zabbix documentation, while
comprehensive, can initially appear terse.</p>
<h3 id="ch02-zabbix-installation-saml-initial-configuration-certificate-generation">Initial Configuration: Certificate Generation</h3>
<p>The foundational step in SAML integration involves the generation of a <code>private key</code>
and a corresponding X.509 certificate. These cryptographic assets are critical
for establishing a secure trust relationship between Zabbix and the Identity Provider
(IdP).</p>
<p>By default, Zabbix expects these files to reside within the <code>ui/conf/certs/</code>
directory. However, for environments requiring customized storage locations, the
zabbix.conf.php configuration file allows for the specification of alternative
paths.</p>
<p>Let's create our private key and certificate file.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch02-zabbix-installation-saml-__codelineno-0-1"></a><span class="nb">cd</span><span class="w"> </span>/usr/share/zabbix/ui/conf/certs/
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch02-zabbix-installation-saml-__codelineno-0-2"></a>openssl<span class="w"> </span>req<span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-nodes<span class="w"> </span>-keyout<span class="w"> </span>sp.key<span class="w"> </span>-x509<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-out<span class="w"> </span>sp.crt
</span></code></pre></div>
<p>Following the generation and placement of the Zabbix Service Provider (SP) certificates,
the next critical phase involves configuring the Identity Provider (IdP). In this
context, we will focus on Google Workspace as the IdP.</p>
<p>Retrieving the IdP Certificate (idp.crt) from Google Workspace:</p>
<ol>
<li><strong>Access the Google Workspace Admin Console:</strong> Log in to your Google Workspace
   administrator account.</li>
<li><strong>Navigate to Applications:</strong> Within the admin console, locate and select the
   "Apps" section.</li>
<li><strong>Access Web and Mobile Apps:</strong> Choose <code>Web and mobile apps</code> from the available
   options.</li>
<li><strong>Create a New Application:</strong> Initiate the creation of a new application to
   facilitate SAML integration. This action will trigger Google Workspace to generate
   the necessary IdP certificate.
   <img alt="Add google app" src="../ch02-zabbix-installation/external-auth/ch02.16-add-google-app.png" /></li>
</ol>
<p><em>2.16 create
new application</em></p>
<ol start="5">
<li><strong>Download the IdP Certificate:</strong> Within the newly created application's settings,
   locate and download the idp.crt file. This certificate is crucial for establishing
   trust between Zabbix and Google Workspace.</li>
<li><strong>Placement of idp.crt:</strong> Copy the downloaded <code>idp.crt</code> file to the same directory
   as the SP certificates in Zabbix, under <code>ui/conf/certs/</code>.</li>
</ol>
<p><img alt="Add google app" src="../ch02-zabbix-installation/external-auth/ch02.17-saml-download.png" /></p>
<p><em>2.17 add
certificate</em></p>
<hr />
<h3 id="ch02-zabbix-installation-saml-saml-attribute-mapping-and-group-authorization">SAML Attribute Mapping and Group Authorization</h3>
<p>A key aspect of SAML configuration is the mapping of attributes between Google
Workspace and Zabbix. This mapping defines how user information is transferred
and interpreted.</p>
<p><strong>Attribute Mapping:</strong></p>
<ul>
<li>It is strongly recommended to map the Google Workspace "Primary Email" attribute
  to the Zabbix "Username" field. This ensures seamless user login using their
  Google Workspace email addresses.</li>
<li>Furthermore, mapping relevant Google Workspace group attributes allows for granular
  control over Zabbix user access. For instance, specific Google Workspace groups
  can be authorized to access particular Zabbix resources or functionalities.</li>
</ul>
<p><strong>Group Authorization:</strong></p>
<ul>
<li>Within the Google Workspace application settings, define the groups that are
  authorized to utilize SAML authentication with Zabbix.</li>
<li>This configuration enables the administrator to control which users can use
  SAML to log into Zabbix.</li>
<li>In Zabbix, you will also need to create matching user groups and configure
  the authentication to use those groups.</li>
</ul>
<p><strong>Configuration Example (Conceptual):</strong></p>
<ul>
<li>Google Workspace Attribute: "Primary Email" -&gt; Zabbix Attribute: "Username"</li>
<li>Google Workspace Attribute: "Group Membership" -&gt; Zabbix Attribute: "User Group"</li>
</ul>
<p>This attribute mapping ensures that users can log in using their familiar Google
Workspace credentials and that their access privileges within Zabbix are determined
by their Google Workspace group memberships.</p>
<p><img alt="saml mappings" src="../ch02-zabbix-installation/external-auth/ch02.18-saml-mappings.png" /></p>
<p><em>2.18 SAML
mappings</em></p>
<hr />
<h3 id="ch02-zabbix-installation-saml-zabbix-saml-configuration">Zabbix SAML Configuration</h3>
<p>With the IdP certificate and attribute mappings established within Google Workspace,
the final step involves configuring Zabbix to complete the SAML integration.</p>
<p><strong>Accessing SAML Settings in Zabbix:</strong></p>
<ul>
<li><strong>Navigate to User Management:</strong> Log in to the Zabbix web interface as an administrator.</li>
<li><strong>Access Authentication Settings:</strong> Go to "Users" -&gt; "Authentication" in the
  left-hand menu.</li>
<li><strong>Select SAML Settings:</strong> Choose the "SAML settings" tab.</li>
</ul>
<p><strong>Configuring SAML Parameters:</strong></p>
<p>Within the "SAML settings" tab, the following parameters must be configured:</p>
<ul>
<li><strong>IdP Entity ID:</strong> This value uniquely identifies the Identity Provider
  (Google Workspace in this case). It can be retrieved from the Google Workspace
  SAML configuration metadata.</li>
<li><strong>SSO Service URL:</strong> This URL specifies the endpoint where Zabbix should send
  authentication requests to Google Workspace. This URL is also found within the
  Google Workspace SAML configuration metadata.</li>
<li><strong>Retrieving Metadata:</strong> To obtain the IdP entity ID and SSO service URL, within
    the Google Workspace SAML application configuration, select the option to <code>Download
metadata</code>. This XML file contains the necessary values.</li>
<li><strong>Username Attribute:</strong> Set this to "username." This specifies the attribute
  within the SAML assertion that Zabbix should use to identify the user.</li>
<li><strong>SP Entity ID:</strong> This value uniquely identifies the Zabbix Service Provider.
  It should be a URL or URI that matches the Zabbix server's hostname.</li>
<li><strong>Sign:</strong> Select <code>Assertions</code>. This configures Zabbix to require that the SAML
  assertions from Google Workspace are digitally signed, ensuring their integrity.</li>
</ul>
<p>Example Configuration (Conceptual)</p>
<ul>
<li>IdP entity ID: <a href="https://accounts.google.com/o/saml2?idpid=your_idp_id">https://accounts.google.com/o/saml2?idpid=your_idp_id</a></li>
<li>SSO service URL: <a href="https://accounts.google.com/o/saml2/idp/SSO?idpid=your_idp_id&amp;SAMLRequest=your_request">https://accounts.google.com/o/saml2/idp/SSO?idpid=your_idp_id&amp;SAMLRequest=your_request</a></li>
<li>Username attribute: username</li>
<li>SP entity ID: https://your_zabbix_server/zabbix</li>
<li>Sign: Assertions</li>
</ul>
<p><img alt="google saml config" src="../ch02-zabbix-installation/external-auth/ch02.19-saml-zabbix-options.png" /></p>
<p><em>2.19 SAML
config</em></p>
<p><strong>Additional Configuration Options:</strong></p>
<p>The Zabbix documentation provides a comprehensive overview of additional SAML
configuration options. Consult the official Zabbix documentation for advanced settings,
such as attribute mapping customization, session timeouts, and error handling configurations.</p>
<p><strong>Verification and Testing:</strong></p>
<p>After configuring the SAML settings, it is crucial to thoroughly test the integration.
Attempt to log in to Zabbix using your Google Workspace credentials. Verify that
user attributes are correctly mapped and that group-based access control is
functioning as expected.</p>
<p><strong>Troubleshooting:</strong></p>
<p>If authentication fails, review the Zabbix server logs and the Google Workspace
audit logs for potential error messages. Ensure that the certificate paths are
correct, the attribute mappings are accurate, and the network connectivity between
Zabbix and Google Workspace is stable.</p>
<h3 id="ch02-zabbix-installation-saml-saml-media-type-mappings">SAML Media Type mappings</h3>
<p>After successfully configuring SAML authentication, the final step is to integrate
media type mappings directly within the SAML settings. This ensures that media
delivery is dynamically determined based on SAML attributes.</p>
<p><strong>Mapping Media Types within SAML Configuration:</strong></p>
<ul>
<li><strong>Navigate to SAML Settings:</strong> In the Zabbix web interface, go to "Users" -&gt;
  "Authentication" and select the "SAML settings" tab.</li>
<li><strong>Locate Media Mapping Section:</strong> Within the SAML settings, look for the section
  related to media type mapping. This section might be labeled "Media mappings"
  or similar.</li>
<li><strong>Add Media Mapping:</strong> Click "Add" to create a new media type mapping.</li>
<li><strong>Select Media Type:</strong> Choose the desired media type, such as "Gmail relay."</li>
<li><strong>Specify Attribute:</strong> In the attribute field, enter the SAML attribute that
  contains the user's email address (typically "username," aligning with the
  primary email attribute mapping).</li>
<li><strong>Configure Active Period :</strong> Specify the active period for this media type.
  This allows for time-based control of notifications.</li>
<li><strong>Configure Severity Levels:</strong> Configure the severity levels for which this
  media type should be used.</li>
</ul>
<p>Example Configuration (Conceptual):</p>
<ul>
<li>Media Type: Gmail relay</li>
<li>Attribute: username</li>
<li>Active Period: 08:00-17:00 (Monday-Friday)</li>
<li>Severity Levels: High, Disaster</li>
</ul>
<p>Rationale:</p>
<p>By mapping media types directly within the SAML configuration, Zabbix can dynamically
determine the appropriate media delivery method based on the SAML attributes received
from the IdP. This eliminates the need for manual media configuration within individual
user profiles when SAML authentication is in use.</p>
<p>Key Considerations:</p>
<ul>
<li>Ensure that the SAML attribute used for media mapping accurately corresponds to
  the user's email address.</li>
<li>Verify that the chosen media type is correctly configured within Zabbix.</li>
<li>Consult the Zabbix documentation for specific information about the SAML media
  mapping functionality, as the exact configuration options may vary depending on
  the Zabbix version.</li>
</ul>
<h3 id="ch02-zabbix-installation-saml-final-configuration-frontend-configuration-adjustments">Final Configuration: Frontend Configuration Adjustments</h3>
<p>After configuring the SAML settings within the Zabbix backend and Google Workspace,
the final step involves adjusting the Zabbix frontend configuration. This ensures
that the frontend correctly handles SAML authentication requests.</p>
<p>Modifying <code>zabbix.conf.php</code>:</p>
<ul>
<li>
<p><strong>Locate Configuration File</strong>: Access the Zabbix frontend configuration file,
  typically located at /etc/zabbix/web/zabbix.conf.php.</p>
</li>
<li>
<p><strong>Edit Configuration:</strong> Open the zabbix.conf.php file using a text editor with
  root or administrative privileges.</p>
</li>
<li>
<p><strong>Configure SAML Settings:</strong> Within the file, locate or add the following
  configuration directives:</p>
</li>
</ul>
<div class="language-php highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch02-zabbix-installation-saml-__codelineno-1-1"></a><span class="x">// Uncomment to override the default paths to SP private key, SP and IdP X.509 certificates,</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch02-zabbix-installation-saml-__codelineno-1-2"></a><span class="x">// and to set extra settings.</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch02-zabbix-installation-saml-__codelineno-1-3"></a><span class="x">$SSO[&#39;SP_KEY&#39;]                  = &#39;conf/certs/sp.key&#39;;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch02-zabbix-installation-saml-__codelineno-1-4"></a><span class="x">$SSO[&#39;SP_CERT&#39;]                 = &#39;conf/certs/sp.crt&#39;;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ch02-zabbix-installation-saml-__codelineno-1-5"></a><span class="x">$SSO[&#39;IDP_CERT&#39;]                = &#39;conf/certs/idp.crt&#39;;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ch02-zabbix-installation-saml-__codelineno-1-6"></a><span class="x">//$SSO[&#39;SETTINGS&#39;]              = [];</span>
</span></code></pre></div>
<hr />
<h2 id="ch02-zabbix-installation-saml-ms-cloud">MS Cloud</h2>
<hr />
<h2 id="ch02-zabbix-installation-saml-okta">Okta</h2>
<hr />
<h2 id="ch02-zabbix-installation-saml-conclusion">Conclusion</h2>
<h2 id="ch02-zabbix-installation-saml-questions">Questions</h2>
<h2 id="ch02-zabbix-installation-saml-useful-urls">Useful URLs</h2>
<p><a href="https://www.zabbix.com/documentation/current/en/manual/web_interface/frontend_sections/users/authentication/saml">https://www.zabbix.com/documentation/current/en/manual/web_interface/frontend_sections/users/authentication/saml</a></p></section><section class="print-page" id="ch02-zabbix-installation-mfa" heading-number="7.6.4"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="multi-factor-authentication">Multi factor authentication</h1>
<p>We all know that before you can start configuring Zabbix via WebUI you have to
sign in. Zabbix has several options to provide better security for user passwords
by configuring password policy:</p>
<ul>
<li>Requirement for Minimum password length</li>
<li>Requirements for password to contain an uppercase and a lowercase Latin letter,
  a digit, a special character</li>
<li>Requirement to avoid easy-to-guess passwords</li>
</ul>
<p>To secure sign in process even more you can configure multi factor authentication
(MFA). MFA protects Zabbix by using a second source of validation before granting
access to its WebUI after a user enters his/her password correctly. Zabbix offers
to types of MFA - Time-based one-time password (TOTP) and Duo MFA provider.</p>
<hr />
<h2 id="ch02-zabbix-installation-mfa-time-based-one-time-password">Time-based one-time password</h2>
<p>In the menu select <code>Users</code> section and then <code>Authentication</code></p>
<p><img alt="MFA Settings initial" src="../ch02-zabbix-installation/external-auth/ch02.20-mfa_settings_initial.png" width="90%" /></p>
<p><em>2.20 Initial MFA settings</em></p>
<p>Now in <code>MFA settings</code> tab select the <code>Enable multi-factor authentication</code> check-box,
then select <code>TOTP</code> in Type drop-down list.</p>
<p><img alt="MFA Settings TOTP" src="../ch02-zabbix-installation/external-auth/ch02.21-mfa_settings_TOTP_new.png" width="90%" /></p>
<p><em>2.21 New MFA method</em></p>
<p>In <code>Hash function</code> drop-down list you can choose SHA-1, SHA-256 or SHA-512, the higher
number is the better security.</p>
<p>In <code>Code lentgh</code> you can select how many digits will be generated for you by Authenticator
application on your phone.</p>
<p>Click <code>Add</code> and then <code>Update</code>. Now you have TOTP MFA configured and it is the default
method of MFA.</p>
<p><img alt="MFA Settings TOTP configured" src="../ch02-zabbix-installation/external-auth/ch02.22-mfa_settings_TOTP_configured.png" width="90%" /></p>
<p><em>2.22 New MFA method added</em></p>
<p>Now you need to tell Zabbix for which User group (or groups) to use MFA. Let's create
a User group that would require MFA.</p>
<p>In the menu select <code>Users</code> section and then <code>User groups</code>, then click <code>Create user
group</code> button</p>
<p><img alt="MFA list of user groups" src="../ch02-zabbix-installation/external-auth/ch02.23-mfa_create_user_groups.png" width="90%" /></p>
<p><em>2.23 Create user group</em></p>
<p>In <code>Group name</code> put "test". Note that <code>Multi-factor authentication</code> field is "Default",
as currently we have only one MFA method configured it does not matter whether we
select "Default" or "TOTP1" that we created above. You also can disable MFA for
all users belonging to this User group. Click <code>Add</code> button to create "test" User
group.</p>
<p><img alt="MFA new user group" src="../ch02-zabbix-installation/external-auth/ch02.24-mfa_new_user_group.png" width="90%" /></p>
<p><em>2.24 New user group configuration</em></p>
<details class="note" open="open">
<summary>Note</summary>
<p>MFA method is defined on per User group basis, i.e. MFA method configured for
a User group will be applied to all users belonging to this group.</p>
</details>
<p>Let's add a user to this user group. In the menu select <code>Users</code> section and then
<code>Users</code>, then click <code>Create user</code> button</p>
<p><img alt="MFA create user" src="../ch02-zabbix-installation/external-auth/ch02.25-mfa_create_user.png" width="90%" /></p>
<p><em>2.25 Create user</em></p>
<p>Fill in <code>Username</code>, <code>Password</code> and <code>Password (once again)</code> fields. Make sure you
select <code>test</code> user group in <code>Groups</code> field.</p>
<p><img alt="MFA new user" src="../ch02-zabbix-installation/external-auth/ch02.26-mfa_new_user.png" width="90%" /></p>
<p><em>2.26 New user configuration</em></p>
<p>Then switch to <code>Permissions</code> tab and select any role.</p>
<p><img alt="MFA new user permissions" src="../ch02-zabbix-installation/external-auth/ch02.27-mfa_new_user_permissions.png" width="90%" /></p>
<p><em>2.27 New user permissions</em></p>
<p>Click <code>Add</code> button to add the user.</p>
<p>Now we can test how TOTP MFA works. Sign out and then try to sign in as a test user
you just created. You will be presented with a QR code. That means that the user
<code>test</code> has not been enrolled in TOTP MFA yet.</p>
<p><img alt="MFA TOTP QR code" src="../ch02-zabbix-installation/external-auth/ch02.28-mfa_totp_qr_code.png" width="30%" /></p>
<p><em>2.28 TOTP QR code</em></p>
<p>On your phone you need to install either "Microsoft authenticator" or "Google authenticator"
application. The procedure of adding new QR code is quite similar, here is how it
looks in "Google authenticator". Tap <code>Add a code</code> and then <code>Scan a QR code</code>. You'll
be immediately presented with a 6 digit code (remember we selected 6 in <code>Code length</code>
when we configured TOTP MFA?)</p>
<p><img alt="MFA TOTP auth app1" src="../ch02-zabbix-installation/external-auth/ch02.29-mfa_totp_auth_app1.png" width="32%" /></p>
<p><em>2.29 Authenticator app, step 1</em></p>
<p><img alt="MFA TOTP auth app2" src="../ch02-zabbix-installation/external-auth/ch02.30-mfa_totp_auth_app2.png" width="32%" /></p>
<p><em>2.30 Authenticator app, step 2</em></p>
<p><img alt="MFA TOTP auth app3" src="../ch02-zabbix-installation/external-auth/ch02.31-mfa_totp_auth_app3.png" width="32%" /></p>
<p><em>2.31 Authenticator app, step 3</em></p>
<p>Enter this code into <code>Verification code</code> field of your login screen and click
<code>Sign in</code>, if you did everything right you are logged in into Zabbix at this point.
At this point the user "test" is considered enrolled into TOTP MFA and Zabbix stores
a special code used for further authentications in its database. The next time
user "test" tries to login into Zabbix there will be only a field to enter
verification code</p>
<p><img alt="MFA TOTP second login" src="../ch02-zabbix-installation/external-auth/ch02.32-mfa_totp_second_login.png" width="32%" /></p>
<p><em>2.32 Verification code request</em></p>
<details class="warning" open="open">
<summary>Warning</summary>
<p>For TOTP MFA to work your Zabbix server must have correct time. Sometimes
it's not the case especially if you are working with containers so pay attention
to this.</p>
</details>
<p>If a user changes (or loses) his/her phone, then Zabbix administrator should reset
his/her enrolment. To do that in the menu select <code>Users</code> then mark a check-box to
the left of "test" user and click "Reset TOTP secret" button.</p>
<p><img alt="MFA TOTP reset password" src="../ch02-zabbix-installation/external-auth/ch02.33-mfa_totp_reset_password.png" width="99%" /></p>
<p><em>2.33 Reset TOTP secret</em></p>
<p>After you reset TOTP secret the "test" user will have to undergo enrolment procedure
again.</p>
<hr />
<h2 id="ch02-zabbix-installation-mfa-duo-mfa-provider">Duo MFA provider</h2>
<p>Duo is a very famous security platform that provides a lot of security related features/products.
To read more please visit <a href="https://duo.com/">Duo</a>. Here we'll talk about Duo only
in regards to Zabbix MFA.</p>
<details class="warning" open="open">
<summary>Warning</summary>
<p>For Duo MFA to work your Zabbix WebUI must be configured to work with HTTPS
(valid certificate is not required, self-signed certificate will work).</p>
</details>
<p>First of all you need to create an account with Duo (it's free to manage up to
10 users) then login into Duo, you are an admin here. In the menu on the left select
<code>Applications</code> and click <code>Protect an Application</code> button.</p>
<p><img alt="MFA DUO applications" src="../ch02-zabbix-installation/external-auth/ch02.34-mfa_duo_applications.png" width="99%" /></p>
<p><em>2.34 DUO Applications menu</em></p>
<p>Then you will see WebSDK in applications list, click on it</p>
<p><img alt="MFA DUO applications list" src="../ch02-zabbix-installation/external-auth/ch02.35-mfa_duo_applications_list.png" width="99%" /></p>
<p><em>2.35 DUO Applications list</em></p>
<p>Here you'll see all the data needed for Zabbix.</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.36-mfa_duo_data.png" width="99%" /></p>
<p><em>2.36 DUO WebSDK application settings</em></p>
<p>Now let's go to Zabbix. First we need to configure Duo MFA method. In the menu select
<code>Users</code> and click <code>Authentication</code>. Then on <code>MFA settings</code> tab click <code>Add</code> in
<code>Methods</code> section.</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.37-mfa_duo_add_method.png" width="99%" /></p>
<p><em>2.37 Add MFA method</em></p>
<p>Fill in all the fields with data from Duo Dashboard -&gt; Applications -&gt; Web SDK page
(see screenshot above) and click <code>Add</code>, then click <code>Update</code> to update Authentication
settings.</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.38-mfa_duo_method_data.png" width="99%" /></p>
<p><em>2.38 DUO method settings</em></p>
<p>After the MFA method is configured let's switch the "Test" group to use Duo MFA.
In the menu select <code>Users</code> and click <code>User groups</code>, then click "test" group. In
the field <code>Multi-factor authentication</code> select "DUO1" and click <code>Update</code>.</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.39-mfa_duo_user_group.png" width="99%" /></p>
<p><em>2.39 DUO MFA authentication method for user group</em></p>
<p>Everything is ready. Let's test it. Sign out of Zabbix and sign back in with "test"
user. You should see a welcome screen from Duo. Click several <code>Next</code> buttons.</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.40-mfa_duo_welcome.png" width="32%" /></p>
<p><em>2.40 Enrolling into DUO, step1</em></p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.41-mfa_duo_welcome1.png" width="32%" /></p>
<p><em>2.41 Enrolling into DUO, step2</em></p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.42-mfa_duo_welcome2.png" width="32%" /></p>
<p><em>2.42 Enrolling into DUO, step3</em></p>
<p>Then you need to select the method of authentication.</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.43-mfa_duo_auth_method.png" width="50%" /></p>
<p><em>2.43 Enrolling into DUO, step4</em></p>
<p>It is up to you what to select you can experiment with all these methods. Let's
select "Duo Mobile" (you need to install "Duo mobile" application on your device).
Click <code>I have a tablet</code> (it's just easier to activate your device this way) and
confirm that you installed "Duo mobile" on your phone. At this point you should
see a QR code that you need to scan in "Duo mobile" application.</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.44-mfa_duo_duo_app.png" width="32%" /></p>
<p><em>2.44 Enrolling into DUO, step5</em></p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.45-mfa_duo_confirm_app_installed.png" width="32%" /></p>
<p><em>2.45 Enrolling into DUO, step6</em></p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.46-mfa_duo_scan_qr.png" width="32%" /></p>
<p><em>2.46 Enrolling into DUO, step7</em></p>
<p>Open "Duo mobile" on your phone. If you did not have this application previously
installed (thus no accounts enrolled) you will see couple of welcome screens.</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.47-mfa_duo_phone_welcome.png" width="48%" /></p>
<p><em>2.47 Configure DUO app, step 1</em></p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.48-mfa_duo_phone_add_account.png" width="48%" /></p>
<p><em>2.48 Configure DUO app, step 2</em></p>
<p>Tap on "Use a QR code" and then scan the code presented by Duo in your Zabbix login
screen. After you do that you will see that the account is enrolled to your Duo
MFA. Enter account name and tap "Done" and you will see the account in the list
of all accounts enrolled into Duo MFA on this device. In Zabbix WebUI you will
also see a confirmation, click "Continue".</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.49-mfa_duo_phone_account_added.png" width="32%" /></p>
<p><em>2.49 Configure DUO app, step 3</em></p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.50-mfa_duo_phone_accounts.png" width="32%" /></p>
<p><em>2.50 Configure DUO app, step 4</em></p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.51-mfa_duo_enrollement_confirmation.png" width="32%" /></p>
<p><em>2.51 Enrolment confirmation</em></p>
<p>Duo will ask you now whether you want to add another method of authentication,
click <code>Skip for now</code> and you'll see a confirmation that set up completed. Click
<code>Login with Duo</code> and a notification will be pushed to your device.</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.52-mfa_duo_another_method.png" width="32%" /></p>
<p><em>2.52 Add another way to login</em></p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.53-mfa_duo_setup_completed.png" width="32%" /></p>
<p><em>2.53 MFA DUO set up completed</em></p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.54-mfa_duo_push_sent.png" width="32%" /></p>
<p><em>2.54 DUO push notification sent</em></p>
<p>Now just tap on "Approve" on your device and you will be logged in into Zabbix.</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.55-mfa_duo_phone_push_notification.png" width="50%" /></p>
<p><em>2.55 DUO push notification on the phone</em></p>
<p>Duo MFA enrolment complete. If you sign out and sign in back then immediately a
push notification will be sent to your device and all you need is tap on
"Approve". Also you will see the user "test" in Duo where you can delete the user,
or deactivate just click on it and experiment.</p>
<p><img alt="MFA DUO " src="../ch02-zabbix-installation/external-auth/ch02.56-mfa_duo_users.png" width="98%" /></p>
<p><em>2.56 New user registered in DUO</em></p>
<h2 id="ch02-zabbix-installation-mfa-conclusion">Conclusion</h2>
<p>Implementing Multi-Factor Authentication (MFA) in Zabbix is a powerful way to
significantly advance your system‚Äôs security beyond the standard password policies.
This chapter outlined how Zabbix supports two robust MFA mechanisms:</p>
<ul>
<li>
<p>Time Based One-Time Password (TOTP): Offers user-friendly, secure login via an
  authenticator app (like Google or Microsoft Authenticator). It's easy to
  configure and effective just ensure that your Zabbix server maintains accurate
  time settings to avoid authentication issues.</p>
</li>
<li>
<p>Duo MFA: Integrates a more advanced, enterprise grade solution that provides
  features like push notifications and customizable authentication methods. Duo
  offers flexible and strong security, albeit requiring a bit more setup (including
  HTTPS on the Zabbix WebUI).</p>
</li>
</ul>
<p>Both MFA options elevate the login process by introducing an additional layer of
validation. Administrators can apply MFA selectively by assigning it to specific
user groups thus tailoring the security posture to organizational needs.</p>
<p>Ultimately, enabling MFA not only enhances protection against unauthorized access
but also fits within a broader strategy of robust authentication. Whether through
TOTP or Duo, adding MFA demonstrates a commitment to safeguarding access to your
Zabbix environment and fortifying your monitoring infrastructure.n</p>
<h2 id="ch02-zabbix-installation-mfa-questions">Questions</h2>
<ul>
<li>
<p>Why is relying on a password alone not sufficient to secure access to a Zabbix
  instance? (Think about common attack methods like password reuse, brute force,
  or phishing.)</p>
</li>
<li>
<p>What are the key differences between TOTP-based MFA and Duo MFA in terms of setup,
  security, and user experience?</p>
</li>
<li>
<p>How does accurate system time affect the reliability of TOTP authentication,
  and what could go wrong if time synchronization is not maintained?</p>
</li>
<li>
<p>If you were tasked with enabling MFA for a production Zabbix system, which method
  (TOTP or Duo) would you choose, and why? (Consider factors such as environment
  size, user skill level, regulatory requirements, and available resources.)</p>
</li>
<li>
<p>What are some potential challenges when rolling out MFA in an organization,
  and how could an administrator mitigate user resistance or technical issues?</p>
</li>
<li>
<p>Why might it be useful to enable MFA only for certain user groups in Zabbix
  rather than enforcing it globally?</p>
</li>
<li>
<p>How does adding MFA to Zabbix align with a broader security strategy, and what
  other complementary security measures should be considered?</p>
</li>
</ul>
<h2 id="ch02-zabbix-installation-mfa-useful-urls">Useful URLs</h2>
<p><a href="https://www.zabbix.com/documentation/current/en/manual/web_interface/frontend_sections/users/authentication/mfa">https://www.zabbix.com/documentation/current/en/manual/web_interface/frontend_sections/users/authentication/mfa</a>
<a href="https://duo.com/docs/sso-zabbix">https://duo.com/docs/sso-zabbix</a></p></section></section></section>
                    <section class='print-page md-section' id='section-8' heading-number='8'>
                        <h1>Chapter 03 : Proxies and Webcomponents<a class='headerlink' href='#section-8' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch03-zabbix-proxies-chapter" heading-number="8.1"><h1 id="ch03-zabbix-proxies-chapter-proxies-and-the-web-services-component">Proxies and the Web services component</h1>
<p>Proxies are often regarded as an advanced topic in Zabbix, but in reality,
they are a fundamental part of many installations and one of the first components
we set up for numerous customers. In this chapter, we'll make proxies the third
subject we cover, encouraging you to consider them from the very beginning of your
Zabbix journey.</p>
<p>We'll start with a basic proxy setup, providing straightforward steps to get you
up and running quickly. Then, we'll take a deep dive into the mechanics of proxies
how they operate within the Zabbix ecosystem, their benefits, and the critical
role they play in distributing monitoring load and enhancing system scalability.</p>
<p>Understanding proxies from the start can significantly improve your architecture,
especially in distributed or large scale environments. Whether you're new to Zabbix
or looking to refine your existing setup, this chapter will offer valuable insights
into why proxies should be an integral part of your monitoring strategy from the start.</p>
<p>By the end, you'll not only know how to set up a basic proxy but also have a clear
understanding of their underlying workings and strategic advantages,
ensuring you make informed decisions as you scale your Zabbix installation.</p>
<p>Secondly, we'll explore the Web services component, which is essential for generating
scheduled reports in Zabbix. We'll discuss what it is, why you might need it,
the requirements for running it, and how to install and configure it effectively.</p>
<p>This chapter aims to provide a comprehensive understanding of both proxies
and the Web services component, equipping you with the knowledge to enhance
your Zabbix monitoring setup effectively.</p></section><section class="print-page" id="ch03-zabbix-proxies-proxy-basics" heading-number="8.2"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="proxy-basics">Proxy basics</h1>
<p>In this chapter we will explain what a proxy is, why you may need or consider it,
what the basic requirements are and what the difference is between <em>Active proxies</em>
and <em>Passive proxies</em>.</p>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-basics-what-is-a-zabbix-proxy">What is a Zabbix Proxy</h2>
<p>A Zabbix proxy is actually a kind of lightweight Zabbix server process that
collects monitoring data from devices on behalf of the real Zabbix server. It's
designed to offload the server by handling data collection tasks, which is 
particularly useful in distributed environments or when monitoring remote
locations with limited connectivity. </p>
<p>The proxy gathers the requested performance and availability data from monitored
devices, applications, and services, then forwards this information to the 
Zabbix server for processing and storage. This architecture helps reduce network
traffic, simplifies network firewall configurations and improves the overall
efficiency of your monitoring system.</p>
<p>So in short a Zabbix proxy can be used to:</p>
<ul>
<li>Monitor remote locations</li>
<li>Monitor devices on separate network segments</li>
<li>Monitor locations that have unreliable connections</li>
<li>Offload the Zabbix server when monitoring thousands of devices</li>
<li>Simplify the maintenance and management</li>
</ul>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-basics-proxy-requirements">Proxy requirements</h2>
<p>If you'd like to set up a few proxies for testing or in your production environment,
you'll need some Linux hosts for installation. While proxies are also available as 
containers (so you don't necessarily need full VMs), we'll use a VM in this demonstration
to show the installation process. Don't worry, we'll cover container deployments as well.</p>
<p>Although proxies are generally lightweight, since Zabbix 4.2 they can perform 
item value preprocessing which can be CPU-intensive.
Therefore, the number of CPUs and memory you'll need depends on:</p>
<ul>
<li>How many machines you'll be monitoring</li>
<li>How many preprocessing rules you'll implement on your hosts</li>
</ul>
<hr />
<h3 id="ch03-zabbix-proxies-proxy-basics-proxy-configuration-updates">Proxy configuration updates</h3>
<p>For a proxy to know what devices it has to monitor, it will receive configuration
updates from the <em>Zabbix server</em>. They include:</p>
<ul>
<li>New or modified monitoring items, triggers, or templates assigned to the proxy.</li>
<li>Changes to host configurations or data collection rules. </li>
</ul>
<p>Before Zabbix 7.0, a full configuration synchronization was performed by proxies
every 3600 seconds (1 hour) by default. With the introduction of Zabbix 7.0, this
behavior changed significantly. Now, configuration synchronization occurs much more
frequently, every 10 seconds by default, but it's an incremental update. This means
that instead of transferring the entire configuration, only the modified entities
are synchronized, greatly improving efficiency and reducing network overhead.</p>
<p>Upon initial proxy startup, a full configuration synchronization is still performed.
Subsequently, both the server and the proxy maintain a revision of the configuration.
When a change is made on the server, only the differences, based on these revision
numbers, are applied to the proxy's configuration, rather than a complete replacement
of the entire configuration as in older versions. This incremental approach allows
for near real-time propagation of configuration changes while minimizing resource
consumption.</p>
<details class="note configuration settings vs configuration updates" open="open">
<summary>Note</summary>
<p>When working with a Zabbix proxy, it‚Äôs important to distinguish between two 
types of "configuration":</p>
<ul>
<li><strong>Proxy Configuration Settings</strong></li>
</ul>
<dl>
<dd>These are the local settings defined in the proxy‚Äôs configuration file. 
They control how the proxy operates.</dd>
</dl>
<ul>
<li><strong>Configuration Updates from the Zabbix Server</strong></li>
</ul>
<dl>
<dd>
<p>These are dynamic updates pushed by the Zabbix server to the proxy.
They include:</p>
<ul>
<li>New or modified monitoring items, triggers, or templates assigned to the proxy.</li>
<li>Changes to host configurations or data collection rules. </li>
</ul>
</dd>
</dl>
</details>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-basics-proxy-throttling">Proxy throttling</h2>
<p>Imagine that you need to restart your Zabbix server and that all proxies start
to push the data they have gathered during the downtime of the Zabbix server.</p>
<p>This would create a huge amount of data being sent at once to the Zabbix server
and possibly bring it to its knees in no time. Since version 6, Zabbix has added 
protection for this kind of situations. When the Zabbix server history cache is 
full the history cache write access is being throttled:
Zabbix server will stop accepting data from proxies when history cache usage 
reaches 80%. Instead those proxies will be put on a throttling list. 
This will continue until the cache usage falls down to 60%.
Now the server will start accepting data from the proxies one by one, defined by the
throttling list. This means the first proxy that attempted to upload data during
the throttling period will be served first and until it's done the server will
not accept data from other proxies.</p>
<p>This table gives you an overview of how and when throttling works in Zabbix.</p>
<table>
<thead>
<tr>
<th>History write cache usage</th>
<th>Zabbix server mode</th>
<th>Zabbix server action</th>
</tr>
</thead>
<tbody>
<tr>
<td>Reaches 80%</td>
<td>Wait</td>
<td>Stops accepting proxy data, but maintains a throttling list (prioritized list of proxies to be contacted later).</td>
</tr>
<tr>
<td>Drops to 60%</td>
<td>Throttled</td>
<td>Starts processing throttling list, but still not accepting proxy data.</td>
</tr>
<tr>
<td>Drops to 20%</td>
<td>Normal</td>
<td>Drops the throttling list and starts accepting proxy data normally.</td>
</tr>
</tbody>
</table>
<p>This may cause delays in detection of problems, as you will have to wait for all
relevant data to be received and processed by the Zabbix server; but you won't lose
any historical data.</p>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-basics-active-versus-passive-proxy">Active versus Passive proxy</h2>
<p>Zabbix proxies have been available since Zabbix 1.6. At that time they where 
available only as what we know today as <strong>Active proxies</strong>. <em>Active</em> means that 
the proxy will initiate the connection by itself to the Zabbix Server. In 
version 1.8.3 <em>passive</em> proxies where introduced. This allowes the server to 
connect to the proxy instead of the other way around.</p>
<p>As mentioned before Zabbix agents can be both active <em>and</em> passive however proxies
cannot be both so we have to choose the way of the communication when we configure
a proxy. </p>
<details class="note" open="open">
<summary>Active/Passive agent on Active/Passive proxy ?</summary>
<p>Remember that choosing the proxy mode <em>active</em> or <em>passive</em> has no impact on 
how Zabbix agents can communicate with this proxy. It's perfectly fine to have
an <em>active proxy</em> and a <em>passive agent</em> working together.</p>
</details>
<hr />
<h3 id="ch03-zabbix-proxies-proxy-basics-active-proxy">Active proxy</h3>
<p>In <em>active</em> mode, the proxy takes full control of its operational settings. This 
includes managing when it checks for new configuration updates and when it sends 
collected data to the server. </p>
<p>It‚Äôs important to note that the key settings for an <em>active proxy</em> are defined 
exclusively in the <em>Zabbix proxy</em> configuration. Any adjustments to these 
parameters should be made directly within the proxy configuration files.</p>
<p>These are the proxy configuration settings you will need to set in <em>active</em> mode:</p>
<ul>
<li><code>ProxyMode</code>: <code>0</code> - Sets the proxy in 'Active' mode</li>
<li><code>Server</code>: IP or DNS of the Zabbix server</li>
<li><code>Hostname</code>: Proxy name - this needs to be exactly the same as configured in the
  frontend.</li>
<li><code>ProxyOfflineBuffer</code>: How long we like to keep data in the DB (in hours) if
  we can't reach the <em>Zabbix server</em>.</li>
<li><code>ProxyLocalBuffer</code>: How long we like to keep data in the DB (in hours) even when
  it is already sent to the <em>Zabbix server</em>.</li>
<li><code>ProxyConfigFrequency</code>: Replaces <code>ConfigFrequency</code> in earlier versions and defines
  how often we request configuration updates (every 10 seconds) from the <em>Zabbix server</em>.</li>
<li><code>DataSenderFrequency</code>: How often data is sent to <em>Zabbix server</em> (every second).</li>
</ul>
<p>When configuring resources for an <em>Active proxy</em>, it‚Äôs important to account for 
its connection behavior with the <em>Zabbix server</em>. During operation, the proxy can 
utilize up to two trapper processes on the server:</p>
<ul>
<li>One trapper is dedicated to sending collected data to the server.</li>
<li>The other trapper is reserved for retrieving configuration updates.</li>
</ul>
<details class="tip" open="open">
<summary>Tip</summary>
<p>To ensure smooth communication, it is considered best practice to allocate two 
trapper processes per <em>Active proxy</em> on the <em>Zabbix server</em>. This configuration 
optimizes performance and prevents potential bottlenecks.</p>
</details>
<p><img alt="Active proxy communication" src="../ch03-zabbix-proxies/active-passive-proxies/ch03-active-communication.png" /></p>
<p><em>3.1 Active proxy
communication</em></p>
<hr />
<h3 id="ch03-zabbix-proxies-proxy-basics-passive-proxy">Passive proxy</h3>
<p>In contrast to an <em>active proxy</em>, a proxy in <em>passive</em> mode will have its operational
settings controlled by the <em>Zabbix server</em>.</p>
<p>Hence, configuring <em>passive</em> proxies requires changes in in both the <em>Zabbix server</em> 
and the <em>Zabbix proxy</em> configuration files as it is now the server
that controls when and how proxy data is requested by making use of pollers.</p>
<p>The most important setting we can find back in the <em>proxy</em> configuration file are:</p>
<ul>
<li><code>ProxyMode</code>: <code>1</code> - Sets the proxy in 'Passive' mode</li>
<li><code>Server:</code> IP or DNS of the <em>Zabbix server</em></li>
<li><code>ProxyOfflineBuffer</code>: How long we like to keep data in the DB (in hours) if
  we can't reach the <em>Zabbix server</em>.</li>
<li><code>ProxyLocalBuffer</code>: How long we like to keep data in the DB (in hours) even when
  it is already sent to the <em>Zabbix server</em>.</li>
</ul>
<p>And finally the config settings we need to change on our <em>Zabbix server</em>:</p>
<ul>
<li><code>StartProxyPollers</code>: The number of pollers to contact proxies.</li>
<li><code>ProxyConfigFrequency</code>: Replaces <code>ConfigFrequency</code> and defines how often
  <em>Zabbix server</em> will sent configuration changes to all proxies.</li>
<li><code>ProxyDataFrequency</code>: How often <em>Zabbix server</em> will request monitored data 
  from our proxies.</li>
</ul>
<details class="tip" open="open">
<summary>Tip</summary>
<p>It is not required for <code>StartProxyPollers</code> to be equal to the number of 
passive proxies you have as one poller can poll multiple proxies. The 
recommended value however depends on your environment and workload. If you
have multiple passive proxies and experience delays in configuration updates
or incoming item values, you may increase this value. However, it is a good 
practice to start with 1, monitor the performance and adjust in accordance.</p>
<p>Zabbix provides out-of-the-box templates for monitoring <em>Zabbix server</em> and 
<em>Zabbix proxies</em> internal metrics. Make sure to use them and closely watch
the value of the <code>zabbix[proxy_history]</code> item on the proxies which represents
the number of values the proxy has received that are yet to be sent to the 
<em>Zabbix server</em>. </p>
</details>
<p><img alt="Passive proxy communication" src="../ch03-zabbix-proxies/active-passive-proxies/ch03-passive-communication.png" /></p>
<p><em>3.2 Passive proxy
communication</em></p>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-basics-proxy-runtime-control-options">Proxy runtime control options</h2>
<p>Just like the <em>Zabbix server</em> our proxy supports runtime control options always
check latest options with the <code>--help</code> option. But here is a short overview of
options available to use.</p>
<dl>
<dt><code>zabbix_proxy --runtime-control housekeeper_execute</code></dt>
<dd>
<p>Triggers the immediate execution of the Zabbix housekeeper process on the 
proxy. The housekeeper is responsible for cleaning up outdated data (e.g., 
old history, trends, or events) according to the configured retention periods 
in Zabbix. This command forces the housekeeper to run now, instead of waiting 
for its scheduled interval.</p>
</dd>
<dt><code>zabbix_proxy --runtime-control log_level_increase=target</code></dt>
<dd>
<p>Increases the log verbosity level for a specific target process (e.g., by type 
like <code>configuration syncer</code>, <code>housekeeper</code>, <code>icmp pinger</code>, by type and number
like <code>poller,3</code> or by PID). This is useful for debugging or troubleshooting, 
as it provides more detailed log output for the specified target. For a full 
list of available targets, check the <a href="https://www.zabbix.com/documentation/current/en/manpages/zabbix_proxy">man-page of <code>zabbix_proxy</code></a>.
<em>Example</em>: <code>log_level_increase="http poller"</code> would make http poller-related
logs more verbose.</p>
</dd>
<dt><code>zabbix_proxy --runtime-control log_level_decrease=target</code></dt>
<dd>
<p>Decreases the log verbosity level for a specific target, reducing the amount 
of log output generated. This is helpful to lower noise in logs after debugging
or to optimize performance by reducing I/O overhead.
<em>Example</em>: <code>log_level_decrease=trapper,2</code> would reduce the verbosity of 
trapper-related logs of the second trapper process.</p>
</dd>
<dt><code>zabbix_proxy --runtime-control snmp_cache_reload</code></dt>
<dd>
<p>Forces the proxy to reload its SNMP cache. This is useful if you‚Äôve made 
changes to SNMP configurations (e.g., updated community strings, OIDs, or 
device IPs) and want the proxy to immediately pick up the new settings 
without restarting the entire service.</p>
</dd>
<dt><code>zabbix_proxy --runtime-control diaginfo=section</code></dt>
<dd>
<p>Generates diagnostic information for a specific section of the proxy‚Äôs 
operation. This is typically used for troubleshooting or performance analysis. 
The section parameter can target areas like historycache, preprocessing or locks.
<em>Example</em>: <code>diaginfo=preprocessing</code> would provide detailed statistics about 
the preprocessing manager.</p>
</dd>
</dl>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-basics-proxy-firewall">Proxy firewall</h2>
<p>Our proxies work like small <em>Zabbix servers</em> so when it comes to the ports to connect
to agents, SNMP, ... nothing changes, all ports need to be configured the same as you
would on a <em>Zabbix server</em>.</p>
<p>When it comes to port for the proxy it depends on our proxy being <code>active</code> or <code>passive</code>.</p>
<ul>
<li><strong>Active Proxy:</strong> Zabbix server needs to have port <code>10051/tcp</code> open so proxy can
  connect.</li>
<li><strong>Passive Proxy:</strong> Needs to have port <code>10051/tcp</code> open on the proxy so that the
  <code>server</code> can connect to the proxy.</li>
</ul>
<p>Do note that for an active <em>Zabbix Agent</em> or <em>Zabbix Sender</em> to communicate with your proxy, 
wether it is an active or a passive one, this will require port <code>10051/tcp</code> to be
open on your proxy server:</p>
<div class="admonition info">
<p class="admonition-title">Open firewall for zabbix-trapper</p>
<p>Red Hat / SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch03-zabbix-proxies-proxy-basics-__codelineno-0-1"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--add-service<span class="o">=</span>zabbix-trapper<span class="w"> </span>--permanent
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch03-zabbix-proxies-proxy-basics-__codelineno-0-2"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch03-zabbix-proxies-proxy-basics-__codelineno-1-1"></a>sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">10051</span>/tcp
</span></code></pre></div></p>
</div></section><section class="print-page" id="ch03-zabbix-proxies-active-passive-proxies" heading-number="8.3"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="active-and-passive-proxies">Active and Passive proxies</h1>
<p>Whether you want to install an Active proxy or a Passive one, much of the installation
and configuration steps are the same.</p>
<hr />
<h2 id="ch03-zabbix-proxies-active-passive-proxies-zabbix-gui-configuration">Zabbix GUI configuration</h2>
<p>There are 2 things we need to do when we like to setup a Zabbix proxy and one of
those steps is adding the proxy in the frontend of Zabbix. So from the menu let's select
<code>Administration</code> =&gt; <code>Proxies</code> and click in the upper right corner on <code>Create proxy</code>.</p>
<p><img alt="Create proxy" src="../ch03-zabbix-proxies/active-passive-proxies/ch03-add-active-proxy.png" /></p>
<p><em>3.3 Create proxy</em></p>
<p>Once pressed, a new modal form will pop-up where we need to fill in some information.</p>
<hr />
<h3 id="ch03-zabbix-proxies-active-passive-proxies-active-proxy">Active proxy</h3>
<p>For active proxies we only need to enter the <em>Proxy name</em> field. Here we will enter
<code>ProxyA</code> to remind us this will be an active proxy.
Don't worry about the other fields we will cover them later. In the <em>Description</em>
field you could enter some text to make it even more clear that this is an active proxy.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>For Zabbix active proxies, you only need to specify the hostname during configuration.
This hostname acts as the unique identifier that the Zabbix server uses to distinguish
between different active proxies and manage their data correctly.</p>
</details>
<p><img alt="Active proxy" src="../ch03-zabbix-proxies/active-passive-proxies/ch03-new-active-proxy.png" /></p>
<p><em>3.4 New proxy</em></p>
<hr />
<h3 id="ch03-zabbix-proxies-active-passive-proxies-passive-proxy">Passive proxy</h3>
<p>For the passive proxy we will enter <code>ProxyP</code> as <em>Proxy name</em> but now we also need
to specify the <em>Interface</em> field. Here we add the IP of the host where our proxy
runs on. You also notice that we use the same port
<code>10051</code> as the <em>Zabbix server</em> to communicate with our proxy.</p>
<p><img alt="Passive proxy" src="../ch03-zabbix-proxies/active-passive-proxies/ch03-new-passive-proxy.png" /></p>
<p><em>3.5 New passive proxy</em></p>
<hr />
<h2 id="ch03-zabbix-proxies-active-passive-proxies-installing-the-proxy">Installing the proxy</h2>
<p>Next up, we need to get the Zabbix proxy software onto a system that will function
as Zabbix Proxy. Set up a new system or VM and make sure it meets the requirements as 
outlined in the <a href="#ch00-getting-started-requirements"><em>Getting Started: Requirements</em></a> 
chapter. </p>
<p>As the Zabbix proxy is actually a small <em>Zabbix server</em>, we also need to make sure
the system is prepared for Zabbix as outlined in <a href="#ch00-getting-started-preparation"><em>Preparing the server for Zabbix</em></a>.</p>
<p>Now that your system is ready and knows where to find the Zabbix software packages, we can 
actually install the Zabbix Proxy software. It's pretty simple, but there's one 
thing we need to decide upfront. Zabbix proxies need a place to store their 
information, and they can use one of three options: MySQL/MariaDB, PostgreSQL, or SQLite3.</p>
<p>We will only cover SQlite as MySQL and PostgreSQL are basically already covered
in the <a href="#ch01-zabbix-components-database"><em>Zabbix components and installation: Database</em></a> chapter.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>The only thing that is a bit different when you setup a MySQL or
PostgreSQL database for use with a Zabbix Proxy instead of a Zabbix Server 
are the scripts you will need to setup the DB structure. </p>
<ul>
<li>For MySQL/MariaDB they are located in <code>/usr/share/zabbix/sql-scripts/mysql/proxy.sql</code>.</li>
<li>For PostgreSQL they can be found in <code>/usr/share/zabbix/sql-scripts/postgresql/proxy.sql</code>.</li>
</ul>
</details>
<div class="admonition info">
<p class="admonition-title">Install zabbix-proxy-sqlite3</p>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-0-1"></a>dnf install zabbix-proxy-sqlite3
</span></code></pre></div></p>
<p>SUSE
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-1-1"></a>zypper install zabbix-proxy-sqlite3
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-2-1"></a>sudo apt install zabbix-proxy-sqlite3
</span></code></pre></div></p>
</div>
<details class="tip" open="open">
<summary>Tip</summary>
<p>If you want to use MySQL or PostgreSQL then you can use the package <code>zabbix-proxy-mysql</code>
or <code>zabbix-proxy-pgsql</code> depending on your needs.</p>
</details>
<hr />
<h2 id="ch03-zabbix-proxies-active-passive-proxies-configuring-the-proxy">Configuring the proxy</h2>
<p>Now that we have installed the required packages we still have to do a few configuration
changes. </p>
<p>Just like with the Zabbix server (or agent for that matter), the configuration
file offers an option to include additional configuration files for custom parameters.
In general, and especially in a production environment, it's often best to avoid
altering the original configuration file directly. Instead you can create and include
separate configuration files for any additional or modified parameters.</p>
<p>On SUSE 16 and later, this feature is already enabled and configured by default
in <code>/usr/etc/zabbix/zabbix_proxy.conf</code>.</p>
<p>On other distributions, you may need to enable it manually in 
<code>/etc/zabbix/zabbix_proxy.conf</code>.</p>
<p>To enable this feature, ensure the next line exists and is not commented (with a
<code>#</code> in front of it):</p>
<div class="admonition info">
<div class="language-ini highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-3-1"></a><span class="na">Include</span><span class="o">=</span><span class="s">/etc/zabbix/zabbix_proxy.d/*.conf</span>
</span></code></pre></div>
</div>
<p>The path <code>/etc/zabbix/zabbix_proxy.d/</code> should already be created by the installed
package, but ensure it really exists.</p>
<p>Now we wil create a custom configuration file <code>general.conf</code> in this <code>/etc/zabbix/zabbix_proxy.d/</code>
directory that will hold some general proxy settings:</p>
<ul>
<li>
<p>The first option we will have to set is <code>ProxyMode</code>:</p>
<ul>
<li>Set this to <code>0</code> for an <em>Active</em> proxy.</li>
<li>Set this to <code>1</code> for a <em>Passive</em> proxy.</li>
</ul>
</li>
<li>
<p>The other option that is important is the option <code>Server</code> which defaults to <code>127.0.0.1</code>,
  so we need to replace this with the IP or DNS name of our <em>Zabbix Server</em>.</p>
</li>
</ul>
<details class="note" open="open">
<summary>Note</summary>
<p>You can fill in multiple servers here in case you have more than one <em>Zabbix Server</em>
connecting to your proxy. Also the port can be added here in case your server
listens on another port then the standard port <code>10051</code>. Just be careful to not
add the IP and DNS name for the same server as this can return double values.</p>
</details>
<ul>
<li>
<p>Another important option is <code>Hostname</code>, especially on an <em>Active</em> proxy.
  Remember in our frontend we gave our <em>Active</em> proxy the name <code>ProxyA</code>, so now 
  we have to fill in the exact same name here for hostname.
  Just like a <em>Zabbix agent</em> in <em>active</em> mode <em>Zabbix server</em> will use the name as a
  unique identifier.\
  For a <em>passive</em> proxy this option matters less, but for clarity it is best to 
  keep it the same: <code>ProxyP</code> in our case. </p>
</li>
<li>
<p>On an <em>Active proxy</em> you may also consider setting <code>ProxyConfigFrequency</code> and 
  <code>DataSenderFrequency</code> to fine-tune communication with the <em>Zabbix server</em>, but
  generally speaking, the defaults should suffice.</p>
</li>
<li>
<p>Other options to consider are <code>ProxyOfflineBuffer</code> and <code>ProxyLocalBuffer</code> to
  make sure the proxy can keep up with Zabbix server outages and the amount of
  monitored data it ingests.</p>
</li>
</ul>
<p>The <code>general.conf</code> file should now look at least something like this:</p>
<details class="example" open="open">
<summary>/etc/zabbix/zabbix_proxy.d/general.conf</summary>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-4-1"></a><span class="na">ProxyMode</span><span class="o">=</span><span class="s">0</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-4-2"></a><span class="na">Server</span><span class="o">=</span><span class="s">192.168.0.50</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-4-3"></a><span class="na">Hostname</span><span class="o">=</span><span class="s">ProxyA</span>
</span></code></pre></div>
</details>
<p>To configure the database settings, create a dedicated configuration file at 
<code>/etc/zabbix/zabbix_proxy.d/database.conf</code>. This file will contain the database
connection parameters. </p>
<p>For SQLite3 implementations, only the <code>DBName</code> parameter requires configuration, specifying the path to the database file. The Zabbix Proxy will automatically create and utilize this database file upon its initial startup.</p>
<details class="example" open="open">
<summary>/etc/zabbix/zabbix_proxy.d/database.conf</summary>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-5-1"></a><span class="na">DBName</span><span class="o">=</span><span class="s">/var/lib/zabbix/zabbix_proxy.db</span>
</span></code></pre></div>
</details>
<p>You can choose any location for the database file, however you must make sure
the directory exists and is writable by the Zabbix proxy process.</p>
<p>In our example, we chose the default <em>home</em>-dir of the <code>zabbix</code>-user as configured
by the Zabbix packages. You can check the home dir of the user on your host using
the <code>getent passwd</code> command:</p>
<details class="example" open="open">
<summary>Check default homedir of user zabbix</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-6-1"></a><span class="go">localhost:~&gt;getent passwd zabbix</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-6-2"></a><span class="go">zabbix:x:476:476:Zabbix Monitoring System:/var/lib/zabbix:/sbin/nologin</span>
</span></code></pre></div>
</details>
<p>Check if the directory exists with correct permissions and SELinux context:</p>
<details class="example" open="open">
<summary>Check existence of zabbix home-directory</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-7-1"></a><span class="go">localhost:~&gt;ls -laZ /var/lib/zabbix</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-7-2"></a><span class="go">total 0</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-7-3"></a><span class="go">drwxr-xr-x. 1 zabbix zabbix unconfined_u:object_r:zabbix_var_lib_t:s0   0 Jan 10 20:01 .</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-7-4"></a><span class="go">drwxr-xr-x. 1 root   root   system_u:object_r:var_lib_t:s0            364 Jan 10 20:05 ..</span>
</span></code></pre></div>
</details>
<p>If the directory does not exist, is not owned by user <code>zabbix</code> or is missing the
SELinux label <code>zabbix_var_lib_t</code>, then you will need to correct this:</p>
<div class="admonition info">
<p class="admonition-title">Create zabbix home-dir</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-8-1"></a><span class="c1"># Create the directory</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-8-2"></a>mkdir<span class="w"> </span>/var/lib/zabbix
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-8-3"></a><span class="c1"># Make user/group zabbix owner </span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-8-4"></a>chown<span class="w"> </span>zabbix:zabbix<span class="w"> </span>/var/lib/zabbix
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-8-5"></a><span class="c1"># Restore SELinux context labels</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-8-6"></a>restorecon<span class="w"> </span>-Rv<span class="w"> </span>/var/lib/zabbix
</span></code></pre></div>
</div>
<details class="tip" open="open">
<summary>Tip</summary>
<p>See <a href="#ch13-advanced-security-selinux-zabbix"><em>Advanced security: SELinux</em></a>
chapter for more details about SELinux and Zabbix.</p>
</details>
<details class="note" open="open">
<summary>MariaDB/MySQL or PostgreSQL as database for Zabbix proxy</summary>
<p>If you chose to use MariaDB/MySQL or PostgreSQL, please refer to <a href="#ch01-zabbix-components-zabbix-server"><em>Installing the Zabbix server</em></a> for the required database
settings you will need to set in the <code>/etc/zabbix/zabbix_proxy.d/database.conf</code>-file.</p>
</details>
<details class="tip" open="open">
<summary>Tip</summary>
<p>A list of all configuration options can be found in the Zabbix documentation.
<a href="https://www.zabbix.com/documentation/current/en/manual/appendix/config/zabbix_proxy">https://www.zabbix.com/documentation/current/en/manual/appendix/config/zabbix_proxy</a></p>
</details>
<p>A notable configuration parameter that was added in <code>7.0</code> is <code>ProxyBufferMode</code> which
determines how collected monitoring data is stored by the proxy before it is forwarded to
the Zabbix server. </p>
<p>Possible buffer modes:</p>
<dl>
<dt><code>disk</code> - Disk buffer (default for existing installations prior to Zabbix 7.0)</dt>
<dd>
<p>All data is written to the Zabbix Proxy database immediately before it is 
sent to the Zabbix server. In case of a proxy or system crash, all data is
retained and will be sent to the Zabbix server as soon as the proxy is
started again.</p>
<p>This is slower due to database I/O but is highly reliable.</p>
</dd>
<dt><code>memory</code> - Memory buffer</dt>
<dd>
<p>Data is stored in RAM and is not written to disk. This makes sure the data
is sent to the Zabbix server as quickly as possible as there is no I/O wait time
for the database involved. Downside is that when the proxy or the system 
crashes when the proxy still has data in the buffer, not yet received by the
server, that data will be lost. Also when the RAM buffer overflows (<code>ProxyMemoryBufferSize</code>), possibly due to a sudden burst of incoming items
or the Zabbix server being unavailable for some time, older data will be 
removed from the buffer before it is sent to the Zabbix server.</p>
</dd>
<dt><code>hybrid</code> - Hybrid buffer (default for new installations since Zabbix 7.0)</dt>
<dd>
<p>Data is primarily stored in RAM but is automatically written to the database
when the memory buffer is full, the data is too old or when the proxy is 
stopped. This makes sure that data is preserved in case the Zabbix server is
unreachable for a longer period or when there are bursts of many incoming
items and hereby balances speed and reliability.</p>
</dd>
</dl>
<details class="warning" open="open">
<summary>Warning</summary>
<p>In Proxies that where installed before <code>7.0</code> the data was first written to
disk in the database and then sent to the <code>Zabbix server</code>. For these installations
when we upgrade this remains the default behavior after upgrading to Zabbix
7.x or higher. It's now recommended for performance reasons to use the new
setting <code>hybrid</code> and to define the <code>ProxyMemoryBufferSize</code>.</p>
</details>
<p>Once you have made all the changes you need in the config file besides the ones
we have covered, we only need to enable the service and start our proxy.
Of course don't forget to open the firewall port <code>10051</code> on your <em>Zabbix server</em>
side for the active proxy.</p>
<div class="admonition info">
<p class="admonition-title">Enable and start the proxy service</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-9-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>zabbix-proxy<span class="w"> </span>--now
</span></code></pre></div>
</div>
<p>If all goes well we can check the log file from our proxy and we will see that Zabbix has created the database by itself.</p>
<details class="example" open="open">
<summary>View Zabbix proxy logs</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-1"></a><span class="go">localhost:~&gt; sudo tail -f /var/log/zabbix/zabbix_proxy.log`</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-2"></a><span class="go">11134:20250519:152232.419 Starting Zabbix Proxy (active) [Zabbix proxy]. Zabbix 7.4.0beta2 (revision 7cd11a01d42).</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-3"></a><span class="go">11134:20250519:152232.419 **** Enabled features ****</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-4"></a><span class="go">11134:20250519:152232.419 SNMP monitoring:       YES</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-5"></a><span class="go">11134:20250519:152232.419 IPMI monitoring:       YES</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-6"></a><span class="go">11134:20250519:152232.419 Web monitoring:        YES</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-7"></a><span class="go">11134:20250519:152232.419 VMware monitoring:     YES</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-8"></a><span class="go">11134:20250519:152232.419 ODBC:                  YES</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-9"></a><span class="go">11134:20250519:152232.419 SSH support:           YES</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-10"></a><span class="go">11134:20250519:152232.419 IPv6 support:          YES</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-11"></a><span class="go">11134:20250519:152232.419 TLS support:           YES</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-12"></a><span class="go">11134:20250519:152232.419 **************************</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-13"></a><span class="go">11134:20250519:152232.419 using configuration file: /etc/zabbix/zabbix_proxy.conf</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-14"></a><span class="go">11134:20250519:152232.419 cannot open database file &quot;/var/lib/zabbix/zabbix_proxy.db&quot;: [2] No such file or directory</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-15"></a><span class="go">11134:20250519:152232.419 creating database ...</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-16"></a><span class="go">11134:20250519:152232.478 current database version (mandatory/optional): 07030032/07030032</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-10-17"></a><span class="go">11134:20250519:152232.478 required mandatory version: 07030032</span>
</span></code></pre></div>
</details>
<p>In case of the <em>active</em> proxy, we are now ready. Going back to our frontend we
should be able to see that our proxy is now online. Zabbix will also show the
version of our proxy and the last seen age.</p>
<p><img alt="ProxyA ready" src="../ch03-zabbix-proxies/active-passive-proxies/ch03-active-proxy-installed.png" /></p>
<p><em>3.6 Active proxy configured</em></p>
<p>For the <em>passive</em> proxy however, you will notice in the frontend that nothing 
seems to be working at all even when we have configured everything correctly on 
our proxy.</p>
<p><img alt="Passive Proxy not working" src="../ch03-zabbix-proxies/active-passive-proxies/ch03-passive-not-working.png" /></p>
<p><em>3.7 Proxy not working</em></p>
<p>The explanation is rather easy as we run a <em>passive</em> proxy, the <em>Zabbix server</em> needs
to poll our proxy. But we did not yet configure our Server to do that currently. 
So next step is to add the needed proxy pollers in our server configuration.</p>
<p>Edit or create a new configuration file in <code>/etc/zabbix/zabbix_server.d/</code> on the
<em>Zabbix Server</em> machine to add the required <code>StartProxyPollers</code> setting.</p>
<div class="admonition info">
<p class="admonition-title">/etc/zabbix/zabbix_server.d/pollers.conf</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-11-1"></a><span class="na">StartProxyPollers</span><span class="o">=</span><span class="s">1</span>
</span></code></pre></div>
</div>
<p>And restart the <em>Zabbix Server</em> process.</p>
<div class="admonition info">
<p class="admonition-title">Restart Zabbix Server</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch03-zabbix-proxies-active-passive-proxies-__codelineno-12-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>zabbix-server
</span></code></pre></div>
</div>
<p>Now going back to the frontend, we will see that our <em>passive proxy</em> becomes
available. If it's not green give it a few seconds or check all steps again
and verify your log files.</p>
<p><img alt="Passive Proxy working" src="../ch03-zabbix-proxies/active-passive-proxies/ch03-passive-working.png" /></p>
<p><em>3.8 Proxy working</em></p>
<p>You are now ready.</p>
<p>For your monitored hosts, this proxy will behave like the 
Zabbix server. Hence, all hosts you want to be monitored by the proxy will now 
have to be configured to have their <code>Server</code> and/or <code>ServerActive</code> configuration 
values set to the IP/hostname of this proxy instead of the <em>Zabbix server</em>.</p>
<hr />
<h2 id="ch03-zabbix-proxies-active-passive-proxies-conclusion">Conclusion</h2>
<p>This chapter has demonstrated the indispensable role of Zabbix proxies in building
robust, scalable, and distributed monitoring infrastructures. We've explored the
fundamental distinction between <em>active</em> and <em>passive</em> proxy modes, highlighting
how each serves different deployment scenarios and network topologies. Understanding
their individual strengths, from simplified firewall configurations with
<em>active proxies</em> to the server-initiated control of <em>passive proxies</em>, is crucial
for optimal system design.</p>
<p>We delved into the comprehensive settings that govern proxy behavior, emphasizing
how proper configuration of parameters like proxy polling intervals and data buffers,
directly impacts performance and data accuracy. The evolution of data storage mechanisms
within the proxy, from purely memory-based approaches to the flexible options of
disk and hybrid storage, empowers administrators to finely tune resource utilization
and data persistence based on their specific needs and the volume of monitored data.</p>
<p>Finally, we examined the critical advancements in configuration synchronization,
particularly the significant improvements introduced with Zabbix 7.0. The shift
towards more efficient and streamlined config sync processes, moving beyond the
limitations of earlier versions, underscores Zabbix's continuous commitment to
enhancing operational efficiency and simplifying large-scale deployments.</p>
<p>In essence, Zabbix proxies are far more than simple data forwarders; they are intelligent
intermediaries that offload significant processing from the central Zabbix server,
reduce network traffic, and enhance the resilience of your monitoring solution.
By carefully selecting the appropriate proxy type, meticulously configuring its
settings, and leveraging the latest features in data storage and configuration
management, you can unlock the full potential of Zabbix to monitor even the most
complex and geographically dispersed environments with unparalleled efficiency and
reliability. The knowledge gained in this chapter will be instrumental in designing
and maintaining a Zabbix infrastructure that is not only robust today but also adaptable
to future monitoring challenges.</p>
<hr />
<h2 id="ch03-zabbix-proxies-active-passive-proxies-questions">Questions</h2>
<ul>
<li>What is the fundamental difference between an active proxy and a passive proxy
  in terms of who initiates the connection?</li>
<li>How does a network firewall configuration differ for active vs passive proxies
  when separated from the server by a network firewall?</li>
</ul>
<hr />
<h2 id="ch03-zabbix-proxies-active-passive-proxies-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manpages/zabbix_proxy">https://www.zabbix.com/documentation/current/en/manpages/zabbix_proxy</a></li>
</ul></section><section class="print-page" id="ch03-zabbix-proxies-proxies-as-container" heading-number="8.4"><nav class='md-tags'><span class='md-tag'>expert</span></nav><h1 id="running-proxies-as-containers">Running Proxies as containers</h1>
<p>As discussed in the previous section, Zabbix proxies offer a lightweight and efficient
solution for distributed monitoring. Leveraging SQLite as their backend database,
they are inherently flexible and portable, making them well-suited for deployment
in containerized environments. This chapter provides a step-by-step guide on deploying
a Zabbix proxy within a container, outlining configuration options and best practices
for optimal performance and maintainability.</p>
<hr />
<h2 id="ch03-zabbix-proxies-proxies-as-container-setting-up-containers">Setting up containers</h2>
<p>For this setup, you will need a virtual machine (VM) with Podman installed to
deploy the Zabbix proxy container. This container will then be configured to
communicate with your Zabbix server.</p>
<p>Refer to the <a href="#ch00-getting-started-preparation-preparing-the-system-for-running-containers-using-podman"><em>Preparing the system for Zabbix</em></a> 
chapter for instructions on preparing your system for running containers using Podman.</p>
<hr />
<h3 id="ch03-zabbix-proxies-proxies-as-container-add-the-proxy-to-the-zabbix-frontend">Add the proxy to the zabbix frontend</h3>
<p><img alt="Add the proxy" src="../ch03-zabbix-proxies/proxy-containers/ch03-container-proxy-new.png" /></p>
<p><em>3.9 Add proxy
to frontend</em></p>
<p>To keep the configuration straightforward, we will deploy an active Zabbix proxy.
In this case, only two parameters need to be configured: the proxy's hostname
(as defined in the Zabbix frontend) and the proxy‚Äôs IP address for communication
with the Zabbix server.</p>
<hr />
<h3 id="ch03-zabbix-proxies-proxies-as-container-prepare-the-proxy-config">Prepare the Proxy config</h3>
<p>The next step is to create a <code>.container</code> unit file for our Quadlet setup. This
file should be placed in the directory <code>~/.config/containers/systemd/</code>. For example,
we will create a file named <code>zabbix-proxy-sqlite.container</code>, which will define the
configuration for running the Zabbix proxy container under SystemD using Podman.</p>
<p>Ensure you are logged in as user <code>podman</code>.</p>
<div class="admonition info">
<p class="admonition-title">Switch to user podman</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-0-1"></a>sudo<span class="w"> </span>-u<span class="w"> </span>podman<span class="w"> </span>-i
</span></code></pre></div>
</div>
<details class="example" open="open">
<summary>Creation of a .container systemd unit file</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-1-1"></a>vi<span class="w"> </span>~/.config/containers/systemd/zabbix-proxy-sqlite.container
</span></code></pre></div>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-1"></a><span class="k">[Unit]</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-2"></a><span class="na">Description</span><span class="o">=</span><span class="s">ZabbixProxy</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-4"></a><span class="k">[Container]</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-5"></a><span class="na">Image</span><span class="o">=</span><span class="s">docker.io/zabbix/zabbix-proxy-sqlite3:7.0-centos-latest</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-6"></a><span class="na">ContainerName</span><span class="o">=</span><span class="s">ZabbixProxySqlite-Quadlet</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-7"></a><span class="na">AutoUpdate</span><span class="o">=</span><span class="s">registry</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-8"></a><span class="na">EnvironmentFile</span><span class="o">=</span><span class="s">ZabbixProxy.env</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-9"></a><span class="na">PublishPort</span><span class="o">=</span><span class="s">10051:10051</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-10"></a>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-11"></a><span class="k">[Service]</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-12"></a><span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-13"></a>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-14"></a><span class="k">[Install]</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-2-15"></a><span class="na">WantedBy</span><span class="o">=</span><span class="s">default.target</span>
</span></code></pre></div>
</details>
<p>The container image for the Zabbix proxy using SQLite can be sourced from Docker
Hub. Specifically, we will use the image tagged 7.0-centos-latest, which is maintained
by the official Zabbix project. This image can be found at:</p>
<p><a href="https://hub.docker.com/r/zabbix/zabbix-proxy-sqlite3/tags?name=centos">https://hub.docker.com/r/zabbix/zabbix-proxy-sqlite3/tags?name=centos</a></p>
<p>A complete list of available image tags, including different versions and operating
system bases, is available on the image‚Äôs main page:</p>
<p><a href="https://hub.docker.com/r/zabbix/zabbix-proxy-sqlite3">https://hub.docker.com/r/zabbix/zabbix-proxy-sqlite3</a></p>
<p>For our purposes, the 7.0-centos-latest tag provides a CentOS-based container image
that is well-suited for LTS environments, and it includes all
necessary components to run the Zabbix proxy with SQLite.</p>
<p>In addition to the <code>.container</code> unit file, we also need to create an environment
file that defines the configuration variables for the container. This file must
reside in the same directory as the <code>.container</code> file: <code>~/.config/containers/systemd/</code>
and should be named <code>ZabbixProxy.env</code>, as referenced in our <code>.container</code> configuration.</p>
<p>This environment file allows us to override default container settings by specifying
environment variables used during container runtime. The list of supported variables
and their functions is clearly documented on the container's Docker Hub page:</p>
<p><a href="https://hub.docker.com/r/zabbix/zabbix-proxy-sqlite3">https://hub.docker.com/r/zabbix/zabbix-proxy-sqlite3</a></p>
<p>These variables allow you to configure key parameters such as the proxy mode, server
address, hostname, database settings, and logging options, providing a flexible
and declarative way to tailor the proxy‚Äôs behavior to your environment.</p>
<p>Let's create the file <code>~/.config/containers/systemd/ZabbixProxy.env</code> and add the
following content.</p>
<div class="admonition info">
<p class="admonition-title">~/.config/containers/systemd/ZabbixProxy.env</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-3-1"></a><span class="c1"># Zabbix proxy hostname as it appears in the Zabbix frontend</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-3-2"></a><span class="na">ZBX_HOSTNAME</span><span class="o">=</span><span class="s">ProxyA</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-3-4"></a><span class="c1"># IP address or DNS name of the Zabbix server</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-3-5"></a><span class="na">ZBX_SERVER_HOST</span><span class="o">=</span><span class="s">&lt;DNS or IP&gt;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-3-7"></a><span class="c1"># Proxy mode: 0 = active, 1 = passive</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-3-8"></a><span class="na">ZBX_PROXYMODE</span><span class="o">=</span><span class="s">0</span>
</span></code></pre></div>
</div>
<p>With our configuration now complete, the final step is to reload the systemd user daemon
so it recognizes the new Quadlet unit. This can be done using the following command:</p>
<div class="admonition info">
<p class="admonition-title">Reload SystemD user daemon</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-4-1"></a>systemctl<span class="w"> </span>--user<span class="w"> </span>daemon-reload
</span></code></pre></div>
</div>
<p>If everything is set up correctly, systemd will automatically generate a service
unit for the container based on the <code>.container</code> file. You can verify that the
unit has been registered by checking the output of <code>systemctl --user list-unit-files</code>:</p>
<details class="example" open="open">
<summary>Verify if the new unit is registered correctly</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-5-1"></a><span class="go">podman@localhost:~&gt; systemctl --user list-unit-files | grep zabbix</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-5-2"></a><span class="go">zabbix-proxy-sqlite.service             generated -</span>
</span></code></pre></div>
</details>
<p>You can now start the container using the <code>systemctl --user start</code> command.
To start the container, use the following command (replacing the service name if
you used a different one):</p>
<details class="example" open="open">
<summary>Start Zabbix Proxy container</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-6-1"></a>systemctl<span class="w"> </span>--user<span class="w"> </span>start<span class="w"> </span>zabbix-proxy-sqlite.service
</span></code></pre></div>
</details>
<p>This command may take a few minutes as it wil download the required Zabbix Proxy
container from the docker registry.</p>
<p>To verify that the container started correctly, you can inspect the running containers
with:</p>
<details class="example" open="open">
<summary>Inspect running containers</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-7-1"></a><span class="go">podman@localhost:~&gt; podman ps</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-7-2"></a><span class="go">CONTAINER ID  IMAGE                                                   COMMAND               CREATED       STATUS       PORTS                     NAMES</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-7-3"></a><span class="go">b5716f8f379d  docker.io/zabbix/zabbix-proxy-sqlite3:7.0-centos-latest /usr/sbin/zabbix_...  2 hours ago   Up 2 hours   0.0.0.0:10051-&gt;10051/tcp  ZabbixProxySqlite-Quadlet</span>
</span></code></pre></div>
</details>
<p>Take note of the <code>CONTAINER ID</code>‚Äîin this example, it is <code>b5716f8f379d</code>. You can
then retrieve the container's logs using:</p>
<details class="info" open="open">
<summary>Retrieve container logs</summary>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-8-1"></a>podman<span class="w"> </span>logs<span class="w"> </span>b5716f8f379d
</span></code></pre></div>
Where <code>b5716f8f379d</code> is the <code>CONTAINER ID</code> of your container</p>
<p>On some distributions, you can also view the logs directly through SystemD:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-9-1"></a>journalctl<span class="w"> </span>--user<span class="w"> </span>-u<span class="w"> </span>zabbix-proxy-sqlite.service
</span></code></pre></div></p>
</details>
<p>This command will return the startup and runtime logs for the container, which
are helpful for troubleshooting and verifying that the Zabbix proxy has started
correctly.</p>
<hr />
<h2 id="ch03-zabbix-proxies-proxies-as-container-upgrading-our-containers">Upgrading our containers</h2>
<p>At some point, you may be asking yourself: How do I upgrade my Zabbix containers?
Fortunately, container upgrades are a straightforward process that can be handled
either manually or through automation, depending on your deployment strategy.</p>
<p>Throughout this book, we've been using the image tag <code>7.0-centos-latest</code>, which always
pulls the most up-to-date CentOS-based Zabbix 7.0 image available at the time.
This approach ensures you are running the latest fixes and improvements without
specifying an exact version.</p>
<p>Alternatively, you can opt for version specific tags such as <code>centos-7.0.13</code>, which
allow you to maintain strict control over the version deployed. This can be helpful
in environments where consistency and reproducibility are critical.</p>
<p>In the following sections, we will explore both approaches: using the <code>latest</code>
tag for automated updates and specifying fixed versions for controlled environments.</p>
<hr />
<h3 id="ch03-zabbix-proxies-proxies-as-container-upgrading-manually">Upgrading manually</h3>
<p>If you're running your Zabbix container using a <strong>floating tag</strong> such as <code>:latest</code> or
<code>:trunk-centos</code>, upgrading is a simple and efficient process. These tags always
point to the most recent image available in the repository.</p>
<details class="info" open="open">
<summary>To upgrade:</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-10-1"></a><span class="c1"># Pull the latest image using Podman.</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-10-2"></a>podman<span class="w"> </span>pull<span class="w"> </span>zabbix/zabbix-proxy-sqlite3:7.0-centos-latest
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-10-3"></a><span class="c1"># Restart the systemd service associated with the container.</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-10-4"></a>systemctl<span class="w"> </span>--user<span class="w"> </span>restart<span class="w"> </span>zabbix-proxy-sqlite.service
</span></code></pre></div>
</details>
<p>Thanks to our Quadlet integration, systemd will handle the rest automatically:
The currently running container will be stopped.
A new container instance will be started using the freshly pulled image.
All configuration options defined in the associated <code>.container</code> file will be reapplied.
This approach allows for quick updates with minimal effort, while still preserving
consistent configuration management through systemd.</p>
<hr />
<h3 id="ch03-zabbix-proxies-proxies-as-container-upgrading-when-using-a-fixed-image-tag">Upgrading When Using a Fixed Image Tag</h3>
<p>If your container is configured to use a <strong>fixed image tag</strong> (e.g., <code>7.0.13-centos</code>)
rather than a floating tag like <code>:latest</code> or <code>:trunk</code>, the upgrade process involves
one additional step: <strong>manually updating the tag in your <code>.container</code> file</strong>.</p>
<p>For example, if you're running a user-level Quadlet container and your configuration
file is located at <code>~/.config/containers/systemd/zabbix-proxy-sqlite.container</code>:</p>
<details class="example" open="open">
<summary>Manually updating the tag</summary>
<p>You'll need to edit this file 
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-11-1"></a>vi<span class="w"> </span>~/.config/containers/systemd/zabbix-proxy-sqlite.container
</span></code></pre></div></p>
<p>and update the <code>Image=</code> line. For instance, change:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-12-1"></a><span class="na">Image</span><span class="o">=</span><span class="s">docker.io/zabbix/zabbix-proxy-sqlite3:7.0.13-centos</span>
</span></code></pre></div>
<p>to:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-13-1"></a><span class="na">Image</span><span class="o">=</span><span class="s">docker.io/zabbix/zabbix-proxy-sqlite3:7.0.14-centos</span>
</span></code></pre></div>
<p>Once the file has been updated, apply the changes by running:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-14-1"></a>systemctl<span class="w"> </span>--user<span class="w"> </span>daemon-reload
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-14-2"></a>systemctl<span class="w"> </span>--user<span class="w"> </span>restart<span class="w"> </span>zabbix-proxy-sqlite.service
</span></code></pre></div>
<p>This tells systemd to reload the modified unit file and restart the container with
the updated image. Since you're using a fixed tag, this upgrade process gives you
full control over when and how new versions are introduced.</p>
</details>
<hr />
<h3 id="ch03-zabbix-proxies-proxies-as-container-upgrading-automatically">Upgrading automatically</h3>
<p>When using floating tags like <code>:latest</code> or <code>:trunk-centos</code> for your Zabbix container
images, Podman Quadlet supports automated upgrades by combining them with the
<code>AutoUpdate=registry</code> directive in your <code>.container</code> file.</p>
<p>This setup ensures your container is automatically refreshed whenever a new image
is available in the remote registry without requiring manual intervention.</p>
<hr />
<h4 id="ch03-zabbix-proxies-proxies-as-container-example-configuration">Example Configuration</h4>
<details class="example" open="open">
<summary>.container file</summary>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-15-1"></a><span class="k">[Container]</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-15-2"></a><span class="na">Image</span><span class="o">=</span><span class="s">docker.io/zabbix/zabbix-proxy-sqlite3:trunk-centos</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-15-3"></a><span class="na">AutoUpdate</span><span class="o">=</span><span class="s">registry</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-15-4"></a><span class="na">...</span>
</span></code></pre></div>
<p>In this example, the <code>Image</code> points to the <code>trunk-centos</code> tag, and <code>AutoUpdate=registry</code>
tells Podman to periodically check the container registry for updates to this tag.</p>
</details>
<hr />
<h4 id="ch03-zabbix-proxies-proxies-as-container-how-the-auto-update-process-works">How the Auto-Update Process Works</h4>
<p>Once configured, the following steps are handled automatically:</p>
<ol>
<li>
<p><strong>Image Check</strong>
   The systemd service <code>podman-auto-update</code> is triggered by a timer (usually daily).
   It compares the current image digest with the remote image's digest for the
   same tag.</p>
</li>
<li>
<p><strong>Image Update</strong>
   If a new version is detected:</p>
</li>
</ol>
<ul>
<li>The updated image is pulled from the registry.</li>
<li>The currently running container is stopped and removed.</li>
<li>A new container is created from the updated image.</li>
</ul>
<ol start="3">
<li><strong>Configuration Reuse</strong>
   The new container is launched using the exact same configuration defined in
   your <code>.container</code> file, including environment variables, volume mounts, ports,
   and networking.</li>
</ol>
<p>This approach provides a clean, repeatable way to keep your Zabbix proxy (or other
components) current without direct user intervention.</p>
<hr />
<h4 id="ch03-zabbix-proxies-proxies-as-container-enabling-the-auto-update-timer">Enabling the Auto-Update Timer</h4>
<p>To ensure that updates are applied regularly, you must enable the Podman auto-update
timer.</p>
<div class="admonition info">
<p class="admonition-title">For System-Wide Services</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-16-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>podman-auto-update.timer
</span></code></pre></div>
</div>
<div class="admonition info">
<p class="admonition-title">For User-Level Services</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch03-zabbix-proxies-proxies-as-container-__codelineno-17-1"></a>systemctl<span class="w"> </span>--user<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>podman-auto-update.timer
</span></code></pre></div>
</div>
<p>This activates a systemd timer that periodically invokes <code>podman-auto-update.service</code>.</p>
<hr />
<h3 id="ch03-zabbix-proxies-proxies-as-container-when-to-use-this-approach">When to Use This Approach</h3>
<p><code>AutoUpdate=registry</code> is particularly useful in the following scenarios:</p>
<ul>
<li><strong>Development or staging environments</strong>, where running the latest version is
  beneficial.</li>
<li><strong>Non-critical Zabbix components</strong>, such as test proxies or lab deployments.</li>
<li><strong>When you prefer a hands-off update strategy</strong>, and image stability is trusted.</li>
</ul>
<details class="warning" open="open">
<summary>Warning</summary>
<p>This setup is not recommended for production environments without a proper rollback
plan. Floating tags like <code>:latest</code> or <code>:trunk-centos</code> can introduce breaking
changes unexpectedly. For production use, fixed version tags (e.g. <code>7.0.13-centos</code>)
are generaly recommended since they offer greater stability and control.</p>
</details>
<hr />
<h2 id="ch03-zabbix-proxies-proxies-as-container-conclusion">Conclusion</h2>
<p>In this chapter, we deployed a Zabbix active proxy using Podman and SystemD 
Quadlets. We configured SELinux, enabled user lingering, and created
both <code>.container</code> and <code>.env</code> files to define proxy behavior. Using Podman in rootless
mode ensures improved security and system integration. SystemD management makes
the container easy to control and monitor. This setup offers a lightweight, flexible,
and secure approach to deploying Zabbix proxies. It is ideal for modern environments,
especially when using containers or virtualisation. With the proxy running, you're
ready to extend Zabbix monitoring to remote locations efficiently.</p>
<hr />
<h2 id="ch03-zabbix-proxies-proxies-as-container-questions">Questions</h2>
<ul>
<li>What are the main advantages of using Podman over Docker for running containers
  on Red Hat-based systems?</li>
<li>Why is the <code>loginctl enable-linger</code> command important when using SystemD with rootless
  Podman containers?</li>
<li>What is the purpose of the <code>.env</code> file in the context of a Quadlet-managed container?</li>
<li>How do SELinux policies affect Podman container execution, and how can you configure
  them correctly?</li>
<li>How can you verify that your Zabbix proxy container started successfully?</li>
<li>What is the difference between an active and passive Zabbix proxy?</li>
</ul>
<hr />
<h2 id="ch03-zabbix-proxies-proxies-as-container-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://hub.docker.com/r/zabbix/zabbix-proxy-sqlite3">https://hub.docker.com/r/zabbix/zabbix-proxy-sqlite3</a></li>
<li><a href="https://podman.io/">https://podman.io/</a></li>
<li><a href="https://docs.podman.io/en/latest/markdown/podman-systemd.unit.5.html">https://docs.podman.io/en/latest/markdown/podman-systemd.unit.5.html</a></li>
<li><a href="https://blog.zabbix.com/podman-container-monitoring-with-prometheus-exporter-part-1/30513/">https://blog.zabbix.com/podman-container-monitoring-with-prometheus-exporter-part-1/30513/</a></li>
</ul></section><section class="print-page" id="ch03-zabbix-proxies-proxy-groups" heading-number="8.5"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="proxy-groups">Proxy groups</h1>
<h2 id="ch03-zabbix-proxies-proxy-groups-zabbix-proxy-groups-high-availability-and-load-balancing">Zabbix Proxy Groups: High Availability and Load Balancing</h2>
<p>Zabbix Proxy Groups provide a robust foundation for <strong>enterprise-grade distributed
monitoring</strong>, enabling automatic <strong>High Availability (HA)</strong> and <strong>Load Balancing
(LB)</strong> across multiple proxies. Instead of binding a monitored host to a single
proxy, the host is assigned to a <strong>Proxy Group</strong>. The Zabbix server then determines
dynamically and continuously which proxy within the group is responsible for monitoring
that host.</p>
<p>This approach ensures uninterrupted monitoring during proxy failures and maintains
an even workload across the proxy infrastructure.</p>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-groups-overview-and-core-concepts">Overview and Core Concepts</h2>
<p>Proxy groups operate under the control of the <strong>Zabbix Server‚Äôs Proxy Group Manager</strong>, which continuously evaluates proxy status, host assignments, and overall group health. Two major capabilities define this feature: <strong>automatic failover</strong> and <strong>workload balancing</strong>.</p>
<h3 id="ch03-zabbix-proxies-proxy-groups-1-high-availability-ha-through-automatic-failover">1. High Availability (HA) Through Automatic Failover</h3>
<p><strong>Failover Mechanism:</strong>
If a proxy stops communicating with the Zabbix server and exceeds the configured
<strong>Failover period</strong>, it is marked <em>Offline</em>. The Proxy Group Manager then
<strong>immediately reassigns</strong> all hosts monitored by that proxy to the remaining
online proxies in the group.</p>
<p><strong>Outcome:</strong>
Monitoring continues with minimal disruption and without manual intervention.</p>
<h3 id="ch03-zabbix-proxies-proxy-groups-2-load-balancing-through-host-redistribution">2. Load Balancing Through Host Redistribution</h3>
<p><strong>Balancing Mechanism:</strong>
The Zabbix server evaluates the number of hosts assigned to each proxy. # Proxy groups</p>
<h2 id="ch03-zabbix-proxies-proxy-groups-zabbix-proxy-groups-high-availability-and-load-balancing_1">Zabbix Proxy Groups: High Availability and Load Balancing</h2>
<p>Zabbix Proxy Groups provide a robust foundation for <strong>enterprise-grade distributed
monitoring</strong>, enabling automatic <strong>High Availability (HA)</strong> and <strong>Load Balancing
(LB)</strong> across multiple proxies. Instead of binding a monitored host to a single
proxy, the host is assigned to a <strong>Proxy Group</strong>. The Zabbix server then determines
dynamically and continuously which proxy within the group is responsible for monitoring
that host.</p>
<p>This approach ensures uninterrupted monitoring during proxy failures and maintains
an even workload across the proxy infrastructure.</p>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-groups-overview-and-core-concepts_1">Overview and Core Concepts</h2>
<p>Proxy groups operate under the control of the <strong>Zabbix Server‚Äôs Proxy Group Manager</strong>,Load balancing is triggered if an imbalance is detected, defined by <strong>two simultaneous conditions</strong>:</p>
<ol>
<li>A difference of <strong>greater than 10 hosts</strong>, <strong>and</strong></li>
<li>The number of hosts assigned to a proxy is <strong>double the group average or more</strong>.</li>
</ol>
<p><strong>Redistribution Logic:</strong></p>
<ol>
<li>Compute the <strong>average hosts per proxy</strong>.</li>
<li>Proxies with excess hosts move them into an <strong>unassigned pool</strong>.</li>
<li>Proxies with a deficit receive hosts from this pool.</li>
</ol>
<p>Example:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Proxy Host Count</th>
<th style="text-align: center;">Group Average</th>
<th style="text-align: center;">Triggered?</th>
<th style="text-align: left;">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>100</strong></td>
<td style="text-align: center;">50</td>
<td style="text-align: center;"><strong>Yes</strong></td>
<td style="text-align: left;">Host count is double the average (2√ó) and difference is 50 (&gt;10).</td>
</tr>
<tr>
<td style="text-align: center;">60</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">No</td>
<td style="text-align: left;">Difference is 10 (not &gt;10); not sufficient to trigger rebalancing.</td>
</tr>
<tr>
<td style="text-align: center;">40</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">No</td>
<td style="text-align: left;">Deficit of 10; insufficient to trigger balancing.</td>
</tr>
<tr>
<td style="text-align: center;"><strong>25</strong></td>
<td style="text-align: center;">5</td>
<td style="text-align: center;"><strong>Yes</strong></td>
<td style="text-align: left;">Proxy has 5√ó the average (‚â•2√ó) and difference is 20 (&gt;10).</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-groups-advanced-operational-detail">Advanced Operational Detail</h2>
<p>The following technical details govern the behavior of the Proxy Group Manager and agents.</p>
<h3 id="ch03-zabbix-proxies-proxy-groups-internal-management-and-communication">Internal Management and Communication</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">Mechanism</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Communication Flow</strong></td>
<td style="text-align: left;">Proxies communicate <strong>only with the Proxy Group Manager</strong> on the Zabbix server. Proxies <strong>do not communicate with each other</strong>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Group Membership</strong></td>
<td style="text-align: left;">Each proxy can belong <strong>only to a single proxy group</strong>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>State Change Trigger</strong></td>
<td style="text-align: left;">Proxy and proxy group states change only <strong>after the configured failover period</strong> has expired.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Shared Knowledge</strong></td>
<td style="text-align: left;">All proxies in the group are informed by the server about the status and addresses of other proxies in the same group.</td>
</tr>
</tbody>
</table>
<h3 id="ch03-zabbix-proxies-proxy-groups-load-balancing-time-window">Load Balancing Time Window</h3>
<ul>
<li>If a proxy group is flagged as unbalanced, the Proxy Group Manager will <strong>wait until the grace period of $10 \times$ the failover delay has expired</strong>.</li>
<li>This grace period prevents redistribution based on temporary spikes. If the imbalance persists, host redistribution is performed.</li>
</ul>
<h3 id="ch03-zabbix-proxies-proxy-groups-agent-configuration-rules">Agent Configuration Rules</h3>
<h4 id="ch03-zabbix-proxies-proxy-groups-passive-agents-server">Passive Agents (<code>Server=</code>)</h4>
<p>A Zabbix agent in passive mode <strong>must accept connections from all members of its proxy group</strong>.
* Configure the <code>Server</code> parameter with a comma-separated list of all node IP addresses or DNS names.
* It is also possible to specify entire network segments if appropriate.</p>
<h4 id="ch03-zabbix-proxies-proxy-groups-active-agents-serveractive">Active Agents (<code>ServerActive=</code>)</h4>
<p>The active agent (v7.0+) will dynamically learn the optimal proxy. It is configured in one of two ways:</p>
<ol>
<li><strong>Specify Multiple Proxies:</strong> Specify multiple proxy addresses using <strong>semicolons</strong>. Any proxy group member the agent connects to can redirect the agent to the currently assigned proxy.</li>
<li><strong>Specify Zabbix Server:</strong> Specify the <strong>Zabbix server address</strong> instead of the proxy addresses. The Proxy Group Manager will redirect the agent to the assigned proxy. The active agent will then add all known proxies to its runtime <code>ServerActive</code> parameter.</li>
</ol>
<h3 id="ch03-zabbix-proxies-proxy-groups-handling-proxy-network-loss">Handling Proxy Network Loss</h3>
<ul>
<li>If a proxy loses its network connection to the Zabbix server, the Proxy Group Manager will automatically reassign the proxy's hosts to other online proxies.</li>
<li>The disconnected proxy will mark itself as offline and will <strong>redirect any active agents</strong> attempting to connect to it toward the other proxies in the group.</li>
</ul>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-groups-configuration-workflow">Configuration Workflow</h2>
<p>Deploying proxy groups effectively involves three main steps.</p>
<h3 id="ch03-zabbix-proxies-proxy-groups-step-1-create-the-proxy-group">Step 1: Create the Proxy Group</h3>
<p>In the Zabbix frontend:</p>
<ol>
<li>Navigate to <strong>Administration ‚Üí Proxy groups</strong>.</li>
<li>Click <strong>Create proxy group</strong>.</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Recommendation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;">Descriptive group name (e.g., <code>EMEA_Prod_Proxies</code>).</td>
<td style="text-align: left;">Use consistent naming tied to region, function, or environment.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Failover period</strong></td>
<td style="text-align: left;">Maximum downtime allowed before proxy becomes <em>Offline</em> and failover is triggered.</td>
<td style="text-align: left;">Default: <strong>1m</strong>. Supports <code>s</code>, <code>m</code>, <code>h</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Minimum number of proxies</strong></td>
<td style="text-align: left;">Minimum required online proxies for the group to be considered <em>Online</em>.</td>
<td style="text-align: left;">Use $N-1$ if you want one proxy failure tolerance.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Proxies</strong></td>
<td style="text-align: left;">Members participating in load sharing and HA.</td>
<td style="text-align: left;">Add all intended proxies.</td>
</tr>
</tbody>
</table>
<h3 id="ch03-zabbix-proxies-proxy-groups-step-2-assign-hosts-to-the-proxy-group">Step 2: Assign Hosts to the Proxy Group</h3>
<p>Hosts must be explicitly assigned to the proxy group:</p>
<ol>
<li>Select hosts in <strong>Hosts</strong>.</li>
<li>Use <strong>Mass Update</strong>.</li>
<li>Set <strong>Monitored by proxy = &lt;Proxy Group Name&gt;</strong>.</li>
</ol>
<p>Only hosts assigned to the group are eligible for automated failover and load balancing.</p>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-groups-architecture-diagram">Architecture Diagram</h2>
<pre  class="mermaid"><code>flowchart LR
    subgraph Server["Zabbix Server"]
        PGM["Proxy Group Manager"]
    end

    subgraph ProxyGroup["Proxy Group"]
        PX1["Proxy 1"]
        PX2["Proxy 2"]
        PX3["Proxy 3"]
    end

    subgraph Hosts["Monitored Hosts"]
        H1["Host A"]
        H2["Host B"]
        H3["Host C"]
        H4["Host D"]
    end

    PGM --> PX1
    PGM --> PX2
    PGM --> PX3

    PX1 <---> H1
    PX2 <---> H2
    PX3 <---> H3
    PX2 <---> H4

    %% Failover arrows
    PX1 -.Failover/Load Balancing.-> PX2
    PX2 -.Failover/Load Balancing.-> PX3
</code></pre>
<h2 id="ch03-zabbix-proxies-proxy-groups-important-considerations-and-limitations">Important Considerations and Limitations</h2>
<ul>
<li><strong>Version Requirements:</strong> All proxies must run Zabbix <strong>7.0 or later</strong> and match the server version.</li>
<li><strong>Firewall Requirements:</strong> Agents must be able to communicate with <strong>every proxy</strong> in the group.</li>
<li><strong>SNMP Traps Not Supported:</strong> Proxy groups <strong>cannot process SNMP traps</strong>. Traps must be routed to a dedicated, non-grouped proxy.</li>
<li><strong>External Dependencies Must Be Identical:</strong> If proxies use external check scripts, ODBC configuration, or third-party integrations, ensure <strong>all proxies have identical configurations</strong>.</li>
<li><strong>VMware Monitoring Impact:</strong> VMware hypervisors may be distributed across proxies, and each proxy will retrieve cached data from vCenter, increasing load.</li>
</ul>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-groups-some-good-practices">Some Good Practices</h2>
<ul>
<li>Use at least three proxies for stable HA and load balancing.</li>
<li>Ensure <strong>symmetric configuration</strong> across all proxies (scripts, credentials, ODBC drivers, time sync).</li>
<li>Monitor proxy performance using built-in templates to understand load and redistribution frequency.</li>
<li>Keep failover periods short for high-criticality environments.</li>
<li>Test failover events regularly in non-production environments.</li>
</ul>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-groups-practical-example">Practical Example</h2>
<p>This example utilizes a single Zabbix Server and a three node Proxy Group to provide
superior High Availability (HA) and load balancing for a large remote location.
This configuration allows for failure tolerance and demonstrates mixed Active/Passive
monitoring modes.</p>
<p>You don't need multiple virtual machines but of course we won't stop you if you
want too. :) An easy alternative is containers. Or running proxies with different
configuration files manually from the command line with the option <code>-c</code> or <code>--config-file</code>.
If you don't know how have a look at our previous chapter <code>Running proxies as containers</code>.</p>
<h3 id="ch03-zabbix-proxies-proxy-groups-environment-overview">Environment Overview</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Quantity</th>
<th style="text-align: left;">Role</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Zabbix Server</td>
<td style="text-align: left;">1 (zbx-server-main)</td>
<td style="text-align: left;">Central hub for all collected data.</td>
</tr>
<tr>
<td style="text-align: left;">Zabbix Proxies</td>
<td style="text-align: left;">3 (zbx-proxy-A1, A2, A3)</td>
<td style="text-align: left;">Collect data locally at the branch office.</td>
</tr>
<tr>
<td style="text-align: left;">Hosts</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">Monitored devices in the branch office.</td>
</tr>
<tr>
<td style="text-align: left;">Monitoring Group</td>
<td style="text-align: left;">Branch-A_HA_Group</td>
<td style="text-align: left;">The Zabbix entity responsible for distributing the</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">300 hosts across the 3 proxies for redundancy.</td>
</tr>
</tbody>
</table>
<h3 id="ch03-zabbix-proxies-proxy-groups-zabbix-proxy-configuration-file-zabbix_proxyconf">Zabbix Proxy Configuration File (zabbix_proxy.conf)</h3>
<p>The IPs are just examples, adapt them to your own setup.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">zbx-proxy-A1 (Active)</th>
<th style="text-align: left;">zbx-proxy-A3 (Passive)</th>
<th style="text-align: left;">zbx-proxy-A2 (Active)</th>
<th style="text-align: left;">Critical Note</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">IP</td>
<td style="text-align: left;">10.0.0.1</td>
<td style="text-align: left;">10.0.0.2</td>
<td style="text-align: left;">10.0.0.3</td>
<td style="text-align: left;">IP/DNS of the the Proxy server.</td>
</tr>
<tr>
<td style="text-align: left;">Hostname</td>
<td style="text-align: left;">zbx-proxy-A1</td>
<td style="text-align: left;">zbx-proxy-A3</td>
<td style="text-align: left;">zbx-proxy-A2</td>
<td style="text-align: left;">Must match the Proxy Name defined in the Zabbix Frontend.</td>
</tr>
<tr>
<td style="text-align: left;">ProxyMode</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">1 = Active (proxy connects to server). 0 = Passive (server connects to proxy).</td>
</tr>
<tr>
<td style="text-align: left;">DBName</td>
<td style="text-align: left;">/tmp/proxy_a1.db</td>
<td style="text-align: left;">/tmp/proxy_a3.db</td>
<td style="text-align: left;">/tmp/proxy_a2.db</td>
<td style="text-align: left;">Each proxy must use a unique database file when use SQlite3 .</td>
</tr>
</tbody>
</table>
<h3 id="ch03-zabbix-proxies-proxy-groups-zabbix-frontend-setup-administration">Zabbix Frontend Setup (Administration)</h3>
<p>Follow these steps in the Zabbix Web Interface (Administration section) to create and assign the Proxy Group.</p>
<h4 id="ch03-zabbix-proxies-proxy-groups-define-individual-proxies-administration-proxies">Define Individual Proxies (Administration -&gt; Proxies)</h4>
<ul>
<li>Navigate to <code>Administration</code>-&gt; <code>Proxies</code>.</li>
<li>Click <code>Create proxy</code>.</li>
<li>Define all three proxies one by one:<ul>
<li>Proxy name: Enter the <code>Hostname</code> (e.g., <code>zbx-proxy-A1</code>).</li>
<li>Proxy mode: Select Active (1) for A1 and A2, and Passive (0) for A3.</li>
<li>Proxy group: Leave as None for now.</li>
</ul>
</li>
<li>Click Add.</li>
</ul>
<p><img alt="Proxy_groups/ch03-add-proxy.png" src="../ch03-zabbix-proxies/Proxy_groups/ch03-add-proxy.png" />
<em>ch03 Add proxy</em></p>
<h4 id="ch03-zabbix-proxies-proxy-groups-create-the-proxy-group-administration-proxy-groups">Create the Proxy Group (Administration -&gt; Proxy groups)</h4>
<ul>
<li>Navigate to <code>Administration</code>-&gt; <code>Proxy groups</code>.</li>
<li>Click <code>Create proxy group</code>.</li>
<li>Configure the group parameters for High Availability:<ul>
<li>Name: <code>Branch-A_HA_Group</code></li>
<li>Minimum proxies: Set to 2. This ensures if only one proxy remains, the group
  will enter a Degrading state, preventing the single remaining proxy from
  being overloaded.</li>
<li>Failover period: <code>1m</code> (The time the server waits before redistributing hosts
  from an offline proxy).</li>
</ul>
</li>
</ul>
<p><img alt="Proxy_groups/ch03-create-proxy-group.png" src="../ch03-zabbix-proxies/Proxy_groups/ch03-create-proxy-group.png" />
<em>ch03 Create Proxy groups</em></p>
<h4 id="ch03-zabbix-proxies-proxy-groups-assign-proxies-to-the-group-administration-proxies">Assign Proxies to the Group (Administration -&gt; Proxies)</h4>
<ul>
<li>Go back to <code>Administration -&gt;</code>Proxies`.</li>
<li>Edit each proxy (<code>zbx-proxy-A1</code>, <code>zbx-proxy-A2</code>, and <code>zbx-proxy-A3</code>).</li>
<li>Change the Proxy group dropdown from <code>None</code> to <code>Branch-A_HA_Group</code>.</li>
<li>Define <code>Address for active agents</code> add the IP of the proxy.</li>
<li>Click <code>Update</code>.</li>
</ul>
<p><img alt="Proxy_groups/ch03-add-proxy-to-group.png" src="../ch03-zabbix-proxies/Proxy_groups/ch03-add-proxy-to-group.png" />
<em>ch03 Add proxy to proxy group</em></p>
<p><img alt="Proxy_groups/ch03-all-proxy-linked.png" src="../ch03-zabbix-proxies/Proxy_groups/ch03-all-proxy-linked.png" />
<em>ch03 All proxies linked with a proxy group</em></p>
<h3 id="ch03-zabbix-proxies-proxy-groups-zabbix-agent-configuration-zabbix_agentdconf">Zabbix Agent Configuration (zabbix_agentd.conf)</h3>
<p>To ensure hosts can be monitored by any proxy in the group, the <code>Zabbix Agent</code>
configuration on the 300 hosts must be aware of all proxy IP addresses. Don't
worry we will not install 300 hosts. Just one agent is fine, we will use a
passive agent and just create 300 dummy agents in the frontend.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Configuration Value Example</th>
<th style="text-align: left;">Rationale for HA/Load Balancing</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Server</td>
<td style="text-align: left;">"IP_A1,IP_A2,IP_A3,10.0.0.1"</td>
<td style="text-align: left;">"Passive Checks: Allows the host to accept</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">incoming connections (checks) from any IP address in the group (and the Server,</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">for redundancy or occasional checks)."</td>
</tr>
<tr>
<td style="text-align: left;">ServerActive</td>
<td style="text-align: left;">IP_A1;IP_A2;IP_A3</td>
<td style="text-align: left;">"Active Checks: The agent will attempt to</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">send data to the first proxy in the semi-colon list. If that fails, it automatically</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">tries the next one, providing agent-side failover."</td>
</tr>
<tr>
<td style="text-align: left;">Hostname</td>
<td style="text-align: left;">[ Not too important ]</td>
<td style="text-align: left;">We will use passive agents to the name is not important.</td>
</tr>
</tbody>
</table>
<p>As a final step you now have to create 300 hosts in the frontend and select
<code>Monitored by proxy</code> field to the <code>proxy group :</code> <code>Branch-A_HA_Group</code>.</p>
<p>Just here is a script for you that will handle those things. Just create an API
token for the Zabbix Administrator account or any account with enough privileges
and fill in the API token and the URL of the zabbix frontend. Make the script
executable <code>chmod +x create_hosts.py</code> or whatever you used as name for the
script. Verify also the <code>Host_group_id</code>, <code>Template_id</code> and the <code>Proxy_group_id</code>. 
This can be done by looking at the URL when clicking on them.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>For this script to work you need to have python3 and you probably need
 to install pip and the requests module.</p>
</details>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-1"></a><span class="ch">#!/bin/python3</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-6"></a><span class="c1"># --- Configuration ---</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-7"></a><span class="n">ZABBIX_URL</span> <span class="o">=</span> <span class="s2">&quot;http://&lt;Server URL&gt;/api_jsonrpc.php&quot;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-8"></a><span class="n">AUTH_TOKEN</span> <span class="o">=</span> <span class="s2">&quot;&lt;API TOKEN&gt;&quot;</span>  <span class="c1"># Replace with your Zabbix API token</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-9"></a><span class="n">HOST_COUNT</span> <span class="o">=</span> <span class="mi">300</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-10"></a><span class="n">HOST_GROUP_ID</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>  <span class="c1"># Replace with the actual ID of your target Host Group (e.g., &#39;Branch A Servers&#39;)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-11"></a><span class="n">TEMPLATE_ID</span> <span class="o">=</span> <span class="s2">&quot;10561&quot;</span> <span class="c1"># Replace with a common template ID (e.g., &#39;Template Module Zabbix agent&#39;)</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-12"></a><span class="n">PROXY_GROUP_ID</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span> <span class="c1"># Replace with the actual ID of your &#39;Branch-A_HA_Group&#39;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">api_call</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">id_val</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-15"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-16"></a><span class="sd">    Generic function to make a Zabbix API call for 7.2+.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-17"></a><span class="sd">    - Token is passed via Authorization: Bearer header.</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-18"></a><span class="sd">    - &#39;auth&#39; is NOT included in the JSON body anymore.</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-19"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-20"></a>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-21"></a>        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json-rpc&quot;</span><span class="p">,</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-22"></a>        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">AUTH_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-23"></a>    <span class="p">}</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-24"></a>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-25"></a>    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-26"></a>        <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-27"></a>        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-28"></a>        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-29"></a>        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">id_val</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-30"></a>    <span class="p">}</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-31"></a>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-32"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-33"></a>        <span class="c1"># using json= lets requests handle encoding</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-34"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">ZABBIX_URL</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-35"></a>        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-36"></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-37"></a>    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-38"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API Request Error on method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-39"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_hosts</span><span class="p">():</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-42"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates the bulk hosts using the host.create API method.&quot;&quot;&quot;</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-43"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting host creation for </span><span class="si">{</span><span class="n">HOST_COUNT</span><span class="si">}</span><span class="s2"> hosts...&quot;</span><span class="p">)</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-44"></a>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-45"></a>    <span class="c1"># --- AUTHENTICATION CHECK ---</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-46"></a>    <span class="n">auth_check_response</span> <span class="o">=</span> <span class="n">api_call</span><span class="p">(</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-47"></a>        <span class="s2">&quot;user.get&quot;</span><span class="p">,</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-48"></a>        <span class="p">{</span><span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]},</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-49"></a>        <span class="n">id_val</span><span class="o">=</span><span class="mi">1000</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-50"></a>    <span class="p">)</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-51"></a>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-52"></a>    <span class="k">if</span> <span class="n">auth_check_response</span> <span class="ow">and</span> <span class="s1">&#39;result&#39;</span> <span class="ow">in</span> <span class="n">auth_check_response</span><span class="p">:</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-53"></a>        <span class="k">if</span> <span class="n">auth_check_response</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]:</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-54"></a>            <span class="n">user_alias</span> <span class="o">=</span> <span class="n">auth_check_response</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-55"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Authenticated successfully as: </span><span class="si">{</span><span class="n">user_alias</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-56"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-57"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Auth success, but no users returned. Check the token&#39;s permissions.&quot;</span><span class="p">)</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-58"></a>            <span class="k">return</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-59"></a>    <span class="k">elif</span> <span class="n">auth_check_response</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">auth_check_response</span><span class="p">:</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-60"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Initial Authentication Error. Received: </span><span class="si">{</span><span class="n">auth_check_response</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-61"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please double-check your ZABBIX_URL and AUTH_TOKEN.&quot;</span><span class="p">)</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-62"></a>        <span class="k">return</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-63"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-64"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Failed to establish connection for authentication check. Check ZABBIX_URL.&quot;</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-65"></a>        <span class="k">return</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-66"></a>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-67"></a>    <span class="c1"># --- END AUTHENTICATION CHECK ---</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-68"></a>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-69"></a>    <span class="n">hosts_created_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-70"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">HOST_COUNT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-71"></a>        <span class="n">host_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SIM-HOST-</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-72"></a>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-73"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-74"></a>            <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">host_name</span><span class="p">,</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-75"></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">host_name</span><span class="p">,</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-76"></a>            <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;groupid&quot;</span><span class="p">:</span> <span class="n">HOST_GROUP_ID</span><span class="p">}],</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-77"></a>            <span class="s2">&quot;templates&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;templateid&quot;</span><span class="p">:</span> <span class="n">TEMPLATE_ID</span><span class="p">}],</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-78"></a>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-79"></a>            <span class="c1"># If you are using proxy groups in 7.x:</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-80"></a>            <span class="s2">&quot;proxy_groupid&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">PROXY_GROUP_ID</span><span class="p">),</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-81"></a>            <span class="s2">&quot;monitored_by&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-82"></a>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-83"></a>            <span class="s2">&quot;interfaces&quot;</span><span class="p">:</span> <span class="p">[{</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-84"></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Zabbix Agent interface</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-85"></a>                <span class="s2">&quot;main&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-86"></a>                <span class="s2">&quot;useip&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-87"></a>                <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-88"></a>                <span class="s2">&quot;dns&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-89"></a>                <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;10050&quot;</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-90"></a>            <span class="p">}],</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-91"></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">0</span>  <span class="c1"># enabled</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-92"></a>        <span class="p">}</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-93"></a>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-94"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">api_call</span><span class="p">(</span><span class="s2">&quot;host.create&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">id_val</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-95"></a>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-96"></a>        <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="s1">&#39;result&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-97"></a>            <span class="n">host_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;hostids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-98"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ Created host </span><span class="si">{</span><span class="n">host_name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">host_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-99"></a>            <span class="n">hosts_created_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-100"></a>        <span class="k">elif</span> <span class="n">response</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-101"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Error creating </span><span class="si">{</span><span class="n">host_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-102"></a>            <span class="k">if</span> <span class="s2">&quot;already exists&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-103"></a>                <span class="k">break</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-104"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-105"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Unknown API error creating </span><span class="si">{</span><span class="n">host_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-106"></a>            <span class="k">break</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-107"></a>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-108"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Script Finished ---&quot;</span><span class="p">)</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-109"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Hosts Created: </span><span class="si">{</span><span class="n">hosts_created_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-111"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112" href="#ch03-zabbix-proxies-proxy-groups-__codelineno-0-112"></a>    <span class="n">create_hosts</span><span class="p">()</span>
</span></code></pre></div>
<p><img alt="Proxy_groups/ch03-proxy-groups.png" src="../ch03-zabbix-proxies/Proxy_groups/ch03-proxy-groups.png" />
<em>ch03 proxy groups</em></p>
<h2 id="ch03-zabbix-proxies-proxy-groups-troubleshooting-tips">Troubleshooting Tips</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Symptom</th>
<th style="text-align: left;">Possible Cause</th>
<th style="text-align: left;">Resolution</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Hosts remain on a failed proxy</strong></td>
<td style="text-align: left;">Proxy is still within the <strong>Failover period</strong> OR proxy group is <em>Offline</em>.</td>
<td style="text-align: left;"><strong>Reduce <code>Failover period</code></strong> in the group configuration. Ensure <code>Minimum number of proxies</code> is set correctly (e.g., $N-1$).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Load balancing does not occur</strong></td>
<td style="text-align: left;">Host difference is below the imbalance threshold (less than 10 hosts difference <strong>or</strong> less than $2\times$ average).</td>
<td style="text-align: left;">This is <strong>expected behavior</strong>. The imbalance must exceed the $10$ host and $2\times$ factor rules.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Proxy not receiving new configuration</strong></td>
<td style="text-align: left;">Proxy is running a version older than the Zabbix server.</td>
<td style="text-align: left;"><strong>Upgrade the proxy</strong> to match the Zabbix server's major version.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Active agents fail to report after failover</strong></td>
<td style="text-align: left;">Incorrect <strong><code>ServerActive</code></strong> setting OR firewall blocks the redirected proxy.</td>
<td style="text-align: left;">Ensure the agent can connect to <em>every</em> proxy IP address. Verify <code>ServerActive</code> includes all proxies or the Zabbix server IP.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SNMP devices not monitored</strong></td>
<td style="text-align: left;">Proxy group is being used for SNMP Traps.</td>
<td style="text-align: left;">Proxy groups <strong>do not support SNMP traps</strong>. Use a dedicated SNMP trap proxy.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-groups-questions">Questions</h2>
<ol>
<li><strong>What is the minimum Zabbix version required</strong> for both the proxy and agent to fully support Proxy Groups, including Active checks?</li>
<li>Describe the difference between the <strong>High Availability (HA) mechanism</strong> and the <strong>Load Balancing (LB) mechanism</strong> in Zabbix Proxy Groups. When does each occur?</li>
<li>What are the two specific conditions that must be met to trigger <strong>automatic host redistribution</strong> (Load Balancing) within a proxy group?</li>
<li>When configuring a Zabbix Agent for a host assigned to a proxy group, why must the <code>ServerActive</code> parameter list <strong>multiple proxy IPs</strong> or the Zabbix server IP?</li>
<li>What is the function of the <strong><code>Minimum number of proxies</code></strong> setting, and what happens when the number of online proxies drops below this value?</li>
<li>Why is it critical that external dependencies (like custom scripts or ODBC configurations) are <strong>identical</strong> across all proxies within the group?</li>
</ol>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-groups-conclusion">Conclusion</h2>
<p>Zabbix Proxy Groups significantly enhance the resilience and scalability of distributed monitoring environments. Through seamless failover and intelligent workload balancing, they allow enterprises to maintain consistent monitoring coverage even during proxy outages or uneven load distribution. When combined with proper agent configuration, firewall rules, and aligned proxy setups, proxy groups form a foundational component of modern Zabbix deployments.</p>
<hr />
<h2 id="ch03-zabbix-proxies-proxy-groups-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/distributed_monitoring">https://www.zabbix.com/documentation/current/en/manual/distributed_monitoring</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/distributed_monitoring/proxies/ha">https://www.zabbix.com/documentation/current/en/manual/distributed_monitoring/proxies/ha</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/concepts/proxy">https://www.zabbix.com/documentation/current/en/manual/concepts/proxy</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/zabbix_agent/config">https://www.zabbix.com/documentation/current/en/manual/config/items/zabbix_agent/config</a></li>
</ul></section><section class="print-page" id="ch03-zabbix-proxies-web-services" heading-number="8.6"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="web-services">Web services</h1>
<p>This chapter explains what the Zabbix Web service component is why you may need
or consider it, what the requirements are and finally how to install it..</p>
<hr />
<h2 id="ch03-zabbix-proxies-web-services-what-is-the-zabbix-web-service">What is the Zabbix web service?</h2>
<p>The Zabbix web service is an optional component that can be deployed on the same
server as the Zabbix server, proxy, frontend or on a separate server. The web service is responsible for handling certain tasks that require a headless browser.</p>
<p>Currently the Zabbix web service is primarily used for generating and sending
scheduled reports, but there are plans to expand its functionality in future
releases of Zabbix.</p>
<p>The actual usage of the Zabbix web service to generate reports is covered in the
<a href="#ch03-zabbix-proxies-ch11-zabbix-visualisation-scheduled-reports.md"><em>Scheduled reports</em></a> chapter.</p>
<p><img alt="zabbix-web-service-overview" src="../ch03-zabbix-proxies/web-services/ch03-web-services-component.png" /></p>
<p><em>3.1 Zabbix web
service overview</em></p>
<hr />
<h2 id="ch03-zabbix-proxies-web-services-zabbix-web-service-requirements">Zabbix web service requirements</h2>
<p>The Zabbix web service requires a linux-based operating system and a headless
Google Chrome or Chromium. </p>
<details class="note" open="open">
<summary>Google Chrome vs Chromium</summary>
<p>Both Google Chrome and Chromium are supported by the Zabbix web service.
However, Google Chrome is a proprietary browser developed by Google, while
Chromium is an open-source project that serves as the basis for Google Chrome.
Depending on your organization's policies and preferences, you may choose
one over the other.</p>
</details>
<div class="admonition warning">
<p class="admonition-title">Known Chromium issue on Ubuntu 20-based distributions</p>
<p>There is a known issue on Ubuntu 20 where Zabbix web service will be unable 
to start Chronium because the Ubuntu-packaged version of Chromium is not
allowed to use home directories outside of <code>/home</code>. However, by default, the
<code>zabbix</code>-user, configured by the Zabbix web service package, uses 
<code>/var/lib/zabbix</code> as its home directory, which causes Chromium to fail to
start on such distributions.</p>
</div>
<p>The system you choose to install the Zabbix web service on should meet the
requirements as outlined in the <a href="#ch00-getting-started-requirements"><em>Getting Started: Requirements</em></a>
chapter and should have sufficient resources to run a headless browser. 
The exact resource requirements will depend on the number of reports you plan to
generate and the complexity of those reports. As a general guideline, we 
recommend at least 2 CPU cores and 4 GB of RAM for a system that will be used to
generate reports for a small to medium-sized Zabbix installation.</p>
<p>Installing Google Chrome or Chromium on your system will pull in additional
dependencies, such as Qt libraries, audio/video codecs, OpenGL libraries, font
rendering libraries, and others. Depending on how you installed your linux
operating system, many of these dependencies are probably not yet installed on
your system. All together, these dependencies may require up to 1 Gb of additional
disk space on your system disk. </p>
<p>This may also be a reason to choose a separate system for the Zabbix web service
installation, especially if you are installing Zabbix server or proxy on a minimal
system and want to keep those systems clean and minimal.</p>
<p>Alternatively, you can also run the Zabbix web service as a container using Podman
or Docker, which includes a headless browser in the container image and keep
you host system clean of all those dependency packages. </p>
<hr />
<h2 id="ch03-zabbix-proxies-web-services-installing-the-zabbix-web-service">Installing the Zabbix web service</h2>
<p>The Zabbix web service can be installed using packages provided by Zabbix
or can be run as a container using Podman or Docker. We will cover both methods
in the chapter, starting with the package installation.</p>
<p>As with other Zabbix components, the Zabbix web service can be installed on the
same system as the Zabbix server, proxy or frontend, or on a separate system. 
If you choose to install it on a separate system, ensure that the system meets
the requirements as outlined in the <a href="#ch00-getting-started-requirements"><em>Getting Started: Requirements</em></a>.</p>
<hr />
<h3 id="ch03-zabbix-proxies-web-services-installing-the-zabbix-web-service-package">Installing the Zabbix web service package</h3>
<p>Before we can install the Zabbix web service package, we need to prepare the server for Zabbix installation as outlined in the <a href="#ch00-getting-started-preparation"><em>Preparing the server for Zabbix</em></a> chapters.</p>
<p>When the system is ready and know where to find the Zabbix software packages, we
can proceed with the installation of the Zabbix web service package. The package
is named <code>zabbix-web-service</code> and can be installed using the package manager of
your operating system.</p>
<div class="admonition info">
<p class="admonition-title">Install zabbix-web-service package</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch03-zabbix-proxies-web-services-__codelineno-0-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>zabbix-web-service
</span></code></pre></div></p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch03-zabbix-proxies-web-services-__codelineno-1-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>zabbix-web-service
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch03-zabbix-proxies-web-services-__codelineno-2-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>zabbix-web-service
</span></code></pre></div></p>
</div>
<p>As mentioned before, the Zabbix web service requires a headless Google Chrome or Chromium
browser to be installed on the system. If you do not have it installed already,
you can install it using the package manager of your operating system.</p>
<div class="admonition info">
<p class="admonition-title">Install Chromium browser</p>
<p>To be able to install Chromium on Red Hat-based systems, you may need to 
install and enable the <a href="https://docs.fedoraproject.org/en-US/epel/">EPEL repository</a> 
first. This is not required for Fedora.</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch03-zabbix-proxies-web-services-__codelineno-3-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>--enablerepo<span class="o">=</span>epel<span class="w"> </span>chromium
</span></code></pre></div></p>
<p>To be able to install Chromium on SLES-based systems, you may need to 
install and enable the <a href="https://packagehub.suse.com/">SUSE Package Hub</a>
repository first. This is not required for openSUSE.</p>
<p>SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch03-zabbix-proxies-web-services-__codelineno-4-1"></a>zypper<span class="w"> </span>install<span class="w"> </span>chromium
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch03-zabbix-proxies-web-services-__codelineno-5-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>chromium-browser
</span></code></pre></div></p>
</div>
<p>Alternatively, you can also install Google Chrome by downloading the package
from the <a href="https://www.google.com/chrome/">Google Chrome website</a> and installing
it using the package manager of your operating system.</p>
<h4 id="ch03-zabbix-proxies-web-services-configuring-the-zabbix-web-service">Configuring the Zabbix web service</h4>
<p>Now that the Zabbix web service package and a headless browser are installed, we
need to configure the Zabbix web service to allow Zabbix server to make requests
to the web service. This is done by editing the <code>/etc/zabbix/zabbix_web_service.conf</code> 
configuration file.</p>
<p>For now, the only configuration parameter that needs to be set is the <code>AllowedIP</code>
parameter, which defines the IP addresses that are allowed to connect to the
Zabbix web service. That is, if you have installed the web service on a separate
system than the Zabbix server or proxy:</p>
<div class="admonition info">
<p class="admonition-title">Edit zabbix_web_service.conf</p>
<p>SUSE only:
On SUSE 16 and later, the configuration file is installed at <code>/usr/etc/zabbix/zabbix_web_service.conf</code> and needs to be copied to <code>/etc/zabbix/</code> before editing:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch03-zabbix-proxies-web-services-__codelineno-6-1"></a>cp<span class="w"> </span>/usr/etc/zabbix/zabbix_web_service.conf<span class="w"> </span>/etc/zabbix/
</span></code></pre></div></p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch03-zabbix-proxies-web-services-__codelineno-7-1"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/zabbix/zabbix_web_service.conf
</span></code></pre></div>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch03-zabbix-proxies-web-services-__codelineno-8-1"></a><span class="na">AllowedIP</span><span class="o">=</span><span class="s">&lt;IP_ADDRESS_OF_ZABBIX_SERVER&gt;</span>
</span></code></pre></div></p>
</div>
<h4 id="ch03-zabbix-proxies-web-services-starting-the-zabbix-web-service">Starting the Zabbix web service</h4>
<p>Now that the Zabbix web service is installed and configured, we can start the
service using the SystemD service manager.</p>
<div class="admonition info">
<p class="admonition-title">Start Zabbix web service</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch03-zabbix-proxies-web-services-__codelineno-9-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>zabbix-web-service<span class="w"> </span>--now
</span></code></pre></div>
</div>
<p>After this, the Zabbix web service should be up and running and ready to accept
connections on port 10053 (by default) from the Zabbix server.</p>
<hr />
<h3 id="ch03-zabbix-proxies-web-services-installing-the-zabbix-web-service-as-a-container">Installing the Zabbix web service as a container</h3>
<p>The Zabbix web service can also be run as a container using Podman or Docker.
This method does not require a separate installation of a headless browser, as the
container image already includes one. This reduces the number of extra packages
you need to install on your system.</p>
<p>Before we can install and run the Zabbix web service container, we need to prepare
the system for running containers as outlined in the <a href="#ch00-getting-started-preparation-configure-podman-for-user-based-container-management"><em>Getting Started: Preparation</em></a>
chapter.</p>
<p>Once the system is ready for running containers, we can proceed with creating
a <code>.container</code> systemd unit file for the Zabbix web service container. This file
should be created in the <code>~/.config/containers/systemd/</code> directory of the user
<code>podman</code> (or whatever user you have chosen to run the containers as).</p>
<p>Ensure you are logged in as user <code>podman</code>.</p>
<div class="admonition info">
<p class="admonition-title">Switch to user podman</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch03-zabbix-proxies-web-services-__codelineno-10-1"></a>sudo<span class="w"> </span>-u<span class="w"> </span>podman<span class="w"> </span>-i
</span></code></pre></div>
</div>
<details class="example" open="open">
<summary>Creation of a .container systemd unit file</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch03-zabbix-proxies-web-services-__codelineno-11-1"></a>vi<span class="w"> </span>~/.config/containers/systemd/zabbix-web-service.container
</span></code></pre></div>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch03-zabbix-proxies-web-services-__codelineno-12-1"></a><span class="k">[Unit]</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ch03-zabbix-proxies-web-services-__codelineno-12-2"></a><span class="na">Description</span><span class="o">=</span><span class="s">Zabbix Web Service Container</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#ch03-zabbix-proxies-web-services-__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#ch03-zabbix-proxies-web-services-__codelineno-12-4"></a><span class="k">[Container]</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#ch03-zabbix-proxies-web-services-__codelineno-12-5"></a><span class="na">Image</span><span class="o">=</span><span class="s">docker.io/zabbix/zabbix-web-service:7.0-centos-latest</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#ch03-zabbix-proxies-web-services-__codelineno-12-6"></a><span class="na">ContainerName</span><span class="o">=</span><span class="s">ZabbixWebService-Quadlet</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#ch03-zabbix-proxies-web-services-__codelineno-12-7"></a><span class="na">AutoUpdate</span><span class="o">=</span><span class="s">registry</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#ch03-zabbix-proxies-web-services-__codelineno-12-8"></a><span class="na">EnvironmentFile</span><span class="o">=</span><span class="s">ZabbixWebService.env</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#ch03-zabbix-proxies-web-services-__codelineno-12-9"></a><span class="na">PublishPort</span><span class="o">=</span><span class="s">10053:10053</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#ch03-zabbix-proxies-web-services-__codelineno-12-10"></a>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#ch03-zabbix-proxies-web-services-__codelineno-12-11"></a><span class="k">[Service]</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#ch03-zabbix-proxies-web-services-__codelineno-12-12"></a><span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#ch03-zabbix-proxies-web-services-__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#ch03-zabbix-proxies-web-services-__codelineno-12-14"></a><span class="k">[Install]</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#ch03-zabbix-proxies-web-services-__codelineno-12-15"></a><span class="na">WantedBy</span><span class="o">=</span><span class="s">default.target</span>
</span></code></pre></div>
</details>
<p>The Zabbix web service container image is available on <a href="https://hub.docker.com/r/zabbix/zabbix-web-service">Docker Hub</a>.
Specifically, we are using the image tagged <code>7.0-centos-latest</code> in this example,
which is maintained by the Zabbix team and is based on CentOS.</p>
<p>Next, we need to create an environment file that will be used to configure the
Zabbix web service container. This file should be created in the same directory
as the <code>.container</code> unit file and should be named <code>ZabbixWebService.env</code>, as 
referenced in the unit file above.</p>
<p>This environment file allows us to override default container settings by specifying
environment variables used during container runtime. The list of supported variables
and their functions is clearly documented on the container's Docker Hub page.</p>
<details class="example" open="open">
<summary>Creation of the environment file</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch03-zabbix-proxies-web-services-__codelineno-13-1"></a>vi<span class="w"> </span>~/.config/containers/systemd/ZabbixWebService.env
</span></code></pre></div>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch03-zabbix-proxies-web-services-__codelineno-14-1"></a><span class="c1"># IP address or DNS name of the Zabbix server</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch03-zabbix-proxies-web-services-__codelineno-14-2"></a><span class="na">ZBX_ALLOWEDIP</span><span class="o">=</span><span class="s">&lt;IP_ADDRESS_OF_ZABBIX_SERVER&gt;</span>
</span></code></pre></div>
</details>
<p>With our configuration now complete, the final step is to reload the systemd user daemon
so it recognizes the new Quadlet unit. This can be done using the following command:</p>
<div class="admonition info">
<p class="admonition-title">Reload SystemD user daemon</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch03-zabbix-proxies-web-services-__codelineno-15-1"></a>systemctl<span class="w"> </span>--user<span class="w"> </span>daemon-reload
</span></code></pre></div>
</div>
<p>If everything is set up correctly, systemd will automatically generate a service
unit for the container based on the <code>.container</code> file. You can verify that the
unit has been registered by checking the output of <code>systemctl --user list-unit-files</code>:</p>
<details class="example" open="open">
<summary>Verify if the new unit is registered correctly</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch03-zabbix-proxies-web-services-__codelineno-16-1"></a><span class="go">podman@localhost:~&gt; systemctl --user list-unit-files | grep zabbix</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#ch03-zabbix-proxies-web-services-__codelineno-16-2"></a><span class="go">zabbix-web-service.service             generated -</span>
</span></code></pre></div>
</details>
<p>Now you can start the Zabbix web service container using the
<code>systemctl --user start</code> command.</p>
<div class="admonition info">
<p class="admonition-title">Start Zabbix web service container</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch03-zabbix-proxies-web-services-__codelineno-17-1"></a>systemctl<span class="w"> </span>--user<span class="w"> </span>start<span class="w"> </span>zabbix-web-service
</span></code></pre></div>
</div>
<p>After this, the Zabbix web service container should be up and running and ready
to accept connections on port 10053 (by default) from the Zabbix server.</p>
<p>This command may take a few minutes as it wil download the required Zabbix Web service
container from the docker registry.</p>
<p>To verify that the container started correctly, you can inspect the running containers
with:</p>
<details class="example" open="open">
<summary>Inspect running containers</summary>
<div class="language-shell-session highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch03-zabbix-proxies-web-services-__codelineno-18-1"></a><span class="go">podman@localhost:~&gt; podman ps</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ch03-zabbix-proxies-web-services-__codelineno-18-2"></a><span class="go">CONTAINER ID  IMAGE                                                   COMMAND               CREATED       STATUS       PORTS                     NAMES</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ch03-zabbix-proxies-web-services-__codelineno-18-3"></a><span class="go">bfedb5d16505  docker.io/zabbix/zabbix-web-service:7.0-centos-latest    /usr/sbin/zabbix_...  12 minutes ago  Up 12 minutes  0.0.0.0:10053-&gt;10053/tcp  ZabbixWebService-Quadlet</span>
</span></code></pre></div>
</details>
<p>Take note of the <code>CONTAINER ID</code>‚Äîin this example, it is <code>b5716f8f379d</code>. You can
then retrieve the container's logs using:</p>
<details class="info" open="open">
<summary>Retrieve container logs</summary>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch03-zabbix-proxies-web-services-__codelineno-19-1"></a>podman<span class="w"> </span>logs<span class="w"> </span>bfedb5d16505
</span></code></pre></div>
Where <code>bfedb5d16505</code> is the <code>CONTAINER ID</code> of your container</p>
<p>On some distributions, you can also view the logs directly through SystemD:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch03-zabbix-proxies-web-services-__codelineno-20-1"></a>journalctl<span class="w"> </span>--user<span class="w"> </span>-u<span class="w"> </span>zabbix-web-service.service
</span></code></pre></div></p>
</details>
<p>This command will return the startup and runtime logs for the container, which
are helpful for troubleshooting and verifying that the Zabbix web service has started
correctly.</p>
<details class="tip" open="open">
<summary>Upgrading the Zabbix web service container</summary>
<p>If, in the future, you need to update the Zabbix web service container to a newer
version, you can do so by pulling the latest image from Docker Hub and then
restarting the container. Refer to the <a href="#ch03-zabbix-proxies-proxies-as-container-upgrading-our-containers"><em>Running Proxies as containers</em></a>
chapter where we discuss updating containers in more detail including
a way to automate the process.</p>
</details>
<hr />
<h3 id="ch03-zabbix-proxies-web-services-firewall-configuration">Firewall configuration</h3>
<p>For the Zabbix server to communicate with the Zabbix web service, the firewall
on the system where the web service is installed must allow incoming connections
on the port used by the web service. By default, this is port <code>10053</code>. If you 
have changed the port in the Zabbix web service configuration, ensure that the
firewall allows incoming connections on the new port.</p>
<div class="admonition info">
<p class="admonition-title">Configure firewall for Zabbix web service</p>
<p>Red Hat / SUSE
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch03-zabbix-proxies-web-services-__codelineno-21-1"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--add-service<span class="o">=</span>zabbix-web-service<span class="w"> </span>--permanent
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#ch03-zabbix-proxies-web-services-__codelineno-21-2"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch03-zabbix-proxies-web-services-__codelineno-22-1"></a>sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">10053</span>/tcp
</span></code></pre></div></p>
</div>
<hr />
<h2 id="ch03-zabbix-proxies-web-services-zabbix-server-configuration">Zabbix server configuration</h2>
<p>Finally, we need to configure the Zabbix server to use the Zabbix web service
for generating scheduled reports. This is done by editing the Zabbix server
configuration. If you followed the instructions for using separate config files
in <code>/etc/zabbix/zabbix_server.d</code> in the <a href="#ch01-zabbix-components-zabbix-server"><em>Installing the Zabbix server</em></a> chapter, you can do this by
creating or editing the <code>/etc/zabbix/zabbix_server.d/web_service.conf</code> file.</p>
<div class="admonition info">
<p class="admonition-title">Edit zabbix_server.d/web_service.conf</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ch03-zabbix-proxies-web-services-__codelineno-23-1"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/zabbix/zabbix_server.d/web_service.conf
</span></code></pre></div>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ch03-zabbix-proxies-web-services-__codelineno-24-1"></a><span class="c1"># Number of report writers to start. Set to 1 or more depending on the</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#ch03-zabbix-proxies-web-services-__codelineno-24-2"></a><span class="c1"># expected load. Minimum is 1 to enable report writing functionality.</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#ch03-zabbix-proxies-web-services-__codelineno-24-3"></a><span class="na">StartReportWriters</span><span class="o">=</span><span class="s">1</span><span class="w"> </span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#ch03-zabbix-proxies-web-services-__codelineno-24-4"></a>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#ch03-zabbix-proxies-web-services-__codelineno-24-5"></a><span class="c1"># Zabbix web service IP address or DNS name</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#ch03-zabbix-proxies-web-services-__codelineno-24-6"></a><span class="na">WebServiceURL</span><span class="o">=</span><span class="s">http://&lt;ZABBIX_WEB_SERVICE_IP_OR_DNS&gt;:10053/report</span>
</span></code></pre></div>
</div>
<p>If you have SELinux enabled on your Zabbix server, you may also need to allow the
Zabbix server to make network connections for it to be able connect to the Zabbix
web service. This can be done using the following command:</p>
<div class="admonition info">
<p class="admonition-title">Allow Zabbix server to connect to Zabbix web service with SELinux</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ch03-zabbix-proxies-web-services-__codelineno-25-1"></a>sudo<span class="w"> </span>setsebool<span class="w"> </span>-P<span class="w"> </span><span class="nv">zabbix_can_network</span><span class="o">=</span><span class="m">1</span>
</span></code></pre></div>
</div>
<p>After making these changes, restart the Zabbix server to apply the new configuration.</p>
<div class="admonition info">
<p class="admonition-title">Restart Zabbix server</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ch03-zabbix-proxies-web-services-__codelineno-26-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>zabbix-server
</span></code></pre></div>
</div>
<p>Finally, you have to tell Zabbix where to find the Zabbix Frontend so that
it can generate the reports correctly. This is done in the Frontend itself
by navigating to </p>
<p><strong>Administration ‚Üí General ‚Üí Other</strong> </p>
<p>and setting the</p>
<ul>
<li><strong>Frontend URL</strong> parameter to the full URL of your Zabbix Frontend.</li>
</ul>
<p>With this, we have completed the installation and configuration of the Zabbix web service and integrated it with the Zabbix server. The Zabbix web service is now ready to generate scheduled reports as configured in the Zabbix server.</p>
<hr />
<h2 id="ch03-zabbix-proxies-web-services-conclusion">Conclusion</h2>
<p>This chapter has covered the installation and configuration of the Zabbix web service which is an essential component for generating scheduled reports
in Zabbix. Whether you choose to install it as a package or run it as a container,
we've learned how to set it up and ensure it is properly configured so that the Zabbix server can communicate with it. </p>
<hr />
<h2 id="ch03-zabbix-proxies-web-services-questions">Questions</h2>
<ul>
<li>What is the primary function of the Zabbix web service?</li>
<li>What are the system requirements for installing the Zabbix web service?</li>
<li>How do you configure the Zabbix web service to allow connections from the Zabbix server?</li>
<li>Should I choose to install the Zabbix web service as a package or run it as a container? Why?</li>
</ul>
<hr />
<h2 id="ch03-zabbix-proxies-web-services-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/concepts/web_service">https://www.zabbix.com/documentation/current/en/manual/concepts/web_service</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/appendix/install/web_service">https://www.zabbix.com/documentation/current/en/manual/appendix/install/web_service</a></li>
</ul></section></section>
                    <section class='print-page md-section' id='section-9' heading-number='9'>
                        <h1>Chapter 04 : Collecting data <a class='headerlink' href='#section-9' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch04-zabbix-collecting-data-chapter" heading-number="9.1"><h1 id="ch04-zabbix-collecting-data-chapter-collecting-data-with-your-zabbix-environment">Collecting data with your Zabbix environment</h1>
<p>In this chapter, we'll take a <strong>detailed journey through Zabbix data flow</strong>,
showing how to progress from an empty setup to a fully functioning system capable
of sending timely notifications. We‚Äôll break down each step, giving you a clear
understanding of how data moves through Zabbix.</p>
<p>We'll then explore the <strong>various protocols</strong> used in Zabbix, how they function,
their compatibility with different components, and how to configure them effectively.
This will provide you with a comprehensive overview of the communication backbone
that powers Zabbix monitoring capabilities.</p>
<p>Next, we'll cover the essentials like <strong>hosts, host groups, host interfaces</strong>,
and <strong>items</strong>, ensuring you understand their roles and how to set them up correctly. </p>
<p>For now, we'll hold off on <strong>custom scripts and external check items</strong>, focusing
instead on the core elements. When we touch on <strong>active agents</strong>, we'll reference
the chapter on auto-registration, guiding you to more detailed discussions on
that topic later.</p>
<p>By the end of this chapter, you'll have a strong grasp of Zabbix data flow and
the protocols that enable seamless monitoring and notifications, preparing you
for more advanced configurations and integrations.</p></section><section class="print-page" id="ch04-zabbix-collecting-data-dataflow" heading-number="9.2"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="dataflow">Dataflow</h1>
<p>The Zabbix dataflow is a concept that is meant to guide us through the various different
stages of building up our monitoring system. In the end, when building a Zabbix
environment we want to achieve a few things:</p>
<ul>
<li><strong>Collected metrics</strong> are stored, can be easily found and are visualised</li>
<li><strong>Problems</strong> are created from our data and shown in the frontend</li>
<li><strong>We take action</strong> on important problems by sending a message or executing commands</li>
</ul>
<p>Those three parts of the Zabbix dataflow in our Zabbix environment can be easily
identified as:</p>
<ul>
<li><strong>Items</strong> </li>
<li><strong>Triggers</strong></li>
<li><strong>Actions</strong></li>
</ul>
<p>But when we look at <code>Items</code> specifically, it's also possible to alter our data before
storing the metrics in Zabbix. This is something we do with a process called pre-processing,
which will take the collected data and change it before storing it in the Zabbix database.
Our dataflow in the end then looks as such:</p>
<p><img align="left" alt="Basic dataflow" src="../ch04-zabbix-collecting-data/datacollection/ch04.1-dataflow-basic.png" />
<em>4.1 Zabbix basic dataflow</em></p>
<p>This gives us a very basic understanding of what steps we have to go through in
Zabbix to get from data being collected to alerts being sent out. Very important
to us Zabbix administrators, as we need to go through these steps each time we want
to end up with a certain type of monitoring.</p>
<p>But, now that we have identified what parts to look at, let's dive a bit deeper
into what each of those parts does. Logically, that would start with <code>Items</code> looking
at the image above. But before we can start discussing <code>Items</code> there is another 
concept we need to understand.</p>
<h2 id="ch04-zabbix-collecting-data-dataflow-hosts">Hosts</h2>
<p>To create <code>Items</code> in Zabbix, we first need to create <code>Hosts</code>. A <code>host</code> is nothing
more than a container (not the Docker kind), it's something that contains <code>Items</code>,
<code>Triggers</code>, <code>graphs</code>, <code>Low Level Discovery</code> rules and <code>Web scenarios</code>. All of these
various different entities are contained within our <strong>Hosts</strong>.</p>
<p>Often times, Zabbix users and administrators make the misconception here that a
<em><code>host</code></em> always represents a physical or virtualised host. But in the end, hosts
are nothing more than a representation of a <code>monitoring target</code>. A monitoring
target is something we want to monitor. This can be a server in your datacenter,
a virtual machine on your hypervisor, a Docker container or even just a website.
Everything you want to monitor in Zabbix will need a host and the host will then
contain your monitoring configuration on its entities.</p>
<h2 id="ch04-zabbix-collecting-data-dataflow-items">Items</h2>
<p><code>Items</code> in Zabbix are Metrics. One <code>Item</code> is usually a single metric we'd like to
collect, with the exception being bulk metric collection which we will discuss
later on in the book. When we want to create our <code>Items</code> we can do this on a host
and we can actually create an unlimited amount of <code>Items</code> on a host.</p>
<h3 id="ch04-zabbix-collecting-data-dataflow-preprocessing">Preprocessing</h3>
<p>But we cannot stop there with <code>Items</code> just yet, as we also mentioned an additional
part of our dataflow. It is possible to change the collected metric on an item before
storing it into the Zabbix database. We do this with a process called preprocessing. </p>
<p>Preprocessing is something we add onto our items when creating the configuration
of such items. It is a part of the item, but not mandatory on every single item.</p>
<p>General rule:</p>
<ul>
<li>Collect metric and store as-is in the database? <strong>No preprocessing</strong></li>
<li>Collect metric and change before storing in the database? <strong>Add preprocessing</strong></li>
</ul>
<p>We will discuss this in more detail later on in the book as well.</p>
<h2 id="ch04-zabbix-collecting-data-dataflow-triggers">Triggers</h2>
<p>With all of the collected metrics, we can now also start to create triggers if we
would want to. A trigger is Zabbix is nothing more than a bit of configuration on
our host, which we will use to define thresholds using metrics collected on items. </p>
<p>A trigger can be setup to use the data collected on an item in a logical expression.
This logical expression will define the threshold and when data is received on the
item(s) used in the logical expression the trigger can go or stay in on of two states:</p>
<ul>
<li><strong>PROBLEM</strong>: When the logical expression is TRUE</li>
<li><strong>OK</strong>: When the logical expression is FALSE</li>
</ul>
<p>This is how we define if our data is in a good or a bad state.</p>
<h3 id="ch04-zabbix-collecting-data-dataflow-events">Events</h3>
<p>When we discuss triggers however, we cannot skip past the Events. Whenever a trigger
changes state, for example it was in OK state and goes into the PROBLEM state, then
Zabbix will create a new Event. There's three types of these events created by our
triggers:</p>
<ul>
<li><strong>Problem event</strong>: When the trigger goes from OK to PROBLEM</li>
<li><strong>Problem resolution event</strong>: When the trigger goes from PROBLEM to OK</li>
<li><strong>Problem update event</strong>: When someone manually updates a problem</li>
</ul>
<p>These problem events are what you will see in the frontend when you navigate to
<code>Monitoring</code> | <code>Problems</code>, but they are also very important in the next step in
the Zabbix dataflow <code>Actions</code>.</p>
<h2 id="ch04-zabbix-collecting-data-dataflow-actions">Actions</h2>
<p>Actions are the last step in our Zabbix dataflow and they are kind of split into
two parts. An action consists of <code>Conditions</code> and <code>Operations</code>. This is going to
be important in making sure the action executes on the right time (conditions)
and executes the right activity (operations). </p>
<p>What happens is, whenever a problem event in Zabbix is created it is sent to every
single problem action in our Zabbix environment. All of these action will then
check the event details like what host did it come from, with which severity, when
did it start, which tags are present. These event details are then checked against
the action conditions and only when the conditions match will the operations be executed.
The operation can then be something like, send a message to Microsoft Teams or
Telegram. But an operation could also be, execute the reboot command on this host.</p>
<p>As you can imagine, the conditions will be very important to make sure that operation
on that action are only executed when we specifically want it to. We do not want to
for example reboot a host without the right problem being first detected.</p>
<h2 id="ch04-zabbix-collecting-data-dataflow-conclusion">Conclusion</h2>
<p>To summarize, all the steps in the dataflow work together to make sure that you can
build the perfect Zabbix environment. When we put the entire dataflow together it
looks like the image below.</p>
<p><img align="left" alt="Detailed dataflow" src="../ch04-zabbix-collecting-data/datacollection/ch04.2-dataflow-detailed.png" />
<em>4.2 Zabbix detailed dataflow</em></p>
<p>Here we can see the various steps coming together.</p>
<ul>
<li>We have our <code>Hosts</code> container our <code>Items</code> and <code>Triggers</code>. </li>
<li>Our <code>Items</code> are collecting metrics</li>
<li>The <code>Triggers</code> are using data from <code>Items</code> to detected problems and create problem <code>Events</code>.</li>
<li>If a problem <code>Event</code> matches the <em>Conditions</em> on an <code>Action</code> the <em>Operations</em> can be executed</li>
</ul>
<p>Important to note here is that if an item is collecting metrics, it doesn't necessarily
need to have a trigger attached to it. The trigger expression is a separate configuration
where we can choose which items we want to define thresholds on. In the end, not
ever item needs to start creating problems. We can also see that we can use several
items or event several items from different hosts in a single trigger.</p>
<p>The same is the case for our events. Not every event will match the conditions on
an action. In practice, this means that some problems will only show up in your
Zabbix frontend, while other might go on to send you an alert message or even execute
commands or scripts. A single event can also match the conditions on multiple actions,
since we mentioned that all events are always send to all action for evaluation.
This can be useful, for example if you want to split you messaging and your script
execution in different action to keep things organised.</p>
<p>Now that we understand the various parts of our Zabbix dataflow we can dive deeper into creating the configuration for the steps in the dataflow.</p>
<h2 id="ch04-zabbix-collecting-data-dataflow-questions">Questions</h2>
<h2 id="ch04-zabbix-collecting-data-dataflow-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch04-zabbix-collecting-data-hosts" heading-number="9.3"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="hosts">Hosts</h1>
<p>After reading the previous dataflow section, it is now clear we have to go through the 
dataflow steps to get from collecting data to sending out alerts. 
The first part of the dataflow is to create a host, so that is what we are now going to tackle
in this part.</p>
<h2 id="ch04-zabbix-collecting-data-hosts-creating-a-host">Creating a host</h2>
<p>As we mentioned, Hosts in Zabbix are nothing more than a container (not the Docker kind).
They contain our <code>Items</code>, <code>Triggers</code>, <code>graphs</code>, <code>Low Level Discovery</code> rules and <code>Web scenarios</code>.  </p>
<p>At this point, we should create our first monitoring host in Zabbix. Navigate to <code>Data collection</code> | <code>Hosts</code> 
and in the top right corner click on the <code>Create host</code> button. This will open up the following modal window:</p>
<p><img align="left" alt="Host creation empty" src="../ch04-zabbix-collecting-data/datacollection/ch04.3-empty-host-creation.png" />
<em>4.3 Empty host creation window</em></p>
<p>There are a lot of fields we can fill in, but few are important to note here specifically. </p>
<ul>
<li><strong>Host name</strong> </li>
<li><strong>Host groups</strong></li>
</ul>
<p>These are the only two mandatory fields in the host creation window. If we fill these two, 
we can create our host. </p>
<h3 id="ch04-zabbix-collecting-data-hosts-host-name">Host name</h3>
<p>The <code>Host name</code> is very important. It functions as both the technical name of the host we will
use in various different locations, but it is also used as the <code>Visible name</code> by default. This 
means that we will work with this name to find through filters this host with its associated data.</p>
<p>Make sure to select a host name that is short and descriptive. For example:</p>
<ul>
<li>linux-srv01-prd</li>
<li>www.thezabbixbook.com</li>
<li>docker-container-42</li>
<li>db-srv10 - Website database</li>
</ul>
<p>The best practise is to keep the host name the same in Zabbix as it is configured on your
monitoring target. The monitoring target, being whatever you are trying to monitor. 
Whether that is a physical or virtual server, a website, a database server or 
a specific database on that database server. Every host in Zabbix is a monitoring target, 
i.e. something you are trying to monitor.</p>
<h3 id="ch04-zabbix-collecting-data-hosts-visible-name">Visible name</h3>
<p>Now, we didn't mention it as it is not a mandatory field. Nevertheless, we need to discuss
the <code>Visible name</code> field before we continue with the <code>Host groups</code>. Although not mandatory,
as I mentioned, the <code>Host name</code> is automatically used as the visible name when not filled in.</p>
<p>Many of us see a form style list and have the need to fill out everything there is to fill out. This
should not be the case with forms like the host creation window in Zabbix. We are only trying to
fill out everything we should be configuring. As such, since the visible name is not mandatory, I 
do not fill it out. Unless, there is an actual need to use the field. </p>
<p>The visible name was added in Zabbix as the host name and visible name fields in Zabbix use
different character encoding in the Zabbix database. </p>
<p><code>Host name</code> = <code>UTF8</code> and supports alphanumeric, dashes, underscores and spaces (not leading or trailing).
<code>Visible name</code> = <code>UTF8_MB4</code> and supports special characters like <code>√ß</code> and even emojis like <code>üëÄ</code>.</p>
<p>This is the main difference. When you want to use a local language for example you could do:</p>
<p><code>Host name</code> = <code>sherbimi-central</code>
<code>Visible name</code> = <code>sh√´rbimi-√ßentral</code></p>
<p>That way you keep your local language in the frontend, but the technical name doesn't include the 
special character. Keep in mind however, that this can create confusion. You now need to remember
two different names for the same host. As such, visible names are only recommended when you really need
them or if you are trying to work around something. Otherwise, there is not need to use them.</p>
<h3 id="ch04-zabbix-collecting-data-hosts-host-groups">Host groups</h3>
<p>In Chapter 02 of the book, we had a deep dive into setting up various different host groups to keep
our Zabbix environment structured. When we create a host, we can now start using on of
our created host groups. Keep in mind, to only add the host to the lowest level of the subgroups. For
example when we have <code>Servers</code> and <code>Servers/Linux</code>, we will only add our host to <code>Servers/Linux</code>.</p>
<p>It's also possible to create a host straight from the host creation window. To do so,
simply start typing the host group name into the <code>Host groups</code> field and it will ask you if
you want to create the host group.</p>
<p><img align="center" alt="Host creation - new host group" src="../ch04-zabbix-collecting-data/datacollection/ch04.4-host-creation-new-group.png" /></p>
<p><em>4.4 Host creation - new host group</em></p>
<p>Let's add the host <code>simple-checks</code> in the <code>Linux/Servers</code> host group.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>It's recommended to read the simple checks recipe from here, as it 
contains useful tips on creating good items.</p>
</details>
<h2 id="ch04-zabbix-collecting-data-hosts-conclusion">Conclusion</h2>
<h2 id="ch04-zabbix-collecting-data-hosts-questions">Questions</h2>
<h2 id="ch04-zabbix-collecting-data-hosts-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch04-zabbix-collecting-data-simple-checks" heading-number="9.4"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="simple-checks">Simple checks</h1>
<p>What would a Zabbix book be without setting up the actual monitoring itself, because in 
the end a monitoring system is all about collecting data through various different protocols. </p>
<p>Simple checks are one (or actually several) of such protocols. Zabbix has a bunch of built-in 
checks we can do, executed from the Zabbix server or proxy towards our monitoring targets. The simple 
checks contain protocol checks such as <code>ICMP Ping</code>, <code>TCP/UDP</code> but also built in <code>VMware</code> monitoring.</p>
<p>Without further ado, let's set up our first items. Please keep in mind that we will be building
everything on a host level for now. Check out Chapter 06 to learn how to do this properly on a template.</p>
<h2 id="ch04-zabbix-collecting-data-simple-checks-building-the-item">Building the item</h2>
<p>We shall start with a simple ICMP Ping check. If you haven't already, at <code>Data collection</code> | <code>Hosts</code>
let's create the host <code>simple-checks</code> in the host group <code>Servers/Linux</code>. Then, for this
new host navigate to <code>Items</code>. You should see a <code>Create item</code> button in the top right corner. Click
on this button and lets have a look at the item creation modal popup window:</p>
<p><img align="left" alt="Empty Item creation" src="../ch04-zabbix-collecting-data/datacollection/ch04.5-empty-item-creation.png" /></p>
<p><em>4.5 Empty Item creation window</em></p>
<p>Make sure to change the <code>Type</code> to <code>Simple check</code> to get a similar result. We can see there are
only two fields (that aren't selectors) mandatory. These, we have to fill in to make our
item work.</p>
<ul>
<li><strong>Name</strong> </li>
<li><strong>Key</strong></li>
</ul>
<h3 id="ch04-zabbix-collecting-data-simple-checks-item-name">Item Name</h3>
<p>The <code>Item name</code> in Zabbix is a very important field for all of our items. This is going
to be the first thing you see when looking for you configuration, but also the main identifier
when you'll search the visualisation pages (like <code>Latest data</code>) for this item. </p>
<p>Item names do not have to be unique (although it is recommended), as it will be
the <code>Item key</code> that will make sure this item is distinguishable as a unique entity. So what is
the best practise here? </p>
<ul>
<li><strong>Item names should be short and descriptive</strong></li>
<li><strong>Item names should contain prefixes where useful</strong></li>
<li><strong>Item names should contain suffixes where useful</strong></li>
</ul>
<p>Some examples of good item names:
- Use <code>Memory utilization</code> not <code>The memory util of this host</code>. Keep it short and descriptive
- Use <code>CPU load</code> or if you have multiple use a suffix <code>CPU load 1m</code> and
<code>CPU load 5m</code> for example
- Use prefixes like <code>Interface eth0: Bits incoming</code> and
<code>Interface eth1: Bits incoming</code> for similar items on different entities</p>
<p>Using those techniques, we can create items that are easy to find and most importantly that
your Zabbix users will want to read. After all, you can count on IT engineers to not read well,
especially in a troubleshooting while everything is down scenario. Keeping things simple will
also make sure your monitoring system will be a pleasure to be used or at least people won't
avoid using your monitoring.</p>
<p>My final and favourite tip is: <strong>Remember: Zabbix uses alphabetical sorting in a lot of places</strong>. Why
is this important, well let's look at the <code>Monitoring</code> | <code>Latest data</code> page with a host using a 
default template:</p>
<p><img align="center" alt="MEM-CPU sorting" src="../ch04-zabbix-collecting-data/datacollection/ch04.6-latest-data-memcpu-sorting.png" />
<em>4.6 Latest data Memory and CPU items sorting</em></p>
<p>If this template had used CPU and Memory as a prefix for all respective items. Then this page
would have nicely sorted them together. While right now, there are CPU items right between the
memory related items. It creates a bit of a mess, making Zabbix harder to read. </p>
<p>If you want to spend (waste?) 30 minutes of your time hearing all about sorting data in various
different places in Zabbix. The following video is highly recommended: https://www.youtube.com/watch?v=5etxbNPrygU</p>
<h3 id="ch04-zabbix-collecting-data-simple-checks-item-key">Item Key</h3>
<p>Next up is the item key, an important part of setting up your Zabbix item as it will serve as
the uniqueness criteria for the creation of this entity. There are two types of item keys:</p>
<ul>
<li><strong>Built in</strong></li>
<li><strong>User defined</strong></li>
</ul>
<p>The built in item keys is what we will use to create our simple check in a while. The user defined
item key is what we will use on items types like <code>SNMP</code> and <code>Script</code>. The main difference is that
built in item keys are defined by Zabbix and attach to a specific monitoring function. The user defined
item keys are just there to serve as the uniqueness criteria, while a different field in the item form
will determine the monitoring function.</p>
<p>Item keys can also be of a <code>Flexible</code> or <code>Non-flexible</code> kind. Flexible meaning the item key accepts
parameters. These parameters change the function of the built-in item keys and also count as part
of the uniqueness of the item keys. For example:</p>
<ul>
<li><strong>agent.version</strong> a <code>Zabbix agent</code> item key doesn't accept parameters and only serves one purpose. To
get the version of the Zabbix agent installed.</li>
<li><strong>net.tcp.service[service,<ip>,<port>]</strong> a <code>Simple check</code> item key that accepts 3 parameters,
each parameter divided by a comma(<code>,</code>). Optional parameters are marked by the <code>&lt;&gt;</code> signs, whereas
mandatory parameters have no pre/suffix.</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-simple-checks-icmp-ping">ICMP Ping</h3>
<p>With all of this in mind, let's finish the creation our ICMP Ping item. First, we will give our
new item a name. Since this is a simple ICMP Ping to the host lets go for:</p>
<ul>
<li><strong>Name</strong> = <code>ICMP Ping</code></li>
</ul>
<p>For the key, we will have to use the built-in key
<code>icmpping[&lt;target&gt;,&lt;packets&gt;,&lt;interval&gt;,&lt;size&gt;,&lt;timeout&gt;,&lt;options&gt;]</code>. This key accepts 6 parameters, all
of which are optional. However, when we do not select an interface on an <code>icmpping</code> item, we
need to fill in at least <code>icmpping[&lt;target&gt;]</code> for it to work. Normally <code>icmpping</code> can use the interface
IP or DNS, but since we will discuss the <code>Host interfaces</code> later in this chapter, let's use
the parameter instead.</p>
<ul>
<li><strong>Key</strong> = <code>icmpping[127.0.0.1]</code></li>
</ul>
<p>The item will now look like this:</p>
<p><img align="center" alt="ICMP Ping item" src="../ch04-zabbix-collecting-data/datacollection/ch04.7-icmpping-item.png" />
<em>4.7 ICMP Ping item</em></p>
<p>It's also best practise to add a tag with the name <code>component</code> to every item we create. Let's switch
to the <code>Tags</code> tab on the item creation window, and create the tag <code>component:system</code>.</p>
<p><img align="center" alt="ICMP Ping item tags" src="../ch04-zabbix-collecting-data/datacollection/ch04.8-icmpping-item-tags.png" />
<em>4.8 ICMP Ping item tags</em></p>
<p>Zabbix utilises the fping utility, installed on the Zabbix server and/or proxy, to execute
ICMP Ping checks. By default, Zabbix adds a repository containing the tool and installs
the dependency. If you have a slightly different setup, make sure this utility is installed
on your system and that the following two parameters are configured in the
Zabbix server/proxy configuration file:</p>
<p>!!! Define Fping paths"</p>
<div class="language-text highlight"><pre><span></span><code>```
FpingLocation=/usr/sbin/fping

Fping6Location=/usr/sbin/fping6
```
</code></pre></div>
<h2 id="ch04-zabbix-collecting-data-simple-checks-tcpudp-ports">TCP/UDP Ports</h2>
<p>Another useful simple check you can create is the TCP (and UDP) port check. With these 4 item keys 
we can monitor the availability and performance of TCP and UDP ports. There are 4 built-in keys
available for these checks:</p>
<ul>
<li><strong>net.tcp.service[service,<ip>,<port>]</strong></li>
<li><strong>net.tcp.service.perf[service,<ip>,<port>]</strong></li>
<li><strong>net.udp.service[service,<ip>,<port>]</strong></li>
<li><strong>net.udp.service.perf[service,<ip>,<port>]</strong></li>
</ul>
<p>Granted, the <code>net.udp.service</code> item keys only monitor the availability and performance of the NTP
protocol due to the "take it our leave it" nature of UDP. But, the <code>net.tcp.service</code> item keys are
useful for monitoring every single TCP port available.</p>
<p>We fill in the <code>service</code> parameter with <code>tcp</code> and the we use <code>ip</code> (or a host interface)
and <code>port</code> to define which TCP port to check. Zabbix will connect to the port and
tell us the up/down status or the connection speed if we use <code>net.tcp.service.perf</code>.
If we fill in the <code>service</code> parameter with <code>ssh, ldap, smtp, ftp, pop, nntp, imap,
tcp, https, telnet</code> it will use the correct (default) port automatically, as well
as do an additional check to make sure the port is actually being used by that
service.</p>
<h2 id="ch04-zabbix-collecting-data-simple-checks-conclusion">Conclusion</h2>
<p>The simple checks are mainly used for ICMP ping and Port checks, which means they
are quite useful for almost every host. It's always a good idea to do some basic
network availability checks on your hosts.</p>
<p>Keep in mind that Zabbix will apply alphabetical sorting in many places when you
create things like items. Keeping things structured in your environment means that
you and your colleagues will have an easier time using your monitoring and
observability platform.</p>
<h2 id="ch04-zabbix-collecting-data-simple-checks-questions">Questions</h2>
<h2 id="ch04-zabbix-collecting-data-simple-checks-useful-urls">Useful URLs</h2>
<p><a href="https://www.youtube.com/watch?v=5etxbNPrygU">https://www.youtube.com/watch?v=5etxbNPrygU</a></p></section><section class="print-page" id="ch04-zabbix-collecting-data-host-interfaces" heading-number="9.5"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="host-interfaces">Host Interfaces</h1>
<p>When we create a host in Zabbix, we have the option to create <code>Host interfaces</code>.
You might have noticed this in the previous chapter already when you created a
host or when you added the simple check.</p>
<p>Host interfaces in Zabbix are used to define a remote monitoring target. We define
the <code>IP address</code> or <code>DNS name</code> as well as the <code>Port</code> that we want our Zabbix server
(or proxy) to connect to when collecting our monitoring information. There are
three types of interfaces.</p>
<ul>
<li><strong>Agent (or ZBX)</strong> </li>
<li><strong>SNMP</strong></li>
<li><strong>JMX</strong></li>
<li><strong>IPMI</strong></li>
</ul>
<p>These interface types are tied directly to the items types. Meaning that when you
want to monitoring the Zabbix agent (passive) you will need a ZBX (agent) type
interface. If you do not have the correct interface, you will not be able to add
the items for monitoring. </p>
<ul>
<li><strong>Agent (or ZBX)</strong> is used by <strong>Zabbix agent</strong> items</li>
<li><strong>SNMP</strong> is used by <strong>SNMP agent</strong> and <strong>SNMP trap</strong> items</li>
<li><strong>JMX</strong> is used by <strong>JMX agent</strong> items</li>
<li><strong>IPMI</strong> is used by <strong>IPMI agent</strong> items</li>
</ul>
<p>Besides these matches, there are also various items like the <code>Simple check</code> items
that can use all four interface types. These items will then only use the interface
IP or DNS to connect to the remote monitoring target.</p>
<h3 id="ch04-zabbix-collecting-data-host-interfaces-agentzbx-and-jmx">Agent/ZBX and JMX</h3>
<p>The Zabbix agent type interface and JMX interface work quite similarly. Both
interface types allow us to define four things. </p>
<p><img align="center" alt="Agent and JMX type interfaces" src="../ch04-zabbix-collecting-data/datacollection/ch04.9-agent-jmx-interfaces.png" />
<em>4.9 Agent and JMX type interfaces</em></p>
<ul>
<li><strong>IP address</strong> </li>
<li><strong>DNS name</strong></li>
<li><strong>Connect to (IP or DNS)</strong></li>
<li><strong>Port</strong></li>
</ul>
<p>It's important to take note of the <code>Connect to</code> field here. It indicates whether
we will use the <code>IP address</code> or <code>DNS name</code> field configured for this interface.
Within Zabbix interfaces it is only possible to use one at the time. That means
there is no failover if DNS starts to fail and as such when using DNS your monitoring
will be dependent on your DNS servers.</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>The question often asked at this point is "Should I use DNS or IP". The choice
in the end is up to the Zabbix administrator, but a simple rule we always
follow is:</p>
<p>If it's static use IP, as your monitoring will keep working even if DNS is
down. If it's dynamic, use DNS as you will save yourself the administrative
overhead.</p>
</details>
<h3 id="ch04-zabbix-collecting-data-host-interfaces-snmp">SNMP</h3>
<p>The SNMP interface has the most options of all four interface types. The reason
for this is because the SNMP type interface allows us to specify the SNMP details
like version, community and credentials.</p>
<p><img align="center" alt="SNMPv2 interface" src="../ch04-zabbix-collecting-data/datacollection/ch04.10-snmpv2-interface.png" />
<em>4.10 SNMPv2 interface</em></p>
<p>When selecting the <code>SNMP version</code> as either <code>SNMPv1</code> or <code>SNMPv2</code>, we are shown
the <code>SNMP community</code> field. <code>SNMPv1</code> and <code>SNMPv2</code> both use unauthenticated and
unencrypted connections by using a plain text <code>SNMP community</code> to initiate a connection
to the SNMP monitoring target like a switch or a router. This `SNMP community is
sent over the network in plain text and as such it can not be seen as fully secure
authentication.</p>
<p>All three SNMP versions will also show the <code>Use combined requests</code> checkbox.
When selected, Zabbix will group multiple SNMP items into a single request to
improve performance. For some older SNMP devices this can cause some issues and
in those cases it might be needed to turn the checkbox off.</p>
<p>Additionally when selecting <code>SNMPv2</code> or <code>SNMPv3</code> we are also presented with the
<code>Max repetition count</code>. When Zabbix uses <code>GETBULK</code> requests it will retrieve multiple
values per OID base in a single call. This option is used to reduce SNMP traffic
overhead when using the <code>walk[]</code> SNMP agent item key. </p>
<p><img align="center" alt="SNMPv3 interface" src="../ch04-zabbix-collecting-data/datacollection/ch04.11-snmpv3-interface.png" />
<em>4.11 SNMPv3 interface</em></p>
<p>For <code>SNMPv3</code> many additional fields will be available for configuration. </p>
<ul>
<li><strong>Context name</strong> Used to define a context, for example when connecting to a
  single device split up in multiple virtual devices (like a virtual router)</li>
<li><strong>Security name</strong> The username we will use when authenticating to our SNMP monitoring
  target</li>
<li><strong>Security level</strong> noAuthNoPriv, AuthNoPriv, AuthPriv. We can choose to do SNMPv3
  without authentication and data encryption, with authentication and without data
  encryption or with both authentication and data encryption.</li>
<li><strong>Authentication protocol</strong> MD5, SHA1, SHA224, SHA256, SHA384, SHA512. The encryption
  strength for our authentication.</li>
<li><strong>Authentication passphrase</strong> The password for authentication.</li>
<li><strong>Privacy protocol</strong> DES, AES128, AES192, AES256, AES192C, AES256C. The encryption
  strength for our data encryption.</li>
<li><strong>Privacy passphrase</strong> The password for data encryption.</li>
</ul>
<p>With <code>SNMPv3</code> it is important to keep security in mind. <code>SNMPv1</code> and <code>SNMPv2</code> should
be considered obsolete at this point, providing potential bad actors with access
to important information or worse write access to devices without authentication.
<code>SNMPv3</code> with authentication and data encryption is as such always recommended.
It's up to the Zabbix administrator to determine what the monitoring target supports,
but higher security is better in this case. </p>
<p>noAuthNoPriv utilizes the <code>SNMPv3</code> protocol without authenticating and encrypting the data. 
AuthNoPriv uses encrypted authentication, but sends monitoring data plain text over the network
AuthPriv is the recommended method for high security, as it uses encrypted authentication and also sends monitoring data encrypted over the network. </p>
<p>When using <code>SNMPv3</code> it is also best practice to use a strong authentication protocol. MD5 and DES are both no longer recommended due to the possibility to brute force the passwords with consumer grade hardware amongst other risks. That's why SHA1 and AES128 or higher is always recommended. </p>
<h3 id="ch04-zabbix-collecting-data-host-interfaces-ipmi">IPMI</h3>
<p>For <code>IPMI agent</code> type items we want to add the <code>IPMI</code> type interface. We can use it to connect to <code>BMC's (Baseboard Management Controller)</code> like <code>iDRAC</code> and <code>iLo</code>. This interface is slightly different again from the previous three interfaces.</p>
<p><img align="center" alt="IPMI interface" src="../ch04-zabbix-collecting-data/datacollection/ch04.12-ipmi-interface.png" />
<em>4.12 IPMI interface</em></p>
<p>We have the same settings for <code>IP</code>, <code>DNS</code> and <code>Port</code> again, but in the case of IPMI we do not define credentials on the interface level. Instead these are provided on a different tab on the host configuration settings.</p>
<p><img align="center" alt="IPMI host settings" src="../ch04-zabbix-collecting-data/datacollection/ch04.13-ipmi-settings.png" />
<em>4.13 IPMI host settings</em></p>
<p>For a host in Zabbix we can only define one IPMI use for authentication, regardless of the amount of interfaces we add. </p>
<ul>
<li><strong>Authentication algorithm</strong> None, MD2, MD5, Straight, OEM, RMCP+. Determines the encryption strength.</li>
<li><strong>Privilege level</strong> Callback, User, Operator, Admin, OEM. Determines the privilege level our user should be allowed to connect with.</li>
<li><strong>Username</strong> The username to authenticate with.</li>
<li><strong>Password</strong> The password to authenticate with.</li>
</ul>
<p>Once again, for security purposes <code>MD2</code> and <code>MD5</code> are not recommended. As well as <code>Straight</code> which is plain text unencrypted and <code>OEM</code> which is vendor specific. If possible, try to use <code>RMCP+</code>, which in most cases is the most secure.</p>
<p>For the <code>Privilege level</code> it is recommended to use either <code>Callback</code> or <code>User</code> in most scenarios. <code>Callback</code> will allow us to access alerts, <code>User</code> will also allow us to access monitoring data. If need higher privilege levels to execute commands on the <code>BMC</code> as well, this is possible. But keep in mind, write access from your monitoring system comes with additional security risks.</p>
<h2 id="ch04-zabbix-collecting-data-host-interfaces-interface-availability">Interface availability</h2>
<p>All four interface types, also come with an icon that can turn <span style="color: green;">Green</span>, <span style="color: orange;">Orange</span>, <span style="color: red;">Red</span> or <span style="color: grey;">Grey</span>. This color determines the interface its availability.</p>
<p>...
...
...</p>
<h2 id="ch04-zabbix-collecting-data-host-interfaces-conclusion">Conclusion</h2>
<p>When configuring your host interfaces in Zabbix, we need to match our <code>Item type</code> to our <code>Interface type</code>. When we have the correct <code>Host interface</code> configured we will be able to add the corresponding <code>Items</code> on our  host to collect data. Upon successful data collection, the interface availability icon will also turn <code>Green</code>.</p>
<p>Some item types like the <code>Simple check</code> also have the possibility to use host interfaces, but do not need them. These items, although they use the interface, do not have an affect on interface availability and the availability icon.</p>
<p>When configuring host interfaces with security settings, keep in mind to use the most secure option that your monitoring target supports. This will make sure your Zabbix environment is more secure, even if a bad actor would be present on your network somehow.</p>
<h2 id="ch04-zabbix-collecting-data-host-interfaces-questions">Questions</h2>
<h2 id="ch04-zabbix-collecting-data-host-interfaces-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch04-zabbix-collecting-data-zabbix-agent-passive" heading-number="9.6"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="zabbix-agent-installation-and-passive-monitoring">Zabbix Agent installation and Passive monitoring</h1>
<p>At this point we are familiar with the Zabbix dataflow, how to create hosts and,
add interfaces and items to a host. As a system administrator or anyone else working
with Linux, Unix or Windows systems usually we jump right into installing the Zabbix
agent and monitoring with it. Using our previous steps however, we have laid the
groundwork for building a proper monitoring solution. We have prepared our systems
before monitoring, which is the most important part to avoid <code>Monitoring fatigue</code>
later on.</p>
<details class="note" open="open">
<summary>Note</summary>
<p><code>Monitoring fatigue</code> and <code>Alert fatigue</code> are two terms heard in monitoring and observability.</p>
<p><code>Alert fatigue</code> happens in Zabbix when you configure too many (incorrect) triggers. When you flood your dashboards or even external media like Teams or Signal with too many alerts your users will not respond to them any longer.</p>
<p><code>Monitoring fatigue</code> happens in Zabbix when you misconfigure things like dashboards, items, host groups, tags and other internal systems that keep things structured. The result is that you or your co-workers do not want to use your own system any longer as it does not deliver the right information easily enough.</p>
</details>
<p>Now, we are ready to start monitoring an actual system.</p>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-passive-agent-basics">Agent basics</h2>
<p>We have prepared an example setup in our Book LAB environment.</p>
<p><img align="center" alt="Zabbix Agent passive hosts" src="../ch04-zabbix-collecting-data/datacollection/ch04.14-windows-linux-agent.png" /></p>
<p><em>4.14 Zabbix Agent passive hosts</em></p>
<p>What we can see here is a setup you might see in any datacenter or office server
cabinet. We have a Zabbix server monitoring one Windows server and one Linux server
directly (or through a proxy). We call Zabbix a network monitoring solution as it
communicates over the network. In Zabbix we have two methods of communication.</p>
<ul>
<li><strong>Passive</strong> Otherwise known as <code>polling</code>. We communicate from the Zabbix server
  (or proxy) towards the monitoring target. The monitoring target is listening
  on a port waiting for Zabbix to request data.</li>
<li><strong>Active</strong> Otherwise known as <code>trapping</code>. We communicate from the monitoring
  target towards the Zabbix server (or proxy). The Zabbix server is listening
  on a port waiting for the monitoring target to send data.</li>
</ul>
<p>As you can imagine there is quite a big difference between these two methods of communication. Often times it depends on the protocol which method is preferred. For example SNMP traps are always an active type of check.</p>
<p>The Zabbix agent however can communicate in either <code>Active</code> or <code>Passive</code> mode. It can even do those simultaneously. Simultaneous communication can be useful when you want to use <code>Passive</code> mode for all communication, but still want to execute some items that are <code>Active</code> only. <code>Active</code> items can do everything <code>Passive</code> items can do however.</p>
<p>Before we can configure either though, we will have to install our Zabbix agent
first. When installing on Linux and Windows we have a choice between two different
agents, <code>Zabbix agent</code> and <code>Zabbix agent 2</code>. Both of these Zabbix agents are still
in active development and receive both major (LTS) and minor updates. The difference
between them is in Programming language and features.</p>
<table>
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: left;">Zabbix agent</th>
<th style="text-align: left;">Zabbix agent 2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Features</td>
<td style="text-align: left;">No focus to include new features</td>
<td style="text-align: left;">Supports everything agent 1 does + more</td>
</tr>
<tr>
<td style="text-align: left;">Programming language</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">GoLang</td>
</tr>
<tr>
<td style="text-align: left;">Extensions</td>
<td style="text-align: left;">C Loadable Modules</td>
<td style="text-align: left;">GoLang plugins</td>
</tr>
<tr>
<td style="text-align: left;">Platforms</td>
<td style="text-align: left;">All</td>
<td style="text-align: left;">Linux and Windows</td>
</tr>
<tr>
<td style="text-align: left;">Concurrency</td>
<td style="text-align: left;">In sequence</td>
<td style="text-align: left;">Concurrently</td>
</tr>
<tr>
<td style="text-align: left;">Storage on outage</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Sqlite</td>
</tr>
<tr>
<td style="text-align: left;">Item timeouts</td>
<td style="text-align: left;">Agent wide</td>
<td style="text-align: left;">Per plugin</td>
</tr>
</tbody>
</table>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-passive-agent-installation-on-linux">Agent installation on Linux</h2>
<p>Installation on Linux can be done in one of three ways. Through direct install
files like <code>.rpm</code> and <code>.deb</code>, by building from sources and through packages pulled
from the repository. Installation through the packages is preferred as this means
Zabbix agent will be updated when updating with commands like <code>dnf update</code> and
<code>apt upgrade</code>. Keep in mind, Zabbix agent is a piece of software just like any
other and as such news versions will contain security and bug fixes. Whatever
installation method you choose, keep your Zabbix agent up-to-date.</p>
<p>We will be using the packages on both RedHat-based and Ubuntu to install <code>Zabbix agent 2</code>.
To use the packages we will add the Zabbix repository first.</p>
<div class="admonition info">
<p class="admonition-title">add zabbix repository</p>
<p>Redhat</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-zabbix-agent-passive-__codelineno-0-1"></a><span class="l l-Scalar l-Scalar-Plain">rpm -Uvh https://repo.zabbix.com/zabbix/7.2/release/rocky/9/noarch/zabbix-release-latest-7.2.el9.noarch.rpm</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch04-zabbix-collecting-data-zabbix-agent-passive-__codelineno-0-2"></a><span class="l l-Scalar l-Scalar-Plain">dnf clean all</span>
</span></code></pre></div>
<p>Ubuntu</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-zabbix-agent-passive-__codelineno-1-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo wget https://repo.zabbix.com/zabbix/7.2/release/ubuntu/pool/main/z/zabbix-release/zabbix-release_latest_7.2+ubuntu24.04_all.deb</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch04-zabbix-collecting-data-zabbix-agent-passive-__codelineno-1-2"></a><span class="l l-Scalar l-Scalar-Plain">sudo dpkg -i zabbix-release_latest_7.2+ubuntu24.04_all.deb</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch04-zabbix-collecting-data-zabbix-agent-passive-__codelineno-1-3"></a><span class="l l-Scalar l-Scalar-Plain">sudo apt update</span>
</span></code></pre></div>
</div>
<p>After adding the repository, we should be able to install <code>Zabbix agent 2</code>.</p>
<div class="admonition info">
<p class="admonition-title">install Zabbix agent 2 package</p>
<p>Redhat</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-zabbix-agent-passive-__codelineno-2-1"></a><span class="l l-Scalar l-Scalar-Plain">dnf install zabbix-agent2</span>
</span></code></pre></div>
<p>Ubuntu</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-zabbix-agent-passive-__codelineno-3-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo apt install zabbix-agent2</span>
</span></code></pre></div>
</div>
<p>After installation make sure to start and enable the Zabbix agent.</p>
<div class="admonition info">
<p class="admonition-title">start Zabbix agent 2</p>
<p>Redhat</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch04-zabbix-collecting-data-zabbix-agent-passive-__codelineno-4-1"></a><span class="l l-Scalar l-Scalar-Plain">systemctl start zabbix-agent2</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch04-zabbix-collecting-data-zabbix-agent-passive-__codelineno-4-2"></a><span class="l l-Scalar l-Scalar-Plain">systemctl enable zabbix-agent2</span>
</span></code></pre></div>
</div>
<p>Your agent is now installed under the <code>zabbix</code> user and ready to be configured.
On a Linux based system, by default we can find all of the Zabbix configuration
files in <code>/etc/zabbix/</code>. Specifically we want to edit <code>/etc/zabbix/zabbix_agent2.conf</code>.</p>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-passive-agent-installation-on-windows">Agent installation on Windows</h2>
<p>On Windows, we have two options to install our Zabbix agent. Through downloading
the <code>.exe</code> file and placing the configuration files in the right location or the
easy option. Downloading the <code>.msi</code> and going through the installation wizard.
Whichever method you prefer, you'll first have to navigate to the Zabbix download
page. We will be using the <code>.msi</code> in our example.</p>
<p><a href="https://www.zabbix.com/download_agents?os=Windows">https://www.zabbix.com/download_agents?os=Windows</a></p>
<p>Here you will be presented with the choice to download either <code>Zabbix agent</code> or
<code>Zabbix agent 2</code>. Choose whichever one you would like to install, but by now we
recommend <code>Zabbix agent 2</code> as it is stable and includes more features.</p>
<p>Once downloaded, we can open the new <code>zabbix_agent2-x.x.x-windows-amd64-openssl.msi</code>
file and it will take us to the wizard window.</p>
<p><img align="center" alt="Zabbix Agent Windows install step 1" src="../ch04-zabbix-collecting-data/datacollection/ch04.15-windows-agent-install-step1.png" /></p>
<p><em>4.15 Zabbix Agent Windows install step 1</em></p>
<p>Step 1 is a simple welcome screen, nothing to do here except click on <code>Next</code>.</p>
<p><img align="center" alt="Zabbix Agent Windows install step 1" src="../ch04-zabbix-collecting-data/datacollection/ch04.16-windows-agent-install-step2.png" /></p>
<p><em>4.15 Zabbix Agent Windows install step 2</em></p>
<p>For step 2, make sure to read the <code>License Agreement</code> (or don't, we do not give legal advice). Then click <code>Next</code>.</p>
<p><img align="center" alt="Zabbix Agent Windows install step 1" src="../ch04-zabbix-collecting-data/datacollection/ch04.17-windows-agent-install-step3.png" /></p>
<p><em>4.15 Zabbix Agent Windows install step 3</em></p>
<p>For step 3 we have some more actions to execute. By default the Zabbix agent on Windows <code>.msi</code> installer includes <code>Zabbix sender</code> and <code>Zabbix get</code>. These are separate utilities that we do not need on every Windows server. I will not install them now, but we can always use the <code>.msi</code> to install them later. The Zabbix agent will function fine without them.</p>
<p><img align="center" alt="Zabbix Agent Windows install step 1" src="../ch04-zabbix-collecting-data/datacollection/ch04.18-windows-agent-install-step4.png" /></p>
<p><em>4.15 Zabbix Agent Windows install step 4</em></p>
<p>Step 4 is our most important step. Here we will already configure our Zabbix agent configuration file, straight from the <code>.msi</code> installer. Let's make sure to set the <code>Hostname</code>, <code>Zabbix server IP/DNS</code> (<code>192.168.46.6</code> in our case) and let's also set the <code>Server or proxy for active checks</code> parameter. As you can see we could also immediately configure encryption with the <code>Enable PSK</code> option, but we will do this later.</p>
<p><img align="center" alt="Zabbix Agent Windows install step 1" src="../ch04-zabbix-collecting-data/datacollection/ch04.19-windows-agent-install-step5.png" /></p>
<p><em>4.15 Zabbix Agent Windows install step 5</em></p>
<p>Now there is nothing left to do except press <code>Install</code> and our Zabbix agent will be both installed and configured.</p>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-passive-agent-installation-on-unix">Agent installation on Unix</h2>
<p>For Unix based systems, simply download the files on the Zabbix download page for either <code>AIX</code>, <code>FreeBSD</code>, <code>OpenBSD</code> or <code>Solaris</code>.</p>
<p><a href="https://www.zabbix.com/download_agents">https://www.zabbix.com/download_agents</a></p>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-passive-agent-installation-on-macos">Agent installation on MacOS</h2>
<p>For MacOS systems, simply download the files on the Zabbix download page and run through the <code>.pkg</code> installer.</p>
<p><a href="https://www.zabbix.com/download_agents?os=macOS">https://www.zabbix.com/download_agents?os=macOS</a></p>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-passive-agent-side-configuration">Agent side configuration</h2>
<p>Configuring the Zabbix agent is similar for all installations. Whether you are on <code>Linux</code>, <code>Unix</code>, <code>Windows</code> or <code>MacOS</code> you will always find the <code>../zabbix_agent2.conf</code> file. The parameters in this configuration file are mostly the same, regardless of the operating system.</p>
<p>For <code>Passive</code> Zabbix agent connections we have only one important parameters to configure out of the box. The <code>Server=</code> parameter. This parameter functions as an allowlist, where we can add IP addresses, IP ranges and DNS entries to a list. All of the entries in this <code>Server=</code> allowlist will be allowed to make a connection to the <code>Passive</code> Zabbix agent and collect data from it.</p>
<p>Edit your configuration file to include your Zabbix server (or proxy) IP address, IP range or DNS entry.</p>
<div class="admonition info">
<p class="admonition-title">edit the Server= parameter</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch04-zabbix-collecting-data-zabbix-agent-passive-__codelineno-5-1"></a><span class="l l-Scalar l-Scalar-Plain">Server=127.0.0.1,192.168.46.30</span>
</span></code></pre></div>
</div>
<p>As you can see in the example, I've left <code>127.0.0.1</code>. Although not required, this can be useful in certain situations. Through the use of a comma <code>,</code> we have indicated that both <code>127.0.0.1</code> and <code>192.168.46.30</code> are allowed to connect. If you are running Zabbix server in HA mode or if you are using Proxy Groups, make sure to include all entries for the Zabbix components that need to connect.</p>
<p>After making changes to the Zabbix agent configuration file, make sure to restart the Windows service. On Linux systems use <code>sytemctl</code> to restart.</p>
<div class="admonition info">
<p class="admonition-title">restart Zabbix agent</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch04-zabbix-collecting-data-zabbix-agent-passive-__codelineno-6-1"></a><span class="l l-Scalar l-Scalar-Plain">systemctl restart zabbix-agent2</span>
</span></code></pre></div>
</div>
<p>If you do not restart, the changes will not take effect.</p>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-passive-zabbix-side-configuration">Zabbix side configuration</h2>
<p>On the Zabbix server side we can now create a new host to monitor. Let's call it <code>zbx-agent-passive-rocky</code> or <code>zbx-agent-passive-windows</code> and let's add the interface.</p>
<p><img align="left" alt="Zabbix Agent passive Linux host" src="../ch04-zabbix-collecting-data/datacollection/ch04.20-passive-agent-linux-host.png" /></p>
<p><em>4.20 Zabbix Agent passive Linux host</em></p>
<p>For Windows it looks similar.</p>
<p><img align="left" alt="Zabbix Agent passive Windows host" src="../ch04-zabbix-collecting-data/datacollection/ch04.21-passive-agent-windows-host.png" /></p>
<p><em>4.21 Zabbix Agent passive Windows host</em></p>
<p>With the host added, correctly with an interface, we can now start monitoring. To do so, let's create one <code>Zabbix agent</code> item type as an example. For your new host <code>zbx-agent-passive-rocky</code> or <code>zbx-agent-passive-windows</code> in the Zabbix frontend, click on <code>Items</code> and then <code>Create item</code> in the top right corner.</p>
<p>Let's create an item <code>System hostname</code>, making sure that if we have more system items alphabetical sorting will group them together. For <code>Passive</code> Zabbix agent the type <code>Zabbix agent</code> is used and we have to specific an <code>Interface</code>. We will use the item key <code>system.hostname</code>.</p>
<p><img align="left" alt="Zabbix Agent passive host item" src="../ch04-zabbix-collecting-data/datacollection/ch04.22-passive-agent-item.png" /></p>
<p><em>4.22 Zabbix Agent passive host item</em></p>
<p>Do not forget to add the standard <code>Component</code> tag to the item to follow the best practise.</p>
<p><img align="left" alt="Zabbix Agent passive host item tag" src="../ch04-zabbix-collecting-data/datacollection/ch04.23-passive-agent-item-tag.png" /></p>
<p><em>4.23 Zabbix Agent passive host item tag</em></p>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-passive-conclusion">Conclusion</h2>
<p>Installing the Zabbix agent can be done with either <code>Zabbix agent</code> or <code>Zabbix agent 2</code>. By now <code>Zabbix agent 2</code> is recommended when available, but <code>Zabbix agent</code> is also still fully supported. Make sure to install the Zabbix agent through the most easily secured method and keep it updated.</p>
<p>Once installed, for <code>Passive</code> communication we will use the <code>Server=</code> parameter to keep our agent secured. We do not want everyone to be able to connect to this agent, even when there might still be a firewall or two in between.</p>
<p>Last but not least, keep <code>Active</code> versus <code>Passive</code> in mind. Depending on where the server is located, it might be preferred to open up ports through your firewall(s) incoming our outgoing. Usually we prefer <code>Active</code> communication, because it means we do not have to give a central server (Zabbix server and proxy) access to all our servers. But in specific cases <code>Passive</code> might be preferred.</p>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-passive-questions">Questions</h2>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-passive-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch04-zabbix-collecting-data-zabbix-agent-active" heading-number="9.7"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="zabbix-agent-active-monitoring">Zabbix Agent Active monitoring</h1>
<p>In the previous part we installed our Zabbix agent and started monitoring a host in the <code>Passive</code> mode. When we use <code>Passive</code> mode the Zabbix server or proxy will connect to the Zabbix agent and request specific item data. The item data is returned within the same TCP session. From a security aspect this means that we need to allow our Zabbix servers or proxies to connect to many different servers.</p>
<p>For security reasons this might not be the best course of action. Instead let's look at the Zabbix agent in <code>Active</code> mode. In <code>Active</code> mode or Zabbix agent will be configured to initiate the connection to the Zabbix server or proxy. It will request its configuration data and receive it back in the same TCP session. After receiving its configuration it can then start sending the item data according to the configuration received. The connection as such is always initiated from the Zabbix agent side, meaning you will allow your many agents to connect to your Zabbix servers or proxies instead.</p>
<p><img align="center" alt="Zabbix Agent active hosts" src="../ch04-zabbix-collecting-data/datacollection/ch04.24-windows-linux-active-agent.png" /></p>
<p><em>4.24 Zabbix Agent active hosts</em></p>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-active-setting-up-the-active-agent">Setting up the active agent</h2>
<p>It's possible to set-up a Zabbix agent to work in both passive and active mode at the same time. Sometimes, we see this as passive mode was being used but an active only check is added later. The Zabbix agent in active mode can execute all item keys, whereas the passive agent cannot execute log item keys. Another reason to prefer active mode in most cases. For clarity, in our example we will use a different linux and windows server for the active agent. We will call these hosts:</p>
<ul>
<li><strong>zbx-agent-active-rocky</strong></li>
<li><strong>zbx-agent-active-windows</strong></li>
</ul>
<p>Because the Zabbix active agent will need to know where to request its configuration and where to start sending data, the setup for the active agent is quite different. The set-up process however is the same for both Linux and Windows. Let's start by editing the Zabbix agent configuration file.</p>
<div class="admonition info">
<p class="admonition-title">open Zabbix agent configuration file</p>
<p>Linux usually:</p>
<p>``` vim /etc/zabbix/zabbix_agent2.conf
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-zabbix-agent-active-__codelineno-0-1"></a>Windows usually:
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch04-zabbix-collecting-data-zabbix-agent-active-__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch04-zabbix-collecting-data-zabbix-agent-active-__codelineno-0-3"></a>``` Open C:\Program Files\Zabbix agent\zabbix_agent2.conf with a text editor
</span></code></pre></div></p>
</div>
<p>Once the configuration is open, there are two important parameters in the configuration file. First, let's make sure our Zabbix agent will know where to connect to.</p>
<div class="admonition info">
<p class="admonition-title">edit ServerActive parameter</p>
<p><code>ServerActive=192.168.46.30</code></p>
</div>
<p>In the example <code>192.168.46.30</code> is the IP address of our Zabbix server (or proxy). Do not forget to remove <code>127.0.0.1</code> in this case. Its important to remember that our Zabbix agent in active mode will connect to every single IP address or DNS name entered in the <code>ServerActive=</code> parameter. Unlike <code>Server=</code> which functions as an allowlist.</p>
<p>Next up, our Zabbix agent needs to know which configuration data to collect. It will connect to the Zabbix server (or proxy) on the IP specified and send over its <code>Hostname=</code> parameter. By default this is set to <code>Hostname=Zabbix server</code> which is incorrect in all cases except the Zabbix server itself. Lets change the configuration.</p>
<div class="admonition info">
<p class="admonition-title">edit Hostname parameter</p>
<p>Linux:</p>
<p>``` Hostname=zbx-agent-active-rocky
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-zabbix-agent-active-__codelineno-1-1"></a>Windows
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch04-zabbix-collecting-data-zabbix-agent-active-__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch04-zabbix-collecting-data-zabbix-agent-active-__codelineno-1-3"></a>``` Hostname=zbx-agent-active-windows
</span></code></pre></div></p>
</div>
<p>It is also possible to comment the <code>#Hostname=</code> parameters, in which case it will use the <code>system.hostname</code> item key to determine the hostname. This makes it easy for environments where the hostname is the same on the system as it will be in Zabbix (best practice).</p>
<p>There is also the <code>HostnameItem=</code> parameter which you can use to set your own item to determine the hostname used. This can be an existing item, but also a <code>UserParameter</code> (more on those later). With this functionality, you can even execute a bash or powershell script to set a custom hostname like that.</p>
<p>With this configuration set you can restart the Zabbix agent to make the changes take effect. In <code>Windows</code> restart the service, for <code>Linux</code> issue the command below.</p>
<div class="admonition info">
<p class="admonition-title">restart Zabbix agent</p>
<p><code>systemctl restart zabbix-agent2</code></p>
</div>
<p>This finalizes the configuration file changes. Now we need to configure the host in Zabbix.</p>
<p><img align="center" alt="Zabbix Agent active hosts in Zabbix" src="../ch04-zabbix-collecting-data/datacollection/ch04.25-windows-linux-active-agent-host.png" /></p>
<p><em>4.25 Zabbix Agent active hosts in Zabbix</em></p>
<p>All we need to do here is make sure to match the hostname of what we configured in the Zabbix agent configuration file. Keep in mind that the <code>Hostname</code> field has to match the <code>Hostname=</code> parameter in the configuration file. The <code>Visible name</code> field does not have effect on the active agent functioning.</p>
<p>We also add the host to the correct host group and that is all for now.</p>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-active-creating-active-items">Creating active items</h2>
<p>Now that these settings all configured we can now start to create some items on our active agent host in Zabbix frontend. Let's click on <code>Items</code> for our host and configure a new Zabbix active type items.</p>
<p><img align="center" alt="Zabbix Agent active item" src="../ch04-zabbix-collecting-data/datacollection/ch04.26-active-agent-item.png" /></p>
<p><em>4.26 Zabbix Agent active item</em></p>
<p>Make sure to set the item <code>Type</code> to <code>Zabbix agent (active)</code>. Most item keys will be the same between <code>Passive</code> and <code>Active</code> mode, but the <code>Type</code> needs to be set correctly.</p>
<p>Also, do not forget to add the tag to this item.</p>
<p><img align="center" alt="Zabbix Agent active item tag" src="../ch04-zabbix-collecting-data/datacollection/ch04.27-active-agent-item-tag.png" /></p>
<p><em>4.27 Zabbix Agent active item tag</em></p>
<p>Your <code>ZBX</code> icon for this host should now turn green, even in active mode.</p>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-active-conclusion">Conclusion</h2>
<p>Zabbix agent in <code>Passive</code> and in <code>Active</code> mode are quite similar. Their main difference being their methods of communications and some different functionalities outside of their core functions being the same. One big difference we haven't mentioned yet however is timestamps. The Zabbix server or proxy communicating with a Zabbix agent in<code>Passive</code> mode adds the timestamp for a collected value at the Zabbix server or proxy side. In <code>Active</code> mode however the timestamp is added directly upon item value collection on the Zabbix agent side. This makes the Zabbix agent in <code>Active</code> mode more accurate with timestamps, but more sensitive for incorrect time settings on your monitoring targets. Keep in mind to set-up NTP when using the Zabbix agent in <code>Active</code> mode, a good idea even outside of Zabbix monitoring. The Zabbix agent in <code>Active</code> mode will always use UTC+0 and send over the timestamp in unixtime.</p>
<p>Finally, let's do a bit of a comparison between the two modes.</p>
<table>
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: left;">Active Zabbix agent</th>
<th style="text-align: left;">Passive Zabbix agent</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Timestamp</td>
<td style="text-align: left;">Zabbix agent</td>
<td style="text-align: left;">Zabbix server or proxy</td>
</tr>
<tr>
<td style="text-align: left;">(event)log items</td>
<td style="text-align: left;">Supported</td>
<td style="text-align: left;">Not supported</td>
</tr>
<tr>
<td style="text-align: left;">Port</td>
<td style="text-align: left;">No port listening, connect to 10051</td>
<td style="text-align: left;">Listening on 10050</td>
</tr>
<tr>
<td style="text-align: left;">Hostname</td>
<td style="text-align: left;">Has to match</td>
<td style="text-align: left;">Can be anything</td>
</tr>
<tr>
<td style="text-align: left;">Remote commands</td>
<td style="text-align: left;">Supported</td>
<td style="text-align: left;">Supported</td>
</tr>
</tbody>
</table>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-active-questions">Questions</h2>
<h2 id="ch04-zabbix-collecting-data-zabbix-agent-active-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch04-zabbix-collecting-data-snmp-polling" heading-number="9.8"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="snmp-polling">SNMP Polling</h1>
<p>In the previous chapter, we explored monitoring strategies that relied on both
active and passive Zabbix agents. This chapter introduces an alternative approach
monitoring via SNMP (Simple Network Management Protocol) which does not require
the installation of a Zabbix agent on the monitored device. This method is
especially useful in environments where agent based monitoring is impractical,
restricted or simply not allowed.</p>
<p>Simple Network Management Protocol (SNMP) is a widely adopted protocol designed
for monitoring and managing devices on IP networks. Despite the word "management"
in its name, SNMP is predominantly employed for monitoring purposes. Its widespread
support across networking hardware and embedded systems has made it a cornerstone
of modern network visibility solutions.</p>
<p>Originally developed in the late 1980s, SNMP has undergone several revisions.
Early versions, such as SNMPv1 and SNMPv2c, were hampered by significant security
limitations. As a result, while SNMP includes functionality for remote device
configuration, its use has remained largely to status monitoring rather than
active management of devices.</p>
<p>SNMP is especially valuable for monitoring resource constrained or embedded devices
that lack the capacity to run a full monitoring agent.</p>
<p>Common examples include:</p>
<ul>
<li>Printers</li>
<li>Network switches, routers, and firewalls</li>
<li>Uninterruptible Power Supplies (UPSs)</li>
<li>NAS (Network-Attached Storage) appliances</li>
<li>Environmental sensors (e.g., temperature, humidity sensors)</li>
</ul>
<p>These devices often provide built-in SNMP support, making them accessible for monitoring
with minimal configuration. Additionally, SNMP can be employed on standard servers
where installing or maintaining a Zabbix agent is either impractical or not permitted.
This could be due to administrative policies, software compatibility or security
concerns, or simply a desire to reduce system footprint.</p>
<p>Recognizing the ubiquity of SNMP, Zabbix provides native SNMP support. This
capability is powered by the open-source Net-SNMP suite, available at
<a href="http://net-snmp.sourceforge.net">http://net-snmp.sourceforge.net</a>. The integration
allows Zabbix to retrieve metrics from SNMP-enabled devices using industry standard
mechanisms.</p>
<p>In this chapter, we will cover the following:</p>
<ul>
<li>An introduction to the Net-SNMP toolkit and its core utilities.</li>
<li>How to integrate MIB (Management Information Base) files into Zabbix, enabling
  the platform to interpret SNMP data correctly.</li>
<li>The process of SNMP polling within Zabbix, including how to define SNMP-based
  items and retrieve data from devices.</li>
</ul>
<p>This chapter serves as the foundation for SNMP-based monitoring in Zabbix. While
we begin with the essentials such as polling, MIB usage, and SNMP item
configuration this is just the start.</p>
<p>Later in this book, we will build upon this knowledge by exploring Low-Level
Discovery (LLD) mechanisms using SNMP. LLD allows Zabbix to automatically detect
and create monitoring items for dynamic or repetitive structures, such as
network interfaces, power supplies, ...</p>
<hr />
<h2 id="ch04-zabbix-collecting-data-snmp-polling-what-is-a-mib">What is a MIB?</h2>
<p>Imagine you have a house full of smart devices: a smart thermostat, a smart lamp,
and a smart doorbell. All these devices keep track of various types of information.
The thermostat has the indoor temperature and battery status, the lamp has its
brightness and color, and the doorbell has a log of who has been at the door.</p>
<p>A MIB (Management Information Base) is the "table of contents" or "catalog" of
all this information on a network device. Every SNMP enabled device has its own
MIB, which is structured and organized. Without a MIB, your Zabbix server wouldn't
know what data is available to monitor. The MIB specifies exactly which metrics
the device can share.</p>
<hr />
<h2 id="ch04-zabbix-collecting-data-snmp-polling-what-is-an-oid">What is an OID?</h2>
<p>To retrieve a specific piece of information from that catalog, you need an address.
An OID (Object Identifier) is that address.</p>
<p>You can think of an OID as a GPS coordinate or a book's unique ISBN number. It's
a hierarchical sequence of numbers (for example, 1.3.6.1.2.1.1.3.0) that leads
you to one specific piece of information, such as a device's uptime or the
number of network errors on a particular port.</p>
<p>The OID is the exact path to the data within the MIB. Zabbix uses these OIDs
to know what to request from the device. You configure Zabbix to say: "Request
the value of this specific OID," and the device returns the requested value.</p>
<p>In short:</p>
<ul>
<li>The MIB is the library catalog that describes the structure of all available
  data.</li>
<li>The OID is the specific address that leads you to the book (the data) you're
  looking for.</li>
</ul>
<p>When Zabbix wants to monitor a device via SNMP, it uses an OID to send an SNMP
request. The agent on the device searches its MIB for the data corresponding
to that OID and sends the value back to Zabbix. This is the foundation of
SNMP based monitoring.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-snmp-polling-what-is-the-oid-tree-structure">What Is the OID Tree Structure?</h3>
<p>The OID (Object Identifier) structure is a hierarchical tree, much like a family
tree or a computer's folder structure. This tree is standardized globally. Each
point on the tree, from the root to the "leaves," is represented by a number.</p>
<p>The tree starts at the root, with a few main branches managed by international
organizations. The most common branch for network management and SNMP often begins
with <code>1.3.6.1</code>. Let's break down this OID to see how the structure works:</p>
<ul>
<li><strong>1:</strong> This branch is managed by <strong>ISO</strong> (International Organization for Standardization).</li>
<li><strong>1.3:</strong> This branch is for <code>identified-organization</code>.</li>
<li><strong>1.3.6:</strong> This is the branch for the U.S. Department of Defense (<strong>DoD</strong>).</li>
<li><strong>1.3.6.1:</strong> This is the <strong>internet</strong> branch, managed by the IETF (Internet
  Engineering Task Force).</li>
<li>... and so on.</li>
</ul>
<p>Every branch in this tree is responsible for managing the numbers below it. Companies
like Cisco or projects like Net-SNMP get their own unique number under a specific
branch, most commonly under <code>1.3.6.1.4.1</code>, which is reserved for private enterprises.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-snmp-polling-how-to-use-the-oid-tree">How to Use the OID Tree</h3>
<p>For Zabbix, the OID tree is essential for understanding what data is available on
a device. Instead of remembering long, unreadable strings of numbers, <strong>MIB
(Management Information Base)</strong> files use text labels to translate the numbers
into human-readable names.</p>
<p><strong>Example:</strong></p>
<ul>
<li>The OID for a device's system description is: <code>1.3.6.1.2.1.1.1.0</code>.</li>
<li>An MIB file translates this to: <code>sysDescr.0</code>.</li>
</ul>
<p>You can use the OID tree to:</p>
<ol>
<li><strong>Look up data manually</strong>: You can browse MIB files or online OID databases to
   find the exact OID for the metric you want to monitor.</li>
<li><strong>Use SNMP commands</strong>: With commands like <code>snmpwalk</code>, <code>snmpget</code>, or <code>snmpstatus</code>,
   you can use the numeric OIDs or the readable names (if MIBs are loaded) to
   request data from a device.</li>
<li><strong>Configure LLD (Low-Level Discovery)</strong>: Zabbix uses OID sub-trees to automatically
   create monitoring items for dynamic components, such as network interfaces or
   disk partitions.</li>
</ol>
<hr />
<h2 id="ch04-zabbix-collecting-data-snmp-polling-net-snmp">Net-SNMP</h2>
<p>The Simple Network Management Protocol (SNMP) is a widely used protocol for monitoring
and managing networked devices. It operates primarily over UDP port 161, though in
certain cases, SNMP agents or proxies may also support TCP port 161 for enhanced
reliability or integration with specific tools. SNMP allows administrators to query
information or trigger actions on remote devices using structured data identified
by Object Identifiers (OIDs).</p>
<p>To begin working with SNMP in a lab or testing environment, you may choose between
two approaches:</p>
<ul>
<li>Use an existing SNMP capable device already present in your network infrastructure.</li>
<li>Deploy a lightweight SNMP agent on a general-purpose server, such as your Zabbix
  server or a dedicated virtual machine.</li>
</ul>
<p>In this chapter, we will walk through the installation and configuration of a basic
SNMP agent on a Rocky or Ubuntu based Zabbix server. However, the same setup can
be applied to any compatible Linux system.</p>
<p>Note: If you're using a device already present on your network, ensure:</p>
<ul>
<li>You have network access to the device (verify routing and firewall settings).</li>
<li>SNMP access is allowed from your Zabbix server‚Äôs IP address.</li>
<li>The correct community string is configured, and your IP is included in the SNMP
  access control rules of the device.</li>
</ul>
<p>Dataflow between Zabbix and the SNMP device.</p>
<pre  class="mermaid"><code>graph TD
    A[Zabbix Server] -->|SNMP Request on port 161/UDP| B(Router, Switch, Printer, ...);
    B -->|SNMP Agent| C{"Management Information Base (MIB)"};
    C -->|Read data via OID's| B;
    B -->|SNMP Response| A
</code></pre>
<p><em>4.28 Overview</em></p>
<p>Before we start lets go over a few tools that we will use and explain what they
exactly do.</p>
<ul>
<li><strong>snmpget:</strong> Retrieves the value of a single, specific OID.</li>
<li><strong>snmpwalk:</strong> Walks an entire OID subtree and displays all of its values.</li>
<li><strong>snmpstatus:</strong> Provides a summary of a device's basic status.</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-snmp-polling-testing-an-snmp-device-where-to-start">Testing an SNMP Device: Where to Start?</h3>
<p>When you're looking to test an SNMP device, it's crucial to understand the available
SNMP versions and which ones you should prioritize. Currently, there are three
commonly used versions: <strong>SNMPv1</strong>, <strong>SNMPv2c</strong>, and <strong>SNMPv3</strong>.</p>
<ul>
<li><strong>SNMPv1</strong>: This is the oldest version and should generally be avoided unless
  absolutely necessary. It's quite limited in functionality and has serious security
  vulnerabilities.</li>
<li><strong>SNMPv2c</strong>: Still the most prevalent version today, SNMPv2c offers improvements
  over v1, especially in data retrieval and performance. It's relatively straightforward
  to configure and use.</li>
<li><strong>SNMPv3</strong>: This version is rapidly gaining popularity and is considered the most
  secure and advanced option. It provides encryption, authentication, and user
  management, which are essential for secure networks.</li>
</ul>
<h4 id="ch04-zabbix-collecting-data-snmp-polling-your-first-test-attempt-snmpv2c-and-the-public-community-string">Your First Test Attempt: SNMPv2c and the 'public' Community String</h4>
<p>To begin your testing, we recommend trying to connect to your device using <strong>SNMPv2c</strong>
and the standard <strong>community string 'public'</strong>. Many devices ship with these default
settings, though it's certainly insecure for production environments.</p>
<p>You can use the <code>snmpstatus</code> command for this. Here‚Äôs an example of how you might
do this in your terminal:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-0-1"></a><span class="w">   </span>snmpstatus<span class="w"> </span>-v<span class="w"> </span>2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="o">[</span>IP-address_of_the_device<span class="o">]</span>
</span></code></pre></div>
<p>Replace <code>[IP-address_of_the_device]</code> with the actual IP address or hostname of the
device you wish to test.</p>
<h4 id="ch04-zabbix-collecting-data-snmp-polling-what-if-you-get-no-information-back">What if You Get No Information Back?</h4>
<p>If you don't receive any information after this attempt, don't panic. It simply means
the default settings likely don't apply to your device, or there might be a network
related issue. You'll need to dig deeper into your device's configuration or troubleshoot
your network.</p>
<p><strong>First, check the device's configuration:</strong></p>
<ol>
<li><strong>SNMP Version</strong>: Which SNMP version (v1, v2c, or v3) is configured and enabled?</li>
<li><strong>Community String (for v1/v2c)</strong>: If your device uses SNMPv1 or SNMPv2c, what
   is the configured community string (similar to a password) for read-only and
   potentially read- write access? It's rarely 'public' in a properly configured
   environment.</li>
<li><strong>Username, Authentication, and Privacy (for v3)</strong>: If your device uses SNMPv3,
   you'll need more specific information:
   - <strong>Username</strong>: What username has been created for SNMPv3?
   - <strong>Authentication Protocol and Password</strong>: Which authentication protocol (e.g.,
     MD5, SHA) is used, and what is its corresponding password?
   - <strong>Privacy Protocol and Password</strong>: Which encryption protocol (e.g., DES, AES)
     is used, and what is its corresponding password?</li>
</ol>
<p><strong>Next, consider potential network issues:</strong></p>
<p>Even if your device is correctly configured, network obstacles can prevent SNMP communication.
Check for:</p>
<ul>
<li><strong>Firewall Blocking</strong>: A firewall (either on your testing machine, the network,
  or the SNMP device itself) might be blocking the UDP port 161, which SNMP typically
  uses. Ensure the necessary ports are open.</li>
<li><strong>ACL Settings on the Device</strong>: The SNMP device itself might have Access Control
  List (ACL) settings configured to restrict access only to specific IP addresses.
  Verify that your testing machine's IP address is permitted.</li>
<li><strong>Network Connectivity</strong>: Basic network issues like incorrect IP addresses, subnet
  masks, or routing problems can also prevent communication. Ensure there's a clear
  network path between your testing machine and the SNMP device.</li>
</ul>
<hr />
<h3 id="ch04-zabbix-collecting-data-snmp-polling-snmpv3-security-levels">SNMPv3 Security Levels</h3>
<p>SNMPv3 offers significant security enhancements over older, unsecured versions
(SNMPv1 and SNMPv2c). The protocol has three security levels:</p>
<ul>
<li>
<p><strong>noAuthNoPriv (Authentication and encryption off):</strong> This is the least secure
  level. There's no authentication and no encryption. It's similar to SNMPv1
  and SNMPv2c and offers no protection. It should only be used in strictly
  controlled lab environments where security is not a concern.</p>
</li>
<li>
<p><strong>authNoPriv (Authentication on, encryption off):</strong> This level authenticates
  the user, which guarantees data integrity. It verifies that messages come from
  a trusted source and haven't been tampered with. However, the data isn't
  encrypted, so it remains readable if the traffic is intercepted. This level
  is suitable for non-sensitive data in a relatively secure network. Authentication
  protocols used here are typically MD5 or SHA.</p>
</li>
<li>
<p><strong>authPriv (Authentication and encryption on):</strong> This is the most secure and
  recommended level. It provides both authentication and data encryption.
  Authentication ensures the integrity and origin of the message, while encryption
  makes the data unreadable to third parties. This is essential for monitoring
  sensitive information or when communicating over unsecured networks. Encryption
  protocols used include DES, 3DES, and AES.</p>
</li>
</ul>
<hr />
<h4 id="ch04-zabbix-collecting-data-snmp-polling-examples-of-snmpv3-commands">Examples of SNMPv3 Commands</h4>
<p>Once you have the necessary information (and have ruled out network issues), you
can try connecting with SNMPv3. Here are some examples of how you might use <code>snmpstatus</code>
with SNMPv3 (depending on your configuration):</p>
<ul>
<li><strong>Authentication only (no encryption):</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-1-1"></a><span class="w">   </span>snmpstatus<span class="w"> </span>-v<span class="w"> </span><span class="m">3</span><span class="w"> </span>-l<span class="w"> </span>authNoPriv<span class="w"> </span>-u<span class="w"> </span><span class="o">[</span>username<span class="o">]</span><span class="w"> </span>-a<span class="w"> </span><span class="o">[</span>authentication_protocol<span class="o">]</span><span class="w"> </span>-A<span class="w"> </span><span class="o">[</span>authentication_password<span class="o">]</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-1-2"></a><span class="w">   </span><span class="o">[</span>IP-address_of_the_device<span class="o">]</span>
</span></code></pre></div>
<p>(Replace <code>[authentication_protocol]</code> with <code>MD5</code> or <code>SHA</code>)</p>
<ul>
<li><strong>Authentication and Encryption:</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-2-1"></a><span class="w">   </span>snmpstatus<span class="w"> </span>-v<span class="w"> </span><span class="m">3</span><span class="w"> </span>-l<span class="w"> </span>authPriv<span class="w"> </span>-u<span class="w"> </span><span class="o">[</span>username<span class="o">]</span><span class="w"> </span>-a<span class="w"> </span><span class="o">[</span>authentication_protocol<span class="o">]</span><span class="w"> </span>-A<span class="w"> </span><span class="o">[</span>authentication_password<span class="o">]</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-2-2"></a><span class="w">   </span>-x<span class="w"> </span><span class="o">[</span>privacy_protocol<span class="o">]</span><span class="w"> </span>-X<span class="w"> </span><span class="o">[</span>privacy_wachtwoord<span class="o">]</span><span class="w"> </span><span class="o">[</span>IP-address_of_the_device<span class="o">]</span>
</span></code></pre></div>
<p>(Replace <code>[authentication_protocol]</code> with <code>MD5</code> or <code>SHA</code> and <code>[privacy_protocol]</code>
  with <code>DES</code> or <code>AES</code>)</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-snmp-polling-a-note-on-snmpv1-avoid-if-possible">A Note on SNMPv1: Avoid if Possible</h3>
<p>While you can technically test with SNMPv1, we strongly advise against using it
in production. SNMPv1 is an outdated and insecure protocol version vulnerable to
various attacks. Always try to connect with v2c or v3 first. Only if you are absolutely
certain that the device exclusively supports SNMPv1 and you have no other option,
you can try using it:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-3-1"></a><span class="w">    </span>snmpstatus<span class="w"> </span>-v<span class="w"> </span><span class="m">1</span><span class="w"> </span>-c<span class="w"> </span><span class="o">[</span>community_string<span class="o">]</span><span class="w"> </span><span class="o">[</span>IP-address_of_the_device<span class="o">]</span>
</span></code></pre></div>
<p>However, remember that using SNMPv1 in a production environment poses a significant
security risk.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-snmp-polling-understanding-the-output-of-snmpstatus">Understanding the Output of snmpstatus</h3>
<p>Let's take a look at an example output from the <code>snmpstatus</code> command. Remember
this is just an example output it will differ from your result.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-4-1"></a><span class="w">    </span>snmpstatus<span class="w"> </span>-v2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="m">127</span>.0.0.1
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-4-2"></a><span class="w">    </span><span class="o">[</span>UDP:<span class="w"> </span><span class="o">[</span><span class="m">127</span>.0.0.1<span class="o">]</span>:161-&gt;<span class="o">[</span><span class="m">0</span>.0.0.0<span class="o">]</span>:33310<span class="o">]=</span>&gt;<span class="o">[</span>Linux<span class="w"> </span>localhost.localdomain<span class="w"> </span><span class="m">5</span>.14.0-570.28.1.el9_6.aarch64
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-4-3"></a><span class="w">    </span><span class="c1">#1 SMP PREEMPT_DYNAMIC Thu Jul 24 07:50:10 EDT 2025 aarch64] Up: 1:24:36.58</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-4-4"></a><span class="w">    </span>Interfaces:<span class="w"> </span><span class="m">2</span>,<span class="w"> </span>Recv/Trans<span class="w"> </span>packets:<span class="w"> </span><span class="m">355763</span>/355129<span class="w"> </span><span class="p">|</span><span class="w"> </span>IP:<span class="w"> </span><span class="m">37414</span>/35988
</span></code></pre></div>
<p>This output provides a concise summary of the device's status, indicating a successful
SNMP query. Let's break down what each part means:</p>
<ol>
<li>
<p><strong><code>snmpstatus -v2c -c public 127.0.0.1</code></strong>:</p>
<ul>
<li><code>-v2c</code>: Specifies that SNMP version 2c was used.</li>
<li><code>-c public</code>: Indicates that the community string "public" was used for authentication.</li>
<li><code>127.0.0.1</code>: This is the target IP address, in this case, the localhost (the
  machine on which the command was run).</li>
</ul>
</li>
<li>
<p><strong><code>[UDP: [127.0.0.1]:161-&gt;[0.0.0.0]:33310]</code></strong>:</p>
<ul>
<li>This section describes the communication path.</li>
<li><code>UDP</code>: Confirms that the User Datagram Protocol was used, which is standard
  for SNMP.</li>
<li><code>[127.0.0.1]:161</code>: This is the source of the SNMP request and the standard
  SNMP port (161) on which the SNMP agent listens.</li>
<li><code>-&gt;[0.0.0.0]:33310</code>: This indicates the destination of the response. <code>0.0.0.0</code>
  is a placeholder for "any address," and <code>33310</code> is a high-numbered ephemeral
  port used by the client to receive the response.</li>
</ul>
</li>
<li>
<p><strong><code>[Linux localhost.localdomain 5.14.0-570.28.1.el9_6.aarch64 #1 SMP PREEMPT_DYNAMIC Thu Jul 24 07:50:10 EDT 2025 aarch64]</code></strong>:</p>
<ul>
<li>This is crucial information about the queried device itself.</li>
<li><code>Linux localhost.localdomain</code>: Identifies the operating system as Linux, with the hostname <code>localhost.localdomain</code>.</li>
<li><code>5.14.0-570.28.1.el9_6.aarch64</code>: This is the kernel version and architecture</li>
<li><code>#1 SMP PREEMPT_DYNAMIC Thu Jul 24 07:50:10 EDT 2025 aarch64</code>: Provides further kernel build details, including the build date and time.</li>
</ul>
</li>
<li>
<p><strong><code>Up: 1:24:36.58</code></strong>:</p>
<ul>
<li>This indicates the <strong>uptime</strong> of the device. The system has been running for
  1 day, 24 hours, 36 minutes, and 58 seconds.</li>
</ul>
</li>
<li>
<p><strong><code>Interfaces: 2, Recv/Trans packets: 355763/355129 | IP: 37414/35988</code></strong>:</p>
<ul>
<li><strong><code>Interfaces: 2</code></strong>: This tells us that the device has detected 2 network interfaces.</li>
<li><strong><code>Recv/Trans packets: 355763/355129</code></strong>: These numbers represent the total
  number of packets received and transmitted across <em>all</em> network interfaces
  on the device since it was last booted.</li>
<li><strong><code>IP: 37414/35988</code></strong>: These figures likely represent the number of IP datagrams
  received and sent specifically by the IP layer on the device. This provides
  a more specific metric of IP traffic compared to the total packet count
  which includes other layer 2 protocols.</li>
</ul>
</li>
</ol>
<p>In summary, this output from <code>snmpstatus</code> quickly provides a clear overview of a
Linux system's basic health and network activity, confirming that the SNMP agent
is reachable and responding with the requested information using SNMPv2c.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-snmp-polling-installing-snmp-agent-on-a-linux-host">Installing SNMP Agent on a Linux Host</h3>
<p>Now that we know a bit more about SNMP it's time to start playing next we will
install the SNMP agent and utilities on our Zabbix server to do some testing.
Or another compatible system if you prefer.</p>
<p>Follow the steps below to get the SNMP agent installed.</p>
<ol>
<li>Install Required Packages</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Update the package list</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-5-1"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>update
</span></code></pre></div></p>
<p>Ubuntu:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-6-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>upgrade
</span></code></pre></div></p>
</div>
<div class="admonition info">
<p class="admonition-title">Install Net-SNMP agent and utilities</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-7-1"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>net-snmp<span class="w"> </span>net-snmp-utils
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-8-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>snmp<span class="w"> </span>snmpd
</span></code></pre></div></p>
</div>
<ol start="2">
<li>Configure the SNMP Agent
   First, create a clean configuration file for the SNMP daemon:</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-9-1"></a><span class="w">    </span>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/snmp/snmpd.conf
</span></code></pre></div>
<p>Paste the following example configuration, which is optimized for SNMP-based
discovery and testing in Zabbix:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-1"></a>tee<span class="w"> </span>/etc/snmp/snmpd.conf<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-2"></a><span class="s"># --------------------------------------------------------------------------</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-3"></a><span class="s"># BASIC ACCESS CONTROL</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-4"></a><span class="s"># --------------------------------------------------------------------------</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-5"></a><span class="s"># This defines who has access and with which community string.</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-6"></a><span class="s"># For a LAB ENVIRONMENT, &#39;public&#39; is acceptable, but EMPHASIZE THAT THIS IS UNSAFE</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-7"></a><span class="s"># FOR PRODUCTION. In production, use SNMPv3 or restricted IP ranges.</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-9"></a><span class="s"># Read-only community string &#39;public&#39; for all IP addresses (WARNING: LAB USE ONLY!)</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-10"></a><span class="s">rocommunity public</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-11"></a><span class="s">#</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-12"></a><span class="s"># IMPORTANT NOTE: The &#39;public&#39; community string is the default and most well-known community string.</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-13"></a><span class="s"># Using this in a production environment is EXTREMELY INSECURE and makes your device vulnerable.</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-14"></a><span class="s"># Anyone who knows your device&#39;s IP address can query basic information about your system.</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-15"></a><span class="s"># USE THIS ONLY AND EXCLUSIVELY IN STRICTLY ISOLATED TEST OR LAB ENVIRONMENTS!</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-16"></a><span class="s"># For production environments:</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-17"></a><span class="s"># - Use a unique, complex community string (e.g., rocommunity YourSuperSecretString)</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-18"></a><span class="s"># - STRONGLY CONSIDER implementing SNMPv3 for superior security (authentication and encryption).</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-19"></a><span class="s">#</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-20"></a>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-21"></a><span class="s"># BETTER FOR LAB (or production with restrictions):</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-22"></a><span class="s"># rocommunity my_secure_community_string 192.168.56.0/24</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-23"></a><span class="s"># Replace &#39;192.168.56.0/24&#39; with the subnet where your Zabbix Server is located.</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-24"></a>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-25"></a>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-26"></a><span class="s"># ============================================</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-27"></a><span class="s"># SNMPv3 Configuration (Recommended for Production, but here with examples)</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-28"></a><span class="s"># ============================================</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-29"></a><span class="s">#</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-30"></a><span class="s"># This section defines users for SNMPv3, each with a different security level.</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-31"></a><span class="s"># In a production environment, you would typically ONLY use the &#39;authPriv&#39; option</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-32"></a><span class="s"># with strong, unique passwords. This setup is useful for lab and testing purposes.</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-33"></a>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-34"></a><span class="s"># --- 1. SNMPv3 User with Authentication and Privacy (authPriv) ---</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-35"></a><span class="s"># THIS IS THE MOST SECURE AND RECOMMENDED SECURITY LEVEL FOR PRODUCTION.</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-36"></a><span class="s"># It requires both correct authentication and encryption of the traffic.</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-37"></a><span class="s">#</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-38"></a><span class="s"># Syntax: createUser USERNAME AUTH_PROTOCOL &quot;AUTH_PASS&quot; PRIV_PROTOCOL &quot;PRIV_PASS&quot;</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-39"></a><span class="s"># Example: createUser mysecureuser SHA &quot;StrongAuthP@ss1&quot; AES &quot;SuperPrivP@ss2&quot;</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-40"></a>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-41"></a><span class="s">createUser secureuser SHA &quot;AuthP@ssSec#1&quot; AES &quot;PrivP@ssSec#2&quot;</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-42"></a><span class="s">rouser secureuser authPriv</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-43"></a>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-44"></a><span class="s"># --- 2. SNMPv3 User with Authentication Only (authNoPriv) ---</span>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-45"></a><span class="s"># This level requires authentication, but the data is NOT encrypted.</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-46"></a><span class="s"># The content of SNMP packets can be read if traffic is intercepted.</span>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-47"></a><span class="s"># NOT RECOMMENDED FOR SENSITIVE DATA OR PRODUCTION ENVIRONMENTS.</span>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-48"></a><span class="s">#</span>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-49"></a><span class="s"># Syntax: createUser USERNAME AUTH_PROTOCOL &quot;AUTH_PASS&quot;</span>
</span><span id="__span-10-50"><a id="__codelineno-10-50" name="__codelineno-10-50" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-50"></a><span class="s"># Example: createUser authonlyuser SHA &quot;AuthOnlyP@ss3&quot;</span>
</span><span id="__span-10-51"><a id="__codelineno-10-51" name="__codelineno-10-51" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-51"></a>
</span><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-52"></a><span class="s">createUser authonlyuser SHA &quot;AuthOnlyP@ss3&quot;</span>
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-53"></a><span class="s">rouser authonlyuser authNoPriv</span>
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-54"></a>
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-55"></a><span class="s"># --- 3. SNMPv3 User with [48;32;186;960;2604tNo Authentication and No Privacy (noAuthNoPriv) ---</span>
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-56"></a><span class="s"># THIS IS THE LEAST SECURE LEVEL AND SHOULD NEVER BE USED IN PRODUCTION!</span>
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-57"></a><span class="s"># It offers NO SECURITY WHATSOEVER. It&#39;s purely for very specific test scenarios</span>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-58"></a><span class="s"># where security is not a concern.</span>
</span><span id="__span-10-59"><a id="__codelineno-10-59" name="__codelineno-10-59" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-59"></a><span class="s">#</span>
</span><span id="__span-10-60"><a id="__codelineno-10-60" name="__codelineno-10-60" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-60"></a><span class="s"># Syntax: createUser USERNAME</span>
</span><span id="__span-10-61"><a id="__codelineno-10-61" name="__codelineno-10-61" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-61"></a><span class="s"># Example: createUser insecureuser</span>
</span><span id="__span-10-62"><a id="__codelineno-10-62" name="__codelineno-10-62" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-62"></a>
</span><span id="__span-10-63"><a id="__codelineno-10-63" name="__codelineno-10-63" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-63"></a><span class="s">createUser insecureuser</span>
</span><span id="__span-10-64"><a id="__codelineno-10-64" name="__codelineno-10-64" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-64"></a><span class="s">rouser insecureuser noAuthNoPriv</span>
</span><span id="__span-10-65"><a id="__codelineno-10-65" name="__codelineno-10-65" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-65"></a>
</span><span id="__span-10-66"><a id="__codelineno-10-66" name="__codelineno-10-66" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-66"></a><span class="s">#</span>
</span><span id="__span-10-67"><a id="__codelineno-10-67" name="__codelineno-10-67" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-67"></a><span class="s"># IMPORTANT SECURITY NOTES FOR ALL SNMPv3 USERS:</span>
</span><span id="__span-10-68"><a id="__codelineno-10-68" name="__codelineno-10-68" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-68"></a><span class="s"># - Replace the example usernames and passwords with your OWN strong, unique values.</span>
</span><span id="__span-10-69"><a id="__codelineno-10-69" name="__codelineno-10-69" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-69"></a><span class="s"># - Passwords must be a MINIMUM of 8 characters long.</span>
</span><span id="__span-10-70"><a id="__codelineno-10-70" name="__codelineno-10-70" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-70"></a><span class="s"># - The passwords for AUTH and PRIV (with authPriv) do not have to be the same.</span>
</span><span id="__span-10-71"><a id="__codelineno-10-71" name="__codelineno-10-71" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-71"></a><span class="s"># - Restrict access to specific IP addresses (e.g., &#39;rouser USERNAME authPriv 192.168.1.0/24&#39;)</span>
</span><span id="__span-10-72"><a id="__codelineno-10-72" name="__codelineno-10-72" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-72"></a><span class="s">#   if you want to further tighten access.</span>
</span><span id="__span-10-73"><a id="__codelineno-10-73" name="__codelineno-10-73" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-73"></a><span class="s">#</span>
</span><span id="__span-10-74"><a id="__codelineno-10-74" name="__codelineno-10-74" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-74"></a>
</span><span id="__span-10-75"><a id="__codelineno-10-75" name="__codelineno-10-75" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-75"></a>
</span><span id="__span-10-76"><a id="__codelineno-10-76" name="__codelineno-10-76" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-76"></a><span class="s"># --------------------------------------------------------------------------</span>
</span><span id="__span-10-77"><a id="__codelineno-10-77" name="__codelineno-10-77" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-77"></a><span class="s"># SYSTEM INFORMATION (OPTIONAL)</span>
</span><span id="__span-10-78"><a id="__codelineno-10-78" name="__codelineno-10-78" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-78"></a><span class="s"># --------------------------------------------------------------------------</span>
</span><span id="__span-10-79"><a id="__codelineno-10-79" name="__codelineno-10-79" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-79"></a><span class="s"># This information is generally available via SNMP and useful for identification.</span>
</span><span id="__span-10-80"><a id="__codelineno-10-80" name="__codelineno-10-80" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-80"></a><span class="s">syslocation  &quot;Rocky Linux Zabbix SNMP Lab Server&quot;</span>
</span><span id="__span-10-81"><a id="__codelineno-10-81" name="__codelineno-10-81" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-81"></a><span class="s">syscontact   &quot;Your Name &lt;your.email@example.com&gt;&quot;</span>
</span><span id="__span-10-82"><a id="__codelineno-10-82" name="__codelineno-10-82" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-82"></a><span class="s">sysname      &quot;RockySNMPHost01&quot; # Often overridden by hostname, but can be specific</span>
</span><span id="__span-10-83"><a id="__codelineno-10-83" name="__codelineno-10-83" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-83"></a>
</span><span id="__span-10-84"><a id="__codelineno-10-84" name="__codelineno-10-84" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-84"></a><span class="s"># --------------------------------------------------------------------------</span>
</span><span id="__span-10-85"><a id="__codelineno-10-85" name="__codelineno-10-85" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-85"></a><span class="s"># ENABLING CRUCIAL MIB MODULES FOR LLD</span>
</span><span id="__span-10-86"><a id="__codelineno-10-86" name="__codelineno-10-86" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-86"></a><span class="s"># --------------------------------------------------------------------------</span>
</span><span id="__span-10-87"><a id="__codelineno-10-87" name="__codelineno-10-87" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-87"></a><span class="s"># &#39;view&#39; statements determine which parts of the MIB tree are visible.</span>
</span><span id="__span-10-88"><a id="__codelineno-10-88" name="__codelineno-10-88" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-88"></a><span class="s"># &#39;systemview&#39; is a standard view. We ensure that the most useful OID trees</span>
</span><span id="__span-10-89"><a id="__codelineno-10-89" name="__codelineno-10-89" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-89"></a><span class="s"># for Zabbix LLD are included here.</span>
</span><span id="__span-10-90"><a id="__codelineno-10-90" name="__codelineno-10-90" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-90"></a>
</span><span id="__span-10-91"><a id="__codelineno-10-91" name="__codelineno-10-91" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-91"></a><span class="s"># Standard System MIBs (uptime, description, etc.)</span>
</span><span id="__span-10-92"><a id="__codelineno-10-92" name="__codelineno-10-92" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-92"></a><span class="s">view systemview included .1.3.6.1.2.1.1    # SNMPv2-MIB::sysDescr, sysUptime, etc.</span>
</span><span id="__span-10-93"><a id="__codelineno-10-93" name="__codelineno-10-93" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-93"></a>
</span><span id="__span-10-94"><a id="__codelineno-10-94" name="__codelineno-10-94" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-94"></a><span class="s"># HOST-RESOURCES-MIB: ESSENTIAL FOR LLD OF HARDWARE/OS COMPONENTS</span>
</span><span id="__span-10-95"><a id="__codelineno-10-95" name="__codelineno-10-95" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-95"></a><span class="s"># This MIB contains information about storage (filesystems), processors,</span>
</span><span id="__span-10-96"><a id="__codelineno-10-96" name="__codelineno-10-96" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-96"></a><span class="s"># installed software, running processes, etc.</span>
</span><span id="__span-10-97"><a id="__codelineno-10-97" name="__codelineno-10-97" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-97"></a><span class="s">view systemview included .1.3.6.1.2.1.25</span>
</span><span id="__span-10-98"><a id="__codelineno-10-98" name="__codelineno-10-98" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-98"></a>
</span><span id="__span-10-99"><a id="__codelineno-10-99" name="__codelineno-10-99" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-99"></a><span class="s"># IF-MIB: ESSENTIAL FOR LLD OF NETWORK INTERFACES</span>
</span><span id="__span-10-100"><a id="__codelineno-10-100" name="__codelineno-10-100" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-100"></a><span class="s"># Contains detailed information about network interfaces.</span>
</span><span id="__span-10-101"><a id="__codelineno-10-101" name="__codelineno-10-101" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-101"></a><span class="s">view systemview included .1.3.6.1.2.1.2</span>
</span><span id="__span-10-102"><a id="__codelineno-10-102" name="__codelineno-10-102" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-102"></a>
</span><span id="__span-10-103"><a id="__codelineno-10-103" name="__codelineno-10-103" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-103"></a><span class="s"># Other useful MIBs (often standard or optional)</span>
</span><span id="__span-10-104"><a id="__codelineno-10-104" name="__codelineno-10-104" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-104"></a><span class="s">view systemview included .1.3.6.1.2.1.4</span>
</span><span id="__span-10-105"><a id="__codelineno-10-105" name="__codelineno-10-105" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-105"></a><span class="s">view systemview included .1.3.6.1.2.1.6</span>
</span><span id="__span-10-106"><a id="__codelineno-10-106" name="__codelineno-10-106" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-106"></a><span class="s">view systemview included .1.3.6.1.2.1.7</span>
</span><span id="__span-10-107"><a id="__codelineno-10-107" name="__codelineno-10-107" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-107"></a>
</span><span id="__span-10-108"><a id="__codelineno-10-108" name="__codelineno-10-108" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-108"></a><span class="s"># --------------------------------------------------------------------------</span>
</span><span id="__span-10-109"><a id="__codelineno-10-109" name="__codelineno-10-109" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-109"></a><span class="s"># EXTENDING SNMPD WITH EXEC COMMANDS (OPTIONAL FOR CUSTOM LLD)</span>
</span><span id="__span-10-110"><a id="__codelineno-10-110" name="__codelineno-10-110" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-110"></a><span class="s"># --------------------------------------------------------------------------</span>
</span><span id="__span-10-111"><a id="__codelineno-10-111" name="__codelineno-10-111" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-111"></a><span class="s"># This allows you to make the output of shell commands or scripts available via SNMP.</span>
</span><span id="__span-10-112"><a id="__codelineno-10-112" name="__codelineno-10-112" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-112"></a><span class="s"># This is ideal for monitoring things not natively available via SNMP.</span>
</span><span id="__span-10-113"><a id="__codelineno-10-113" name="__codelineno-10-113" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-113"></a><span class="s"># Example: Monitor the number of logged-in users (not LLD, but demonstrates the principle)</span>
</span><span id="__span-10-114"><a id="__codelineno-10-114" name="__codelineno-10-114" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-114"></a><span class="s"># exec activeUsers /usr/bin/who | wc -l</span>
</span><span id="__span-10-115"><a id="__codelineno-10-115" name="__codelineno-10-115" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-115"></a>
</span><span id="__span-10-116"><a id="__codelineno-10-116" name="__codelineno-10-116" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-116"></a><span class="s"># Example: A script that generates LLD-like output</span>
</span><span id="__span-10-117"><a id="__codelineno-10-117" name="__codelineno-10-117" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-117"></a><span class="s"># imagine /opt/scripts/docker_lld.sh returns JSON that Zabbix can parse</span>
</span><span id="__span-10-118"><a id="__codelineno-10-118" name="__codelineno-10-118" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-118"></a><span class="s"># exec dockerContainers /opt/scripts/docker_lld.sh</span>
</span><span id="__span-10-119"><a id="__codelineno-10-119" name="__codelineno-10-119" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-119"></a><span class="s"># This requires a custom LLD parser in Zabbix. For an introduction, this</span>
</span><span id="__span-10-120"><a id="__codelineno-10-120" name="__codelineno-10-120" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-120"></a><span class="s"># might be a bit too advanced, but it&#39;s good to mention as a possibility.</span>
</span><span id="__span-10-121"><a id="__codelineno-10-121" name="__codelineno-10-121" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-121"></a>
</span><span id="__span-10-122"><a id="__codelineno-10-122" name="__codelineno-10-122" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-122"></a><span class="s"># --------------------------------------------------------------------------</span>
</span><span id="__span-10-123"><a id="__codelineno-10-123" name="__codelineno-10-123" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-123"></a><span class="s"># SYSLOGGING</span>
</span><span id="__span-10-124"><a id="__codelineno-10-124" name="__codelineno-10-124" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-124"></a><span class="s"># --------------------------------------------------------------------------</span>
</span><span id="__span-10-125"><a id="__codelineno-10-125" name="__codelineno-10-125" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-125"></a><span class="s"># For logging snmpd activities (useful for debugging)</span>
</span><span id="__span-10-126"><a id="__codelineno-10-126" name="__codelineno-10-126" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-126"></a><span class="s">dontLogTCPWrappers no</span>
</span><span id="__span-10-127"><a id="__codelineno-10-127" name="__codelineno-10-127" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-10-127"></a><span class="s">EOF</span>
</span></code></pre></div>
<p>Let's do some practical tests with this setup we just created. Start the SNMP Service
and Configure the Firewall</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-11-1"></a><span class="c1"># Start the SNMP daemon</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-11-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>snmpd
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-12-1"></a><span class="c1"># Enable it to start on boot</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-12-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>snmpd
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-13-1"></a><span class="c1"># Check that the service is running</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-13-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>snmpd
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-13-3"></a>If<span class="w"> </span>your<span class="w"> </span>system<span class="w"> </span>uses<span class="w"> </span>firewalld,<span class="w"> </span>ensure<span class="w"> </span>that<span class="w"> </span>SNMP<span class="w"> </span>traffic<span class="w"> </span>is<span class="w"> </span>allowed:
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-14-1"></a><span class="c1"># Add SNMP to permanent firewall rules</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-14-2"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--add-service<span class="o">=</span>snmp<span class="w"> </span>--permanent
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-15-1"></a><span class="c1"># Reload the firewall configuration</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-15-2"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-16-1"></a><span class="c1"># Confirm that SNMP is listed</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-16-2"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--list-services<span class="w"> </span>--permanent
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-1"></a>Verifying<span class="w"> </span>SNMP<span class="w"> </span>Functionality
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-2"></a>From<span class="w"> </span>your<span class="w"> </span>Zabbix<span class="w"> </span>server<span class="w"> </span>or<span class="w"> </span>any<span class="w"> </span>SNMP<span class="w"> </span>client<span class="w"> </span>system<span class="w"> </span>with<span class="w"> </span>net-snmp-utils<span class="w"> </span>installed:
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-4"></a><span class="c1"># Repace &lt;IP_ADDRESS&gt; wit the IP of the client where you installed the SNMP</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-5"></a><span class="c1"># config. If localhost you can use 127.0.0.1.</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-7"></a><span class="c1"># General system info (sysDescr, sysUptime, etc.)</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-8"></a>snmpwalk<span class="w"> </span>-v2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>&lt;IP_ADDRESS&gt;<span class="w"> </span>.1.3.6.1.2.1.1
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-9"></a>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-10"></a><span class="c1"># List interface names (useful for interface LLD)</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-11"></a>snmpwalk<span class="w"> </span>-v2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>&lt;IP_ADDRESS&gt;<span class="w"> </span>.1.3.6.1.2.1.2.2.1.2
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-12"></a>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-13"></a><span class="c1"># List filesystem descriptions</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-14"></a>snmpwalk<span class="w"> </span>-v2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>&lt;IP_ADDRESS&gt;<span class="w"> </span>.1.3.6.1.2.1.25.2.3.1.3
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-15"></a>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-16"></a><span class="c1"># Get CPU load per processor core</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-17-17"></a>snmpwalk<span class="w"> </span>-v2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>&lt;IP_ADDRESS&gt;<span class="w"> </span>.1.3.6.1.2.1.25.3.3.1.2
</span></code></pre></div>
<details class="note" open="open">
<summary>Note</summary>
<p>For SNMPv3 we can do the same. You could adapt the configuration file or just
go with what we have prepared already in the snmpd.conf file.</p>
</details>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-1"></a>vi<span class="w"> </span>/etc/snmp/snmpd.conf
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-2"></a>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-3"></a><span class="c1"># Look for the following lines and adapt them as you like.</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-5"></a>createUser<span class="w"> </span>authonlyuser<span class="w"> </span>SHA<span class="w"> </span><span class="s2">&quot;AuthOnlyP@ss3&quot;</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-6"></a>rouser<span class="w"> </span>authonlyuser<span class="w"> </span>authNoPriv
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-7"></a>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-8"></a>createUser<span class="w"> </span>secureuser<span class="w"> </span>SHA<span class="w"> </span><span class="s2">&quot;AuthP@ssSec#1&quot;</span><span class="w"> </span>AES<span class="w"> </span><span class="s2">&quot;PrivP@ssSec#2&quot;</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-9"></a>rouser<span class="w"> </span>secureuser<span class="w"> </span>authPriv
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-10"></a>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-11"></a>createUser<span class="w"> </span>insecureuser
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-18-12"></a>rouser<span class="w"> </span>insecureuser<span class="w"> </span>noAuthNoPriv
</span></code></pre></div>
<p>After you have adapted your config don't forget to restart the snmpd service</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-19-1"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>snmpd
</span></code></pre></div>
<p>You should now be able to test your items with SNMPv3 Let me give you an example
command for noAuthNoPriv,authNoPriv and the most secure authPriv. This should
work out of the box with what is already configured in our <code>snmpd.conf</code> file.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-20-1"></a>snmpwalk<span class="w"> </span>-v3<span class="w"> </span>-l<span class="w"> </span>noAuthNoPriv<span class="w"> </span>-u<span class="w"> </span>insecureuser<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>.1.3.6.1.2.1.2.2.1.2
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-20-2"></a>snmpwalk<span class="w"> </span>-v3<span class="w"> </span>-l<span class="w"> </span>authNoPriv<span class="w"> </span>-u<span class="w"> </span>authonlyuser<span class="w"> </span>-a<span class="w"> </span>SHA<span class="w"> </span>-A<span class="w"> </span>AuthOnlyP@ss3<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>.1.3.6.1.2.1.2.2.1.2
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-20-3"></a>snmpwalk<span class="w"> </span>-v3<span class="w"> </span>-l<span class="w"> </span>authPriv<span class="w"> </span>-u<span class="w"> </span>secureuser<span class="w"> </span>-a<span class="w"> </span>SHA<span class="w"> </span>-A<span class="w"> </span>AuthP@ssSec#1<span class="w"> </span>-x<span class="w"> </span>AES<span class="w"> </span>-X<span class="w"> </span>PrivP@ssSec#2<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>.1.3.6.1.2.1.2.2.1.2
</span></code></pre></div>
<details class="note" open="open">
<summary>Note</summary>
<p>If you change the config file and adapt the passwords and for some reason
they do not get accepted do not worry just restart the service again it things
still don't work you can remove the persistent key file
sudo rm /var/lib/net-snmp/snmpd.conf
It's quite brutal but in our test environment it will help you out.</p>
</details>
<hr />
<h2 id="ch04-zabbix-collecting-data-snmp-polling-snmp-monitoring-in-zabbix"><strong>SNMP Monitoring in Zabbix</strong></h2>
<p>Now that we have covered how SNMP works, it's time to put that knowledge into
practice. We'll start up our Zabbix instance and begin monitoring, but first,
it's crucial to understand the two different methods Zabbix offers for retrieving
SNMP information from a device.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-1"></a>The RFC3411 Specs specify that an EngineID needs to be unique this is very
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-2"></a>important for monitoring. You will see errors like Bad parse of ASN.1 if you
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-3"></a>have a conflict.
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-4"></a>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-5"></a>Within an administrative domain, an snmpEngineID is the unique and
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-6"></a>unambiguous identifier of an SNMP engine.  Since there is a one-to-
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-7"></a>one association between SNMP engines and SNMP entities, it also
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-8"></a>uniquely and unambiguously identifies the SNMP entity within that
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-9"></a>administrative domain.  Note that it is possible for SNMP entities in
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-10"></a>different administrative domains to have the same value for
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-11"></a>snmpEngineID.  Federation of administrative domains may necessitate
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-21-12"></a>assignment of new values.
</span></code></pre></div>
</div>
<hr />
<h4 id="ch04-zabbix-collecting-data-snmp-polling-legacy-snmp-monitoring"><strong>Legacy SNMP Monitoring</strong></h4>
<p>The traditional method for SNMP monitoring is synchronous. It uses a <strong>single OID</strong>
placed directly into the item's SNMP OID field. Zabbix will wait for a response
before it moves on to the next check.</p>
<ul>
<li><strong>OID</strong>: A single textual or numeric OID is used to retrieve a single value synchronously.
  For example: <code>1.3.6.1.2.1.31.1.1.1.6.3</code>.</li>
<li>The timeout for these items is governed by the <code>Timeout</code> parameter in the <strong>Zabbix
  server configuration file</strong>. To make this method functional, the <code>StartPollers</code>
  parameter must also be correctly configured.</li>
</ul>
<p>When we talk about bulk processing in legacy it can be interesting to have a look
at the Zabbix documentation about this subject.
<a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/snmp#internal-workings-of-combined-processing">https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/snmp#internal-workings-of-combined-processing</a></p>
<hr />
<h4 id="ch04-zabbix-collecting-data-snmp-polling-asynchronous-snmp-monitoring-recommended"><strong>Asynchronous SNMP Monitoring (Recommended)</strong></h4>
<p>The newer, <strong>recommended</strong> approach is asynchronous and provides much better
performance. It leverages native SNMP bulk requests (<code>GetBulkRequest-PDUs</code>).</p>
<ul>
<li><strong><code>walk[OID1, OID2, ...]</code></strong>: This retrieves a subtree of values. For
  <strong>example:</strong> <code>walk[1.3.6.1.2.1.2.2.1.2,1.3.6.1.2.1.2.2.1.3]</code>.</li>
<li><strong><code>get[OID]</code></strong>: This retrieves a single value asynchronously. For <strong>example:</strong>
  <code>get[1.3.6.1.2.1.31.1.1.1.6.3]</code>.</li>
</ul>
<p>With asynchronous monitoring, timeout settings can be configured per item. It's
best to set a low timeout value to avoid long delays if a device is unreachable,
as Zabbix will attempt up to 5 retries. A 3-second timeout, for instance, could
result in a 15-second wait.</p>
<p>All <code>walk[OID]</code> and <code>get[OID]</code> items are executed asynchronously, meaning Zabbix
does not need to wait for one response before starting other checks. DNS resolution
is also handled asynchronously. The maximum concurrency for these checks is 1000,
defined by the <code>MaxConcurrentChecksPerPoller</code> parameter. The number of SNMP pollers
dedicated to this method is set by the <code>StartSNMPPollers</code> parameter.</p>
<h4 id="ch04-zabbix-collecting-data-snmp-polling-synchronous-versus-asynchronous-polling">Synchronous versus Asynchronous Polling</h4>
<p>Zabbix can also use two different internal methods for polling:</p>
<p><strong>Synchronous Polling</strong></p>
<p>Synchronous polling means the Zabbix server queries one SNMP OID at a time and waits
for the response before continuing. This is simpler and ensures accurate timing,
but it can become slow when monitoring hundreds or thousands of items per second.</p>
<ul>
<li>Characteristics: Sequential, blocking, predictable timing</li>
<li>Use case: Small environments or when timing precision is critical</li>
</ul>
<p><strong>Asynchronous Polling</strong></p>
<p>Asynchronous polling sends multiple SNMP requests in parallel without waiting for
each response before sending the next. This dramatically increases performance
and reduces latency in large environments.</p>
<ul>
<li>Characteristics: Parallel, non-blocking, more efficient</li>
<li>Use case: Large-scale Zabbix installations with many SNMP hosts</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Direction</th>
<th style="text-align: left;">Timing</th>
<th style="text-align: left;">Example</th>
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Polling (Sync)</td>
<td style="text-align: left;">Zabbix ‚Üí Device</td>
<td style="text-align: left;">Periodic</td>
<td style="text-align: left;">SNMP GET for CPU load</td>
<td style="text-align: left;">Predictable, simple</td>
<td style="text-align: left;">Slower, more traffic</td>
</tr>
<tr>
<td style="text-align: left;">Polling (Async)</td>
<td style="text-align: left;">Zabbix ‚Üí Device</td>
<td style="text-align: left;">Parallel</td>
<td style="text-align: left;">Many SNMP GETs at once</td>
<td style="text-align: left;">Fast, scalable</td>
<td style="text-align: left;">More complex tuning</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="ch04-zabbix-collecting-data-snmp-polling-polling-your-first-oid-in-zabbix"><strong>Polling Your First OID in Zabbix</strong></h3>
<p>Let's begin by polling our first OID in Zabbix. As you may recall from a previous
<code>snmpwalk</code> command, querying <code>.1.3.6.1.2.1.2.2.1.2</code> returned two results, identifying
the network interfaces on the device:</p>
<ul>
<li><code>IF-MIB::ifDescr.1 = STRING: lo</code></li>
<li><code>IF-MIB::ifDescr.2 = STRING: enp0s1</code></li>
</ul>
<p>To find the inbound and outbound octets for the <code>enp0s1</code> network card, we need to
locate the correct OID. While a MIB file would provide a clear map of all available
OIDs, this isn't always an option. A common method to discover the correct OID is
to perform a broader <code>snmpwalk</code> by removing the last digit from the initial OID.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-22-1"></a>snmpwalk<span class="w"> </span>-v2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>&lt;IP_ADDRESS&gt;<span class="w"> </span>.1.3.6.1.2.1.2.2.1
</span></code></pre></div>
<p>This command returns a more extensive list of MIB objects.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-23-1"></a>IF-MIB::ifIndex.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-23-2"></a>IF-MIB::ifIndex.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">2</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-23-3"></a>IF-MIB::ifDescr.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>STRING:<span class="w"> </span>lo
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-23-4"></a>IF-MIB::ifDescr.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>STRING:<span class="w"> </span>enp0s1
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-23-5"></a>...
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-23-6"></a>IF-MIB::ifInOctets.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">697830615</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-23-7"></a>IF-MIB::ifInOctets.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">49954965</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-23-8"></a>...
</span></code></pre></div>
<p>From this output, we can see that the index for our target network card, <code>enp0s1</code>,
is <code>2</code>. This confirms that we can use this index to find the correct data.
The output <code>IF-MIB::ifInOctets.2 = Counter32: 49954965</code> appears to be the value
we need, but this is not the raw OID.</p>
<p>To convert this human-readable output into a numerical OID that Zabbix can use,
we can add the <code>-On</code> flag to our <code>snmpwalk</code> command, which converts the output
to its numerical form.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-24-1"></a>snmpwalk<span class="w"> </span>-v2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>&lt;IP_ADDRESS&gt;<span class="w"> </span>IF-MIB::ifInOctets.2<span class="w"> </span>-On
</span></code></pre></div>
<p>The result is the specific OID for the inbound octets on the <code>enp0s1</code> interface:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-25-1"></a>.1.3.6.1.2.1.2.2.1.10.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">50050587</span>
</span></code></pre></div>
<p>This is the OID you would use to configure an SNMP item in Zabbix to monitor the
network traffic for this specific interface.</p>
<p>Another useful tool that will help here is <code>snmptranslate</code> which does the same
thing and also the other way back.</p>
<div class="admonition info">
<p class="admonition-title">snmptranslate</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-26-1"></a>snmptranslate -On IF-MIB::ifInOctets.2
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-26-2"></a>.1.3.6.1.2.1.2.2.1.10.2
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-26-3"></a>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-26-4"></a>snmptranslate .1.3.6.1.2.1.2.2.1.10.2
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-26-5"></a>IF-MIB::ifInOctets.2
</span></code></pre></div>
</div>
<p>There is yet another tool that helps to visualise a SNMP table with the easy to
remember name ... <code>snmptable</code>. This tool allows you to see the data more easy
then a simple a snmp walk. To stay with our network cards have a look at this
output.</p>
<div class="admonition info">
<p class="admonition-title">snmptable</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-27-1"></a>snmptable<span class="w"> </span>-v<span class="w"> </span>2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>IF-MIB::ifTable
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-27-2"></a>SNMP<span class="w"> </span>table:<span class="w"> </span>IF-MIB::ifTable
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-27-3"></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-27-4"></a><span class="w"> </span>ifIndex<span class="w"> </span>ifDescr<span class="w">    </span>ifType<span class="w">           </span>ifMtu<span class="w">  </span>ifSpeed<span class="w">    </span>ifPhysAddress<span class="w">     </span>ifAdminStatus
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-27-5"></a><span class="w">   </span><span class="m">1</span><span class="w">      </span>lo<span class="w">        </span>softwareLoopback<span class="w"> </span><span class="m">65536</span><span class="w">  </span><span class="m">10000000</span><span class="w">                     </span>up
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-27-6"></a><span class="w">   </span><span class="m">2</span><span class="w">  </span>enp0s1<span class="w">        </span>ethernetCsmacd<span class="w">    </span><span class="m">1500</span><span class="w">        </span><span class="m">0</span><span class="w">    </span><span class="m">76</span>:ae:5:aa:5f:45<span class="w">  </span>up
</span></code></pre></div>
</div>
<h3 id="ch04-zabbix-collecting-data-snmp-polling-polling-a-single-snmp-item">Polling a single SNMP item</h3>
<p>Ok enough with the theory let's create an actual item in Zabbix. Create a new
host with the name <code>SNMP Device</code> and place it in a group <code>SNMP Devices</code>. We also
need to tell Zabbix where we can find our SNMP device as Zabbix is doing the
polling (Or if we use a Proxy it will be the proxy.)</p>
<p>So let's add a <code>SNMP Interface</code> and give it the IP of the device we would like
to monitor. If you have been following our steps on the local machine you can
use ip 127.0.0.1, our own server.</p>
<p><img alt="Host Interface" src="../ch04-zabbix-collecting-data/snmp-polling/ch04.29-snmp-host-.png" /></p>
<p><em>4.29 SNMP Interface</em></p>
<p>Once our host is created and saved with the correct interface we have to create
an item on the host. Click on <code>items</code> next to the host <code>SNMP Device</code>. On the top
right click the box <code>Create item</code> you will be greeted with another form to fill
in the item information.</p>
<ul>
<li><strong>Name:</strong> In traffic enp0s1 (A short descriptive name)</li>
<li><strong>Type:</strong> SNMP Agent</li>
<li><strong>Key:</strong> snmp.in (free form short descriptive)</li>
<li><strong>Type of information:</strong> Numeric(Unsigned)</li>
<li><strong>Host interface:</strong> The SNMP interface we created on our host. If you have
  more then 1 interface just select the one you need.</li>
<li><strong>SNMP OID:</strong> get[oid] to retrieve the information or only the oid but then it
  will use synchronous polling.</li>
<li><strong>Units:</strong> The data is in bytes so use B.</li>
</ul>
<p><img alt="snmp-polling/../ch04-zabbix-collecting-data/snmp-polling/ch04.30-snmp-item.png" src="../ch04-zabbix-collecting-data/snmp-polling/ch04.30-snmp-item.png" /></p>
<p><em>04.30 SNMP Item</em></p>
<p>Before we safe this item there is one more important step we need to do. Network
items are usually counters. Meaning the device is just counting the amount of
traffic that passed the interface. This means the counter will always go up as
more data passes the interface over time. So we need to calculate a delta.</p>
<p>For this we can use preprocessing steps so let's move to the tab <code>preprocessing</code>
first before we save it.</p>
<p>Add a preprocessing step with the name <code>Change per second</code></p>
<p><img alt="snmp-polling/../ch04-zabbix-collecting-data/snmp-polling/ch04.31-snmp-item-preprocessing.png" src="../ch04-zabbix-collecting-data/snmp-polling/ch04.31-snmp-item-preprocessing.png" /></p>
<p><em>snmp preprocessing</em></p>
<p>We can now safe the item and have a look at our latest data page we should have
a nice graph with our data over time.</p>
<p>If you decide to use the test button before you safe the item (this is always a
good idea then don't forget that Zabbix needs 2 item values tot calculate the
difference. ) So you will have to test the <code>Get value and test</code> button twice.</p>
<p>Also don't forget to select the <code>Get value from host</code> box so Zabbix retrieves it
from the host.</p>
<h4 id="ch04-zabbix-collecting-data-snmp-polling-how-does-change-per-second-work">How does change per second work ?</h4>
<p>Given a counter value sampled at two different times:</p>
<ul>
<li>At time ( t_1 ), the counter value is ( C_1 ).</li>
<li>At time ( t_2 ), the counter value is ( C_2 ).</li>
</ul>
<p>The change per second (rate) is calculated as:</p>
<p>$$
\text{Rate} = \frac{C_2 - C_1}{t_2 - t_1}
$$</p>
<p>where ( t_2 - t_1 ) is the time elapsed in seconds.</p>
<hr />
<p><strong>If the counter rolls over</strong> (i.e., ( C_2 &lt; C_1 )), and the max counter value is ( M ), then adjust as:</p>
<p>$$
\text{Rate} = \frac{(M - C_1) + C_2 + 1}{t_2 - t_1}
$$</p>
<h3 id="ch04-zabbix-collecting-data-snmp-polling-polling-a-list-of-item">Polling a list of item</h3>
<p>Let's do the same for our snmp walk item. This time we will look for the
information from all our interfaces. For this we need to find our correct OID
first. This can be done with <code>snmptranslate</code> which will convert our table name
to an OID,</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-28-1"></a>snmptranslate<span class="w"> </span>-On<span class="w"> </span>IF-MIB::ifTable
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-28-2"></a>.1.3.6.1.2.1.2.2
</span></code></pre></div>
<p>This is the OID we can use in our item. Let's clone our previous item and make
some changes.</p>
<ul>
<li><strong>Name:</strong> ifTable (or another descriptive name)</li>
<li><strong>Key:</strong> snmp.ifTable</li>
<li><strong>Type of information:</strong>: Text</li>
<li><strong>SNMP OID:</strong> walk[.1.3.6.1.2.1.2.2]</li>
</ul>
<p>The rest can stay as is just remove the preprocessing step we added in earlier
example as this item will return us a whole list of information.</p>
<p><img alt="snmp-polling/../ch04-zabbix-collecting-data/snmp-polling/ch04.32-snmp-walk.png" src="../ch04-zabbix-collecting-data/snmp-polling/ch04.32-snmp-walk.png" /></p>
<p><em>04.32 SNMP Walk</em></p>
<p>When we press the <code>Get value and test</code> button in the test item screen we get a
whole list of data.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-1"></a>.1.3.6.1.2.1.2.2.1.1.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-2"></a>.1.3.6.1.2.1.2.2.1.1.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">2</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-3"></a>.1.3.6.1.2.1.2.2.1.2.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>STRING:<span class="w"> </span><span class="s2">&quot;lo&quot;</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-4"></a>.1.3.6.1.2.1.2.2.1.2.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>STRING:<span class="w"> </span><span class="s2">&quot;enp0s1&quot;</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-5"></a>.1.3.6.1.2.1.2.2.1.3.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">24</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-6"></a>.1.3.6.1.2.1.2.2.1.3.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">6</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-7"></a>.1.3.6.1.2.1.2.2.1.4.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">65536</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-8"></a>.1.3.6.1.2.1.2.2.1.4.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">1500</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-9"></a>.1.3.6.1.2.1.2.2.1.5.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Gauge32:<span class="w"> </span><span class="m">10000000</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-10"></a>.1.3.6.1.2.1.2.2.1.5.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Gauge32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-11"></a>.1.3.6.1.2.1.2.2.1.6.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>STRING:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-12"></a>.1.3.6.1.2.1.2.2.1.6.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>STRING:<span class="w"> </span><span class="s2">&quot;76:ae:5:aa:5f:45&quot;</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-13"></a>.1.3.6.1.2.1.2.2.1.7.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-14"></a>.1.3.6.1.2.1.2.2.1.7.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-15"></a>.1.3.6.1.2.1.2.2.1.8.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-16"></a>.1.3.6.1.2.1.2.2.1.8.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>INTEGER:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-17"></a>.1.3.6.1.2.1.2.2.1.9.1<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-18"></a>.1.3.6.1.2.1.2.2.1.9.2<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-19"></a>.1.3.6.1.2.1.2.2.1.10.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">69417222</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-20"></a>.1.3.6.1.2.1.2.2.1.10.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">59215034</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-21"></a>.1.3.6.1.2.1.2.2.1.11.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">6460587</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-22"></a>.1.3.6.1.2.1.2.2.1.11.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">113038</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-23"></a>.1.3.6.1.2.1.2.2.1.12.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-24"></a>.1.3.6.1.2.1.2.2.1.12.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-25"></a>.1.3.6.1.2.1.2.2.1.13.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-26"></a>.1.3.6.1.2.1.2.2.1.13.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-27"></a>.1.3.6.1.2.1.2.2.1.14.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-28"></a>.1.3.6.1.2.1.2.2.1.14.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-29"></a>.1.3.6.1.2.1.2.2.1.15.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-30"></a>.1.3.6.1.2.1.2.2.1.15.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-31"></a>.1.3.6.1.2.1.2.2.1.16.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">69417222</span>
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-32"></a>.1.3.6.1.2.1.2.2.1.16.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">44139841</span>
</span><span id="__span-29-33"><a id="__codelineno-29-33" name="__codelineno-29-33" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-33"></a>.1.3.6.1.2.1.2.2.1.17.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">6460587</span>
</span><span id="__span-29-34"><a id="__codelineno-29-34" name="__codelineno-29-34" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-34"></a>.1.3.6.1.2.1.2.2.1.17.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">97398</span>
</span><span id="__span-29-35"><a id="__codelineno-29-35" name="__codelineno-29-35" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-35"></a>.1.3.6.1.2.1.2.2.1.18.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-36"><a id="__codelineno-29-36" name="__codelineno-29-36" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-36"></a>.1.3.6.1.2.1.2.2.1.18.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-37"><a id="__codelineno-29-37" name="__codelineno-29-37" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-37"></a>.1.3.6.1.2.1.2.2.1.19.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-38"><a id="__codelineno-29-38" name="__codelineno-29-38" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-38"></a>.1.3.6.1.2.1.2.2.1.19.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-39"><a id="__codelineno-29-39" name="__codelineno-29-39" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-39"></a>.1.3.6.1.2.1.2.2.1.20.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-40"><a id="__codelineno-29-40" name="__codelineno-29-40" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-40"></a>.1.3.6.1.2.1.2.2.1.20.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Counter32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-41"><a id="__codelineno-29-41" name="__codelineno-29-41" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-41"></a>.1.3.6.1.2.1.2.2.1.21.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>Gauge32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-42"><a id="__codelineno-29-42" name="__codelineno-29-42" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-42"></a>.1.3.6.1.2.1.2.2.1.21.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>Gauge32:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-29-43"><a id="__codelineno-29-43" name="__codelineno-29-43" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-43"></a>.1.3.6.1.2.1.2.2.1.22.1<span class="w"> </span><span class="o">=</span><span class="w"> </span>OID:<span class="w"> </span>.0.0
</span><span id="__span-29-44"><a id="__codelineno-29-44" name="__codelineno-29-44" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-29-44"></a>.1.3.6.1.2.1.2.2.1.22.2<span class="w"> </span><span class="o">=</span><span class="w"> </span>OID:<span class="w"> </span>.0.0
</span></code></pre></div>
<p>So we have the traffic in but we would like to find traffic out as well of
course. Let's use our walk item to extract the outgoing traffic for this we need
to create a dependent item.</p>
<p>Go to <code>Data collection</code> - <code>Hosts</code> and click on <code>Items</code>. You should be able to
see our newly created <code>ifTable</code> item and 3 dots before it's name.</p>
<p>Click on those 3 dots and select <code>Create dependent item</code> from the list.
Fill in the new item with the following information.</p>
<ul>
<li><strong>Name:</strong> Out traffic enp0s1</li>
<li><strong>Type:</strong> dependent item</li>
<li><strong>Key:</strong> snmp.out</li>
<li><strong>Type of information:</strong> Unsigned</li>
<li><strong>Master item:</strong> Already filled in but should be our item ifTable that we made
  before.</li>
<li><strong>Units:</strong> B</li>
</ul>
<p><img alt="snmp-polling/../ch04-zabbix-collecting-data/snmp-polling/ch04.33-snmp-dependent-item.png" src="../ch04-zabbix-collecting-data/snmp-polling/ch04.33-snmp-dependent-item.png" /></p>
<p><em>04.33 Dependent SNMP Item</em></p>
<p>This item as is at the moment is an exact copy of our master item so we need to
add some preprocessing steps first. Let's go to the tab <code>preprocessing</code> and add
our first step.</p>
<p>Add the step <code>SNMP walk value</code> and after it paste the OID we want <code>.1.3.6.1.2.1.2.2.1.16.1</code>
and choose <code>unchanged</code>.</p>
<div class="admonition info">
<p class="admonition-title">find our correct OID</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-30-1"></a>snmptranslate<span class="w"> </span>IF-MIB::ifOutOctets.1<span class="w"> </span>-On
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#ch04-zabbix-collecting-data-snmp-polling-__codelineno-30-2"></a>.1.3.6.1.2.1.2.2.1.16.1
</span></code></pre></div>
</div>
<p>Remember from our previous item we need to calculate the <code>Changes per second</code>
so add this as the second preprocessing step.</p>
<p><img alt="snmp-polling/../ch04-zabbix-collecting-data/snmp-polling/ch04.34-snmp-item-preprocessing.png" src="../ch04-zabbix-collecting-data/snmp-polling/ch04.34-snmp-item-preprocessing.png" /></p>
<p><em>04.34 preprocessing
steps</em></p>
<p>Going now to our latest data page will show use the In and Our traffic for our
network card but with data gathered in different ways. Both ways use the
synchronous pollers but the last way will gather all data at once and then
pre-process it.</p>
<p>After you have added more items you can remove the option to keep history from
your master items.</p>
<h2 id="ch04-zabbix-collecting-data-snmp-polling-conclusion">Conclusion</h2>
<p>SNMP polling remains a vital method for monitoring network devices when agents
aren't an option. With Zabbix's asynchronous polling, checks can run in parallel,
dramatically improving performance and lowering the load on both your server and
the network. SNMPv3 should be your go-to choice, delivering authentication and
encryption to secure sensitive data. The SNMP walk item type adds another advantage
collecting multiple metrics in bulk with a single request, making discovery and
ongoing polling faster and more efficient.</p>
<p>By combining these modern features with carefully tuned polling intervals and
item counts, you can create an SNMP setup that is secure, efficient, and scalable.
And with asynchronous speed, SNMPv3 security, and bulk walks at your disposal, you're
ready to monitor more devices, in less time, with greater confidence. Now it's
time to put these capabilities to work and see just how far your monitoring can
go.</p>
<h2 id="ch04-zabbix-collecting-data-snmp-polling-questions">Questions</h2>
<ul>
<li>Why is it better use SNMPv3 instead of v2c or v1 ?</li>
<li>Do I need to configure pollers for SNMP ? If so which pollers ?</li>
<li>Can I still use the old style to monitor SNMP ? Should I start using get[]
  and walk[] instead ?</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-snmp-polling-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/snmp">https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/snmp</a></li>
<li><a href="https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol">https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc3410">https://datatracker.ietf.org/doc/html/rfc3410</a></li>
<li><a href="https://blog.zabbix.com/zabbix-snmp-what-you-need-to-know-and-how-to-configure-it/10345/">https://blog.zabbix.com/zabbix-snmp-what-you-need-to-know-and-how-to-configure-it/10345/</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc3411#section-3.1.1.1">https://datatracker.ietf.org/doc/html/rfc3411#section-3.1.1.1</a></li>
</ul></section><section class="print-page" id="ch04-zabbix-collecting-data-snmp-trapping" heading-number="9.9"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="snmp-trapping">SNMP Trapping</h1>
<p>SNMP traps are one of the most powerful features in Zabbix network monitoring.
Unlike traditional SNMP polling, which periodically queries devices for status
updates, SNMP traps deliver real-time alerts directly from network equipment
the moment an event occurs, no waiting for the next polling cycle.</p>
<p>In this chapter, you'll learn how to set up SNMP trap handling in Zabbix, from
installing and configuring snmptrapd to integrating it with the Zabbix server.
You'll also discover how to analyse, filter, and map incoming traps using regular
expressions, and how to link them with triggers and notifications for instant
visibility into network issues.</p>
<p>Whether you're monitoring switches, routers, UPS systems, or firewalls, mastering
SNMP traps in Zabbix gives you faster event detection, reduced network load, and
deeper operational insight.</p>
<h2 id="ch04-zabbix-collecting-data-snmp-trapping-traps-versus-polling">Traps versus Polling</h2>
<p>In Zabbix, SNMP (Simple Network Management Protocol) is one of the most common
methods for monitoring network devices such as switches, routers, firewalls, and
UPS systems.
There are two main ways Zabbix can receive information from an SNMP-enabled device:</p>
<ul>
<li>Polling (active monitoring) See our topic SNMP Polling in Chapter 4.</li>
<li>Traps (passive monitoring)</li>
</ul>
<p>To understand the differences between trapping and polling and understand the
advantages and disadvantages lets have a quick overview:</p>
<ul>
<li>With SNMP polling, the Zabbix server or proxy periodically queries the device for
specific values using SNMP GET requests. For example, CPU load, interface status,
temperature ... The device responds with the current data, and Zabbix stores it
in the database.</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-polling">Polling</h3>
<p>Polling is a client initiated and scheduled process. It is predictable, reliable,
and suitable for continuous metrics that change over time.</p>
<p><strong>Advantages:</strong></p>
<ul>
<li>Easy to control frequency and timing.</li>
<li>Works even if the device doesn't support traps.</li>
<li>Historical trend data is consistent.</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
<li>Generates more network traffic on large infrastructures.</li>
<li>Delays between polls mean slower event detection.</li>
<li>If a device goes down, Zabbix won't notice until the next polling cycle. (This
can be detected by using the nodata function or using "SNMP agent availability"
item but not for individual items unless every items has the nodata function and
this is also a bad idea.)</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-trapping">Trapping</h3>
<p>SNMP traps work the opposite way. The device itself sends a message (trap) to the
Zabbix system when an event occurs. For example, a power failure, link down, or
temperature alarm. Zabbix listens for incoming traps via the snmptrapd daemon
and processes them through its SNMP trap item type.</p>
<p>Traps are event driven and asynchronous, meaning they are sent immediately when
something happens. No waiting or polling required.</p>
<p><strong>Advantages:</strong></p>
<ul>
<li>Instant notification of important events.</li>
<li>Reduces network load (no regular queries).</li>
<li>Ideal for devices that push alerts rather than respond to queries.</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
<li>Requires external configuration (snmptrapd, scripts, log parsing).</li>
<li>Not all devices send traps for all events.</li>
<li>If traps are missed or misconfigured, data is lost. (Traps use UDP)</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Direction</th>
<th style="text-align: left;">Timing</th>
<th style="text-align: left;">Example</th>
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Polling (Sync)</td>
<td style="text-align: left;">Zabbix ‚Üí Device</td>
<td style="text-align: left;">Periodic</td>
<td style="text-align: left;">SNMP GET for CPU load</td>
<td style="text-align: left;">Predictable, simple</td>
<td style="text-align: left;">Slower, more traffic</td>
</tr>
<tr>
<td style="text-align: left;">Polling (Async)</td>
<td style="text-align: left;">Zabbix ‚Üí Device</td>
<td style="text-align: left;">Parallel</td>
<td style="text-align: left;">Many SNMP GETs at once</td>
<td style="text-align: left;">Fast, scalable</td>
<td style="text-align: left;">More complex tuning</td>
</tr>
<tr>
<td style="text-align: left;">Traps</td>
<td style="text-align: left;">Device ‚Üí Zabbix</td>
<td style="text-align: left;">Event-driven</td>
<td style="text-align: left;">Interface down trap</td>
<td style="text-align: left;">Instant alerts, low load</td>
<td style="text-align: left;">Requires trap daemon, can miss events</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ch04-zabbix-collecting-data-snmp-trapping-snmp-traps-flow-in-zabbix">SNMP Traps flow in Zabbix</h2>
<pre  class="mermaid"><code>flowchart TB
    %% --- Traps section (top) ---
    subgraph TRAPS[Traps]
        direction TB
        TITLET["SNMP Traps<br/>Acrive Monitoring"]
        WIDE["                                                                 "]
        DEV2[Network Device]
        TRAPD[snmptrapd Daemon]
        HANDLER[SNMPTT or perl script]
        ZBXT[Zabbix Server or Proxy]
        DBT[Zabbix Database]
        UI2[Zabbix Frontend]
        USER2[User]

        TITLET --> DEV2
        DEV2 -->|SNMP Trap UDP 162| TRAPD
        TRAPD -->|Handler Script| HANDLER
        HANDLER -->|Trap Log| ZBXT
        ZBXT --> DBT
        DBT --> UI2
        UI2 -->|Displays event| USER2
    end

    %% --- Invisible connector to force vertical stacking ---
    TRAPS -.-> POLLING

    %% --- Polling section (bottom) ---
    subgraph POLLING[Polling]
        direction LR
        TITLEP["SNMP Polling<br/>Passive Monitoring"]
        ZBX[Zabbix Server or Proxy]
        DEV[Network Device]
        TITLEP --> ZBX
        ZBX -->|SNMP GET UDP 161| DEV
        DEV -->|SNMP Response| ZBX
        ZBX --> DBP[Zabbix Database]
        DBP --> UI1[Zabbix Frontend]
        UI1 -->|Displays polled data| USER1[User]
    end

    %% --- Styling ---
    style POLLING fill:#f0fff0,stroke:#3a3,stroke-width:1px
    style TRAPS fill:#f0f8ff,stroke:#339,stroke-width:1px
    style WIDE fill:none,stroke:none
    style TITLEP fill:transparent,stroke:transparent
    style TITLET fill:transparent,stroke:transparent
    style ZBX fill:#e0ffe0,stroke:#3a3
    style DEV fill:#ffefd5,stroke:#c96
    style DEV2 fill:#ffefd5,stroke:#c96
    style TRAPD fill:#f9f9f9,stroke:#777
    style HANDLER fill:#f0f8ff,stroke:#339
    style ZBXT fill:#e0ffe0,stroke:#3a3
    style DBP fill:#fffbe0,stroke:#996
    style DBT fill:#fffbe0,stroke:#996
    style UI1 fill:#e8e8ff,stroke:#669
    style UI2 fill:#e8e8ff,stroke:#669
    style USER1 fill:#fff0f0,stroke:#c33
    style USER2 fill:#fff0f0,stroke:#c33
</code></pre>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-snmp-trap-flow-active-monitoring">SNMP Trap Flow (Active Monitoring)</h3>
<p>In an SNMP Trap setup, communication is device initiated. Meaning the network
device sends an event message to Zabbix the moment something happens.
This is called active monitoring because Zabbix doesn't need to query the device
periodically.</p>
<p><strong>Step-by-step flow:</strong></p>
<ul>
<li>
<p><strong>Network Device:</strong>
When an event occurs (for example, a power failure, interface down, or temperature
alarm), the device immediately sends an SNMP Trap to the configured destination
on UDP port 162.</p>
</li>
<li>
<p><strong>snmptrapd Daemon:</strong>
The Net-SNMP daemon <strong>snmptrapd</strong>  listens for incoming traps.
It acts as a relay between the device and Zabbix, executing a handler script
whenever a trap is received.</p>
</li>
<li>
<p><strong>Trap Handler / Log File:</strong>
The handler script (often zabbix_trap_receiver.pl or SNMPTT) processes the trap
and writes it into a log file, usually "/var/log/snmptrap/snmptrap.log."
This file contains the raw trap data including timestamps, source IPs, and OIDs.</p>
</li>
<li>
<p><strong>Zabbix Server or Proxy:</strong>
The Zabbix component (server or proxy) monitors the trap log for new entries and
matches them against configured SNMP trap items. These items use regular expressions
or string filters to extract relevant data.</p>
</li>
<li>
<p><strong>Zabbix Database:</strong>
Once processed, the trap information is stored in the database like any other
item value.</p>
</li>
<li>
<p><strong>Zabbix Frontend:</strong>
The event becomes visible in the Zabbix frontend almost instantly showing up in
Latest Data, Problems, or triggering actions and notifications based on your configuration.</p>
</li>
</ul>
<details class="note" open="open">
<summary>Note</summary>
<p>SNMP traps deliver real-time alerts without polling overhead, making them
ideal for event driven devices like UPSs, firewalls, or network switches.</p>
</details>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-snmp-polling-flow-passive-monitoring"><strong>SNMP Polling Flow (Passive Monitoring)</strong></h3>
<p>In contrast, SNMP Polling is Zabbix initiated.
This is called passive monitoring because the Zabbix server (or proxy)  queries
the device at a set interval to retrieve values.</p>
<p><strong>Step-by-step flow:</strong></p>
<ul>
<li>
<p><strong>Zabbix Server or Proxy:</strong>
Periodically sends an SNMP GET request to the device using UDP port 161.
Each SNMP item in Zabbix corresponds to a specific OID (Object Identifier) that
defines which metric is requested (e.g., CPU usage, interface status).</p>
</li>
<li>
<p><strong>Network Device:</strong>
Responds to the SNMP GET request with the current value of the requested OID.</p>
</li>
<li>
<p><strong>Zabbix Database:</strong>
The response data is stored in the database with a timestamp for trend analysis
and historical graphing.</p>
</li>
<li>
<p><strong>Zabbix Frontend:</strong>
Displays the collected values in graphs, dashboards, and triggers thresholds if
defined.</p>
</li>
</ul>
<details class="note" open="open">
<summary>Note</summary>
<p>Polling provides consistent, periodic data collection. Ideal for metrics like
bandwidth usage, temperature, or CPU load. However, it may have a small delay
between data updates depending on the polling interval (e.g., every 30s,
1min, etc.).</p>
</details>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-summary">Summary</h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>SNMP Traps (Active)</th>
<th>SNMP Polling (Passive)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Initiator</strong></td>
<td>Network Device</td>
<td>Zabbix</td>
</tr>
<tr>
<td><strong>Direction</strong></td>
<td>Device ‚Üí Zabbix</td>
<td>Zabbix ‚Üí Device</td>
</tr>
<tr>
<td><strong>Transport Port</strong></td>
<td>UDP 162</td>
<td>UDP 161</td>
</tr>
<tr>
<td><strong>Frequency</strong></td>
<td>Event-driven (immediate)</td>
<td>Periodic (configurable interval)</td>
</tr>
<tr>
<td><strong>Resource Usage</strong></td>
<td>Lower (only on events)</td>
<td>Higher (regular queries)</td>
</tr>
<tr>
<td><strong>Data Type</strong></td>
<td>Event notifications</td>
<td>Continuous metrics</td>
</tr>
<tr>
<td><strong>Best for</strong></td>
<td>Fault and alert notifications</td>
<td>Performance and trend monitoring</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In production Zabbix environments, many administrators combine both methods:
- Use SNMP polling for regular metrics (e.g., interface traffic, system uptime).
- Use SNMP traps for immediate events (e.g., link down, power failure).
This hybrid approach gives you both real-time alerts and historical performance
data, achieving complete SNMP visibility with minimal overhead.</p>
</div>
<hr />
<h2 id="ch04-zabbix-collecting-data-snmp-trapping-setting-up-snmp-traps-with-zabbix_trap_receiver">Setting up SNMP traps with zabbix_trap_receiver</h2>
<p>In this section, we'll configure Zabbix to receive and process SNMP traps using
the Perl script zabbix_trap_receiver.pl. SNMP traps allow network devices to actively
send event information to the Zabbix server, enabling near real-time alerting without
periodic polling.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-open-the-firewall-for-snmp-trap-traffic"><strong>Open the Firewall for SNMP Trap Traffic</strong></h3>
<p>By default, SNMP traps are received on UDP port 162.
Make sure this port is open on your Zabbix server:</p>
<div class="admonition info">
<p class="admonition-title">Open firewall port 162/udp</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-0-1"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--add-port<span class="o">=</span><span class="m">162</span>/udp<span class="w"> </span>--permanent
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-0-2"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-1-1"></a>sudo ufw allow 162/udp
</span></code></pre></div></p>
</div>
<p>This allows incoming traps from SNMP-enabled devices.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-install-required-snmp-packages"><strong>Install Required SNMP Packages</strong></h3>
<p>The snmptrapd daemon and Perl bindings are needed for trap handling.</p>
<div class="admonition info">
<p class="admonition-title">Install needed packages</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-2-1"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>net-snmp-utils<span class="w"> </span>net-snmp-perl<span class="w"> </span>net-snmp
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-3-1"></a>sudo apt install snmpd snmp libsnmp-dev snmptrapd
</span></code></pre></div></p>
</div>
<p>This installs the SNMP tools, daemon, and Perl modules used by Zabbix's receiver
script.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-install-zabbix_trap_receiverpl"><strong>Install zabbix_trap_receiver.pl</strong></h3>
<p>Download the latest zabbix_trap_receiver.pl script from the official
Zabbix source archive <a href="https://cdn.zabbix.com/zabbix/sources/stable/">https://cdn.zabbix.com/zabbix/sources/stable/</a></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-4-1"></a>sudo<span class="w"> </span>wget<span class="w"> </span>https://cdn.zabbix.com/zabbix/sources/stable/8.0/zabbix-8.0.0.tar.gz
</span></code></pre></div>
<p>Once downloaded, extract the file and copy the script to /usr/bin and make it executable:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-5-1"></a>sudo<span class="w"> </span>tar<span class="w"> </span>-xvf<span class="w"> </span>zabbix-8.0.0.tar.gz
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-5-2"></a>sudo<span class="w"> </span>cp<span class="w"> </span>zabbix-8.0.0/misc/snmptrap/zabbix_trap_receiver.pl<span class="w"> </span>/usr/bin/.
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-5-3"></a>sudo<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>/usr/bin/zabbix_trap_receiver.pl
</span></code></pre></div>
<p>This script receives traps from snmptrapd and writes them to a log file that Zabbix
can read.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-configure-snmptrapd"><strong>Configure snmptrapd</strong></h3>
<p>Edit the SNMP trap daemon configuration file:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-6-1"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/snmp/snmptrapd.conf
</span></code></pre></div>
<p>Append the following lines:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-7-1"></a>authCommunity<span class="w"> </span>execute<span class="w"> </span>public
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-7-2"></a>perl<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="s2">&quot;/usr/bin/zabbix_trap_receiver.pl&quot;</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-explanation"><strong>Explanation:</strong></h3>
<ul>
<li>authCommunity execute public allows traps from devices using the community
  string public.</li>
<li>The perl do line executes the Zabbix Perl handler for each incoming trap.</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-edit-the-perl-script"><strong>Edit the perl script</strong></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-8-1"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/usr/bin/zabbix_trap_receiver.pl
</span></code></pre></div>
<p>Replace <code>$SNMPTrapperFile = '/tmp/zabbix_traps.tmp';</code> with:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-9-1"></a><span class="nv">$SNMPTrapperFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/var/log/zabbix_traps_archive/zabbix_traps.log&#39;</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-enable-snmp-trap-support-in-zabbix"><strong>Enable SNMP Trap Support in Zabbix</strong></h3>
<p>Edit the Zabbix server configuration file:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-10-1"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/zabbix/zabbix_server.conf
</span></code></pre></div>
<p>Uncomment or add the following parameters:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-11-1"></a><span class="nv">StartSNMPTrapper</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-11-2"></a><span class="nv">SNMPTrapperFile</span><span class="o">=</span>/var/log/zabbix_traps_archive/zabbix_traps.log
</span></code></pre></div>
<details class="note" open="open">
<summary>Note</summary>
<ul>
<li>StartSNMPTrapper=1 enables the Zabbix SNMP trapper process.</li>
<li>The SNMPTrapperFile path must match exactly the path used inside zabbix_trap_receiver.pl.</li>
</ul>
</details>
<p>Restart the Zabbix server to apply changes:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-12-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>zabbix-server
</span></code></pre></div>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-enable-and-start-snmptrapd"><strong>Enable and Start snmptrapd</strong></h3>
<p>Activate and start the SNMP trap daemon so it launches at boot:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-13-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>snmptrapd<span class="w"> </span>--now
</span></code></pre></div>
<p>This service will now listen on UDP 162 and feed incoming traps to Zabbix.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-optional-rotate-the-trap-log-file"><strong>(Optional) Rotate the Trap Log File</strong></h3>
<p>Zabbix writes all traps into a temporary log file.
To prevent this file from growing indefinitely, configure log rotation.</p>
<p>Create the directory:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-14-1"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/log/zabbix_traps_archive
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-14-2"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/var/log/zabbix_traps_archive
</span></code></pre></div>
On ubuntu only :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-15-1"></a>chown<span class="w"> </span>Debian-snmp:<span class="w"> </span>/var/log/zabbix_traps_archive/
</span></code></pre></div>
<p>Next we create a logrotate configuration file <code>/etc/logrotate.d/zabbix_traps</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-16-1"></a>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/logrotate.d/zabbix_traps
</span></code></pre></div>
<p>Add the following content to this file.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-1"></a>/var/log/zabbix_traps_archive/zabbix_traps.log<span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-2"></a><span class="w">    </span>weekly
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-3"></a><span class="w">    </span>size<span class="w"> </span>10M
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-4"></a><span class="w">    </span>compress
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-5"></a><span class="w">    </span>notifempty
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-6"></a><span class="w">    </span>dateext
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-7"></a><span class="w">    </span>dateformat<span class="w"> </span>-%Y%m%d
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-8"></a><span class="w">    </span>missingok
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-9"></a><span class="w">    </span>olddir<span class="w"> </span>/var/log/zabbix_traps_archive
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-10"></a><span class="w">    </span>maxage<span class="w"> </span><span class="m">365</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-11"></a><span class="w">    </span>rotate<span class="w"> </span><span class="m">10</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-17-12"></a><span class="o">}</span>
</span></code></pre></div>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-conclusion"><strong>Conclusion</strong></h3>
<p>You've now configured Zabbix to:</p>
<ul>
<li>Listen for SNMP traps on UDP 162</li>
<li>Use snmptrapd and zabbix_trap_receiver.pl to capture traps</li>
<li>Write traps to a Zabbix-monitored log file</li>
<li>Rotate the trap log automatically</li>
<li>Verify correct trap delivery and troubleshoot via SELinux if needed</li>
</ul>
<p>Once traps are arriving, you can create SNMP trap items in Zabbix (type SNMP trap,
key snmptrap[regex]) to trigger events, alerts, and dashboards.</p>
<h2 id="ch04-zabbix-collecting-data-snmp-trapping-setting-up-snmp-traps-with-bash-parser">Setting up SNMP traps with bash parser</h2>
<p>Using <code>perl</code> parser script might feel the only way to do trap parsing which
is not true. <code>bash</code> script will use less dependencies and can be shortcut
to get a working setup faster.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-bash-script-to-accept-the-trap">Bash script to accept the trap</h3>
<p>Create a file <code>/usr/bin/zabbix_trap_receiver.sh</code> with content:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-2"></a>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-3"></a><span class="c1"># Outcome will be produced into a file</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-4"></a><span class="nv">OUT</span><span class="o">=</span>/var/log/zabbix_traps_archive/zabbix_traps.log
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-6"></a><span class="c1"># Put contents of SNMP trap from stdin into a variable</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-7"></a><span class="nv">ALL</span><span class="o">=</span><span class="k">$(</span>tee<span class="k">)</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-8"></a>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-9"></a><span class="c1"># Extract IP where trap is coming from</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-10"></a><span class="nv">HOST</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ALL</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^UDP&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-Eo<span class="w"> </span><span class="s2">&quot;[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-11"></a>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-12"></a><span class="c1"># Append SNMP trap into the log file</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-13"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ZBXTRAP </span><span class="nv">$HOST</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-14"></a><span class="k">$(</span>date<span class="k">)</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-18-15"></a><span class="nv">$ALL</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>--append<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUT</span><span class="s2">&quot;</span>
</span></code></pre></div>
<p>The most important part is for the message to hold keyword <code>ZBXTRAP</code>
which is followed by IP address.</p>
<div class="admonition tip">
<p class="admonition-title">tip</p>
<p>The bash <code>HOST</code> variable can be redefined to extract an IP address
from actual trap message, therefore giving an opportunity
automatically forward and store message in appropriate host in Zabbix.</p>
</div>
<p>To enable trap parser inside <code>/etc/snmp/snmptrapd.conf</code> instead of using:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-19-1"></a>perl do &quot;/usr/bin/zabbix_trap_receiver.pl&quot;;
</span></code></pre></div>
<p>use:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-20-1"></a>traphandle default /usr/bin/zabbix_trap_receiver.sh
</span></code></pre></div>
<hr />
<h2 id="ch04-zabbix-collecting-data-snmp-trapping-testing-and-debugging">Testing and debugging</h2>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-to-test-rotation-manually">To test rotation manually</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-21-1"></a>sudo<span class="w"> </span>logrotate<span class="w"> </span>--force<span class="w"> </span>/etc/logrotate.d/zabbix_traps
</span></code></pre></div>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-testing-snmp-trap-reception">Testing SNMP Trap Reception</h3>
<p>We can simulate a trap manually using the snmptrap command.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-22-1"></a>Example<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>SNMP<span class="w"> </span>v1<span class="w"> </span>Test<span class="w"> </span>Trap
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-22-2"></a>sudo<span class="w"> </span>snmptrap<span class="w"> </span>-v<span class="w"> </span><span class="m">1</span><span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="s1">&#39;.1.3.6.1.6.3.1.1.5.4&#39;</span><span class="w"> </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">33</span><span class="w"> </span><span class="s1">&#39;55&#39;</span><span class="w"> </span>.1.3.6.1.6.3.1.1.5.4<span class="w"> </span>s<span class="w"> </span><span class="s2">&quot;eth0&quot;</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-23-1"></a>Example<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>SNMP<span class="w"> </span>v2c<span class="w"> </span>Test<span class="w"> </span>Trap
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-23-2"></a>sudo<span class="w"> </span>snmptrap<span class="w"> </span>-v<span class="w"> </span>2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>localhost<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="m">1</span>.3.6.1.4.1.8072.2.3.0.1<span class="w"> </span><span class="m">1</span>.3.6.1.4.1.8072.2.3.2.1<span class="w"> </span>i<span class="w"> </span><span class="m">123456</span>
</span></code></pre></div>
<p>While using "zabbix_trap_receiver.pl" as a parser, the perl dependencies will be
validated only at the runtime when receiving the actual message. It can be handy
to see if the status of service is still healthy. Running the "status" for the
systemd service automatically prints the most recent log lines of snmptrapd.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-24-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>snmptrapd
</span></code></pre></div>
<p>For troubleshooting efficiency:</p>
<ul>
<li>
<p>Wrong order is: restart service, run status, send trap</p>
</li>
<li>
<p>Correct order is: restart service, send trap, run status</p>
</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-testing-snmp-trap-reception-without-upd-channel">Testing SNMP Trap reception without UPD channel</h3>
<p>This method helps to simulate an SNMP trap message even if device currently
cannot send one.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-25-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ZBXTRAP 127.0.0.1</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-25-2"></a><span class="k">$(</span>date<span class="k">)</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-25-3"></a><span class="s2">line two</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-25-4"></a><span class="s2">line three&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>--append<span class="w"> </span>/var/log/zabbix_traps_archive/zabbix_traps.log
</span></code></pre></div>
<p>The most important part is having keyword "ZBXTRAP" (all caps) followed by the
IP address. The IP must belong to an <strong>existing SNMP interface</strong> behind 
Zabbix proxy/server.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-validate-if-proxyserver-runs-a-correct-mapping">Validate if proxy/server runs a correct mapping</h3>
<p>If the host is not yet made in frontend, that is perfect opportunity to validate
if Zabbix proxy/server service has recognised the mapping with a zabbix_traps.log file.</p>
<p>Every time the trap message is sent (and the device is not yet registered in GUI), 
it should print a line about "unmatched trap received from"</p>
<p>Send a test trap</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-26-1"></a>sudo snmptrap -v 1 -c public 127.0.0.1 &#39;.1.3.6.1.6.3.1.1.5.4&#39; &#39;0.0.0.0&#39; 6 33 &#39;55&#39; .1.3.6.1.6.3.1.1.5.4 s &quot;eth0&quot;
</span></code></pre></div>
<p>Check immediately</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-27-1"></a>date
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-27-2"></a>grep<span class="w"> </span><span class="s2">&quot;unmatched trap received from&quot;</span><span class="w"> </span>/var/log/zabbix/zabbix_proxy.log
</span></code></pre></div>
<p>If the line appear, it's a solid indication the settings about
StartSNMPTrapper and SNMPTrapperFile is configured correctly.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-selinux-considerations">SELinux considerations</h3>
<p>If SELinux is enabled and traps are not being processed, check for denied actions:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-28-1"></a>sudo<span class="w"> </span>ausearch<span class="w"> </span>-m<span class="w"> </span>AVC,USER_AVC<span class="w"> </span>-ts<span class="w"> </span>recent
</span></code></pre></div></p>
<p>Adjust SELinux policies or create exceptions for /usr/bin/zabbix_trap_receiver.pl and the trap log directory as needed.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-optional-snmpv3-trap-configuration">(Optional) SNMPv3 Trap Configuration</h3>
<p>If using SNMPv3 for secure traps, you can define users directly in snmptrapd.conf:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-29-1"></a>createUser<span class="w"> </span>-e<span class="w"> </span>&lt;engineid&gt;<span class="w"> </span>&lt;user&gt;<span class="w"> </span>SHA<span class="w"> </span>&lt;key&gt;<span class="w"> </span>AES<span class="w"> </span>&lt;key&gt;
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-29-2"></a>authUser<span class="w"> </span>log,execute<span class="w"> </span>&lt;user&gt;
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-29-3"></a>perl<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="s2">&quot;/usr/bin/zabbix_trap_receiver.pl&quot;</span><span class="p">;</span>
</span></code></pre></div>
<p>This adds authentication and encryption for trap communication.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-desperate-snmptrapdconf-for-snmpv2">Desperate snmptrapd.conf for SNMPv2</h3>
<p>If community names for SNMPv2 traps are not known and deadlines are approaching,
we can allow every SNMP trap message to come in
by ignoring all community names.</p>
<p>Add at the beginning of existing configuration file add:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-30-1"></a>disableAuthorization yes 
</span></code></pre></div>
<p>For example with a bash parser it's enough to have only 2 active lines
to make it functional and have confidence that trap receiving is working.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-31-1"></a>echo &quot;
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-31-2"></a># Allow everyone to register a message
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-31-3"></a>disableAuthorization yes
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-31-4"></a>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-31-5"></a># Forward message to parser script
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-31-6"></a>traphandle default /usr/bin/zabbix_trap_receiver.sh
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-31-7"></a>&quot; | sudo tee /etc/snmp/snmptrapd.conf
</span></code></pre></div>
<p>This is only applicable to SNMPv2 traps. This will not work with SNMPv3 traps.</p>
<h2 id="ch04-zabbix-collecting-data-snmp-trapping-trap-mapping-and-preprocessing">Trap mapping and preprocessing</h2>
<p>With SNMP traps now configured and the trap receiver operational, the next step
is to create a host in the Zabbix frontend so we can link incoming traps to a
specific monitored device.</p>
<p>In the Zabbix web interface, navigate to:
Data collection ‚Üí Hosts, and click Create host.</p>
<ul>
<li><strong>Hostname :</strong> Network Switch 01</li>
<li><strong>Host groups :</strong> SNMP Devices</li>
<li><strong>Interfaces :</strong> SNMP with IP 127.0.0.1</li>
</ul>
<p><img alt="snmp-traps/ch04.35-snmp-host.png" src="../ch04-zabbix-collecting-data/snmp-traps/ch04.35-snmp-host.png" /></p>
<p>In Zabbix, the macro {$SNMP_COMMUNITY} is often defined globally under Administration
‚Üí Macros. This global macro provides a default SNMP community string used by all
hosts that rely on SNMP for polling or trap-based communication.</p>
<p>However, a better approach, especially in larger or more secure environments is
to define a unique SNMP community per device and override the global macro at the
host level. This allows for more granular access control and simplifies troubleshooting
when multiple community strings are used across the network.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-sending-a-test-trap">Sending a Test Trap</h3>
<p>With the host and trap receiver configured, we can now simulate a link down event
from our device by sending an SNMP trap manually from the command line:</p>
<p>On the command line we can now sent a trap to mimic a Link down on our device.
<code>snmptrap -v 2c -c public 127.0.0.1 '' 1.3.6.1.6.3.1.1.5.3</code></p>
<p>This command sends a version 2c SNMP trap using the community string public to
the local Zabbix trap receiver, emulating a linkDown event defined by
OID 1.3.6.1.6.3.1.1.5.3.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-verifying-trap-reception">Verifying Trap Reception</h3>
<p>After sending the test trap, open the Zabbix frontend and navigate to:
<code>Monitoring</code> ‚Üí <code>Latest data</code></p>
<p>Select the host <code>Network Switch 01</code>.
If everything is configured correctly, you should now see data populated in your
SNMP trap item, confirming that Zabbix successfully received and processed the
trap.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-1"></a>2025-10-13T21:10:58+0200 PDU INFO:
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-2"></a>  errorindex                     0
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-3"></a>  notificationtype               TRAP
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-4"></a>  messageid                      0
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-5"></a>  transactionid                  2
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-6"></a>  receivedfrom                   UDP: [127.0.0.1]:50483-&gt;[127.0.0.1]:162
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-7"></a>  community                      public
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-8"></a>  requestid                      57240481
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-9"></a>  version                        1
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-10"></a>  errorstatus                    0
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-11"></a>VARBINDS:
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-12"></a>  DISMAN-EVENT-MIB::sysUpTimeInstance type=67 value=Timeticks: (227697) 0:37:56.97
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-32-13"></a>  SNMPv2-MIB::snmpTrapOID.0      type=6  value=OID: IF-MIB::linkDown
</span></code></pre></div>
<p>Sending a More Realistic Trap Example</p>
<p>In a real production environment, SNMP traps usually include additional variable
bindings (varbinds) that describe the state of the affected interface or component.
To better simulate a real-world scenario, we can extend our previous test command
to include this extra information.</p>
<p>Run the following command on the Zabbix server:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-33-1"></a>snmptrap<span class="w"> </span>-v<span class="w"> </span>2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-33-2"></a><span class="w">  </span>IF-MIB::linkDown<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-33-3"></a><span class="w">  </span>IF-MIB::ifIndex<span class="w"> </span>i<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-33-4"></a><span class="w">  </span>IF-MIB::ifAdminStatus<span class="w"> </span>i<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-33-5"></a><span class="w">  </span>IF-MIB::ifOperStatus<span class="w"> </span>i<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-33-6"></a><span class="w">  </span>IF-MIB::ifName<span class="w"> </span>s<span class="w"> </span><span class="s2">&quot;Gi0/1&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-33-7"></a><span class="w">  </span>IF-MIB::ifDescr<span class="w"> </span>s<span class="w"> </span><span class="s2">&quot;GigabitEthernet0/1&quot;</span>
</span></code></pre></div>
This will give use the following output:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-1"></a>2025-10-13T21:53:15+0200 PDU INFO:
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-2"></a>  errorstatus                    0
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-3"></a>  version                        1
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-4"></a>  requestid                      139495039
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-5"></a>  community                      public
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-6"></a>  transactionid                  14
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-7"></a>  receivedfrom                   UDP: [127.0.0.1]:35753-&gt;[127.0.0.1]:162
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-8"></a>  messageid                      0
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-9"></a>  notificationtype               TRAP
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-10"></a>  errorindex                     0
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-11"></a>VARBINDS:
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-12"></a>  DISMAN-EVENT-MIB::sysUpTimeInstance type=67 value=Timeticks: (481390) 1:20:13.90
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-13"></a>  SNMPv2-MIB::snmpTrapOID.0      type=6  value=OID: IF-MIB::linkDown
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-14"></a>  IF-MIB::ifIndex                type=2  value=INTEGER: 1
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-15"></a>  IF-MIB::ifAdminStatus          type=2  value=INTEGER: 1
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-16"></a>  IF-MIB::ifOperStatus           type=2  value=INTEGER: 1
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-17"></a>  IF-MIB::ifName                 type=4  value=STRING: &quot;Gi0/1&quot;
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-34-18"></a>  IF-MIB::ifDescr                type=4  value=STRING: &quot;GigabitEthernet0/1&quot;
</span></code></pre></div>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-optional-bulletproof-solution">(optional) Bulletproof solution</h3>
<p>Official Zabbix SNMP templates do not require installing MIB files, targeting
raw OIDs for data polling. If we continue this style for trapping too
we can create a dependency free solution by enabling a "numerical" flag inside
/etc/snmp/snmptrapd.conf</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-35-1"></a>outputOption n
</span></code></pre></div>
<p>Edit the file, restart the snmptrapd service, send test trap, and check the log:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-36-1"></a>tail -99 /var/log/zabbix_traps_archive/zabbix_traps.log
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">In long run</p>
<p>Using a numerical traps will take much more time to design a template.
More time in creating items and triggers. Due to the '.' (dot) symbol of
being a special character in the regular expression world, the items
keys will require to escape. This makes solution not visually pleasant.
Ignoring escaping the '.' will also work 99.9% of time, but it violates the
idea of bulletproof and precise solution.</p>
</div>
<hr />
<p>Using numerical traps can be best direction if:</p>
<ul>
<li>
<p>There is a big passion about bulletproof solution. Creating solution with
bare minimum dependencies - MIBs are never required for Zabbix proxies.</p>
</li>
<li>
<p>Template readability is not an issue. You are only person in the
monitoring department. There are no team mates.</p>
</li>
<li>
<p>Have a lot of time to design solution</p>
</li>
<li>
<p>You are willing to share your masterpiece with the internet.
Perhaps share it at GitHub</p>
</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-creating-snmp-trap-items">Creating SNMP Trap Items</h3>
<p>Now that our host is configured and we've verified that traps are being received,
we can create a set of items to store and process the trap data in a structured way.</p>
<p>We‚Äôll start with a catch-all (fallback) item that captures every SNMP trap received
for this host. Then we'll add two dependent items to extract specific values such
as the administrative and operational interface status.</p>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-creating-the-snmp-fallback-item">Creating the SNMP Fallback Item</h3>
<p>This item serves as the master collector for all incoming traps. Any dependent
items you create later will use this as their source.</p>
<p>In the Zabbix frontend, navigate to
<code>Data collection</code> ‚Üí <code>Hosts</code> ‚Üí <code>Network Switch 01</code> ‚Üí <code>Items</code>
and click Create item.</p>
<p>Configure the following parameters:</p>
<ul>
<li><strong>Name:</strong> SNMP Trap: Fallback</li>
<li><strong>Type:</strong> SNMP trap</li>
<li><strong>Key:</strong> snmptrap.fallback</li>
<li><strong>Type of information:</strong> Text</li>
</ul>
<p>Next we will create 2 dependent items. One item for the ifAdminStatus and another
one for the ifOperStatus. You can do this by clicking on the 3 dots before our
fallback item or by just creating a new item and selecting type <code>Dependent item</code></p>
<ul>
<li><strong>Name:</strong> Trap ifAdminStatus</li>
<li><strong>Type:</strong> Dependent item</li>
<li><strong>Key:</strong> trap.ifAdminStatus</li>
<li><strong>Type of information:</strong> Numeric(unsigned)</li>
<li><strong>Master item:</strong> (Select your fallback item as master item)</li>
</ul>
<p>Click on the <code>preprocessing</code> tab and select <code>Regular expression</code>.
use <code>IF-MIB::ifAdminStatus[\s\S]*?INTEGER:\s+(\d+)</code> in the Parameters field and
<code>\1</code> in the Output box.</p>
<p>Select the box <code>Custom on fail</code> and use the option <code>Discard value</code>.</p>
<p><img alt="snmp-traps/ch04.36-snmp-preprocessing.png" src="../ch04-zabbix-collecting-data/snmp-traps/ch04.36-snmp-preprocessing.png" /></p>
<p>Next we create our second item also dependent on our Fallback item.</p>
<ul>
<li><strong>Name:</strong> Trap ifOperStatus</li>
<li><strong>Type:</strong> Dependent item</li>
<li><strong>Key:</strong> trap.ifAdminStatus</li>
<li><strong>Type of information:</strong> Numeric(unsigned)</li>
<li><strong>Master item:</strong> (Select your fallback item as master item)</li>
</ul>
<p>Again go to the <code>Preprocessing</code> tab and enter following information.</p>
<p>Select <code>Regular expression</code> and for Parameters enter <code>IF-MIB::ifOperStatus[\s\S]*?INTEGER:\s+(\d+)</code>
and <code>\1</code> in the Output box.</p>
<p>Again add a <code>Custom on fail</code> step and select <code>Discard value</code>.</p>
<p><img alt="ch04.37-snmp-preprocessing.png" src="../ch04-zabbix-collecting-data/snmp-traps/ch04.36-snmp-preprocessing.png" /></p>
<p>We have our items now but we still are missing our trigger. Go back to your host
and click on the triggers and add the following trigger.</p>
<p><strong>Name:</strong> Problem (Link down:)
<strong>Severity:</strong> Warning</p>
<p><strong>Problem expression:</strong> <code>last(/Network Switch 01/trap.ifOperStatus)=2 and last(/Network Switch 01/trap.ifAdminStatus)=2</code></p>
<p><strong>Recovery expression:</strong> <code>last(/Network Switch 01/trap.ifOperStatus)=1 and last(/Network Switch 01/trap.ifAdminStatus)=1</code></p>
<p><img alt="snmp-traps/ch04.38-snmp-trigger.png" src="../ch04-zabbix-collecting-data/snmp-traps/ch04.38-snmp-trigger.png" /></p>
<p>Make sure to also select the box <code>Allow manual close.</code> This can help to close
the problem in case we don't receive a TRAP.</p>
<p>You should now be able to sent a trap to open and close a problem in Zabbix
based on the status of the ifOperStatus and the ifAdminStatus </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-37-1"></a>snmptrap<span class="w"> </span>-v<span class="w"> </span>2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>IF-MIB::linkDown<span class="w">   </span>IF-MIB::ifIndex<span class="w"> </span>i<span class="w"> </span><span class="m">1</span><span class="w">   </span>IF-MIB::ifAdminStatus<span class="w"> </span>i<span class="w"> </span><span class="m">2</span><span class="w">   </span>IF-MIB::ifOperStatus<span class="w"> </span>i<span class="w"> </span><span class="m">2</span><span class="w">   </span>IF-MIB::ifName<span class="w"> </span>s<span class="w"> </span><span class="s2">&quot;Gi0/1&quot;</span><span class="w">   </span>IF-MIB::ifDescr<span class="w"> </span>s<span class="w"> </span><span class="s2">&quot;GigabitEthernet0/1&quot;</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-37-2"></a>snmptrap<span class="w"> </span>-v<span class="w"> </span>2c<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>IF-MIB::linkDown<span class="w">   </span>IF-MIB::ifIndex<span class="w"> </span>i<span class="w"> </span><span class="m">1</span><span class="w">   </span>IF-MIB::ifAdminStatus<span class="w"> </span>i<span class="w"> </span><span class="m">1</span><span class="w">   </span>IF-MIB::ifOperStatus<span class="w"> </span>i<span class="w"> </span><span class="m">1</span><span class="w">   </span>IF-MIB::ifName<span class="w"> </span>s<span class="w"> </span><span class="s2">&quot;Gi0/1&quot;</span><span class="w">   </span>IF-MIB::ifDescr<span class="w"> </span>s<span class="w"> </span><span class="s2">&quot;GigabitEthernet0/1&quot;</span>
</span></code></pre></div>
<p>As a bonus you can add on the host a value map and link the items with it.</p>
<p><img alt="snmp-traps/ch04.39-snmp-valuemap.png" src="../ch04-zabbix-collecting-data/snmp-traps/ch04.39-snmp-valuemap.png" /></p>
<p>If you don't like 2 different items and want to be more fancy you could create
an dependent item like we did above and use JS instead of perl regex.</p>
<p><div class="language-JavaScript highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-2"></a>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-3"></a><span class="kd">function</span><span class="w"> </span><span class="nx">grab</span><span class="p">(</span><span class="nx">re</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-4"></a><span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">re</span><span class="p">);</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">m</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-6"></a><span class="p">}</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-7"></a>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-8"></a><span class="c1">// Extract fields from your sample payload</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-9"></a><span class="kd">var</span><span class="w"> </span><span class="nx">ifName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">grab</span><span class="p">(</span><span class="sr">/IF-MIB::ifName[\s\S]*?STRING:\s+&quot;([^&quot;]+)&quot;/m</span><span class="p">);</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-10"></a><span class="kd">var</span><span class="w"> </span><span class="nx">admin</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nx">grab</span><span class="p">(</span><span class="sr">/IF-MIB::ifAdminStatus[\s\S]*?INTEGER:\s+(\d+)/m</span><span class="p">);</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-11"></a><span class="kd">var</span><span class="w"> </span><span class="nx">oper</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nx">grab</span><span class="p">(</span><span class="sr">/IF-MIB::ifOperStatus[\s\S]*?INTEGER:\s+(\d+)/m</span><span class="p">);</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-12"></a>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-13"></a><span class="c1">// Map 1/2/3 -&gt; up/down/testing</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="o">:</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="o">:</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="o">:</span><span class="s1">&#39;testing&#39;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-15"></a><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">map</span><span class="p">[</span><span class="nx">admin</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">admin</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">;</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-16"></a><span class="kd">var</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">map</span><span class="p">[</span><span class="nx">oper</span><span class="p">]</span><span class="w">  </span><span class="o">||</span><span class="w"> </span><span class="nx">oper</span><span class="w">  </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">;</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-17"></a><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ifName</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;ifName=?&#39;</span><span class="p">;</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-18"></a>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-38-19"></a><span class="k">return</span><span class="w"> </span><span class="s1">&#39;interface=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; adminStatus=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; operStatus=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">o</span><span class="p">;</span>
</span></code></pre></div>
This will return output in latest data like <code>interface=Gi0/1 adminStatus=down operStatus=down</code></p>
<p>Another solution way more easy could be to create a specific item instead of
falling back on the fallback item that looks exactly for a link that goes Down
or Up. This can be done by creating a specific item like this:</p>
<p><code>snmptrap["IF-MIB::link(Down|Up)"]</code></p>
<p>We could then create a trigger like:
<code>str(/Network Switch 01/snmptrap["IF-MIB::link(Down|Up)"],"IF-MIB::linkDown")=1</code>
and a recovery trigger like :
<code>str(/Network Switch 01/snmptrap["IF-MIB::link(Down|Up)"],"IF-MIB::linkUp")=1</code></p>
<p>As you can see the solutions are endless and SNMP traps are not so easy and
probably need some tweaking before you have it all working like you want.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>The snmptrap.fallback is a good point to start with if you have no clue what
traps to expect it can help you to discover all the traps and stay to be sure
you catch all traps even if they are not configured on your host.</p>
</details>
<h2 id="ch04-zabbix-collecting-data-snmp-trapping-deploying-bare-minimum-mib-files">Deploying bare minimum MIB files</h2>
<p>Gathering proper MIB files might sounds a tedious and time consuming task.</p>
<p>Installing too many MIBs will cause degradation for the
SNMP trap translation process and slow down the SNMP polling process.</p>
<p>Here is an universal method (treat it as one option) on how to obtain bare minimum
MIBs to work with most of devices. This is useful for SNMP polling too.</p>
<p>The project <a href="https://github.com/netdisco/netdisco-mibs">https://github.com/netdisco/netdisco-mibs</a>
exist for 20 years and is a collection of MIBs for a lot of vendors. Dare I say: all vendors?</p>
<p>To install/replace the Linux distribution stock MIB bundle:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-1"></a><span class="c1"># move to /tmp</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-2"></a><span class="nb">cd</span><span class="w"> </span>/tmp
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-3"></a>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-4"></a><span class="c1"># download</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-5"></a>curl<span class="w"> </span>-kL<span class="w"> </span>https://github.com/netdisco/netdisco-mibs/archive/refs/heads/master.zip<span class="w"> </span>-o<span class="w"> </span>/tmp/netdisco-mibs.zip
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-6"></a>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-7"></a><span class="c1"># unpack. this will create &#39;/tmp/netdisco-mibs-master&#39; directory</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-8"></a>unzip<span class="w"> </span>/tmp/netdisco-mibs.zip<span class="w"> </span>-d<span class="w"> </span>/tmp
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-9"></a>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-10"></a><span class="c1"># remove existing/official MIBs from Linux distribution</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-11"></a>rm<span class="w"> </span>-rf<span class="w"> </span>/usr/share/snmp/mibs/*
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-12"></a>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-13"></a><span class="c1"># install Netdisco collection. it will move all directories which start with lower case letter or digit</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-14"></a>find<span class="w"> </span>/tmp/netdisco-mibs-master<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-name<span class="w"> </span><span class="s1">&#39;[a-z0-9]*&#39;</span><span class="w"> </span>-exec<span class="w"> </span>mv<span class="w"> </span><span class="o">{}</span><span class="w"> </span>/usr/share/snmp/mibs/<span class="w"> </span><span class="se">\;</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-15"></a>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-16"></a><span class="c1"># list what is installed</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-17"></a>ls<span class="w"> </span>-1<span class="w"> </span>/usr/share/snmp/mibs
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-18"></a>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-19"></a><span class="c1"># cleanup</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-39-20"></a>rm<span class="w"> </span>-rf<span class="w"> </span>/tmp/netdisco*
</span></code></pre></div>
<p>To enable bare minimum MIBs we need to enable two catalogs "rfc" and "net-snmp".</p>
<p>Overwrite/replace configuration by using:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-40-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-40-2"></a><span class="s2">mibs :</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-40-3"></a><span class="s2">mibdirs /usr/share/snmp/mibs/rfc:/usr/share/snmp/mibs/net-snmp</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-40-4"></a><span class="s2">mibs +ALL</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-40-5"></a><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/snmp/snmp.conf
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Fun fact</p>
<p>Modifying /etc/snmp/snmp.conf file the changes are applied on the fly.
No need to restart anything.</p>
</div>
<h3 id="ch04-zabbix-collecting-data-snmp-trapping-include-another-vendor">Include another vendor</h3>
<p>Let's say we need to work with Cisco equipment. We can double-check if vendor
is included in Netdisco bundle. Grep for case insensitive name:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-41-1"></a>ls<span class="w"> </span>-1<span class="w"> </span>/usr/share/snmp/mibs<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>Cisco
</span></code></pre></div>
<p>If the vendor is in list, then include "cisco" directory
together with "rfc" and "net-snmp" directory, like this:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-42-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-42-2"></a><span class="s2">mibs :</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-42-3"></a><span class="s2">mibdirs /usr/share/snmp/mibs/rfc:/usr/share/snmp/mibs/net-snmp:/usr/share/snmp/mibs/cisco</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-42-4"></a><span class="s2">mibs +ALL</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#ch04-zabbix-collecting-data-snmp-trapping-__codelineno-42-5"></a><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/snmp/snmp.conf
</span></code></pre></div>
<p>Adding multiple vendors is possible but it will slow down the translation speed.
Adding plus one vendor usually add at least 1s more to the translation speed.</p>
<h2 id="ch04-zabbix-collecting-data-snmp-trapping-conclusion_1">Conclusion</h2>
<p>We started by setting up the trap reception environment using snmptrapd and the
zabbix_trap_receiver.pl script, then integrated it into Zabbix through the SNMP
Trapper process.
You also learned how to open the necessary firewall ports, configure log rotation
for the trap file, and verify successful reception using test traps.</p>
<p>In the Zabbix frontend, we created a host representing our SNMP device, added
a catch-all trap item, and built dependent items to extract key values such as
ifAdminStatus and ifOperStatus.
From there, we constructed a simple yet effective trigger pair that raises an alert
when a linkDown trap is received and automatically resolves it when a linkUp trap
arrives.</p>
<p>Combine traps with SNMP polling to balance real-time alerts with long-term
performance metrics.</p>
<p>SNMP traps are one of the most powerful mechanisms in Zabbix for achieving proactive
monitoring. When properly configured, they provide immediate visibility into the
health and state of your infrastructure, allowing you to respond to issues the
moment they happen, not minutes later.</p>
<h2 id="ch04-zabbix-collecting-data-snmp-trapping-questions">Questions</h2>
<ul>
<li>What is the key difference between SNMP polling and SNMP traps in how they collect data?</li>
<li>Why are SNMP traps often described as active monitoring while SNMP polling is passive?</li>
<li>What is the purpose of the zabbix_trap_receiver.pl script, and where is it defined in the SNMP configuration?</li>
<li>What role does the parameter StartSNMPTrapper play in zabbix_server.conf?</li>
<li>In what kind of situations would you prefer SNMP traps over polling?</li>
<li>How could you use SNMP traps in combination with SNMP polling for a hybrid monitoring strategy?</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-snmp-trapping-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/snmptrap">https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/snmptrap</a></li>
<li><a href="https://git.zabbix.com/projects/ZBX/repos/zabbix/browse/misc/snmptrap">https://git.zabbix.com/projects/ZBX/repos/zabbix/browse/misc/snmptrap</a></li>
<li><a href="https://www.net-snmp.org/">https://www.net-snmp.org/</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc3416">https://datatracker.ietf.org/doc/html/rfc3416</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc1905">https://datatracker.ietf.org/doc/html/rfc1905</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc1157">https://datatracker.ietf.org/doc/html/rfc1157</a></li>
</ul></section><section class="print-page" id="ch04-zabbix-collecting-data-http" heading-number="9.10"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="http-items">HTTP Items</h1>
<p>In modern environments, monitoring stops being useful the moment you only check
whether a port is open. Applications, platforms, and integrations increasingly
communicate over HTTP-based APIs, and if you want to understand whether something
is actually working, you need to monitor it at that level.</p>
<p>The HTTP agent item allows Zabbix to act as a native HTTP client. It can send HTTP
or HTTPS requests, authenticate, include custom headers, send payloads, and process
responses as structured monitoring data. This makes it possible to monitor REST
APIs, web services, internal microservices, SaaS integrations, and even the Zabbix
API itself,without external scripts or custom agents.</p>
<p>At a beginner level, the HTTP agent answers the question ‚Äúdoes this endpoint respond?‚Äù.
At an expert level, it answers ‚Äúis this application behaving correctly, securely,
and predictably under real conditions?‚Äù.</p>
<p>With the release of the Zabbix 7.x serie, the HTTP agent has become more efficient and
user friendly, featuring realtime configuration validation and improved connection
handling.</p>
<h3 id="ch04-zabbix-collecting-data-http-how-the-http-agent-item-works">How the HTTP Agent Item Works</h3>
<p>An HTTP agent item is executed by the Zabbix server or a Zabbix proxy. For each
execution, Zabbix performs exactly one HTTP request based on the configured parameters
and stores a result derived from the response.</p>
<p>Zabbix does not decide whether a response is ‚Äúgood‚Äù or ‚Äúbad‚Äù. It records facts:
headers and body content. Interpretation is left entirely to preprocessing and
triggers. This design makes the HTTP agent item flexible enough
to support both simple availability checks and advanced API monitoring.</p>
<p>Internally, Zabbix uses libcurl to perform HTTP and HTTPS requests. This is an
important implementation detail. Redirect handling, TLS negotiation, proxy
behavior, timeout semantics, and error reporting all follow curl behavior.
If a request can be reproduced successfully using the curl command line, it can
almost always be made to work in Zabbix with the same parameters.</p>
<h4 id="ch04-zabbix-collecting-data-http-efficiency-persistent-and-asynchronous-connections">Efficiency: Persistent and Asynchronous Connections</h4>
<p>Since Zabbix 7.0, the HTTP agent supports Persistent Connections. Instead of
opening and closing a new TCP connection for every check, Zabbix can keep the
connection open. This significantly reduces CPU overhead and network latency,
especially when polling high frequency API endpoints.</p>
<p>Also since Zabbix 7.0 HTTP pollers are asynchronous, execution order and timing
are not as simple as ‚Äúone poller, one request‚Äù.</p>
<p>An HTTP poller can initiate hundreds of requests, (1000 per poller to be precise)
wait for responses, and process completed transactions while other requests are
still in flight. This makes HTTP monitoring efficient, but it also means that
slow endpoints do not block fast ones, as long as poller capacity is not exhausted.</p>
<p>However, timeouts still matter. A large number of slow or failing endpoints with
long timeouts can consume concurrency slots and reduce effective throughput. This
is another reason why conservative timeout values and reasonable polling intervals
are critical in large environments.</p>
<p>Understanding that HTTP agent items are asynchronous helps explain why increasing
poller counts rarely fixes poorly behaving endpoints.</p>
<h3 id="ch04-zabbix-collecting-data-http-core-request-configuration">Core Request Configuration</h3>
<p>Every HTTP agent item starts with a URL. This must be a fully qualified HTTP or
HTTPS endpoint, including the scheme and path. Zabbix sends exactly what you
configure; it does not infer protocols or rewrite requests.</p>
<p>The <strong>request method</strong> defines how the request is sent. GET is the default and works
well for most health checks and read only API calls. POST, PUT, PATCH, and DELETE
are available and commonly required for REST APIs that expect structured input.</p>
<p>When the chosen method supports it, a request body can be defined. The body is
sent verbatim. Zabbix does not validate JSON syntax, escape characters, or infer
content types. Any formatting errors are passed directly to the remote endpoint.</p>
<p>To ensure the request is interpreted correctly, HTTP headers can be defined explicitly.
This is where authentication tokens, API keys, content types, and vendorspecific
headers belong. Headers are static per item, which is intentional and has implications
for advanced use cases discussed later.</p>
<ul>
<li><strong>Request Method:</strong> GET is the default, but POST, PUT, PATCH, and DELETE are
  available for interactive APIs.</li>
<li><strong>Request Body:</strong> You can define a body for methods like POST. Zabbix has improved
  the handling of JSON and XML types. When you select these, Zabbix automatically
  sets the correct Content-Type header (e.g., application/json) if you haven't
  specified one manually.</li>
</ul>
<p>Headers: This is where authentication tokens and vendor-specific requirements belong.</p>
<p><strong>Expert Tip :</strong> Always use Secret Macros (e.g., {$API.TOKEN}) for headers containing
credentials to ensure they are masked in the UI and logs.</p>
<h3 id="ch04-zabbix-collecting-data-http-https-certificates-and-trust">HTTPS, Certificates, and Trust</h3>
<p>HTTPS support for HTTP agent items depends on the environment in which the Zabbix
server or proxy runs. HTTP agent items do not maintain their own certificate store.
All TLS validation is performed using the system trust store available to the
Zabbix process.</p>
<p>If an endpoint uses an internal or private certificate authority, that CA must
be trusted by the operating system running Zabbix. Installing a certificate in
a browser does nothing for Zabbix.</p>
<p>Disabling certificate verification at the item level may make errors disappear,
but it also disables meaningful security checks, including hostname validation.
In production environments, this should be treated as a temporary diagnostic step,
not a solution.</p>
<p>For APIs that require mutual TLS, Zabbix supports client certificates. The HTTP
agent item references the certificate and private key, but the files themselves
must exist on disk and be readable by the Zabbix process. Permission issues here
often surface as generic TLS failures, so testing with curl using the same certificate
and key is strongly recommended.</p>
<h3 id="ch04-zabbix-collecting-data-http-timeouts-what-they-really-mean">Timeouts: What They Really Mean</h3>
<p>The timeout parameter of the HTTP agent item is often misunderstood, and the
distinction matters in production.</p>
<p>The configured timeout is not a single, shared budget for the entire request.
Instead, it is applied to multiple blocking phases of the HTTP transaction,
following libcurl behavior.</p>
<p>Conceptually, the timeout applies to:</p>
<ul>
<li>DNS resolution</li>
<li>TCP connection establishment</li>
<li>TLS handshake (for HTTPS)</li>
<li>Sending the request</li>
<li>Waiting for the response</li>
<li>Receiving the response body</li>
</ul>
<p>These phases occur sequentially, and each phase can consume up to the configured
timeout.</p>
<p>As a result, the total wall clock execution time can exceed the configured timeout.
This is why users sometimes observe behavior that looks like ‚Äúdouble timeout‚Äù.</p>
<p>For example, with a timeout of 10 seconds:</p>
<ul>
<li>Connection and TLS negotiation take 9 seconds</li>
<li>The server then takes 9 seconds to respond</li>
</ul>
<p>The request may complete after roughly 18 seconds without violating timeout rules.</p>
<p>This is not a bug. It is a consequence of exposing a single timeout value rather
than separate connect and read timeouts.</p>
<p>From an expert perspective, this means the timeout should not be treated as a
strict SLA boundary. Always leave margin between expected response time and
configured timeout, especially for APIs that perform backend processing.</p>
<h3 id="ch04-zabbix-collecting-data-http-what-becomes-the-item-value">What Becomes the Item Value</h3>
<p>The HTTP agent item allows you to choose what part of the HTTP response is stored
as the item value.</p>
<p>Zabbix can store the response body, the response headers, or the HTTP status code.
This choice has architectural implications.</p>
<p>Storing the full response body allows multiple dependent items to extract different
values from a single request. Storing only the status code creates a lightweight
availability or correctness check with minimal processing overhead.</p>
<p>At scale, choosing the correct retrieval mode reduces API load, minimizes network
traffic, and keeps Zabbix performance predictable.</p>
<h3 id="ch04-zabbix-collecting-data-http-preprocessing-and-structured-data">Preprocessing and Structured Data</h3>
<p>Most APIs return structured data, commonly JSON. Preprocessing allows Zabbix to
extract specific values using JSONPath expressions, regular expressions, or text
transformations.</p>
<p>A common expert pattern is to create one HTTP agent item that retrieves structured
data and several dependent items that extract individual metrics. This avoids
repeated API calls and ensures consistency between related values.</p>
<p>Preprocessing is performed entirely on the Zabbix side after the request completes
and does not affect the request itself.</p>
<h3 id="ch04-zabbix-collecting-data-http-http-agent-pollers-and-server-configuration">HTTP Agent Pollers and Server Configuration</h3>
<p>HTTP agent items are executed by a dedicated pool of processes called HTTP pollers.
These are separate from regular pollers and are configured explicitly in the Zabbix
server or proxy configuration file.</p>
<p>The number of HTTP pollers is controlled by the StartHTTPAgentPollers parameter.
If this value is set to zero, HTTP agent items will not be executed at all, regardless
of how many are configured in the frontend. This is an easy oversight when enabling
HTTP monitoring for the first time.</p>
<p>Choosing the correct number of HTTP pollers is not about matching the number of
items one-to-one. Since Zabbix 7.0, HTTP pollers are fully asynchronous. A single
HTTP poller can manage up to 1000 concurrent HTTP requests internally, using
non-blocking I/O.</p>
<p>This is a fundamental architectural change compared to older Zabbix versions and
explains why HTTP agent items scale far better than many users expect. Increasing
StartHTTPAgentPollers is usually only required when dealing with extreme request
volumes, very slow endpoints, or aggressive timeout values.</p>
<p>From an expert perspective, it is often better to tune timeouts and polling intervals
before increasing the number of HTTP pollers. Adding pollers increases concurrency,
but it also increases memory usage and outbound network pressure.</p>
<h3 id="ch04-zabbix-collecting-data-http-accepted-http-response-codes-and-unsupported-items">Accepted HTTP Response Codes and Unsupported Items</h3>
<p>By default, Zabbix expects HTTP responses to return status codes that are explicitly
allowed for the item. If the response code does not match what is configured, the
item becomes unsupported.</p>
<p>This behavior is often misunderstood. An unsupported item is not the same as a 
failed check. It indicates that Zabbix considers the response invalid for this
item's definition.</p>
<p>Zabbix allows you to define accepted response codes in a flexible way. You can
specify a single code, a comma-separated list of codes, or ranges of codes. This
makes it possible to model real application behavior accurately.</p>
<p>For example, some APIs legitimately return 204 No Content on success, while others
use 202 Accepted for asynchronous processing. If these codes are not listed as
acceptable, Zabbix will mark the item unsupported even though the service is
behaving correctly.</p>
<p>At an expert level, this mechanism is extremely useful. It allows you to distinguish
between ‚Äúthe endpoint responded, but not in an acceptable way‚Äù and genuine
transport-level failures such as timeouts or TLS errors.</p>
<h3 id="ch04-zabbix-collecting-data-http-redirect-handling-limits">Redirect Handling Limits</h3>
<p>When redirect following is enabled, Zabbix will automatically follow HTTP redirects.
However, this behavior is not unlimited.</p>
<p>Zabbix follows up to 10 HTTP redirects per request. If this limit is exceeded,
the request fails. This protects the server from redirect loops and misconfigured
endpoints.</p>
<p>In practice, production APIs and web services should never approach this limit.
If they do, it usually indicates a configuration error that should be addressed
rather than worked around.</p>
<p>For authenticated APIs, redirects should be used with caution. Authentication
headers are not always resent across redirects, especially when hosts or protocols
change. Monitoring the final endpoint directly is often the safer choice.</p>
<h3 id="ch04-zabbix-collecting-data-http-enable-trapping-pushing-data-instead-of-pulling">Enable Trapping: Pushing Data Instead of Pulling</h3>
<p>HTTP agent items are typically used in a polling model, where Zabbix initiates
the request. However, Zabbix also supports a hybrid approach through the ‚ÄúEnable
trapping‚Äù option.</p>
<p>When trapping is enabled, the item can accept data pushed to it using zabbix_sender
or the Zabbix API history.push method. This allows external systems or applications
to send web content or processed results directly into Zabbix.</p>
<p>This is particularly useful in scenarios where the web application itself is capable
of detecting important events and generating alerts. Instead of Zabbix repeatedly
polling an endpoint, the application can push meaningful data when something
noteworthy happens.</p>
<p>From an architectural standpoint, this turns the HTTP agent item into a flexible
ingestion point rather than a pure polling mechanism. It is not a replacement for
polling, but a powerful complement when event-driven monitoring makes more sense.</p>
<h3 id="ch04-zabbix-collecting-data-http-practical-example-monitoring-the-zabbix-api">Practical Example: Monitoring the Zabbix API</h3>
<p>The Zabbix API itself is a good example of HTTP agent usage because it is strict,
well-defined, and widely deployed.</p>
<h4 id="ch04-zabbix-collecting-data-http-authenticating-to-the-api">Authenticating to the API</h4>
<p>The Zabbix API uses JSON-RPC over HTTP. Authentication is performed by calling
the user.login method. Another better way is to use an API token and pass it in the
Authorization header in the headers section.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-http-__codelineno-0-1"></a>Authorization<span class="w"> </span>:<span class="w"> </span>Bearer<span class="w"> </span><span class="o">{</span><span class="nv">$YOUR_TOKEN_MACRO</span><span class="o">}</span>
</span></code></pre></div>
<p>The endpoint is typically:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-http-__codelineno-1-1"></a>http://&lt;IP Address&gt;/api_jsonrpc.php
</span></code></pre></div>
<p>The HTTP agent item is configured with a POST request and the following body:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-http-__codelineno-2-1"></a>{
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch04-zabbix-collecting-data-http-__codelineno-2-2"></a>  &quot;jsonrpc&quot;: &quot;2.0&quot;,
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ch04-zabbix-collecting-data-http-__codelineno-2-3"></a>  &quot;method&quot;: &quot;apiinfo.version&quot;,
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ch04-zabbix-collecting-data-http-__codelineno-2-4"></a>  &quot;params&quot;: {},
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ch04-zabbix-collecting-data-http-__codelineno-2-5"></a>  &quot;id&quot;: 1
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ch04-zabbix-collecting-data-http-__codelineno-2-6"></a>}
</span></code></pre></div>
<p>The <code>Content-Type</code> header must be set to <code>application/json</code>. Without it, the API
will reject the request.</p>
<p>The response looks like this:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-http-__codelineno-3-1"></a>{
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch04-zabbix-collecting-data-http-__codelineno-3-2"></a>  &quot;jsonrpc&quot;: &quot;2.0&quot;,
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ch04-zabbix-collecting-data-http-__codelineno-3-3"></a>  &quot;result&quot;: &quot;8.0.0&quot;,
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ch04-zabbix-collecting-data-http-__codelineno-3-4"></a>  &quot;id&quot;: 1
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ch04-zabbix-collecting-data-http-__codelineno-3-5"></a>}
</span></code></pre></div>
<img alt="http/../ch04-zabbix-collecting-data/http/ch04.60_http_item.png" src="../ch04-zabbix-collecting-data/http/ch04.60_http_item.png" /></p>
<p>Using JSONPath preprocessing with $.result, the authentication token can be extracted.</p>
<h4 id="ch04-zabbix-collecting-data-http-retrieving-data">Retrieving Data</h4>
<p>The returned version string can be stored as a text item or evaluated by triggers.
While this example is simple, the same pattern applies to retrieving problem counts,
host statistics, or internal API data.</p>
<p>HTTP agent items are best suited for stateless, deterministic API calls. Token
reuse and session orchestration are intentionally limited and should be handled
externally if required.</p>
<h3 id="ch04-zabbix-collecting-data-http-runtime-debugging-and-logging">Runtime Debugging and Logging</h3>
<p>Debugging HTTP agent items does not require restarting the Zabbix server or proxy.
Zabbix supports runtime log level control, including per-process adjustments.</p>
<p>HTTP agent items are executed by HTTP poller processes. To debug HTTP agent behavior
specifically, logging should be increased only for those processes.</p>
<p>This is done using runtime control commands:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch04-zabbix-collecting-data-http-__codelineno-4-1"></a>zabbix_server -R log_level_increase=http poller
</span></code></pre></div>
<p>or on a proxy:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch04-zabbix-collecting-data-http-__codelineno-5-1"></a>zabbix_server -R log_level_decrease=http poller
</span></code></pre></div>
<p>This approach allows detailed libcurl-level diagnostics without restarting services
or flooding logs from unrelated processes.</p>
<p>When debug logging is enabled, the Zabbix log will show detailed information about
DNS resolution, TLS negotiation, certificate validation, proxy usage, and timeout
behavior. These messages are the authoritative source of truth when troubleshooting
HTTP agent issues.</p>
<p>Always enable debugging on the node that actually executes the item. If a host is
monitored via a proxy, increasing logging on the server will show nothing.</p>
<h3 id="ch04-zabbix-collecting-data-http-http-agent-item-parameters-reference">HTTP Agent Item Parameters Reference</h3>
<p>The table below summarizes the key HTTP agent parameters and their purpose.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">URL</td>
<td style="text-align: left;">Full HTTP or HTTPS endpoint Zabbix will request.</td>
</tr>
<tr>
<td style="text-align: left;">Request method</td>
<td style="text-align: left;">HTTP method used for the request (GET, POST, PUT, PATCH, DELETE).</td>
</tr>
<tr>
<td style="text-align: left;">Request body</td>
<td style="text-align: left;">Optional payload sent verbatim with supported methods.</td>
</tr>
<tr>
<td style="text-align: left;">HTTP headers</td>
<td style="text-align: left;">Custom headers such as authentication tokens or content types.</td>
</tr>
<tr>
<td style="text-align: left;">Timeout</td>
<td style="text-align: left;">Maximum duration applied per blocking phase of the request lifecycle.</td>
</tr>
<tr>
<td style="text-align: left;">Follow redirects</td>
<td style="text-align: left;">Enables or disables automatic redirect handling.</td>
</tr>
<tr>
<td style="text-align: left;">HTTP authentication</td>
<td style="text-align: left;">Built-in HTTP authentication supported by libcurl.</td>
</tr>
<tr>
<td style="text-align: left;">Proxy</td>
<td style="text-align: left;">Optional HTTP proxy used for the request.</td>
</tr>
<tr>
<td style="text-align: left;">Retrieve mode</td>
<td style="text-align: left;">Determines whether body, headers, or status code is stored.</td>
</tr>
<tr>
<td style="text-align: left;">SSL verify peer</td>
<td style="text-align: left;">Enables or disables server certificate validation.</td>
</tr>
<tr>
<td style="text-align: left;">SSL verify host</td>
<td style="text-align: left;">Enables or disables hostname verification.</td>
</tr>
<tr>
<td style="text-align: left;">Client certificate</td>
<td style="text-align: left;">Client certificate for mutual TLS authentication.</td>
</tr>
<tr>
<td style="text-align: left;">Client key</td>
<td style="text-align: left;">Private key associated with the client certificate.</td>
</tr>
<tr>
<td style="text-align: left;">Preprocessing</td>
<td style="text-align: left;">Transforms responses into usable metrics.</td>
</tr>
</tbody>
</table>
<h2 id="ch04-zabbix-collecting-data-http-conclusion">Conclusion</h2>
<p>The HTTP agent item is one of the most powerful and misunderstood tools in Zabbix.
It allows Zabbix to observe systems the same way applications and users do: through
HTTP.</p>
<p>Used casually, it checks availability. Used deliberately, it becomes a precise,
scalable, and secure API monitoring mechanism.</p>
<p>Understanding how it behaves internally ‚Äî how timeouts are applied, how certificates
are validated, and how logging really works ‚Äî is what turns it from a feature into
a tool.</p>
<p>Or, as every experienced API engineer eventually learns:</p>
<p><strong><em>‚ÄúHTTP is simple ‚Äî until you assume it is.‚Äù</em></strong></p>
<h2 id="ch04-zabbix-collecting-data-http-questions">Questions</h2>
<ul>
<li>Why does the HTTP agent item treat an HTTP 500 response differently from a timeout
  or TLS failure, and how should this influence trigger design?</li>
<li>In what situations would using dependent items with a single HTTP agent item be
  preferable to creating multiple independent HTTP agent items?</li>
<li>How does the asynchronous execution model of HTTP pollers change the way HTTP
  monitoring scales compared to traditional pollers?</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-http-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/http">https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/http</a></li>
<li><a href="https://curl.se/docs/">https://curl.se/docs/</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/api/reference/user/login?hl=user.login">https://www.zabbix.com/documentation/current/en/manual/api/reference/user/login?hl=user.login</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/api?hl=Bearer#by-authorization-header">https://www.zabbix.com/documentation/current/en/manual/api?hl=Bearer#by-authorization-header</a></li>
</ul></section><section class="print-page" id="ch04-zabbix-collecting-data-preprocessing" heading-number="9.11"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="preprocessing">Preprocessing</h1>
<p>In the previous part of this book about SNMP polling we started using some preprocessing. We used it to extract data from our bulk collected SNMP items as well as manipulate how the data is stored in our Zabbix database.</p>
<p>Without properly understanding this underlying technical functionality however, we do not have the correct foundation to understand what preprocessing is. As such, let's have a more detailed look into what preprocessing is exactly, how we can use it and why it is such an important part of our Zabbix environment.</p>
<h2 id="ch04-zabbix-collecting-data-preprocessing-preprocessing-functionality">Preprocessing functionality</h2>
<p>The preprocessing functionality in our Zabbix environment is used to transform received data from our hosts on items. It allows us to process data before it is stored into our Zabbix database, it's right in the name preprocessing. Whenever we configure an item in our Zabbix environment, it's possible for us to apply the preprocessing logic and alter the incoming data.</p>
<p>We do this on the item configuration, under the <code>preprocessing</code> tab of the item we are editing.</p>
<p><img alt="preprocessing/../ch04-zabbix-collecting-data/preprocessing/ch04.35-preprocessing-item-tab.png" src="../ch04-zabbix-collecting-data/preprocessing/ch04.35-preprocessing-item-tab.png" /></p>
<p><em>4.35 Preprocessing item tab</em></p>
<p>Here we can add our preprocessing steps by pressing the <code>add</code> button and selecting a step. However, before we dive deeper into how to create our steps let's have a look at exactly what preprocessing does within our Zabbix application.</p>
<p>For our Zabbix monitoring to function as it does, we have to have a collector process running. A process like the Pollers, SNMP Pollers, Trappers and all of the other ones. These processes are in charge of connecting over the network to collect a value using a specific protocol like the Zabbix agent or SNMP. In case of the Trappers, the process is waiting around to receive data instead. They have one thing in common however and that is that at one point data will be received on that process. </p>
<p>When the data is received, Zabbix server or proxy will always send data through the preprocessor. This happens before the data is stored in the Zabbix database and that is why it is called preprocessing. We process the data before we store it in the database.</p>
<p><img alt="preprocessing/../ch04-zabbix-collecting-data/preprocessing/ch04.36-preprocessing-basic-functionality.png" src="../ch04-zabbix-collecting-data/preprocessing/ch04.36-preprocessing-basic-functionality.png" />
<em>4.36 Preprocessing basic functionality</em></p>
<p>When data is received, Zabbix will internally kick of a few steps. First, it will add the received metric on your item to the preprocessing queue. From the processing queue, the processing manager will find a free preprocessing worker process will be found. One preprocessing worker can handle the preprocessing steps for a single item at the time. Once the preprocessing worker is done, the processed item moves on to the next step in our Zabbix server or proxy processes and the worker is free to handle the next item preprocessing.</p>
<h2 id="ch04-zabbix-collecting-data-preprocessing-various-types-of-preprocessing">Various types of preprocessing</h2>
<p>There are several types of preprocessing available, all of which will process and output our data in a different way. This is the current list of preprocessing steps available:</p>
<ul>
<li><strong>Regular expression</strong> is a simple way (once you understand regex) to extract data. </li>
<li><strong>Replace</strong> is used to replace one value with another, especially useful to replace string with numeric.</li>
<li><strong>Trim</strong> is used to trim characters from both the left and right side at the same time. </li>
<li><strong>Right trim</strong> is used to trim characters from right side.</li>
<li>
<p><strong>Left trim</strong> is used to trim characters from left side.</p>
</li>
<li>
<p><strong>XML XPath</strong> is used to extract specific data from XML.</p>
</li>
<li><strong>JSONPath</strong> is used to extract specific data from JSON.</li>
<li><strong>CSV to JSON</strong> is used to convert collected CSV data to JSON.</li>
<li>
<p><strong>XML to JSON</strong> is used to convert collected XML data to JSON.</p>
</li>
<li>
<p><strong>SNMP walk value</strong> is used to extract a specific SNMP OID from a larger SNMP walk. Also used to format UTF8 or MAC as HEX, as well as BITS as integer.</p>
</li>
<li><strong>SNMP walk to JSON</strong> is used to convert an SNMP walk to JSON format (ready for low level discovery).</li>
<li>
<p><strong>SNMP get value</strong> is used to format an SNMP get value in UTF8 or MAC format as HEX, as well as BITS as integer.</p>
</li>
<li>
<p><strong>Custom multiplier</strong> is a simple mathematical multiplier, which can also be used to divide.</p>
</li>
<li>
<p><strong>Simple change</strong> is a simple calculation to get the difference between the last and previous value.</p>
</li>
<li>
<p><strong>Change per second</strong> is a calculation to get the difference between the last and previous value based on the number of seconds that have passed between them.</p>
</li>
<li>
<p><strong>Boolean to decimal</strong> is used to convert the aforementioned value.</p>
</li>
<li><strong>Octal to decimal</strong> is used to convert the aforementioned value. </li>
<li>
<p><strong>HExadecimal to decimal</strong> is used to convert the aforementioned value. </p>
</li>
<li>
<p><strong>Javascript</strong> is an extensive preprocessor, where we can use Javascript Duktape engine to apply complex scripts for processing.</p>
</li>
<li>
<p><strong>In range</strong> is used to validate if the value falls within a defined range.</p>
</li>
<li><strong>Matches regular expression</strong> is used to validate if the value matches the regular expression. </li>
<li><strong>Does not match regular expression</strong> is used to validate if the value does not match the regular expression. </li>
<li><strong>Check for error in JSON</strong> is used to validate if there are errors in the received JSON.</li>
<li><strong>Check for error in XML</strong> is used to validate if there are errors in the received XML.</li>
<li><strong>Check for error using regular expression</strong> is used to validate if there are errors using an regular expression.</li>
<li>
<p><strong>Check for not supported value</strong> is used to validate if no value could be received.</p>
</li>
<li>
<p><strong>Discard unchanged</strong> is used to discard any duplicate values. </p>
</li>
<li>
<p><strong>Discard unchanged with heartbeat</strong> is used to discard any duplicate values, but still save it if the heartbeat has passed. </p>
</li>
<li>
<p><strong>Prometheus pattern</strong> is used to extract values from prometheus data.</p>
</li>
<li><strong>Prometheus to JSON</strong> is used to convert prometheus data to JSON data (ready for low level discovery).</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-preprocessing-detailed-examples-of-most-important-preprocessing">Detailed examples of most important preprocessing</h2>
<p>When working with Zabbix, you will find that depending on your environment, some preprocessing steps are used more than others. Some of the most used ones are important to properly understand their functioning. </p>
<p><strong>Regular expression</strong>
Regular expressions are a whole subject on its own, there are many books on the topic on its own. We won't going over the details here, for that we recommend going to https://regex101.com. On this website you can read extensive documentation about regular expressions, as well as test your existing ones. </p>
<p>Let's start with a basic example, where we have an item that received the value: <strong>The error is value: 0</strong>. Let's say we want to get numeric value from the string, we could configure our preprocessing like this.</p>
<p><img alt="preprocessing/../ch04-zabbix-collecting-data/preprocessing/ch04.37-preprocessing-regex.png" src="../ch04-zabbix-collecting-data/preprocessing/ch04.37-preprocessing-regex.png" />
<em>4.37 Preprocessing regular expression</em></p>
<p>This would then result in the value <strong>0</strong>, which we can store as the <code>Numeric (unsigned)</code> item type of information. The basic functionality of the regular expression preprocessing step as you can see is to extract values from larger data.</p>
<p><strong>JSONPath and additional steps</strong>
Within Zabbix monitoring, JSON data structures are used quite a lot. We can find it in Low Level Discovery, export files and it is often the data format sent back by API's. As such, being able to process JSON datasets is important and that is where JSONPath comes in. Let's say we have a basic JSON dataset we collected from an API.</p>
<div class="admonition info">
<p class="admonition-title">Example JSON</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-0-1"></a>{
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-0-2"></a>&quot;hostname&quot;: &quot;webserver01&quot;,
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-0-3"></a>&quot;c&quot;: true,
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-0-4"></a>&quot;retry_count&quot;: 3
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-0-5"></a>}
</span></code></pre></div>
</div>
<p>Now with JSONpath, we could extract these values. Let's say we want to get the <code>enabled</code> value and store it as a <code>Numeric (unsigned)</code> value. We could do the following.</p>
<p><img alt="preprocessing/../ch04-zabbix-collecting-data/preprocessing/ch04.38-preprocessing-jsonpath.png" src="../ch04-zabbix-collecting-data/preprocessing/ch04.38-preprocessing-jsonpath.png" />
<em>4.38 Preprocessing JSONPath</em></p>
<p>This will extract the value <code>true</code>. However, as a bonus we said we would also to store this extracted value as a <code>Numeric (unsigned)</code> value. To do this, I used an additional 2 preprocessing steps <code>replace</code>. Replacing <code>false</code> with <code>0</code> and <code>true</code> with <code>1</code>. If we press the <code>Test all steps</code> button, we can see the result happen live.</p>
<p><img alt="preprocessing/../ch04-zabbix-collecting-data/preprocessing/ch04.39-preprocessing-jsonpath-test.png" src="../ch04-zabbix-collecting-data/preprocessing/ch04.39-preprocessing-jsonpath-test.png" />
<em>4.39 Preprocessing JSONPath test</em></p>
<p>It's important to know that we can add an unlimited amount of preprocessing steps, but that Zabbix will always execute all of them in the order in which they are defined. First, we extract the value from JSON. Second, we try to replace <code>false</code> with <code>0</code> which didn't do anything as there was no match. Third, we replace <code>true</code> with <code>1</code> which worked. Now all we have to do is apply a value mapping to translate true and false back into human readable format. The big benefit here being that storing these kinds of values as <code>Numeric (unsigned)</code> gives us a lot more trigger functions as options for alerting. It also means we can now store the value in <code>Trend</code> tables, as only <code>Numeric</code> data types are stores as trends.</p>
<p><strong>SNMP walk value</strong> </p>
<p><strong>SNMP walk to JSON</strong></p>
<p><strong>Custom multiplier</strong> 
The customer multiplier is simple, but important. In Zabbix you might often find that you receive a value, that you would want to store slightly differently. Specifically, this preprocessing step is often used to convert numbers to their base value. Your device might be giving you MegaBytes (MB) for example, where Zabbix would like us to store Bytes (B) instead. </p>
<p><img alt="preprocessing/../ch04-zabbix-collecting-data/preprocessing/ch04.40-preprocessing-multiplier.png" src="../ch04-zabbix-collecting-data/preprocessing/ch04.40-preprocessing-multiplier.png" />
<em>4.40 Preprocessing Custom Multiplier</em></p>
<p>This will now store the received MegaByte value as Bytes. Now, we can set the item <code>Units</code> setting to B and it will convert the Bytes stored to a human readable Mega, Giga, Tera, etc.</p>
<p>Storing base values is always preferred in Zabbix, so we can do the conversion with <code>Units</code> on the item later. This results in a more dynamic setup.</p>
<p><strong>Simple Change and Change per second</strong>
We quickly mentioned the <code>Simple Change</code> before, which calculates the difference between <code>Last</code> and <code>Previous</code> value. Change per second goes a step further however by introducing a time based calculation to the formula. </p>
<p>A simple change calculation would look like this.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Position</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Last #1</td>
<td style="text-align: left;">9</td>
</tr>
<tr>
<td style="text-align: left;">Last #2 (previous)</td>
<td style="text-align: left;">4</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;">-----</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>5</strong></td>
</tr>
</tbody>
</table>
<p>We can see the result here is a simple <em>5</em>, using the formula <code>Last - Previous</code>. In Zabbix the last received value is often indicated by <code>Last #1</code> and the value before it as <code>Last #2</code>. Next, let's introduce the time based calculation with <code>Change per second</code>, so we see something more difficult.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Position</th>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Timestamp (Unixtime)</th>
<th style="text-align: left;">Change per second</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Last #1</td>
<td style="text-align: left;">13</td>
<td style="text-align: left;">1763282130</td>
<td style="text-align: left;">7</td>
</tr>
<tr>
<td style="text-align: left;">Last #2 (previous)</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">1763282100</td>
<td style="text-align: left;">30</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;">---- -</td>
<td style="text-align: left;">------------------- -</td>
<td style="text-align: left;">-------------------- /</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>7</strong></td>
<td style="text-align: left;"><strong>30</strong></td>
<td style="text-align: left;">0.23333333</td>
</tr>
</tbody>
</table>
<p>We can see the calculation is the same in principle, we subtract <code>Last #1</code> and <code>Last #2</code>. We also takes the Unixtime stamp of when <code>Last #1</code> and <code>Last #2</code> were collected, subtracting those. Subtracting those time values gives us the time passed between <code>Last #1</code> and <code>Last #2</code>. Then the last step is to divide the values, giving us an estimate of how much values were received per second. Of course, the shorter our update interval is, the closer the estimate. But it gives us an accurate average over time.</p>
<p>This kind of calculation works with what we call <code>Counters</code>, values that always increase on our monitoring targets. For example, network interfaces Bits received/sent are often times counters. These work by calculating how much data has passed over the interface in total, often since the last reboot. Often times, a useless metric to us unless we convert it with <code>Change per second</code> when it gives us a nice <code>Bits/s</code>. This allows us to monitor network traffic over time, instead of just a total. </p>
<p><strong>Javascript</strong>
With  many APIs out there being used to make monitoring data available to us, responses are getting more complex. It might happen that you get a response that isn't perfect for us to store in Zabbix. One of my favourite examples is dates and times. Sometimes developers might decide to gives us back a string value with the dates, for example:</p>
<ul>
<li><strong>Aug 21 1991</strong></li>
<li><strong>Aug 24 1991</strong></li>
<li><strong>May 8 1945</strong></li>
</ul>
<p>Using Javascript, we could convert these dates into a nice <code>Unixtime</code> stamp. Unixtime is something Zabbix understands as a Unit and can be used in trigger functions. </p>
<div class="admonition info">
<p class="admonition-title">Example Javascript</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-1"></a>// Expecting: &quot;Feb 20 2040&quot;
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-2"></a>    var months = {
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-3"></a>        Jan: 0, Feb: 1, Mar: 2, Apr: 3, May: 4, Jun: 5,
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-4"></a>        Jul: 6, Aug: 7, Sep: 8, Oct: 9, Nov: 10, Dec: 11
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-5"></a>    };
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-7"></a>    if (typeof value !== &#39;string&#39;) {
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-8"></a>        return value;
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-9"></a>    }
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-11"></a>    // Split on whitespace
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-12"></a>    var parts = value.trim().split(/\s+/);
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-13"></a>    if (parts.length !== 3) {
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-14"></a>        return value; // or throw, depending on how strict you want to be
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-15"></a>    }
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-16"></a>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-17"></a>    var monStr = parts[0];
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-18"></a>    var day = parseInt(parts[1], 10);
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-19"></a>    var year = parseInt(parts[2], 10);
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-20"></a>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-21"></a>    var month = months[monStr];
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-22"></a>    if (month === undefined || isNaN(day) || isNaN(year)) {
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-23"></a>        return value;
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-24"></a>    }
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-25"></a>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-26"></a>    // Use UTC midnight of that date, convert ms ‚Üí seconds
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-27"></a>    var ts = Date.UTC(year, month, day) / 1000;
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-28"></a>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#ch04-zabbix-collecting-data-preprocessing-__codelineno-1-29"></a>    return ts;
</span></code></pre></div>
</div>
<p>Keep in mind, Zabbix will already put this Javascript code in a function for preprocessing as <code>function (value) { }</code>. When testing this code, we can see it executed for us now, converting out weird date format into a nice Unixtime.</p>
<p><img alt="preprocessing/../ch04-zabbix-collecting-data/preprocessing/ch04.41-preprocessing-javascript.png" src="../ch04-zabbix-collecting-data/preprocessing/ch04.41-preprocessing-javascript.png" />
<em>4.41 Preprocessing Javascript</em></p>
<p><strong>Discard unchanged with heartbeat</strong> 
Shortly, I'd also like to discuss the <code>Discard unchanged with heartbeat</code> preprocessing in more detail. Let's say we set up our preprocessing step <code>Discard unchanged with heartbeat</code> with a heartbeat value of <code>5m</code>. We might see the following happen.</p>
<p>| Value | Timestamp | Stored value? |
| :---- | :-------- |
|   0   |    Now    | No
|   0   |   1m ago  | Yes
|   1   |   2m ago  | Yes
|   1   |   3m ago  | No
|   1   |   4m ago  | No
|   1   |   5m ago  | No
|   1   |   6m ago  | No
|   1   |   7m ago  | No
|   1   |   8m ago  | Yes
|   0   |   9m ago  | Yes</p>
<p>We can see that we only store the value if it changes from <code>0</code> to <code>1</code> or from <code>1</code> to <code>0</code> in this case. However, at the <code>2m ago</code> timestamp we can see an exception. This specific value had passed the 5 minute heartbeat interval, meaning we store this value even though it had not changed yet. This can be used to make sure we still save a value from time to time, which can be useful for data integrity or crafting your trigger expressions later on.</p>
<h2 id="ch04-zabbix-collecting-data-preprocessing-conclusion">Conclusion</h2>
<p>As we can see preprocessing can be used to turns raw received data into structured, meaningful monitoring data. Once you the various different types of preprocessing your Zabbix environment becomes cleaner and more powerful. It's useful to familiarise yourself with the various options in preprocessing, although we do not need to know all of them in detail. Different situations call for different types of preprocessing, so it's good to at least know of the existence of most of them. The Zabbix documentation also includes more details, as well as various examples.</p>
<h2 id="ch04-zabbix-collecting-data-preprocessing-questions">Questions</h2>
<h2 id="ch04-zabbix-collecting-data-preprocessing-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch04-zabbix-collecting-data-dependent" heading-number="9.12"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="dependent-items">Dependent items</h1>
<p>There are cases when you have large chunks of data which are rich of monitoring
metrics. You can of course slice them with the help of scripts and so extract
needed valuable pieces to be stored individually, as separate items. However,
there is a native way in Zabbix which can do the very same thing without a need
to involve any scripting. And that is something called "Dependent items".</p>
<p>Think of "Dependent items" as small fragments of your large dataset. Of course,
nothing limits or tells you that your dataset must be large. It can also be
small, but the smaller - the less sense the dependent items would make. When
having something large to be collected, you have to collect that data only once
and have the splitting being done by preprocessing.</p>
<p>Another use case when you might benefit from dependent items is when data
collection has "high cost", in terms of time retrieving it or when network
traffic matters. For example, some remote resource which you want to collect has
slow network or you want to save each and every byte sent over the network, but
there are multiple things in that resource which you want to monitor. Without
dependent items approach you would need to retrieve that resource as many times
as you have unique items, or store it once and then slice it on your own. But
with dependent items, you need to collect such data only once and transform it
into individual metrics just by employing native Zabbix features.</p>
<p>So basically, the beauty of dependent items lies in the data collection
efficiency.</p>
<p>There are three main concepts involved when talking about "Dependent items":</p>
<ul>
<li>master item</li>
<li>dependent item</li>
<li>preprocessing</li>
</ul>
<p>Master item is just a regular Zabbix item. It can be any type of data collection
behind it - say it can be "Zabbix agent", "Zabbix trapper", "HTTP agent" item
or anything else.</p>
<p>Once new value is collected for the master item, all of its dependent items
are also updated. It has to be specified in dependent item's configuration,
which item is the master item for it. One master item can have unlimited number
of dependent items.</p>
<details class="info" open="open">
<summary>Info</summary>
<p>Since dependent item gets updated on master item's value update, it does not
have its own update interval</p>
</details>
<p>To be able to extract just the needed part of data from the master item, you
will for sure want to apply some preprocessing. Preprocessing loves structured
data. You should in all cases seek for structured data as your master item's
content (e.g. json, csv, etc). This way, you will be able to extract needed
data easier. When dealing with preprocessing, apply the most suitable method
for particular data source format (e.g. use JSONPath for json) and understand
your limits (e.g. regex is Perl flavor and JavaScript is Duktape underneath).</p>
<h2 id="ch04-zabbix-collecting-data-dependent-hello-world">Hello World</h2>
<p>Let's go through an example, the most basic one, so that you would better
understand how the dependent items get updated.</p>
<p>First of all, we will have a simple bash script, which will create three lines
of structured data.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-dependent-__codelineno-0-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch04-zabbix-collecting-data-dependent-__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch04-zabbix-collecting-data-dependent-__codelineno-0-3"></a><span class="nv">master_result</span><span class="o">=</span>/tmp/master.txt
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch04-zabbix-collecting-data-dependent-__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch04-zabbix-collecting-data-dependent-__codelineno-0-5"></a><span class="k">for</span><span class="w"> </span>x<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span>a..c<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch04-zabbix-collecting-data-dependent-__codelineno-0-6"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">x</span><span class="si">}</span><span class="s2">: </span><span class="k">$((</span><span class="nv">RANDOM</span><span class="o">%</span><span class="m">100</span><span class="k">))</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="si">${</span><span class="nv">master_result</span><span class="si">}</span>.tmp
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch04-zabbix-collecting-data-dependent-__codelineno-0-7"></a><span class="k">done</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch04-zabbix-collecting-data-dependent-__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch04-zabbix-collecting-data-dependent-__codelineno-0-9"></a>mv<span class="w"> </span>-f<span class="w"> </span><span class="si">${</span><span class="nv">master_result</span><span class="si">}</span>.tmp<span class="w"> </span><span class="si">${</span><span class="nv">master_result</span><span class="si">}</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ch04-zabbix-collecting-data-dependent-__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ch04-zabbix-collecting-data-dependent-__codelineno-0-11"></a><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</span></code></pre></div>
<p>This script is added to cron and is being run once a minute. It is kind of
obvious what this script does - it outputs random number and has a prefix of
one of the three letters: "a", "b" or "c":</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-dependent-__codelineno-1-1"></a>binary@linux:~$<span class="w"> </span>cat<span class="w"> </span>/tmp/master.txt
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch04-zabbix-collecting-data-dependent-__codelineno-1-2"></a>a:<span class="w"> </span><span class="m">54</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch04-zabbix-collecting-data-dependent-__codelineno-1-3"></a>b:<span class="w"> </span><span class="m">98</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch04-zabbix-collecting-data-dependent-__codelineno-1-4"></a>c:<span class="w"> </span><span class="m">21</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ch04-zabbix-collecting-data-dependent-__codelineno-1-5"></a>binary@linux:~$
</span></code></pre></div>
<p>Now this data file becomes our "master item". It will be collected by Zabbix
native item <code>vfs.file.contents</code>, like:</p>
<p><img alt="Dependent items - first master item" src="../ch04-zabbix-collecting-data/dependent/ch04.xx-dependent-items-hello-world-master.png" /></p>
<details class="info" open="open">
<summary>Info</summary>
<p>Master item on its own has a little purpose of being stored, especially when
it is huge. Its only purpose could be debugging, thus once operating 
normally, it should not be stored and that will not affect dependent items
in any way</p>
</details>
<p>And then we can set our dependent items:</p>
<p><img alt="Dependent items - first dependent item" src="../ch04-zabbix-collecting-data/dependent/ch04.xx-dependent-items-hello-world-dependent.png" /></p>
<p>This dependent item will have the following preprocessing - it will extract
number from line starting with "a":</p>
<p><img alt="Dependent items - first dependent item preprocessing" src="../ch04-zabbix-collecting-data/dependent/ch04.xx-dependent-items-hello-world-dependent-preprocessing.png" /></p>
<p>We will then clone the first item in same fashion and get a full set of items:</p>
<p><img alt="Dependent items - first dependent items all" src="../ch04-zabbix-collecting-data/dependent/ch04.xx-dependent-items-hello-world-all.png" /></p>
<p>Now data is being collected once and we have 3 separate numeric items, which we
can use depending on our needs - draw some graphs, have some triggers on top, etc.</p>
<p><img alt="Dependent items - first dependent items results" src="../ch04-zabbix-collecting-data/dependent/ch04.xx-dependent-items-hello-world-result.png" /></p>
<h2 id="ch04-zabbix-collecting-data-dependent-dependent-items-from-json">Dependent items from json</h2>
<p>Previous example had a "Regular expression" as the preprocessing step. In real
life, you might often face json as your master item, so preprocessing would be
different. Of course, regexp is a universal thing so it is also suitable to
extract something from json, but there is a dedicated preprocessing type
exactly for this purpose - <code>JSONPath</code>.</p>
<p>So first let's modify our example script to produce json:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-3"></a><span class="nv">json</span><span class="o">=</span><span class="s2">&quot;{&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-5"></a><span class="k">for</span><span class="w"> </span>x<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span>a..c<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-6"></a><span class="w">  </span><span class="nv">json</span><span class="o">+=</span><span class="s2">&quot;\&quot;</span><span class="si">${</span><span class="nv">x</span><span class="si">}</span><span class="s2">\&quot;:\&quot;</span><span class="k">$((</span><span class="nv">RANDOM</span><span class="o">%</span><span class="m">100</span><span class="k">))</span><span class="s2">\&quot;,&quot;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-7"></a><span class="k">done</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-9"></a><span class="nv">json</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">json</span><span class="p">%,</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-10"></a><span class="nv">json</span><span class="o">+=</span><span class="s2">&quot;}&quot;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-12"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">json</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;/tmp/master.json
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-13"></a>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#ch04-zabbix-collecting-data-dependent-__codelineno-2-14"></a><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</span></code></pre></div>
<p>Now we can have similar approach of one single master item and bunch of
dependent items nearby. Just this time, we would have <code>JSONPath</code> as
preprocessing step for dependent items.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-dependent-__codelineno-3-1"></a>binary@linux:~$<span class="w"> </span>cat<span class="w"> </span>/tmp/master.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.&#39;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch04-zabbix-collecting-data-dependent-__codelineno-3-2"></a><span class="o">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ch04-zabbix-collecting-data-dependent-__codelineno-3-3"></a><span class="w">  </span><span class="s2">&quot;a&quot;</span>:<span class="w"> </span><span class="s2">&quot;94&quot;</span>,
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ch04-zabbix-collecting-data-dependent-__codelineno-3-4"></a><span class="w">  </span><span class="s2">&quot;b&quot;</span>:<span class="w"> </span><span class="s2">&quot;41&quot;</span>,
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ch04-zabbix-collecting-data-dependent-__codelineno-3-5"></a><span class="w">  </span><span class="s2">&quot;c&quot;</span>:<span class="w"> </span><span class="s2">&quot;78&quot;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ch04-zabbix-collecting-data-dependent-__codelineno-3-6"></a><span class="o">}</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ch04-zabbix-collecting-data-dependent-__codelineno-3-7"></a>binary@linux:~$
</span></code></pre></div>
<p><img alt="Dependent items - first dependent item - json" src="../ch04-zabbix-collecting-data/dependent/ch04.xx-dependent-items-hello-world-dependent-preprocessing-json.png" /></p>
<p>Easy and smooth!</p>
<h2 id="ch04-zabbix-collecting-data-dependent-dependent-items-and-lld">Dependent items and LLD</h2>
<p>Now imagine our example script produces not <code>{a..c}</code> but a full alphabet,
<code>{a..z}</code>. We could clone dependent items one by one, but that would also
include editing the preprocessing step regexp each time as well. If you are
familiar with LLD, you most likely see where this goes. We will apply LLD here
and combine it with dependent items!</p>
<p>For LLD, we will use <code>log_discovery.sh</code>, which makes it possible to perform LLD
from log files (thus, also, from any other text files). Source for this script
can be found in the "Useful URLs" section. It will have item prototypes of
"Dependent item" type and will rely on master item in same template, just
outside of discovery.</p>
<p><img alt="Dependent items - LLD" src="../ch04-zabbix-collecting-data/dependent/ch04.xx-dependent-items-hello-world-lld.png" /></p>
<p>And then item prototypes would look like:</p>
<p><img alt="Dependent items - LLD item prototype" src="../ch04-zabbix-collecting-data/dependent/ch04.xx-dependent-items-hello-world-lld-item-prototype.png" /></p>
<p>Once LLD "magic" happens, we have all items in place:</p>
<p><img alt="Dependent items - LLD item values" src="../ch04-zabbix-collecting-data/dependent/ch04.xx-dependent-items-hello-world-lld-item-latest-data.png" /></p>
<p>Now by using wildcard in our dashboard "Graph" widget:</p>
<p><img alt="Dependent items - LLD graph widget" src="../ch04-zabbix-collecting-data/dependent/ch04.xx-dependent-items-hello-world-lld-widget.png" /></p>
<p>we are able to select all of our items at once. Thanks to LLD, we are able to
create all of our items at once. Finally, thanks to the concept of "Dependent
items", we are able to collect all of our data at once.</p>
<p>This is truly beautiful once you understand it.</p>
<p><img alt="Dependent items - LLD result" src="../ch04-zabbix-collecting-data/dependent/ch04.xx-dependent-items-hello-world-lld-result.png" /></p>
<h2 id="ch04-zabbix-collecting-data-dependent-conclusion">Conclusion</h2>
<p>Dependent items concept is a great way to become more efficient in data
collection under certain circumstances.</p>
<p>If you have some huge structured data file or output and want to split it into
separate monitoring entities - think no more. Dependent items are here for you.
Same is applicable to all the other cases when you want to collect data once
but have multiple separate metrics out of it.</p>
<h2 id="ch04-zabbix-collecting-data-dependent-questions">Questions</h2>
<ul>
<li>Does master item have to be some special type of item or it can be collected
in any regular way?</li>
<li>Are you limited in number of dependent items from one master item?</li>
<li>What is the main benefit of using dependent items?</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-dependent-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/dependent_items">https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/dependent_items</a></li>
<li><a href="https://github.com/b1nary1/zabbix/tree/main/log_discovery">https://github.com/b1nary1/zabbix/tree/main/log_discovery</a></li>
</ul></section><section class="print-page" id="ch04-zabbix-collecting-data-ssh-telnet" heading-number="9.13"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="ssh-telnet">SSH / Telnet</h1>
<p>Let's say you have a device that doesn't support SNMP, there is no API and it's just not exposing any data (or just the data you need) via any protocol. However, you are able to login to the device and you are able to execute commands through the SSH or Telnet terminal. In this case Zabbix can still provide you with a solid option to monitor the device.</p>
<p>Zabbix provides us with the option to set up a remote connection through SSH or Telnet and execute any command we'd normally execute ourselves manually. We can then use our preprocessing rules and other methods to parse this information and create valuable monitoring metrics from it. </p>
<details class="security notice" open="open">
<summary>Security</summary>
<p>Please keep in mind that Telnet sends Usernames/Passwords unencrypted over your network. This means that it is not considered a secure connection and as such it should not be used. However, if you have a device that only exposes data via Telnet, Zabbix still provides you with the option to use the protocol at your own risk.</p>
</details>
<h1 id="ch04-zabbix-collecting-data-ssh-telnet-ssh-monitoring">SSH Monitoring</h1>
<p>Let's start with the most used method, SSH. Since this is a secure encrypted connection, it is often times used to get data from devices that do not expose it via other protocols. However, our favourite use case for SSH monitoring is to get data from devices that do have SNMP or an API, but only expose certain data through the CLI. This gives you another option in gathering information you need that the vendor might not have properly exposed.</p>
<p>In our Zabbix frontend, let's navigate to <code>Monitoring</code> | <code>Hosts</code> and create a new host for SSH and Telnet monitoring. Let's call it <code>cli-monitoring</code> and put it in the hostgroup XYZ.</p>
<p><img align="left" alt="CLI Monitoring" src="../ch04-zabbix-collecting-data/ssh-telnet/ch04.xx-cli-monitoring-host.png" />
<em>4.xx Zabbix CLI Monitoring host</em></p>
<p>After creating the host, click on <code>Items</code> for this host and then in the top right corner click on <code>Create item</code>. We will set the <code>Type</code> to <code>SSH Agent</code>, which we will need to create SSH based checks. Something you might not expect about this item is that the <code>Key</code> is automatically filled in as:
- <strong>ssh.run[<unique short description>,<ip>,<port>,<encoding>,<ssh options>,<subsystem>]</strong></p>
<p>The key for SSH items is built in and we are thus forced to use this key format to make the item work. You can see however we get some key parameters to customise how it works.</p>
<ul>
<li><strong><unique short description>: Is used to make this item unique, as we cannot have duplicate keys on Zabbix hosts.</strong></li>
<li><strong><ip>: Can we used to specify the target IP Address for SSH to connect to. Can be used if no host interface is specified</strong></li>
<li><strong><port>: Can be used to specify a different SSH port, the default is port 22.</strong></li>
<li><strong><encoding>: How to decode the remote output, is it UTF-8 or ANSI for example.</strong></li>
<li><strong><ssh options>: In case you have more SSH settings you want to use, these can be set here. For example you could set KexAlgorithms=curve25519-sha256;Ciphers=chacha20-poly1305@openssh.com to force stronger security</strong></li>
<li><strong><subsystem>: If you'd like to force this connection to use a different SSH subsystem to connect into.</strong></li>
</ul>
<p>As you can see we have a lot of options, but in most cases the <code>unique short description</code> and <code>ip</code> will be enough.</p>
<p>Let's give the item the <code>Key</code> value <code>ssh.run[ssh.logins.10m,127.0.0.1]</code> and also a <code>Name</code> value <code>SSH Logins (10m)</code>. Then the trick to making this item works comes along, we need to login using SSH and execute commands.</p>
<p>At <code>Authentication method</code> we will select <code>Password</code> for the example, but you are also able to select <code>Public key</code> as an option here. Going with <code>Public key</code> would allow you to set:
- <strong>User name: The user to login as.</strong>
- <strong>Public key file: The path to the Public key we will use to login.</strong>
- <strong>Private key file: The path to the Private key we will use to login.</strong>
- <strong>Key passphrase: The password to decrypt the Private key.</strong></p>
<p>Keep in mind, when using SSH key authentication it is important to update you Zabbix server and/or Zabbix proxy configuration file. You can set the <code>SSHKeyLocation=</code> parameter to for example <code>SSHKeyLocation=/home/zabbix/.ssh/</code> which will be the path where the public and private keys for SSH checks (and actions) will be located. For example now you can fill in <code>Public key file</code> as <code>ssh-monitoring.pub</code> and it will use the full path <code>/home/zabbix/.ssh/ssh-monitoring.pub</code>.</p>
<p>But as we mentioned let's start with by setting <code>Authentication method</code> to <code>Password</code>. I will set my <code>User name</code> to <code>ssh-monitoring</code> and set a strong secure <code>Password</code>.</p>
<details class="fun security fact" open="open">
<summary>Fun</summary>
<p>That was a lie, I did in fact not set a secure password as this is only a LAB environment to write examples for this book. But YOU SHOULD set a strong password, especially in production. This is also the reason we use username ssh-monitoring as we will create a separate limited user account for SSH monitoring. DO NOT use root!</p>
</details>
<p>Last but not least, let's add the command to execute in the <code>Executed script</code> field.</p>
<div class="admonition info">
<p class="admonition-title">Executed script for SSH</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-ssh-telnet-__codelineno-0-1"></a>journalctl<span class="w"> </span>-u<span class="w"> </span>sshd<span class="w"> </span>--since<span class="w"> </span><span class="s2">&quot;-10 min&quot;</span><span class="w"> </span>--no-pager<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;Accepted password&quot;</span>
</span></code></pre></div>
</div>
<p>At the executed script part it is also possible to add multiple commands, which Zabbix will then execute line-by-line within the same SSH session. Another option is to execute an entire script located somewhere on your device. The options are quite endless. </p>
<p>In this case we are executing a command through SSH on a Linux system, simply because it's an easy to explain and setup option. But of course, if I had the Zabbix agent installed on this server already I might as well have used a UserParameter (or remote command if preferred). SSH checks are way more useful on devices where no agent can be installed.</p>
<p>Let's go to our Linux CLI and create the account on our Zabbix server on Linux for testing.</p>
<div class="admonition info">
<p class="admonition-title">Create ssh-monitoring user</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-ssh-telnet-__codelineno-1-1"></a>sudo<span class="w"> </span>useradd<span class="w"> </span>-m<span class="w"> </span>-s<span class="w"> </span>/bin/bash<span class="w"> </span>ssh-monitoring
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch04-zabbix-collecting-data-ssh-telnet-__codelineno-1-2"></a>passwd<span class="w"> </span>ssh-monitoring
</span></code></pre></div>
</div>
<p>Set that secure password we discussed earlier and then give it limited permissions</p>
<div class="admonition info">
<p class="admonition-title">Set ssh-monitoring user permissions</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-ssh-telnet-__codelineno-2-1"></a>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>systemd-journal<span class="w"> </span>ssh-monitor
</span></code></pre></div>
</div>
<p>Afterwards let's double-check our item configuration, make sure everything is set up correctly. </p>
<p><img align="left" alt="CLI Monitoring SSH item" src="../ch04-zabbix-collecting-data/ssh-telnet/ch04.xx-cli-monitoring-ssh-item.png" />
<em>4.xx Zabbix CLI Monitoring SSH item</em></p>
<p>Do not forget to add your tag.</p>
<p><img align="left" alt="CLI Monitoring SSH item tag" src="../ch04-zabbix-collecting-data/ssh-telnet/ch04.xx-cli-monitoring-ssh-item-tag.png" />
<em>4.xx Zabbix CLI Monitoring SSH item tag</em></p>
<p>This should now work as expected and when you navigate to <code>Monitoring</code> | <code>Latest data</code> you should now see a value for this host.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>If you are using selinux or a similar security tool, please keep in mind this can block Zabbix access to execute SSH as usual. You should check your audit logs and make sure to allow the SSH connection you'd like to setup. Do not over allow and keep things secure.</p>
</details>
<h1 id="ch04-zabbix-collecting-data-ssh-telnet-telnet-monitoring">Telnet Monitoring</h1>
<p>Telnet monitoring works almost in the exact same way as SSH monitoring, except of course the Telnet protocol is used in the background. When we navigate to <code>Items</code> for our <code>cli-monitoring</code> host again, we can click on <code>Create item</code> in the top right corner. </p>
<p>Let's add the item <code>Type</code> as <code>TELNET agent</code> and you will see the <code>Key</code> field already filled out just like the SSH check:
- <strong>telnet.run[<unique short description>,<ip>,<port>,<encoding>]</strong></p>
<p>The fields are almost the same as SSH, with a few less options.
- <strong><unique short description>: Is used to make this item unique, as we cannot have duplicate keys on Zabbix hosts.</strong>
- <strong><ip>: Can we used to specify the target IP Address for Telnet to connect to. Can be used if no host interface is specified</strong>
- <strong><port>: Can be used to specify a different Telnet port, the default is port 23.</strong>
- <strong><encoding>: How to decode the remote output, is it UTF-8 or ANSI for example.</strong></p>
<p>Let's set this one up similar to SSH with the item the <code>Key</code> value <code>telnet.run[telnet.logins.10m,127.0.0.1]</code> and also a <code>Name</code> value <code>Telnet Logins (10m)</code>. Of course we also need to specify a command to execute again, so let's add this to the <code>Executed script</code> field.</p>
<div class="admonition info">
<p class="admonition-title">Executed script for SSH</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-ssh-telnet-__codelineno-3-1"></a>journalctl<span class="w"> </span>--since<span class="w"> </span><span class="s2">&quot;-10 min&quot;</span><span class="w"> </span>--no-pager<span class="w"> </span>-t<span class="w"> </span><span class="k">in</span>.telnetd<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;LOGIN&quot;</span>
</span></code></pre></div>
</div>
<p>For Telnet we will also need to specify the <code>User name</code> and <code>Password</code> fields again. Keep in mind, Telnet passwords are sent over the network unencrypted, so once a hacker is in your network the password will be known. If you do still choose to use Telnet for something, still try to set a secure password as this could help against unintelligent scripted attacks, but against a real targeted attack Telnet is useless. Only use Telnet if you make sure the user doesn't have any option to do something malicious on devices you do not care too much about. It really is a last resort monitoring option, so ask yourself is the monitoring worth more than security here?</p>
<p>Again, let's double-check our item configuration, to make sure everything is set up correctly. </p>
<p><img align="left" alt="CLI Monitoring Telnet item" src="../ch04-zabbix-collecting-data/ssh-telnet/ch04.xx-cli-monitoring-telnet-item.png" />
<em>4.xx Zabbix CLI Monitoring Telnet item</em></p>
<p>Do not forget to add your tag.</p>
<p><img align="left" alt="CLI Monitoring Telnet item tag" src="../ch04-zabbix-collecting-data/ssh-telnet/ch04.xx-cli-monitoring-telnet-item-tag.png" />
<em>4.xx Zabbix CLI Monitoring Telnet item tag</em></p>
<p>Then, if you had a Telnet user set up. You can go to <code>Monitoring</code> | <code>Latest data</code> to check if the value is coming in.</p>
<h2 id="ch04-zabbix-collecting-data-ssh-telnet-conclusion">Conclusion</h2>
<p>SSH and Telnet monitoring provide you with a great fallback when traditional protocols like SNMP or API's simply aren't available. It might also be the case that a vendor hides important information within CLI commands. Using a limited user account, only granted access to specific commands, Zabbix can remotely authenticate and execute CLI commands or even entire scripts to get us raw terminal output that can be used as metrics.</p>
<p>When working with these two options, of course SSH will be the preferred method as it grants us the correct security for modern environments. Telnet should only be used when absolutely all other options are exhausted. In any case, the workflow remains the same in both cases: log in, run a command, preprocess the output, and then use it just like any other metric you have collected.</p>
<h2 id="ch04-zabbix-collecting-data-ssh-telnet-questions">Questions</h2>
<h2 id="ch04-zabbix-collecting-data-ssh-telnet-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch04-zabbix-collecting-data-script" heading-number="9.14"><nav class='md-tags'><span class='md-tag'>expert</span></nav><h1 id="script-item">Script item</h1>
<p>Zabbix offers several item types for gathering data, but sometimes you need logic,
multiple API calls, or data manipulation that's too complex for simple preprocessing.
<strong>Script items</strong> fill that gap, they run JavaScript directly on the Zabbix Server
or Proxy and can fetch, process, and return data exactly how you need it.</p>
<p>In this chapter, we'll explore what script items can do through <strong>two working examples</strong>:</p>
<ol>
<li>Checking GitHub repository stars via public API</li>
<li>Querying the public weather page Open-Meteo</li>
</ol>
<h2 id="ch04-zabbix-collecting-data-script-understanding-script-items">Understanding Script items</h2>
<p>Script items execute JavaScript in the Zabbix backend using the built-in Duktape
engine.</p>
<p>They're ideal when you need:</p>
<ul>
<li>HTTP or API calls that return JSON/XML data</li>
<li>Conditional logic or loops</li>
<li>Chained API requests (login + data fetch)</li>
<li>Monitoring without deploying an agent</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-script-common-javascript-objects">Common JavaScript objects</h3>
<p>Zabbix provides several JavaScript objects for script items:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>HttpRequest</code></td>
<td style="text-align: left;">Perform HTTP(S) requests</td>
</tr>
<tr>
<td style="text-align: left;"><code>Zabbix.log(level, message)</code></td>
<td style="text-align: left;">Log messages (level 4=debug, 3=info, etc.)</td>
</tr>
<tr>
<td style="text-align: left;"><code>JSON.parse()</code> / <code>JSON.stringify()</code></td>
<td style="text-align: left;">Handle JSON data</td>
</tr>
<tr>
<td style="text-align: left;"><code>parameters.&lt;name&gt;</code></td>
<td style="text-align: left;">Access item parameters defined in the UI</td>
</tr>
</tbody>
</table>
<p><strong>Limits:</strong> up to 10 <code>HttpRequest</code> objects per run; typical timeout ‚â§ 30 seconds
(depending on item settings).</p>
<p>The complete list of objects can be found in the official Zabbix documentation:
<a href="https://www.zabbix.com/documentation/current/en/manual/config/items/preprocessing/javascript/javascript_objects">https://www.zabbix.com/documentation/current/en/manual/config/items/preprocessing/javascript/javascript_objects</a></p>
<p>Let's create some example scripts so that you get a better understanding of how
it works.</p>
<p>Create a new host in <code>Data collection</code> -&gt; <code>Hosts</code>.</p>
<ul>
<li><strong>Host name:</strong> javascript</li>
<li><strong>Host groups:</strong> JS Servers</li>
</ul>
<p>Actually name and group are not important at all in this case :) When done
create an item on the host.</p>
<hr />
<h2 id="ch04-zabbix-collecting-data-script-example-1-query-a-public-api-github-repository-stars">Example 1 ‚Äì Query a public API (GitHub repository stars)</h2>
<p>This item will return the current number of <strong>stars</strong> for a given GitHub repository
using the REST API.</p>
<h3 id="ch04-zabbix-collecting-data-script-item-setup">Item setup</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Query Github Repository</td>
</tr>
<tr>
<td style="text-align: left;">Type</td>
<td style="text-align: left;">Script</td>
</tr>
<tr>
<td style="text-align: left;">Key</td>
<td style="text-align: left;">github.repo.stars</td>
</tr>
<tr>
<td style="text-align: left;">Type of information</td>
<td style="text-align: left;">Numeric (unsigned)</td>
</tr>
<tr>
<td style="text-align: left;">Unit</td>
<td style="text-align: left;">Stars</td>
</tr>
<tr>
<td style="text-align: left;">Update interval</td>
<td style="text-align: left;">1h</td>
</tr>
<tr>
<td style="text-align: left;">Timeout</td>
<td style="text-align: left;">5s</td>
</tr>
<tr>
<td style="text-align: left;">Parameters</td>
<td style="text-align: left;">owner = <code>zabbix</code></td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;">repo = <code>zabbix</code></td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;">token = <code>&lt;optional Github token&gt;</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> GitHub‚Äôs API enforces rate limits for unauthenticated requests (‚âà60/hour per IP).
Add a personal access token for higher limits.</p>
</blockquote>
<p>Add the following code in the script box of the item.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-script-__codelineno-0-1"></a><span class="c1">// Parameters (item ‚Üí Parameters):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch04-zabbix-collecting-data-script-__codelineno-0-2"></a><span class="c1">//   owner = zabbix</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch04-zabbix-collecting-data-script-__codelineno-0-3"></a><span class="c1">//   repo  = zabbix</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch04-zabbix-collecting-data-script-__codelineno-0-4"></a><span class="c1">//   token = &lt;optional PAT&gt;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch04-zabbix-collecting-data-script-__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch04-zabbix-collecting-data-script-__codelineno-0-6"></a><span class="c1">// Parse parameters from `value` (JSON string)</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch04-zabbix-collecting-data-script-__codelineno-0-7"></a><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch04-zabbix-collecting-data-script-__codelineno-0-8"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch04-zabbix-collecting-data-script-__codelineno-0-9"></a><span class="w">  </span><span class="nx">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span><span class="w">   </span><span class="c1">// { owner, repo, token }</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ch04-zabbix-collecting-data-script-__codelineno-0-10"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ch04-zabbix-collecting-data-script-__codelineno-0-11"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="s2">&quot;Parameter JSON parse failed: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">e</span><span class="p">;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ch04-zabbix-collecting-data-script-__codelineno-0-12"></a><span class="p">}</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#ch04-zabbix-collecting-data-script-__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#ch04-zabbix-collecting-data-script-__codelineno-0-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">owner</span><span class="p">;</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#ch04-zabbix-collecting-data-script-__codelineno-0-15"></a><span class="kd">var</span><span class="w"> </span><span class="nx">repo</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">repo</span><span class="p">;</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#ch04-zabbix-collecting-data-script-__codelineno-0-16"></a><span class="kd">var</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">token</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#ch04-zabbix-collecting-data-script-__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#ch04-zabbix-collecting-data-script-__codelineno-0-18"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">owner</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">repo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#ch04-zabbix-collecting-data-script-__codelineno-0-19"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="s2">&quot;Missing &#39;owner&#39; or &#39;repo&#39; parameter&quot;</span><span class="p">;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#ch04-zabbix-collecting-data-script-__codelineno-0-20"></a><span class="p">}</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#ch04-zabbix-collecting-data-script-__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#ch04-zabbix-collecting-data-script-__codelineno-0-22"></a><span class="kd">var</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://api.github.com/repos/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">owner</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">repo</span><span class="p">;</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#ch04-zabbix-collecting-data-script-__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#ch04-zabbix-collecting-data-script-__codelineno-0-24"></a><span class="kd">var</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#ch04-zabbix-collecting-data-script-__codelineno-0-25"></a><span class="nx">req</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s2">&quot;User-Agent: zabbix-script-item&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// required by GitHub</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#ch04-zabbix-collecting-data-script-__codelineno-0-26"></a><span class="nx">req</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s2">&quot;Accept: application/vnd.github+json&quot;</span><span class="p">);</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#ch04-zabbix-collecting-data-script-__codelineno-0-27"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#ch04-zabbix-collecting-data-script-__codelineno-0-28"></a><span class="w">  </span><span class="nx">req</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s2">&quot;Authorization: Bearer &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">token</span><span class="p">);</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#ch04-zabbix-collecting-data-script-__codelineno-0-29"></a><span class="p">}</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#ch04-zabbix-collecting-data-script-__codelineno-0-30"></a>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#ch04-zabbix-collecting-data-script-__codelineno-0-31"></a><span class="kd">var</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#ch04-zabbix-collecting-data-script-__codelineno-0-32"></a><span class="kd">var</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">getStatus</span><span class="p">();</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#ch04-zabbix-collecting-data-script-__codelineno-0-33"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">code</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="mf">200</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#ch04-zabbix-collecting-data-script-__codelineno-0-34"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="s2">&quot;GitHub API HTTP &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; body=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">body</span><span class="p">;</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#ch04-zabbix-collecting-data-script-__codelineno-0-35"></a><span class="p">}</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#ch04-zabbix-collecting-data-script-__codelineno-0-36"></a>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#ch04-zabbix-collecting-data-script-__codelineno-0-37"></a><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#ch04-zabbix-collecting-data-script-__codelineno-0-38"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">stargazers_count</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#ch04-zabbix-collecting-data-script-__codelineno-0-39"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="s2">&quot;Unexpected response: missing stargazers_count&quot;</span><span class="p">;</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#ch04-zabbix-collecting-data-script-__codelineno-0-40"></a><span class="p">}</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#ch04-zabbix-collecting-data-script-__codelineno-0-41"></a>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#ch04-zabbix-collecting-data-script-__codelineno-0-42"></a><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">stargazers_count</span><span class="p">;</span>
</span></code></pre></div>
<p><img alt="Script/ch04.40-script-example1.png" src="../ch04-zabbix-collecting-data/Script/ch04.40-script-example1.png" /></p>
<h3 id="ch04-zabbix-collecting-data-script-example-trigger">Example trigger</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-script-__codelineno-1-1"></a>last(/javascript/github.repo.stars)=0
</span></code></pre></div>
<p>In this case we get an alert if the script returns 0</p>
<hr />
<h2 id="ch04-zabbix-collecting-data-script-example-2-public-weather">Example 2 - Public weather</h2>
<p>In this script we call Open-Meteo and ask for for information like temperature,
windspeed, direction based on our longitude / latitude.</p>
<h3 id="ch04-zabbix-collecting-data-script-item-setup_1">Item setup</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Query Weather Open Meteo</td>
</tr>
<tr>
<td style="text-align: left;">Type</td>
<td style="text-align: left;">Script</td>
</tr>
<tr>
<td style="text-align: left;">Key</td>
<td style="text-align: left;">weather.openmeteo.json</td>
</tr>
<tr>
<td style="text-align: left;">Type of information</td>
<td style="text-align: left;">Text</td>
</tr>
<tr>
<td style="text-align: left;">Update interval</td>
<td style="text-align: left;">1h</td>
</tr>
<tr>
<td style="text-align: left;">Parameters</td>
<td style="text-align: left;">latitude = <code>50.85</code>, longitude = <code>4.7</code></td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;">temperature_unit = <code>celsius</code> (celsius / fahrenheit)</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;">windspeed_unit = <code>kmh</code>   (kmh / ms / mph / kn)</td>
</tr>
</tbody>
</table>
<p>Add the following code in the script box.</p>
<p><div class="language-js highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-script-__codelineno-2-1"></a><span class="c1">// Parameters (item ‚Üí Parameters):</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch04-zabbix-collecting-data-script-__codelineno-2-2"></a><span class="c1">//   latitude = 50.85</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ch04-zabbix-collecting-data-script-__codelineno-2-3"></a><span class="c1">//   temperaature_unit  = 4.7</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ch04-zabbix-collecting-data-script-__codelineno-2-4"></a><span class="c1">//   windspeed_unit = kmh / ms / mph / kn</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ch04-zabbix-collecting-data-script-__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ch04-zabbix-collecting-data-script-__codelineno-2-6"></a><span class="kd">function</span><span class="w"> </span><span class="nx">toNumberFixLocale</span><span class="p">(</span><span class="nx">s</span><span class="p">){</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="nx">s</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="kc">NaN</span><span class="p">;</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">t</span><span class="o">=</span><span class="nb">String</span><span class="p">(</span><span class="nx">s</span><span class="p">).</span><span class="nx">trim</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="s2">&quot;.&quot;</span><span class="p">);</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ch04-zabbix-collecting-data-script-__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#ch04-zabbix-collecting-data-script-__codelineno-2-8"></a><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="o">=</span><span class="p">{};</span><span class="w"> </span><span class="k">try</span><span class="p">{</span><span class="w"> </span><span class="nx">p</span><span class="o">=</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="s2">&quot;Param JSON parse failed: &quot;</span><span class="o">+</span><span class="nx">e</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#ch04-zabbix-collecting-data-script-__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#ch04-zabbix-collecting-data-script-__codelineno-2-10"></a><span class="kd">var</span><span class="w"> </span><span class="nx">lat</span><span class="o">=</span><span class="nx">toNumberFixLocale</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">latitude</span><span class="p">),</span><span class="w"> </span><span class="nx">lon</span><span class="o">=</span><span class="nx">toNumberFixLocale</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">longitude</span><span class="p">);</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#ch04-zabbix-collecting-data-script-__codelineno-2-11"></a><span class="k">if</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">lat</span><span class="p">)</span><span class="o">||</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">lon</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">ok</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="nx">status</span><span class="o">:</span><span class="s2">&quot;BAD_COORDS&quot;</span><span class="p">,</span><span class="nx">note</span><span class="o">:</span><span class="s2">&quot;Use dots, e.g. 50.85 and 4.35&quot;</span><span class="p">});</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#ch04-zabbix-collecting-data-script-__codelineno-2-12"></a><span class="k">if</span><span class="p">(</span><span class="nx">lat</span><span class="o">&lt;-</span><span class="mf">90</span><span class="o">||</span><span class="nx">lat</span><span class="o">&gt;</span><span class="mf">90</span><span class="o">||</span><span class="nx">lon</span><span class="o">&lt;-</span><span class="mf">180</span><span class="o">||</span><span class="nx">lon</span><span class="o">&gt;</span><span class="mf">180</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">ok</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="nx">status</span><span class="o">:</span><span class="s2">&quot;RANGE_ERROR&quot;</span><span class="p">});</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#ch04-zabbix-collecting-data-script-__codelineno-2-13"></a>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#ch04-zabbix-collecting-data-script-__codelineno-2-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">tUnit</span><span class="o">=</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">temperature_unit</span><span class="o">||</span><span class="s2">&quot;celsius&quot;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#ch04-zabbix-collecting-data-script-__codelineno-2-15"></a><span class="kd">var</span><span class="w"> </span><span class="nx">wUnit</span><span class="o">=</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">windspeed_unit</span><span class="o">||</span><span class="s2">&quot;kmh&quot;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#ch04-zabbix-collecting-data-script-__codelineno-2-16"></a>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#ch04-zabbix-collecting-data-script-__codelineno-2-17"></a><span class="kd">var</span><span class="w"> </span><span class="nx">url</span><span class="o">=</span><span class="s2">&quot;https://api.open-meteo.com/v1/forecast?latitude=&quot;</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">lat</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;longitude=&quot;</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">lon</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;current_weather=true&amp;temperature_unit=&quot;</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">tUnit</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;windspeed_unit=&quot;</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">wUnit</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;timezone=auto&quot;</span><span class="p">;</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#ch04-zabbix-collecting-data-script-__codelineno-2-18"></a>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#ch04-zabbix-collecting-data-script-__codelineno-2-19"></a><span class="kd">var</span><span class="w"> </span><span class="nx">req</span><span class="o">=</span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s2">&quot;User-Agent: zabbix-script-item&quot;</span><span class="p">);</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#ch04-zabbix-collecting-data-script-__codelineno-2-20"></a><span class="kd">var</span><span class="w"> </span><span class="nx">body</span><span class="o">=</span><span class="nx">req</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nx">code</span><span class="o">=</span><span class="nx">req</span><span class="p">.</span><span class="nx">getStatus</span><span class="p">();</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#ch04-zabbix-collecting-data-script-__codelineno-2-21"></a><span class="k">if</span><span class="p">(</span><span class="nx">code</span><span class="o">!==</span><span class="mf">200</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">ok</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="nx">status</span><span class="o">:</span><span class="s2">&quot;HTTP&quot;</span><span class="p">,</span><span class="nx">http</span><span class="o">:</span><span class="nx">code</span><span class="p">,</span><span class="nx">url</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span><span class="nx">body</span><span class="o">:</span><span class="nb">String</span><span class="p">(</span><span class="nx">body</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">180</span><span class="p">)});</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#ch04-zabbix-collecting-data-script-__codelineno-2-22"></a>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#ch04-zabbix-collecting-data-script-__codelineno-2-23"></a><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="p">;</span><span class="w"> </span><span class="k">try</span><span class="p">{</span><span class="w"> </span><span class="nx">j</span><span class="o">=</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">);}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">ok</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="nx">status</span><span class="o">:</span><span class="s2">&quot;BAD_JSON&quot;</span><span class="p">});</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#ch04-zabbix-collecting-data-script-__codelineno-2-24"></a><span class="kd">var</span><span class="w"> </span><span class="nx">cw</span><span class="o">=</span><span class="nx">j</span><span class="p">.</span><span class="nx">current_weather</span><span class="o">||</span><span class="nx">j</span><span class="p">.</span><span class="nx">current</span><span class="o">||</span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#ch04-zabbix-collecting-data-script-__codelineno-2-25"></a><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">cw</span><span class="o">||</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">cw</span><span class="p">.</span><span class="nx">temperature</span><span class="o">!==</span><span class="s2">&quot;number&quot;</span><span class="o">||</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">cw</span><span class="p">.</span><span class="nx">windspeed</span><span class="o">!==</span><span class="s2">&quot;number&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">ok</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="nx">status</span><span class="o">:</span><span class="s2">&quot;NO_CURRENT&quot;</span><span class="p">});</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#ch04-zabbix-collecting-data-script-__codelineno-2-26"></a>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#ch04-zabbix-collecting-data-script-__codelineno-2-27"></a><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">ok</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="nx">status</span><span class="o">:</span><span class="s2">&quot;OK&quot;</span><span class="p">,</span><span class="nx">temperature</span><span class="o">:</span><span class="nx">cw</span><span class="p">.</span><span class="nx">temperature</span><span class="p">,</span><span class="nx">windspeed</span><span class="o">:</span><span class="nx">cw</span><span class="p">.</span><span class="nx">windspeed</span><span class="p">,</span><span class="nx">winddirection</span><span class="o">:</span><span class="nx">cw</span><span class="p">.</span><span class="nx">winddirection</span><span class="p">,</span><span class="nx">is_day</span><span class="o">:</span><span class="nx">cw</span><span class="p">.</span><span class="nx">is_day</span><span class="p">,</span><span class="nx">time</span><span class="o">:</span><span class="nx">cw</span><span class="p">.</span><span class="nx">time</span><span class="o">||</span><span class="s2">&quot;&quot;</span><span class="p">});</span>
</span></code></pre></div>
<img alt="Script/ch04.42-script-example2.png" src="../ch04-zabbix-collecting-data/Script/ch04.42-script-example2.png" /></p>
<p>Next create a few dependent items that use this script as master item.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name:</strong></td>
<td style="text-align: left;">Temperature</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key:</strong></td>
<td style="text-align: left;">weather.temp</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information:</strong></td>
<td style="text-align: left;">Float</td>
</tr>
<tr>
<td style="text-align: left;">Preprocessing</td>
<td style="text-align: left;">JSONPath: -&gt; $.temperature</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name:</strong></td>
<td style="text-align: left;">Windspeed</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key:</strong></td>
<td style="text-align: left;">weather.windspeed</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information:</strong></td>
<td style="text-align: left;">Float</td>
</tr>
<tr>
<td style="text-align: left;">Preprocessing</td>
<td style="text-align: left;">JSONPath: -&gt; $.windspeed</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name:</strong></td>
<td style="text-align: left;">Wind direction</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key:</strong></td>
<td style="text-align: left;">weather.winddir</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information:</strong></td>
<td style="text-align: left;">Unsigned</td>
</tr>
<tr>
<td style="text-align: left;">Preprocessing</td>
<td style="text-align: left;">JSONPath: -&gt; $.winddirection</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name:</strong></td>
<td style="text-align: left;">Is day</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key:</strong></td>
<td style="text-align: left;">weather.is_day</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information:</strong></td>
<td style="text-align: left;">Unsigned</td>
</tr>
<tr>
<td style="text-align: left;">Preprocessing</td>
<td style="text-align: left;">JSONPath: -&gt; $.is_day</td>
</tr>
</tbody>
</table>
<p><img alt="Script/ch04.41-script-example2.png" src="../ch04-zabbix-collecting-data/Script/ch04.41-script-example2.png" /></p>
<hr />
<h2 id="ch04-zabbix-collecting-data-script-best-practices-and-troubleshooting">Best practices and troubleshooting</h2>
<ul>
<li><strong>Timeouts:</strong> Keep script execution short; APIs may delay.</li>
<li><strong>Testing:</strong> Use <em>‚ÄúCheck now‚Äù</em> in the item to see raw output.</li>
<li><strong>Logging:</strong> Use <code>Zabbix.log(3, "message")</code> for debug output (appears in server
  or proxy log).</li>
<li><strong>Error handling:</strong> Always <code>throw</code> errors instead of returning strings; Zabbix
  will mark the item as unsupported automatically.</li>
<li><strong>Object reuse:</strong> Each script can create up to 10 <code>HttpRequest</code> objects reuse
  one when chaining API calls.</li>
<li><strong>Security:</strong> Never hard-code passwords or tokens; use macros or item parameters.</li>
</ul>
<hr />
<h2 id="ch04-zabbix-collecting-data-script-when-to-use-script-items">When to use Script items</h2>
<p>Use Script items when:</p>
<ul>
<li>You need <strong>logic, loops, or multiple API calls</strong>.</li>
<li>You monitor <strong>remote services</strong> where agents aren't available.</li>
<li>You want to prototype an integration before writing a custom plugin.</li>
</ul>
<p>For simple JSON transformations, preprocessing JavaScript might be enough, but
Script items shine when you need full control.</p>
<hr />
<h2 id="ch04-zabbix-collecting-data-script-expert-techniques-for-script-items">Expert techniques for Script items</h2>
<h3 id="ch04-zabbix-collecting-data-script-1-debugging-things">1. Debugging things</h3>
<p>During development, use the internal logging API to trace script behavior:</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-script-__codelineno-3-1"></a><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Debug: response body = &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">body</span><span class="p">);</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch04-zabbix-collecting-data-script-__codelineno-3-2"></a><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Info: token received successfully&quot;</span><span class="p">);</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ch04-zabbix-collecting-data-script-__codelineno-3-3"></a><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Warning: unexpected API reply&quot;</span><span class="p">);</span>
</span></code></pre></div>
<details class="tip" open="open">
<summary>Tip</summary>
<ul>
<li>Log level <code>4</code> = debug, visible only if the server log level ‚â•4.</li>
<li>Log level <code>3</code> = informational.</li>
<li>The log lines are written to the Zabbix server or proxy log, not the frontend.</li>
</ul>
</details>
<p>When a script throws an error, Zabbix automatically marks the item as <em>unsupported</em>.</p>
<h3 id="ch04-zabbix-collecting-data-script-2-using-macros-and-secret-parameters">2. Using macros and secret parameters</h3>
<p>Always move credentials, tokens, and sensitive values to <strong>item parameters</strong> or
<strong>macros</strong> rather than hard coding them.</p>
<p>For example:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>token</code></td>
<td style="text-align: left;"><code>{$GITHUB_TOKEN}</code></td>
</tr>
</tbody>
</table>
<p>Then define <code>{$GITHUB_TOKEN}</code> in your host or template with <strong>secret visibility</strong>.
This allows you to reuse the same script safely across environments.</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Manage secrets via <em>template macros</em> so that they are portable if you
export the template. Store secrets in a vault instead of the DB.</p>
</details>
<h3 id="ch04-zabbix-collecting-data-script-3-error-handling-and-fallback-logic">3. Error handling and fallback logic</h3>
<p>Production scripts should degrade gracefully.
You can catch and handle network failures, retry, or return a fallback value:</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch04-zabbix-collecting-data-script-__codelineno-4-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch04-zabbix-collecting-data-script-__codelineno-4-2"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch04-zabbix-collecting-data-script-__codelineno-4-3"></a><span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">parameters</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch04-zabbix-collecting-data-script-__codelineno-4-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">getStatus</span><span class="p">()</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="mf">200</span><span class="p">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ch04-zabbix-collecting-data-script-__codelineno-4-5"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="s2">&quot;HTTP &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">getStatus</span><span class="p">();</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ch04-zabbix-collecting-data-script-__codelineno-4-6"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ch04-zabbix-collecting-data-script-__codelineno-4-7"></a><span class="p">}</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ch04-zabbix-collecting-data-script-__codelineno-4-8"></a><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ch04-zabbix-collecting-data-script-__codelineno-4-9"></a><span class="w">  </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Request failed: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#ch04-zabbix-collecting-data-script-__codelineno-4-10"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// Fallback value for triggers</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#ch04-zabbix-collecting-data-script-__codelineno-4-11"></a><span class="p">}</span>
</span></code></pre></div>
<p>This script catches any errors (network failure, bad JSON, missing .value, etc.):
Logs the error at severity level 2 (Warning) into the Zabbix server log.
It returns a numeric 0 instead of throwing errors, so the item remains
supported.</p>
<h3 id="ch04-zabbix-collecting-data-script-4-caching-between-executions">4. Caching between executions</h3>
<p>Script items don't keep memory between runs, but you can reuse data efficiently
by combining one master Script or trapper item that stores the full JSON response
with several dependent items that extract individual fields. This isn't true caching
inside JavaScript. It's data reuse via Zabbix history, avoiding repeated API calls.</p>
<h3 id="ch04-zabbix-collecting-data-script-5-parallelization-and-performance-considerations">5. Parallelization and performance considerations</h3>
<p>Each Script item consumes one poller slot.
If you have dozens of Script items that do API calls, consider:</p>
<ul>
<li>Running them on a <strong>proxy</strong> close to the data source (reduces latency).</li>
<li>Adjusting <code>StartPollers</code> and <code>Timeout</code> in <code>zabbix_server.conf</code>.</li>
<li>Avoiding heavy JSON parsing or unnecessary loops.</li>
<li>Using asynchronous APIs only when truly needed. Duktape executes synchronously.</li>
</ul>
<p>A single bad Script item can block a poller for its entire timeout period, so always
test and tune.</p>
<h3 id="ch04-zabbix-collecting-data-script-6-returning-structured-data">6. Returning structured data</h3>
<p>Script items can return <strong>JSON strings</strong> which can then be used in <strong>dependent items</strong>.
Example: returning a JSON object containing multiple metrics.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch04-zabbix-collecting-data-script-__codelineno-5-1"></a><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch04-zabbix-collecting-data-script-__codelineno-5-2"></a><span class="w">  </span><span class="nx">cpu_usage</span><span class="o">:</span><span class="w"> </span><span class="mf">25</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch04-zabbix-collecting-data-script-__codelineno-5-3"></a><span class="w">  </span><span class="nx">mem_usage</span><span class="o">:</span><span class="w"> </span><span class="mf">67</span><span class="p">,</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ch04-zabbix-collecting-data-script-__codelineno-5-4"></a><span class="w">  </span><span class="nx">disk_free</span><span class="o">:</span><span class="w"> </span><span class="mf">18234</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ch04-zabbix-collecting-data-script-__codelineno-5-5"></a><span class="p">});</span>
</span></code></pre></div>
<p>Then create dependent items with JSONPath like:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch04-zabbix-collecting-data-script-__codelineno-6-1"></a><span class="err">$.cpu_usage</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch04-zabbix-collecting-data-script-__codelineno-6-2"></a><span class="err">$.mem_usage</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch04-zabbix-collecting-data-script-__codelineno-6-3"></a><span class="err">$.disk_</span><span class="kc">free</span>
</span></code></pre></div>
<p>This allows one Script item to feed many dependent metrics. A professional optimization
pattern.</p>
<h3 id="ch04-zabbix-collecting-data-script-7-combining-script-items-with-preprocessing-javascript">7. Combining script items with preprocessing JavaScript</h3>
<p>Advanced users often pair a Script item that performs heavy retrieval with preprocessing
JavaScript that performs lightweight normalization.</p>
<p>Example:</p>
<ul>
<li>Script item fetches a full JSON payload from an API.</li>
<li>Dependent item extracts a numeric value using preprocessing JavaScript:</li>
</ul>
<div class="language-js highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch04-zabbix-collecting-data-script-__codelineno-7-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch04-zabbix-collecting-data-script-__codelineno-7-2"></a><span class="k">return</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">cpu</span><span class="p">;</span>
</span></code></pre></div>
<p>This separates responsibilities and makes troubleshooting easier.</p>
<h3 id="ch04-zabbix-collecting-data-script-8-controlling-execution-context">8. Controlling execution context</h3>
<p>Script items always run <strong>on the poller process</strong> of either the Zabbix server or
proxy. Understanding this helps when debugging:</p>
<ul>
<li>If an item runs on a <strong>proxy</strong>, it has network access only from the proxy‚Äôs location.</li>
<li>You can <strong>force</strong> execution on a proxy by assigning the host to that proxy.</li>
<li>Logs for script execution appear in the respective poller‚Äôs log file.</li>
</ul>
<details class="info" open="open">
<summary>Info</summary>
<p>There is a small exception when it comes to the use of the poller process.
If you make use of the test button to test the item then the check will not
user the poller but the task manager process.</p>
</details>
<h3 id="ch04-zabbix-collecting-data-script-9-best-practice-checklist">9. Best practice checklist</h3>
<ul>
<li>‚úÖ Keep scripts short (&lt;200 lines).</li>
<li>‚úÖ Always handle HTTP status codes and JSON errors.</li>
<li>‚úÖ Use parameters or macros for configuration.</li>
<li>‚úÖ Log at <code>Zabbix.log(3, ...)</code> for operations and <code>Zabbix.log(4, ...)</code> for debugging.</li>
<li>‚úÖ Reuse a single <code>HttpRequest</code> object per script.</li>
<li>‚úÖ Test interactively in the frontend with <em>‚ÄúCheck now‚Äù</em>.</li>
<li>‚úÖ Document the purpose and return type at the top of each script.</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-script-12-summary">12. Summary</h3>
<p>By mastering Script items, you've reached the <strong>expert level of Zabbix data collection</strong>.
You now understand not just how to fetch and return data, but how to:</p>
<ul>
<li>Debug effectively</li>
<li>Secure your credentials</li>
<li>Handle API errors gracefully</li>
<li>Optimize poller usage</li>
<li>Reuse scripts for multiple metrics</li>
</ul>
<p>These skills let you integrate Zabbix with virtually any system.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>When a Script item is executed, Zabbix starts a Duktape JavaScript interpreter
inside the server or proxy process. For each check run, Zabbix injects a few
built-in variables into the script‚Äôs environment the most important one is
<code>value</code>.</p>
<p><code>value</code> is a JSON string that contains all item parameters you defined under
Parameters ‚Üí Name / Value.</p>
<p>Inside the script, you must parse it first:</p>
<p><code>var p = JSON.parse(value);</code></p>
<p>You can then access the parameters by name:</p>
<p><code>var host = p.host;</code>
<code>var port = p.port;</code></p>
<p>If you try to reference a <code>parameters</code> object (as seen in some very old examples),
you will get : <code>ReferenceError: identifier 'parameters' undefined</code> because the
Duktape runtime does not inject such a variable anymore. All parameters are
passed inside the value JSON string.</p>
</details>
<h2 id="ch04-zabbix-collecting-data-script-conclusion">Conclusion</h2>
<p>Script items make Zabbix remarkably flexible ‚Äî they let you collect data from any
API or service with just a few lines of JavaScript.
While the built-in Duktape engine is synchronous and minimal, meaning no true
parallelism or advanced JS features, it‚Äôs more than enough for lightweight
automation and integrations.</p>
<p>The key to using Script items effectively is efficiency: fetch once, reuse results
through dependent items, and keep scripts small and predictable. When heavier or
high-frequency polling is needed, move it closer to the data source with proxies
or external collectors.</p>
<p>With those principles in mind, Script items become your gateway between Zabbix
and the modern API world ‚Äî simple, powerful, and entirely scriptable.</p>
<h2 id="ch04-zabbix-collecting-data-script-questions">Questions</h2>
<ul>
<li>What makes Script items different from external checks or user parameters in Zabbix?</li>
<li>How are Script item parameters passed to the JavaScript environment in modern
  Zabbix versions?</li>
<li>Why does using JSON.parse(value) make your scripts more portable?</li>
<li>How can you avoid making multiple API calls when several metrics come from the
  same endpoint?</li>
<li>Why are global macros usually not a good choice for secrets in exported templates?</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-script-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/preprocessing/javascript/javascript_objects">https://www.zabbix.com/documentation/current/en/manual/config/items/preprocessing/javascript/javascript_objects</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/script">https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/script</a></li>
</ul></section><section class="print-page" id="ch04-zabbix-collecting-data-jmx" heading-number="9.15"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="monitoring-java-applications-with-jmx">Monitoring Java Applications with JMX</h1>
<p>One of the neat features that Zabbix offers out of the box is the ability to monitor
Java applications. To make this happen, Zabbix uses something called the
<code>Java Gateway</code>, which communicates with Java applications via the
<code>Java Management Extensions</code> JMX, for short.</p>
<p><code>JMX</code> is a built-in Java technology designed specifically for monitoring and managing
Java applications and the <code>Java Virtual Machine</code> (JVM). It works through components
called <code>MBeans</code> (Managed Beans), which act like data sensors and control points.
These MBeans can expose useful information like memory usage, thread counts, and
even allow runtime configuration changes, all while the application is running.</p>
<p>One of the strengths of JMX is its flexibility. It supports both local and remote
access, so whether your Java app is on the same machine or halfway across the
network, Zabbix can still keep an eye on it. Combined with the Java Gateway, this
makes JMX a powerful and scalable option for monitoring Java-based environments
with minimal setup. Also JMX was an extension but is part of JAVA SE since java 5.</p>
<h2 id="ch04-zabbix-collecting-data-jmx-key-concepts-in-jmx-monitoring">Key Concepts in JMX Monitoring</h2>
<p>Before diving into JMX monitoring with Zabbix, it helps to get familiar with a
few core building blocks that make it all work:</p>
<p><strong>Managed Beans (MBeans):</strong>
These are the heart of JMX. MBeans are Java objects that expose useful bits of
data (called attributes) and operations (as regular methods) from your application.
Think of them as little control panels inside your Java app, you can read metrics,
tweak settings, or trigger actions through them.</p>
<p><strong>JMX Agent:</strong>
This is the engine behind the scenes. Running inside the Java Virtual Machine (JVM),
the JMX agent connects everything together. It's what lets management tools
(like Zabbix) interact with the MBeans.</p>
<p><strong>MBean Server:</strong>
A key part of the JMX agent, the MBean server is like a central registry where
MBeans are registered and managed. It keeps everything organized and accessible.</p>
<p><strong>Connectors:</strong>
Want to monitor your Java app remotely? That's where connectors come in. They
let external tools connect to the JMX agent over a network. So you're not limited
to local monitoring.</p>
<p><strong>Adaptors:</strong>
Sometimes you need JMX data to speak a different language. Adaptors convert JMX
info into formats that non-Java tools can understand, like HTTP or SNMP, making
integration easier with broader monitoring ecosystems.</p>
<h2 id="ch04-zabbix-collecting-data-jmx-jmx-core-architecture">JMX Core Architecture</h2>
<p>To understand how Zabbix collects data from Java applications, it helps to know
the basic structure of JMX itself. JMX is built on a three-layer architecture that
separates how metrics are defined, how they are stored inside the JVM, and how
external tools can reach them.</p>
<ul>
<li>
<p><strong>Instrumentation Layer:</strong> This is where the application exposes its internal
  state through MBeans (Managed Beans). They can be standard, dynamic, or MXBeans,
  and represent things like memory usage, thread counts, or application specific
  metrics.</p>
</li>
<li>
<p><strong>Agent Layer:</strong> ‚Äì Every JVM contains an MBeanServer, which acts as a registry
  and makes these MBeans available for management. When you start a JVM with
  -Dcom.sun.management.jmxremote, you are exposing this server for external access.</p>
</li>
<li>
<p><strong>Remote Management Layer:</strong> This is how outside tools connect to the JVM.
  Connectors (such as RMI or JMXMP) and adaptors (such as HTTP or SNMP bridges)
  allow Zabbix and other monitoring systems to fetch the metrics. By default,
  Zabbix uses an RMI connector via the Java Gateway.</p>
</li>
</ul>
<pre  class="mermaid"><code>flowchart LR
    A[Application] --> B[MBeans]
    B --> C[MBeanServer]
    C --> D[Connector RMI - JMXMP]
    D --> E[Zabbix Java Gateway]
    E --> F[Zabbix Server / DB]
    F --> G[Frontend]

    classDef app fill:#fef3c7,stroke:#111,stroke-width:1px,color:#111;
    classDef mbean fill:#dbeafe,stroke:#111,stroke-width:1px,color:#111;
    classDef gateway fill:#fde68a,stroke:#111,stroke-width:1px,color:#111;
    classDef zabbix fill:#bbf7d0,stroke:#111,stroke-width:1px,color:#111;

    class A app;
    class B,C mbean;
    class D,E gateway;
    class F,G zabbix;

</code></pre>
<h2 id="ch04-zabbix-collecting-data-jmx-where-does-the-zabbix-java-gateway-fit-in-this-picture">Where Does the Zabbix Java Gateway Fit in this picture?</h2>
<p>The Zabbix Java Gateway is an external component in the Zabbix ecosystem specifically
designed to handle JMX monitoring. While it's not part of the JMX framework itself,
it acts as a JMX client that connects to your Java application‚Äôs JMX agent and
collects data from MBeans. So, if we map it to the components we just discussed,
here's how it fits: =&gt; <strong>Category: Connectors (Client-Side)</strong></p>
<p>Why? Because the Zabbix Java Gateway is essentially a remote management application
that connects to the JMX agent running inside your Java app‚Äôs JVM. It uses JMX's
remote communication protocols (usually over RMI) to pull data from the MBean server.</p>
<p>Think of it like this:</p>
<ul>
<li>Your Java app exposes data via MBeans.</li>
<li>The JMX agent and MBean server inside the JVM make that data available.</li>
<li>The Zabbix Java Gateway reaches in from the outside, asks for that data,
  and passes it along to your Zabbix server.</li>
</ul>
<p>So, while connectors in JMX terminology usually refer to the part inside the JVM
that allows remote access, the Java Gateway is the counterpart on the outside.
The client that initiates those connections.</p>
<pre  class="mermaid"><code>flowchart LR
    subgraph JVM["Java Application (JVM)"]
        subgraph JMX["JMX Agent"]
            MBServer["MBean Server"]
            Connector["Connectors"]
            Adaptor["Adaptors"]
            M1["MBean"]
            M2["MBean"]

            MBServer --- M1
            MBServer --- M2
            MBServer --- Connector
            MBServer --- Adaptor
        end
    end

    ZS["Zabbix Server"]
    JGW["Zabbix Java Gateway"]

    ZS --> JGW
    JGW --> Connector

</code></pre>
<h2 id="ch04-zabbix-collecting-data-jmx-setup-tomcat-to-monitor-with-zabbix">Setup Tomcat to monitor with Zabbix.</h2>
<p>To ensure accurate testing of JMX monitoring with Zabbix, a dedicated host is essential.
Although configuration on the Zabbix server is possible, a separate machine provides a
more realistic representation of a production environment. For our setup, we'll
use a new virtual machine running either Rocky Linux or Ubuntu. This machine will
serve as our JMX-enabled target, and we'll install and configure Tomcat on it for
this purpose.</p>
<details class="info" open="open">
<summary>Setup Tomcat</summary>
<p>Red hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-0-1"></a>dnf install tomcat
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch04-zabbix-collecting-data-jmx-__codelineno-0-2"></a>vi /etc/sysconfig/tomcat
</span></code></pre></div>
Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-1-1"></a>apt install tomcat10
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch04-zabbix-collecting-data-jmx-__codelineno-1-2"></a>vi /etc/default/tomcat10
</span></code></pre></div>
Add the following config: in Ubuntu remove the original JAVA_OPTS line or
place a # in front</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-2-1"></a><span class="l l-Scalar l-Scalar-Plain">JAVA_OPTS=&quot;\</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch04-zabbix-collecting-data-jmx-__codelineno-2-2"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">-Dcom.sun.management.jmxremote=true \</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ch04-zabbix-collecting-data-jmx-__codelineno-2-3"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">-Dcom.sun.management.jmxremote.port=8686 \</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ch04-zabbix-collecting-data-jmx-__codelineno-2-4"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">-Dcom.sun.management.jmxremote.rmi.port=8686 \</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ch04-zabbix-collecting-data-jmx-__codelineno-2-5"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">-Dcom.sun.management.jmxremote.authenticate=false \</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ch04-zabbix-collecting-data-jmx-__codelineno-2-6"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">-Dcom.sun.management.jmxremote.ssl=false \</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ch04-zabbix-collecting-data-jmx-__codelineno-2-7"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">-Djava.rmi.server.hostname=&lt;local ip or hostname&gt;&quot;</span>
</span></code></pre></div>
</details>
<h3 id="ch04-zabbix-collecting-data-jmx-explanation-of-each-line">Explanation of Each Line</h3>
<p>Let's go over the lines we just configured. They are a set of configuration options,
called <strong>JMX options</strong>, passed to the Java Virtual Machine (JVM) at startup. These
options enable and configure the Java Management Extensions (JMX) agent, which
allows for remote monitoring and management of the application, in this case,
Apache Tomcat.</p>
<ul>
<li>
<p><strong><code>JAVA_OPTS="... "</code></strong>
  This is a variable used by Tomcat's startup scripts to hold a collection of
  command-line arguments for the Java process. The backslash (<code>\</code>) at the end of
  each line is a shell syntax feature that allows a single command or variable
  to span multiple lines, making the configuration easier to read.</p>
</li>
<li>
<p><strong><code>-Dcom.sun.management.jmxremote=true</code></strong>
  This is the main switch to enable the JMX remote agent. By setting this to <code>true</code>,
  you're telling the JVM to start the JMX management server.</p>
</li>
<li>
<p><strong><code>-Dcom.sun.management.jmxremote.port=8686</code></strong>
  This option specifies the <strong>port number</strong> for the JMX agent to listen on for
  incoming connections. In this case, it's set to <code>8686</code>.</p>
</li>
<li>
<p><strong><code>-Dcom.sun.management.jmxremote.rmi.port=8686</code></strong>
  This sets the port for the <strong>RMI (Remote Method Invocation) server</strong>. The JMX
  agent uses RMI to communicate with remote clients. In this configuration,
  both the JMX agent and the RMI server are configured to use the same port,
  simplifying the setup.</p>
</li>
<li>
<p><strong><code>-Dcom.sun.management.jmxremote.authenticate=false</code></strong>
  This disables authentication for JMX connections. For production environments,
  this should be set to <code>true</code> to require a username and password. Setting it to
  <code>false</code> is only suitable for development or testing environments.</p>
</li>
<li>
<p><strong><code>-Dcom.sun.management.jmxremote.ssl=false</code></strong>
  This disables Secure Sockets Layer (SSL) for JMX connections, meaning communication
  is not encrypted. Like authentication, this should be set to <code>true</code> in a production
  environment to secure the connection.</p>
</li>
<li>
<p><strong><code>-Djava.rmi.server.hostname=&lt;local ip&gt;"</code></strong>
  This is a crucial option that tells the RMI server which <strong>IP address</strong> to announce
  to clients. Clients will use this hostname to connect to the server. If this
  is not explicitly set, the RMI server might use the server's internal hostname
  or a loopback address (<code>127.0.0.1</code>), which would prevent external connections.
  By setting it to <code>&lt;your local IP&gt;</code>, you ensure that the JMX port is bound to
  the correct network interface for remote access.</p>
</li>
</ul>
<details class="note" open="open">
<summary>Note</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-1"></a>There<span class="w"> </span>isn<span class="s1">&#39;t a single, universally &quot;standard&quot; port for JMX that is accepted</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-2"></a><span class="s1">across all applications and vendors. The JMX specification itself does not</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-3"></a><span class="s1">define a default port, leaving it to the implementer to choose one.</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-5"></a><span class="s1">However, certain ports have become common or de facto standards within the Java</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-6"></a><span class="s1">ecosystem. The most frequently seen ports for JMX are in the high-number range,</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-7"></a><span class="s1">typically:</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-9"></a><span class="s1">- 1099: This port is a historic default for the RMI Registry, which JMX often</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-10"></a><span class="s1">  uses for communication. While it&#39;</span>s<span class="w"> </span>not<span class="w"> </span>strictly<span class="w"> </span>a<span class="w"> </span>JMX<span class="w"> </span>port,<span class="w"> </span>it<span class="s1">&#39;s often</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-11"></a><span class="s1">  associated with older JMX configurations.</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-12"></a>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-13"></a><span class="s1">- 8686: This port is a well-accepted and formally registered port for JMX with</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-14"></a><span class="s1">  the Internet Assigned Numbers Authority (IANA). The IANA service name for port</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-15"></a><span class="s1">  8686 is sun-as-jmxrmi. This makes it a great choice because it&#39;</span>s<span class="w"> </span>officially
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-16"></a><span class="w">  </span>recognized<span class="w"> </span>and<span class="w"> </span>less<span class="w"> </span>likely<span class="w"> </span>to<span class="w"> </span>conflict<span class="w"> </span>with<span class="w"> </span>other<span class="w"> </span>common<span class="w"> </span>services.
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-18"></a>Why<span class="w"> </span>Port<span class="w"> </span><span class="m">8686</span><span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>Good<span class="w"> </span>Choice?
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-19"></a>Port<span class="w"> </span><span class="m">8686</span><span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>User<span class="w"> </span>Port<span class="w"> </span><span class="o">(</span><span class="m">1024</span>-49151<span class="o">)</span>,<span class="w"> </span>which<span class="w"> </span>means<span class="w"> </span>it<span class="s1">&#39;s available for registered</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-20"></a><span class="s1">services but isn&#39;</span>t<span class="w"> </span>a<span class="w"> </span><span class="s2">&quot;well known&quot;</span><span class="w"> </span>port<span class="w"> </span>that<span class="w"> </span>requires<span class="w"> </span>a<span class="w"> </span>special<span class="w"> </span>permission<span class="w"> </span>level
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-21"></a>to<span class="w"> </span>use.<span class="w"> </span>It<span class="err">&#39;</span>s<span class="w"> </span>IANA<span class="w"> </span>registration<span class="w"> </span>as<span class="w"> </span>sun-as-jmxrmi<span class="w"> </span>makes<span class="w"> </span>it<span class="w"> </span>a<span class="w"> </span>safe<span class="w"> </span>and<span class="w"> </span>logical
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-22"></a>choice<span class="w"> </span><span class="k">for</span><span class="w"> </span>JMX<span class="w"> </span>monitoring,<span class="w"> </span>especially<span class="w"> </span>when<span class="w"> </span>you<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>standardize<span class="w"> </span>port<span class="w"> </span>assignments
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#ch04-zabbix-collecting-data-jmx-__codelineno-3-23"></a>across<span class="w"> </span>a<span class="w"> </span>large<span class="w"> </span>infrastructure.
</span></code></pre></div>
</details>
<h2 id="ch04-zabbix-collecting-data-jmx-setup-zabbix-to-monitor-jmx">Setup Zabbix to monitor JMX</h2>
<p>Now that we've set up a JMX-enabled application, we need to configure Zabbix to
monitor it. Since Zabbix can't connect directly to JMX endpoints, we need an
intermediary tool: the <strong>Zabbix Java Gateway</strong>.</p>
<p>This gateway needs to be installed and configured on your Zabbix server or proxy,
allowing a single gateway to service multiple JMX applications. The gateway operates
in a passive mode, which means it polls data directly from your JMX application.
The Zabbix server or proxy then polls the gateway to retrieve this data, completing
the connection chain.</p>
<p><img alt="Zabbix java gateway" src="../ch04-zabbix-collecting-data/JMX/ch04.35-jmx-zabbix.png" /></p>
<p><em>04.35 JMX Gateway</em></p>
<details class="info" open="open">
<summary>Install the JAVA Gateway</summary>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-4-1"></a>dnf install zabbix-java-gateway
</span></code></pre></div>
Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-5-1"></a>apt install zabbix-java-gateway
</span></code></pre></div></p>
</details>
<h2 id="ch04-zabbix-collecting-data-jmx-configuring-zabbix-and-the-java-gateway">Configuring Zabbix and the JAVA Gateway</h2>
<p>After installing the gateway, you'll find its configuration file at <code>/etc/zabbix/zabbix_java_gateway.conf</code>.
The default <code>LISTEN_IP</code> is set to 0.0.0.0, which means it listens on all network
interfaces, though you can change this. The gateway listens on port 10052, a non
IANA registered port, which can also be adjusted using the <code>LISTEN_PORT</code> option
if needed.</p>
<p>The first setting we'll change is <code>START_POLLERS</code>. We need to uncomment this line
and set a value, for example, <code>START_POLLERS=5</code> to define the number of concurrent
connections. The TIMEOUT option controls network operation timeouts, while
<code>PROPERTIES_FILE</code> allows you to define or override additional key-value properties,
such as a keystore password, without exposing them in a command line.</p>
<p>For your Zabbix server, you'll need to update the configuration file at <code>/etc/zabbix/zabbix_server.conf</code>.</p>
<p>You'll need to modify three key options:</p>
<ul>
<li>
<p><strong>JavaGateway:</strong> Uncomment this line and set its value to the IP address of
  the host running your Java gateway. This will likely be your Zabbix
  server itself, but it can be on a separate VM or proxy.</p>
</li>
<li>
<p><strong>JavaGatewayPort:</strong> This option should remain at the default <code>10052</code> unless
  you've changed the port in your gateway's configuration.</p>
</li>
<li>
<p><strong>StartJavaPollers:</strong> Uncomment and set this option to define the number of
  concurrent Java pollers the server will use. A good starting
  point is to match the number you set on the gateway, for
  example, 5.</p>
</li>
</ul>
<p>After making the changes to <code>/etc/zabbix/zabbix_server.conf</code> and <code>/etc/zabbix/zabbix_java_gateway.conf</code>,
you need to restart the following services:</p>
<ul>
<li>Zabbix Java Gateway</li>
<li>Zabbix Server</li>
</ul>
<p>Restarting these two services applies the new configuration, allowing the server
to communicate with the Java Gateway and begin polling for JMX data. Also don't
forget to enable the <code>Zabbix Java Gateway</code> service.</p>
<details class="info" open="open">
<summary>Restart the services</summary>
<p>RedHat and Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-6-1"></a>systemctl enable zabbix-java-gateway --now
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch04-zabbix-collecting-data-jmx-__codelineno-6-2"></a>systemclt restart zabbix-server
</span></code></pre></div></p>
</details>
<p>On the application side don't forget to open the firewall so that our
<code>zabbix-java-gateway</code> can connect to our application.</p>
<div class="admonition info">
<p class="admonition-title">Allow JMX</p>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-7-1"></a>firewall-cmd --add-port=8686/tcp --permanent
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch04-zabbix-collecting-data-jmx-__codelineno-7-2"></a>firewall-cmd --reload
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-8-1"></a>sudo ufw allow 8686/tcp
</span></code></pre></div></p>
</div>
<details class="warning" open="open">
<summary>Warning</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-9-1"></a>Don&#39;t forget to place SeLinux in permissive mode before you start else the
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ch04-zabbix-collecting-data-jmx-__codelineno-9-2"></a>JAVA gateway will not work. You should fix SeLinux permissions once the setup
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#ch04-zabbix-collecting-data-jmx-__codelineno-9-3"></a>is working.
</span></code></pre></div>
</details>
<h2 id="ch04-zabbix-collecting-data-jmx-monitoring-jmx-items">Monitoring JMX items</h2>
<p>After having setup everything, we can now connect to our Java application's JMX port to
verify everything is working.</p>
<p>For this, we can use JConsole, a monitoring tool that comes with the Java Development
Kit (JDK). Another great option is VisualVM, which offers a more visual and feature
rich experience. You can download it from <a href="https://visualvm.github.io/download.html">https://visualvm.github.io/download.html</a>.</p>
<p>Start your preferred application and connect to our JMX port on 8686.</p>
<p><img alt="Jconsole" src="../ch04-zabbix-collecting-data/JMX/ch04.36-jconsole.png" /></p>
<p><em>04.36 Jconsole</em></p>
<p>After a successful login you should be greeted with a screen like this. Were you
have a tree view overview of all the Mbeans we can use to gather information
from.</p>
<p><img alt="ch04.37 Succesful login" src="../ch04-zabbix-collecting-data/JMX/ch04.37-jconsole-mbeans-tree.png" /></p>
<p><em>04.37 Login screen</em></p>
<p>Before we can do this we need to create a new host in our Zabbix server. Let's
go to <code>Data collection</code> - <code>Hosts</code> and click on <code>Create host</code> in the upper right
corner. Use the following settings to create our host:</p>
<ul>
<li>Hostname : Tomcat</li>
<li>Host groups: JMX</li>
<li>Interfaces: JMX<ul>
<li>IP address: IP of your Tomcat server</li>
<li>Port : 8686 or the port you specified in your Tomcat configuration.</li>
</ul>
</li>
</ul>
<p>Press the <code>Add</code> button when ready.</p>
<details class="note" open="open">
<summary>Note</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-10-1"></a>It seems weird that we not specify the JavaGateway here but it&#39;s actually
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch04-zabbix-collecting-data-jmx-__codelineno-10-2"></a>normal. Zabbix knows from its configuration file where the gateway is. So we
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ch04-zabbix-collecting-data-jmx-__codelineno-10-3"></a>need to specify the IP and the PORT of the JAVA application here that we would
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ch04-zabbix-collecting-data-jmx-__codelineno-10-4"></a>like to monitor.
</span></code></pre></div>
</details>
<h3 id="ch04-zabbix-collecting-data-jmx-create-our-first-item">Create our first item</h3>
<p>On our host Tomcat create a new item and add the following information.</p>
<ul>
<li><em>Name:</em> requestCount</li>
<li><em>Type:</em> JMX Agent</li>
<li><em>Key:</em> jmx["Catalina:type=GlobalRequestProcessor,name=\"http-nio-8080\"", "requestCount"]</li>
<li><em>Type of information:</em> Numeric(unsigned)</li>
<li><em>Host interface:</em> The JMX interface we just created on our host.</li>
</ul>
<p><img alt="JMX Item" src="../ch04-zabbix-collecting-data/JMX/ch04.38-jmx-requestCount-item.png" /></p>
<p><em>ch04.38 JMX item</em></p>
<details class="info" open="open">
<summary>Verifying and Saving the Item</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-11-1"></a>Before saving the configured item, use the Test button. Clicking Get value
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ch04-zabbix-collecting-data-jmx-__codelineno-11-2"></a>or Get value and test should populate the value field with data, confirming
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#ch04-zabbix-collecting-data-jmx-__codelineno-11-3"></a>that the item is functional. Once the test is successful, you can save the
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#ch04-zabbix-collecting-data-jmx-__codelineno-11-4"></a>item.
</span></code></pre></div>
</details>
<p>To understand how we constructed the item key, let's look at the process in JConsole.</p>
<ol>
<li>
<p>Navigate to the MBeans tab and expand Catalina &gt; GlobalRequestProcessor &gt; http-nio-8080.</p>
</li>
<li>
<p>The ObjectNAme field on the right displays the MBean's fully qualified name:
   <code>Catalina:type=GlobalRequestProcessor,name="http-nio-8080"</code>. This is the base
   for our Zabbix item key.</p>
</li>
</ol>
<p>The primary challenge with this specific key is that it contains double quotes (")
within the <code>name</code> attribute. Zabbix requires the entire JMX key to be enclosed
in double quotes, which would conflict with the existing quotes. To resolve this,
we must <strong>escape</strong> the inner double quotes with a backslash ().</p>
<p>This results in the following structure for the Zabbix item key:
<code>jmx["Catalina:type=GlobalRequestProcessor,name=\"http-nio-8080\""]</code>.</p>
<p>This key is still incomplete. To specify the metric to be monitored, you must
append an attribute name, such as maxTime, requestCount, or bytesReceived, at
the end of the key, separated by a comma.
<code>jmx["Catalina:type=GlobalRequestProcessor,name=\"http-nio-8080\"","requestCount"]</code></p>
<p><img alt="requestCount item" src="../ch04-zabbix-collecting-data/JMX/ch04.39-jconsole-requestCount.png" /></p>
<p><em>04.39 requestCount item</em></p>
<p>The <code>java.lang.management.Memory</code> MBean provides a good example of how to handle
CompositeData types in Zabbix. This MBean has an attribute called <code>HeapMemoryUsage</code>,
which is not a simple value but rather an instance of <code>CompositeData</code>. This special
JMX data type is used to represent complex structures.</p>
<p>This means that attributes like <code>init</code>, <code>used</code>, <code>committed</code>, or <code>max</code> aren't accessed
directly on the MBean itself. Instead, they are part of the <code>MemoryUsage</code> object
that is returned when you query the <code>HeapMemoryUsage</code> attribute.</p>
<p>To monitor a specific value from this composite object, you must specify the
attribute name within the <code>CompositeData</code> structure. For example, to get the maximum
heap memory usage, the Zabbix item key would be: <code>jmx["java.lang:type=Memory","HeapMemoryUsage.max"]</code>.</p>
<p><img alt="" src="../ch04-zabbix-collecting-data/JMX/ch04.40-jconsole-HeapMemory.Max.png" /></p>
<p>_04.40 HeapMemoryUsage</p>
<h4 id="ch04-zabbix-collecting-data-jmx-viewing-tabular-data">Viewing Tabular Data</h4>
<p>To view the detailed breakdown of the <code>HeapMemoryUsage</code> attribute, double click on
its value in the attribute value column. This action displays the composite data
in a tabular format, making it easier to see individual metrics like <code>init</code>, <code>used</code>,
<code>committed</code>, and <code>max</code>.</p>
<h4 id="ch04-zabbix-collecting-data-jmx-zabbix-jmx-item-keys">Zabbix JMX Item Keys</h4>
<p>Zabbix offers three primary item keys for JMX monitoring:</p>
<ul>
<li>
<p><strong>jmx[]:</strong> This is the standard key used for monitoring a specific JMX attribute.
  It's the most common key for creating simple, direct checks.</p>
</li>
<li>
<p><strong>jmx.get[]:</strong> This key is used to retrieve a full object from an MBean. It is
  often paired with Low Level Discovery (LLD) rules and preprocessing steps to
  extract specific values from the returned data, allowing for more flexible data
  collection.</p>
</li>
<li>
<p><strong>jmx.discovery[]:</strong> This key is specifically designed for use with Low Level
  Discovery. It helps Zabbix automatically discover multiple JMX MBeans or attributes
  on a monitored host, which is essential for scaling JMX monitoring across a large
  number of components.</p>
</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-jmx-making-use-of-jmxget">Making use of jmx.get[]</h3>
<p>The <code>jmx.get[]</code> item key returns a JSON array containing a list of MBean objects or
their attributes. Unlike <code>jmx.discovery[]</code>, it does not automatically define LLD
macros. Instead, it is particularly useful when you need to retrieve a structured
set of data and then process it using JSONPath in a dependent item or a low level
discovery rule.</p>
<p>While <code>jmx.get[]</code> is commonly used for Low Level Discovery (LLD), it is also highly
effective for creating dependent items without using a full discovery rule. This
allows you to collect multiple related metrics from a single request to the JMX
agent, which is more efficient.</p>
<p>For instance, the key <code>jmx.get[attributes,"*:type=GarbageCollector,name=PS MarkSweep"]</code>
would return a comprehensive payload with all attributes of the specified garbage
collector.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-1"></a><span class="p">[</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-3"></a><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CollectionCount&quot;</span><span class="p">,</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-4"></a><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;java.lang:type=GarbageCollector,name=PS MarkSweep,CollectionCount&quot;</span><span class="p">,</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-5"></a><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;java.lang.Long&quot;</span><span class="p">,</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-6"></a><span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-7"></a><span class="w">    </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;java.lang:type=GarbageCollector,name=PS MarkSweep&quot;</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-8"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-9"></a><span class="w">  </span><span class="err">...</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-10"></a><span class="w">  </span><span class="err">...</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-11"></a><span class="w">  </span><span class="err">...</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-12"></a><span class="w">  </span><span class="err">...</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-13"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-14"></a><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ObjectName&quot;</span><span class="p">,</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-15"></a><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;java.lang:type=GarbageCollector,name=PS MarkSweep,ObjectName&quot;</span><span class="p">,</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-16"></a><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;javax.management.ObjectName&quot;</span><span class="p">,</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-17"></a><span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;java.lang:type=GarbageCollector,name=PS MarkSweep&quot;</span><span class="p">,</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-18"></a><span class="w">    </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;java.lang:type=GarbageCollector,name=PS MarkSweep&quot;</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-19"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#ch04-zabbix-collecting-data-jmx-__codelineno-12-20"></a><span class="p">]</span>
</span></code></pre></div>
<p>This JSON output can then be used as the master item for multiple dependent items,
each with a preprocessing step to extract a specific value (e.g., <code>CollectionCount</code>
or <code>CollectionTime</code>) using a JSONPath expression. This technique is a powerful
way to reduce the load on both the JMX agent and the Zabbix server by making a
single call to collect multiple metrics.</p>
<h2 id="ch04-zabbix-collecting-data-jmx-performance-considerations-for-jmx-monitoring">Performance Considerations for JMX Monitoring</h2>
<p>JMX monitoring is powerful but comes with higher overhead compared to traditional
Zabbix agent checks. To ensure your monitoring remains efficient and doesn't impact
either your Zabbix infrastructure or the monitored JVMs, keep the following points
in mind.</p>
<p>Zabbix communicates with the Java Gateway synchronously:</p>
<ul>
<li>The Zabbix server sends a request for a JMX item.</li>
<li>The Java Gateway connects to the target JVM and retrieves the data.</li>
<li>Only when the response comes back does the Zabbix server proceed with that item's
  check.
This means that if JMX queries are slow (due to network, JVM GC pauses, or overloaded
gateways), your monitoring queue can back up.</li>
</ul>
<p>To optimize performance:</p>
<ul>
<li>The Java Gateway bundles multiple requests for the same host and processes them
  in a single JVM connection.</li>
<li>This reduces the overhead of repeatedly opening/closing JMX connections.</li>
<li>
<p>For example, if you monitor 20 JVM attributes on the same Tomcat, the gateway
  will collect them in fewer, larger batches instead of 20 separate calls.</p>
</li>
<li>
<p>Once a JMX connection to a JVM is established, the gateway keeps it alive and
  reuses it for subsequent checks.</p>
</li>
<li>This avoids expensive RMI connection setup for
  every metric.</li>
<li>If the JVM restarts or the connection drops, the gateway will re-establish it automatically.</li>
</ul>
<p>Two important parameters in zabbix_server.conf and zabbix_java_gateway.conf directly
affect JMX performance:</p>
<ul>
<li>StartJavaPollers (on Zabbix Server)<ul>
<li>Defines how many parallel JMX pollers the server can use.</li>
<li>Too few pollers ‚Üí JMX checks queue up and fall behind.</li>
<li>Too many pollers ‚Üí high load on Java Gateway and JVMs.</li>
</ul>
</li>
<li>StartPollers (general pollers)
  Balance with Java pollers so your server can handle both JMX and regular agent
  checks without bottlenecks.</li>
<li>
<p>Rule of thumb: start small (Ex: 5‚Äì10 Java pollers) and increase gradually while
  monitoring load.</p>
</li>
<li>
<p>Don't enable all MBeans just because you can.</p>
</li>
<li>Focus on actionable JVM metrics (heap, non-heap, GC, threads, JDBC pools) and
  a few application-specific MBeans that map to real-world performance.</li>
<li>Too many JMX items not only stress the JVM but also flood your Zabbix database
  with unnecessary history data.</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-jmx-monitoring-jmx-through-jolokia">Monitoring JMX through Jolokia</h2>
<p>While Zabbix can natively collect JMX data using the Zabbix Java Gateway, an
alternative worth considering is Jolokia ‚Äî a lightweight JMX-to-HTTP bridge.</p>
<p>Jolokia exposes JMX MBeans over a simple REST/JSON interface, which means you
can collect Java metrics using Zabbix's HTTP Agent items instead of the Java Gateway.
The result is often lower overhead, easier network configuration, and greater flexibility.</p>
<p>Why Jolokia?</p>
<ul>
<li>No Gateway Needed. Jolokia runs as a Java agent, servlet, or OSGi bundle directly
  inside the JVM.</li>
<li>Efficient Data Collection. You can request multiple attributes in a single HTTP
  call and split them into dependent items using JSONPath preprocessing.</li>
<li>Firewall-Friendly. Works over standard HTTP(S) ports, avoiding the complexity
  of RMI and port ranges.</li>
<li>Secure, it supports HTTPS, authentication, and access control policies out of
  the box.</li>
</ul>
<p>Example:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-13-1"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:8778/jolokia/read/java.lang:type<span class="o">=</span>Memory,java.lang:type<span class="o">=</span>Threading
</span></code></pre></div>
<p>In Zabbix:</p>
<p>Create an HTTP Agent master item pointing to the Jolokia endpoint.
Add dependent items to extract individual values, e.g.:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch04-zabbix-collecting-data-jmx-__codelineno-14-1"></a><span class="err">$.value</span><span class="p">[</span><span class="err">&#39;java.la</span><span class="kc">n</span><span class="err">g</span><span class="p">:</span><span class="kc">t</span><span class="err">ype=Memory&#39;</span><span class="p">][</span><span class="err">&#39;HeapMemoryUsage&#39;</span><span class="p">][</span><span class="err">&#39;used&#39;</span><span class="p">]</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch04-zabbix-collecting-data-jmx-__codelineno-14-2"></a><span class="err">$.value</span><span class="p">[</span><span class="err">&#39;java.la</span><span class="kc">n</span><span class="err">g</span><span class="p">:</span><span class="kc">t</span><span class="err">ype=Threadi</span><span class="kc">n</span><span class="err">g&#39;</span><span class="p">][</span><span class="err">&#39;ThreadCou</span><span class="kc">nt</span><span class="err">&#39;</span><span class="p">]</span>
</span></code></pre></div>
<p>This approach allows you to collect dozens of metrics with a single network request.</p>
<details class="note" open="open">
<summary>When to use it ?</summary>
<p>Choose Jolokia if you prefer a stateless, agent-based setup or need to monitor
many JVMs without maintaining a central Java Gateway. Stick with the Zabbix
Java Gateway if you rely on built-in templates or want a fully integrated,
out of the box JMX experience.</p>
</details>
<h2 id="ch04-zabbix-collecting-data-jmx-conclusion">Conclusion</h2>
<p>Zabbix handles JMX monitoring synchronously, but optimizes performance with request
bundling and connection reuse. By tuning pollers, using reasonable update intervals,
and selecting only the most valuable metrics, you can scale JMX monitoring without
overloading your monitoring system or your Java applications.</p>
<h2 id="ch04-zabbix-collecting-data-jmx-questions">Questions</h2>
<ul>
<li>Explain how the Zabbix Java Gateway fits into the overall JMX architecture.
  Why is it needed?</li>
<li>In Zabbix, what is the difference between the item keys jmx[], jmx.get[] and
  jmx.discovery[]? Give an example use case for each.</li>
<li>Reflect: In your environment, what Java-applications would benefit most from
  JMX monitoring? What metrics would you pick first, and why?</li>
<li>What are security considerations when enabling remote JMX monitoring in production?
  What could go wrong if you leave flags like authenticate=false and ssl=false in
  a live environment?</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-jmx-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=aKGYa6Y9r60&amp;t=87s">https://www.youtube.com/watch?v=aKGYa6Y9r60&amp;t=87s</a></li>
<li><a href="https://docs.oracle.com/javase/1.5.0/docs/guide/management/agent.html">https://docs.oracle.com/javase/1.5.0/docs/guide/management/agent.html</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/jmx_monitoring">https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/jmx_monitoring</a></li>
<li><a href="https://jolokia.org/">https://jolokia.org/</a></li>
</ul></section><section class="print-page" id="ch04-zabbix-collecting-data-ipmi" heading-number="9.16"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="ipmi-monitoring">IPMI Monitoring</h1>
<h2 id="ch04-zabbix-collecting-data-ipmi-what-is-ipmi">What is IPMI</h2>
<p>Out-of-band management has been part of enterprise server administration for decades,
long before modern APIs and automation frameworks became common. One of the most widely
adopted standards in this space is the Intelligent Platform Management Interface
(IPMI). Despite its age and limitations, IPMI remains deeply embedded in data centers
and continues to play a role in hardware monitoring today.</p>
<p>This chapter introduces IPMI from a practical monitoring perspective and explains
how it integrates with Zabbix, while also setting realistic expectations about where
IPMI fits in modern environments.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-understanding-ipmi">Understanding IPMI</h3>
<p>IPMI allows administrators to monitor and manage physical server hardware independently
of the operating system. Even when a system is powered off, hung, or unable to
boot, IPMI usually remains accessible as long as the server has power.</p>
<p>At the center of IPMI is the Baseboard Management Controller (BMC). The BMC is
a small embedded controller with its own firmware, network interface, and access
to system sensors. Because it operates independently of the host operating system,
it can continue reporting hardware health even when the OS is unavailable.</p>
<p>Most server vendors implement IPMI through their own management platforms. While
they share a common IPMI foundation, each adds vendor-specific features and naming
conventions.</p>
<p>Common BMC implementations include:</p>
<ul>
<li>Dell ‚Äì iDRAC</li>
<li>HPE ‚Äì iLO</li>
<li>Lenovo ‚Äì XClarity Controller</li>
<li>Supermicro ‚Äì IPMI</li>
<li>Fujitsu ‚Äì iRMC</li>
</ul>
<p>From a monitoring perspective, these differences matter because sensor names,
availability, and behavior often vary by vendor and even by firmware version.</p>
<pre  class="mermaid"><code>flowchart TB
  %% ---------- Styles ----------
  classDef zabbix fill:#e3f2fd,stroke:#1e88e5,color:#0d47a1
  classDef ipmi fill:#ede7f6,stroke:#5e35b1,color:#311b92
  classDef network fill:#e8f5e9,stroke:#2e7d32,color:#1b5e20
  classDef hardware fill:#fff3e0,stroke:#ef6c00,color:#e65100
  classDef sensors fill:#fffde7,stroke:#fbc02d,color:#6d4c41

  %% ---------- Nodes ----------
  Z["Zabbix Server / Proxy"]
  O["OpenIPMI"]
  N["Management Network"]
  B["BMC"]
  H["Hardware Sensors"]

  %% ---------- Flow ----------
  Z --> O
  O -->|"IPMI (UDP 623)"| N
  N --> B
  B --> H

  %% ---------- Classes ----------
  class Z zabbix
  class O ipmi
  class N network
  class B hardware
  class H sensors
</code></pre>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-ipmi-architecture-and-sensors">IPMI Architecture and Sensors</h3>
<p>IPMI monitoring is built around hardware sensors exposed by the BMC. These sensors
report real-time measurements and state information about the physical system.</p>
<p>Typical sensor categories include:</p>
<ul>
<li>Temperature sensors
  CPU temperature, system or motherboard temperature, inlet and exhaust air temperature</li>
<li>Fan sensors
  Fan speed (RPM), fan presence, fan failure states</li>
<li>Voltage sensors
  CPU voltage, memory voltage, standby voltage rails</li>
<li>Power sensors
  Power supply status, redundancy state, power consumption</li>
<li>Chassis sensors
  Chassis intrusion, lid open/closed state</li>
<li>Miscellaneous sensors
  Battery status, watchdog timers, hardware fault indicators</li>
</ul>
<p>Each sensor has a name, a type, and one or more thresholds that indicate warning
or critical conditions. Importantly, sensor names are vendor-defined and case-sensitive,
which has direct implications for monitoring tools such as Zabbix.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-communication-and-protocols">Communication and Protocols</h3>
<p>When accessed over the network, IPMI typically communicates using UDP port 623.
Older implementations rely on the Remote Management Control Protocol (RMCP), while
newer systems support RMCP+, which adds authentication and encryption.</p>
<p>Although RMCP+ improves security compared to earlier versions, its real world
effectiveness depends heavily on vendor configuration and firmware quality. As
a result, IPMI traffic still lacks many of the security and observability features
administrators expect from modern management interfaces.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-security-caveats">Security Caveats</h3>
<p>IPMI‚Äôs design reflects the assumptions of an earlier era, and this has lasting
security implications. Many systems ship with IPMI enabled by default, sometimes
with weak or unchanged credentials. Legacy authentication methods and insecure
cipher suites may remain active unless explicitly disabled.</p>
<p>Unlike modern APIs, IPMI does not natively use HTTPS or certificates. Logging and
auditing capabilities are minimal, making it difficult to track access or investigate
incidents. Because the BMC operates below the operating system, a compromised
management controller can be extremely difficult to detect or remediate.</p>
<p>For these reasons, IPMI should always be treated as a high-privilege interface.
Best practice is to place it on a dedicated management network, restrict access
aggressively, and keep BMC firmware up to date. When used carefully, IPMI can be
safe enough for monitoring, but it should never be treated like a normal application
service.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-verifying-ipmi-access-with-ipmitool">Verifying IPMI Access with ipmitool</h3>
<p>Before configuring IPMI monitoring in Zabbix, it is often helpful to verify connectivity
manually. On most Linux distributions, this is done using the <code>ipmitool</code> utility.</p>
<p>A simple sensor query confirms that the BMC is reachable and that credentials are
correct. If sensor data can be retrieved successfully with <code>ipmitool</code>, the same
configuration will usually work in Zabbix as well.</p>
<p>These tools are primarily for validation and troubleshooting; they are not required
for day-to-day monitoring once Zabbix is configured.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-native-ipmi-monitoring-in-zabbix">Native IPMI Monitoring in Zabbix</h3>
<p>Zabbix includes native IPMI support, allowing it to poll BMCs directly without
agents or external scripts. This is done using the IPMI agent item type.</p>
<p>To enable IPMI monitoring, a host must be configured with an IPMI interface specifying
the BMC's management IP address and port. Credentials can be defined at the host
or template level, depending on how standardized the environment is.</p>
<p>Once configured, Zabbix queries individual sensors and stores their values just
like any other monitored metric.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-ipmi-items-and-templates">IPMI Items and Templates</h3>
<p>Each IPMI item in Zabbix corresponds to a specific sensor name exposed by the BMC.
Because sensor naming is not standardized, templates often require customization.</p>
<p>Zabbix ships with generic IPMI templates that provide a useful starting point.
These templates usually include:</p>
<ul>
<li>Core temperature sensors</li>
<li>Fan speed monitoring</li>
<li>Power supply status</li>
<li>Basic triggers for warning and critical states</li>
</ul>
<p>In practice, these templates are rarely ‚Äúplug and play.‚Äù Sensors may be missing,
renamed, or behave differently across vendors. As a result, IPMI templates are
best treated as baselines that are refined for specific hardware platforms.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-practical-limitations">Practical Limitations</h3>
<p>From a modern monitoring perspective, IPMI has clear limitations. Discovery
capabilities are weak, sensor models are inconsistent, and extending IPMI beyond
basic health checks is difficult. Automation and integration with external systems
are also limited compared to API-driven approaches.</p>
<p>These constraints do not make IPMI obsolete, but they do define its role. IPMI is
best suited for fundamental hardware health monitoring rather than deep observability
or automation.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-when-ipmi-still-makes-sense">When IPMI Still Makes Sense</h3>
<p>IPMI remains relevant in many environments, particularly where hardware fleets
are already deployed and newer management standards are unavailable. In controlled
networks with proper isolation and access controls, it provides reliable insight
into physical system health.</p>
<p>For many organizations, IPMI will continue to coexist with newer technologies
for years to come.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-understanding-how-ipmi-tools-work">Understanding How IPMI Tools Work</h3>
<p>Before Zabbix enters the picture, it helps to understand how IPMI is typically
accessed from a system administrator‚Äôs point of view. The most common tool for
interacting with IPMI is <code>ipmitool</code>, a command-line utility that communicates directly
with the BMC.</p>
<p>ipmitool does not talk to the operating system. Instead, it connects straight to
the BMC using IPMI over LAN, authenticates using the configured credentials, and
requests sensor data or management actions. In many ways, Zabbix's native IPMI
monitoring behaves very similarly, it simply automates and schedules the same
type of queries.</p>
<p>Using <code>ipmitool</code> manually is therefore an excellent way to validate connectivity,
credentials, and available sensors before attempting to monitor a system with Zabbix.</p>
<hr />
<h4 id="ch04-zabbix-collecting-data-ipmi-installing-ipmitool">Installing ipmitool</h4>
<p>The <code>ipmitool</code> package is widely available and easy to install on all major Linux
distributions.</p>
<p>On Red Hat Enterprise Linux, Rocky Linux, AlmaLinux, and other RHEL-based systems,
the package can be installed using:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-0-1"></a>dnf install -y ipmitool
</span></code></pre></div>
<p>On Debian and Ubuntu systems, installation is done with:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-1-1"></a>apt install -y ipmitool
</span></code></pre></div>
<p>Once installed, no additional services are required. The tool is invoked directly
from the command line and communicates with the BMC over the network.</p>
<hr />
<h4 id="ch04-zabbix-collecting-data-ipmi-exploring-ipmi-sensors-with-ipmitool">Exploring IPMI Sensors with ipmitool</h4>
<p>The most common starting point is to list available sensors. This provides immediate
insight into what the BMC exposes and what Zabbix will be able to monitor.</p>
<p>A typical command looks like this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-2-1"></a>ipmitool -I lanplus -H &lt;BMC_IP&gt; -U &lt;USER&gt; sensor list
</span></code></pre></div>
<p>This command returns a list of sensors along with their current values and status.
While the exact output varies by vendor, readers will usually see entries for
temperatures, fans, voltages, and power supplies.</p>
<p>To focus on specific types of data, administrators often scan the output for
familiar patterns:</p>
<ul>
<li>Fan-related sensors usually include keywords like FAN, Fan1, or System Fan</li>
<li>Temperature sensors often reference CPU, System, Inlet, or Exhaust</li>
<li>Power supply sensors may indicate presence, redundancy, or failure states</li>
</ul>
<p>This exploratory step is important because sensor names must be used exactly as
shown when configuring Zabbix IPMI items.</p>
<p><strong>Example Output:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Sensor  Name</th>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Units</th>
<th style="text-align: left;">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">CPU Temp</td>
<td style="text-align: left;">42.000</td>
<td style="text-align: left;">degrees C</td>
<td style="text-align: left;">ok</td>
</tr>
<tr>
<td style="text-align: left;">System Temp</td>
<td style="text-align: left;">35.000</td>
<td style="text-align: left;">degrees C</td>
<td style="text-align: left;">ok</td>
</tr>
<tr>
<td style="text-align: left;">Inlet Temp</td>
<td style="text-align: left;">22.000</td>
<td style="text-align: left;">degrees C</td>
<td style="text-align: left;">ok</td>
</tr>
<tr>
<td style="text-align: left;">Exhaust Temp</td>
<td style="text-align: left;">28.000</td>
<td style="text-align: left;">degrees C</td>
<td style="text-align: left;">ok</td>
</tr>
<tr>
<td style="text-align: left;">FAN1</td>
<td style="text-align: left;">4200.000</td>
<td style="text-align: left;">RPM</td>
<td style="text-align: left;">ok</td>
</tr>
<tr>
<td style="text-align: left;">FAN2</td>
<td style="text-align: left;">4100.000</td>
<td style="text-align: left;">RPM</td>
<td style="text-align: left;">ok</td>
</tr>
<tr>
<td style="text-align: left;">PSU1 Status</td>
<td style="text-align: left;">0x01</td>
<td style="text-align: left;">discrete</td>
<td style="text-align: left;">ok</td>
</tr>
<tr>
<td style="text-align: left;">PSU2 Status</td>
<td style="text-align: left;">0x01</td>
<td style="text-align: left;">discrete</td>
<td style="text-align: left;">ok</td>
</tr>
<tr>
<td style="text-align: left;">Voltage 12V</td>
<td style="text-align: left;">12.096</td>
<td style="text-align: left;">Volts</td>
<td style="text-align: left;">ok</td>
</tr>
<tr>
<td style="text-align: left;">Chassis Intrusion</td>
<td style="text-align: left;">0x00</td>
<td style="text-align: left;">discrete</td>
<td style="text-align: left;">ok</td>
</tr>
</tbody>
</table>
<p>Each line represents a sensor exposed by the BMC. While the exact sensors and names
vary by vendor and hardware model, the structure is consistent.</p>
<p><strong>The output columns represent:</strong></p>
<ul>
<li><strong>Sensor name:</strong> The identifier used by IPMI. This value is case-sensitive and
  must match exactly when configuring Zabbix IPMI items.</li>
<li><strong>Current reading:</strong> The latest measured value reported by the sensor.</li>
<li><strong>Units:</strong> The measurement unit, such as degrees Celsius, RPM, or Volts.</li>
<li><strong>Status:</strong> A simplified state indicating whether the sensor is operating normally.</li>
</ul>
<p>Discrete sensors (such as power supply status or chassis intrusion) may show
hexadecimal values instead of numeric readings.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-working-with-discrete-ipmi-sensors">Working with Discrete IPMI Sensors</h3>
<p>Some IPMI sensors do not return numeric measurements such as temperature or fan
speed. Instead, they return discrete values, where individual bits represent different
states or conditions. Common examples include power supply status, chassis intrusion,
or predictive hardware failures.</p>
<p>In these cases, Zabbix can evaluate specific bits using the bitwise AND trigger
function, band().</p>
<p><strong>Example: Predictive Power Supply Failure</strong></p>
<p>Assume an IPMI sensor returns a value where the eighth bit indicates a predictive
failure condition. To check whether this bit is set, Zabbix applies a bitmask using
the band() function.</p>
<p>In decimal notation:</p>
<ul>
<li>Bit 8 corresponds to the value 128</li>
<li>The trigger expression checks whether this bit is set</li>
</ul>
<p>Example trigger expression:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-3-1"></a>band<span class="o">(</span>last<span class="o">(</span>/host/Power_Unit_Stat<span class="o">)</span>,128<span class="o">)=</span><span class="m">128</span>
</span></code></pre></div>
This expression:</p>
<ul>
<li>Takes the most recent value</li>
<li>Applies a bitmask of 128</li>
<li>Triggers only if the predictive failure bit is set</li>
</ul>
<p>This approach allows precise monitoring of hardware fault conditions that are
otherwise hidden inside composite IPMI values.</p>
<p><strong>Notes on Bitmask-Based Monitoring:</strong></p>
<ul>
<li>Bitmask logic is common with IPMI but rare with modern APIs</li>
<li>Care should be taken not to poll too many IPMI sensors, as BMCs can easily be
  overloaded</li>
<li>Since Zabbix 4.0, IPMI sensors can be referenced using name: or id: syntax,
  improving reliability across firmware versions</li>
</ul>
<p>Because of this complexity, IPMI monitoring often requires more manual tuning than
Redfish-based monitoring, where health states are typically exposed as explicit
fields such as Status.Health.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-how-zabbix-uses-ipmi-internally">How Zabbix Uses IPMI Internally</h3>
<p>Zabbix does not invoke ipmitool or external commands when monitoring IPMI. Instead,
it integrates directly with the OpenIPMI library, a widely used, open-source implementation
of the IPMI specification.</p>
<p>OpenIPMI handles the low-level details of IPMI communication, including protocol
handling, authentication, and sensor access. Zabbix uses this library to communicate
with the BMC in a structured and efficient way, without relying on shell commands
or external processes.</p>
<p>From the user‚Äôs perspective, this distinction is mostly invisible. Whether IPMI
data is retrieved manually with ipmitool or automatically by Zabbix, the underlying
interaction with the BMC follows the same IPMI standards and exposes the same sensors.</p>
<hr />
<h4 id="ch04-zabbix-collecting-data-ipmi-configuring-ipmi-pollers">Configuring IPMI Pollers</h4>
<p>By default, Zabbix does not enable IPMI pollers. You could start with a low
number like 3 or 5. In environments with
only a few monitored servers, this is usually sufficient. However, in larger environments,
this configuration may quickly become a bottleneck.</p>
<p>The number of IPMI pollers is controlled by the following configuration parameter:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-4-1"></a>StartIPMIPollers
</span></code></pre></div>
<p>If IPMI checks begin to queue or time out, increasing this value is often necessary.
As with other Zabbix poller types, changes require a restart of the Zabbix server
or proxy to take effect.</p>
<p>Because IPMI pollers rely on network communication with management controllers, their performance is influenced not only by Zabbix itself, but also by:</p>
<ul>
<li>BMC responsiveness</li>
<li>Network latency to the management network</li>
<li>Firmware quality and load on the BMC</li>
</ul>
<hr />
<h4 id="ch04-zabbix-collecting-data-ipmi-relationship-between-ipmitool-and-zabbix">Relationship Between ipmitool and Zabbix</h4>
<p>Although Zabbix does not use ipmitool internally, the two tools are closely related conceptually. Both rely on standard IPMI mechanisms and expose the same underlying sensor data.</p>
<p>For this reason, ipmitool remains the preferred tool for:</p>
<ul>
<li>Validating IPMI connectivity</li>
<li>Discovering available sensors</li>
<li>Verifying sensor names and behavior</li>
<li>Troubleshooting authentication and firmware issues</li>
</ul>
<p>If a sensor cannot be queried successfully with ipmitool, it will almost certainly fail in Zabbix as well.</p>
<hr />
<h4 id="ch04-zabbix-collecting-data-ipmi-configuring-an-ipmi-item-in-zabbix">Configuring an IPMI Item in Zabbix</h4>
<p>Configuring an IPMI item in Zabbix is conceptually simple, but attention to detail is crucial.</p>
<p>An IPMI item requires:</p>
<ul>
<li>Item type set to IPMI agent</li>
<li>A key that references the exact sensor name</li>
<li>An update interval appropriate for hardware metrics</li>
</ul>
<p>For example, to monitor a CPU temperature sensor, the item key might look like:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-5-1"></a>ipmi.get[CPU Temp]
</span></code></pre></div>
<p>If the sensor name does not match exactly, including case and spacing, the item
will fail. For this reason, copying sensor names directly from ipmitool output
is strongly recommended.</p>
<p>Triggers are typically defined on top of these items to detect warning and critical
thresholds, either using vendor recommendations or operational experience.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-known-issues-and-common-pitfalls">Known Issues and Common Pitfalls</h3>
<p>IPMI monitoring works reliably once configured correctly, but several recurring
issues are worth calling out explicitly.</p>
<p>One common problem is inconsistent sensor naming. The same server model may expose
different sensor names depending on firmware version, making templates fragile
across hardware revisions.</p>
<p>Another frequent issue is slow or unresponsive BMCs. Some management controllers
respond slowly under load, which can cause timeouts or delayed data in Zabbix.
This becomes more noticeable as the number of monitored systems grows.</p>
<p>Authentication problems are also common. Incorrect cipher suite settings, locked
user accounts, or firmware bugs can all prevent successful IPMI polling even when
credentials appear correct.</p>
<p>Finally, IPMI interfaces are sometimes overlooked during network changes. Firewall
rules, VLAN reconfiguration, or routing changes can silently break access to the
management network while leaving the operating system untouched.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-practical-advice-for-reliable-ipmi-monitoring">Practical Advice for Reliable IPMI Monitoring</h3>
<p>From experience, IPMI monitoring works best when treated as infrastructure monitoring,
not application monitoring. Polling intervals should be reasonable, sensor counts
kept under control, and templates carefully validated per vendor.</p>
<p>Using ipmitool during setup and troubleshooting remains invaluable. If a sensor
cannot be queried manually, Zabbix will not be able to retrieve it either.</p>
<p>When these practices are followed, IPMI provides stable and useful visibility into
hardware health, even if it shows its age in other areas.</p>
<hr />
<h2 id="ch04-zabbix-collecting-data-ipmi-introduction-to-redfish">Introduction to Redfish</h2>
<p>If IPMI feels like a tool from another era, Redfish is what replaced it: a modern,
web friendly management standard designed for automation and secure operations.
Redfish exposes hardware management through a RESTful interface and focuses on
being both human-readable and machine friendly. </p>
<p>In practical terms, Redfish is what you wish IPMI had been: structured resources,
predictable URIs, and data you can query using the same tools you already use for
web services.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-rest-https">REST + HTTPS</h3>
<p>Redfish is built around REST concepts and is typically accessed over HTTPS. Instead
of vendor specific ‚Äúsensor names‚Äù or proprietary client utilities, you access resources
using URLs and standard HTTP methods. </p>
<p>That shift matters for monitoring:</p>
<ul>
<li>You can test endpoints with curl.</li>
<li>You can retrieve structured JSON payloads.</li>
<li>You can monitor it with Zabbix HTTP agent items (no special IPMI subsystem needed).</li>
</ul>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-json-schema-and-standardized-resources">JSON schema and standardized resources</h3>
<p>Redfish resources are delivered as JSON and described by formal schemas. DMTF
publishes the schema index (including JSON Schema formats), which makes the ecosystem
far more consistent than IPMI in practice.</p>
<p>The big win for authors and operators is that Redfish revolves around standard
resource types. You'll see the same patterns repeatedly across vendors:</p>
<ul>
<li><strong>ServiceRoot:</strong> /redfish/v1 (entry point)</li>
<li><strong>Systems:</strong> server/compute view (CPU, memory, boot, power state)</li>
<li><strong>Chassis:</strong> physical enclosure view</li>
<li><strong>Managers:</strong> the management controller (think BMC/iDRAC/iLO)</li>
<li><strong>Power / Thermal:</strong> structured telemetry for PSUs, fans, temperatures (often
  via chassis-related resources)</li>
</ul>
<p>Even when vendors add OEM extensions, the baseline model stays recognizable.</p>
<hr />
<h2 id="ch04-zabbix-collecting-data-ipmi-testing-redfish-with-a-simulator">Testing Redfish with a Simulator</h2>
<p>Since not everyone has an IPMI interface available and since we cannot use a
standard that would work for everybody we will focus on a simulator. This should
give you a good idea on how things work in real life.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-dmtf-mockup-server">DMTF Mockup Server</h3>
<p>The Mockup Server serves static Redfish mockups and runs by <code>default</code> on <code>127.0.0.1:8000</code>.</p>
<p>We will install for this a docker container on our Zabbix system or another
system if you prefer.</p>
<p>For the examples in this book, we use a fork of the official DMTF Redfish Mockup
Server. The simulator runs in a container and provides a predictable, vendor neutral
Redfish API that is ideal for testing and monitoring examples.</p>
<p>The following sections show how to run the simulator on Rocky Linux using Podman
and on Ubuntu 24.04 using Docker.</p>
<p>In both cases, the result is the same: a Redfish service listening locally on
port 8000.</p>
<hr />
<h4 id="ch04-zabbix-collecting-data-ipmi-rocky-linux-podman">Rocky Linux (Podman)</h4>
<p>Rocky Linux uses Podman as its default container engine. Podman is daemonless,
integrates well with system security, and can run Docker-compatible images without
modification.</p>
<p><strong>Install Podman</strong></p>
<p>Podman is available in the default Rocky repositories:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-6-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>podman
</span></code></pre></div>
<p>No additional services need to be enabled.</p>
<p>Clone the Redfish Mockup Server Repository.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-7-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/penmasters/Redfish-Mockup-Server.git
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-7-2"></a><span class="nb">cd</span><span class="w"> </span>Redfish-Mockup-Server
</span></code></pre></div>
<p>This repository is a fork of the upstream DMTF project and is used here for documentation and monitoring examples.</p>
<p>Build the Container Image (optional but recommended)
Building the image locally ensures reproducible behavior:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-8-1"></a>podman<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>redfish-mockup-server<span class="w"> </span>.
</span></code></pre></div>
<p><strong>Run the Redfish Mockup Server</strong></p>
<p>Start the container and expose port 8000:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-9-1"></a>podman<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span>redfish-mockup-server
</span></code></pre></div>
<p>Once running, the Redfish service root is available at:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-10-1"></a>http://127.0.0.1:8000/redfish/v1
</span></code></pre></div>
<h4 id="ch04-zabbix-collecting-data-ipmi-ubuntu-2404-docker">Ubuntu 24.04 (Docker)</h4>
<p>On Ubuntu, Docker remains the most widely used container runtime and is familiar to many administrators.</p>
<p><strong>Install Docker from the Ubuntu repositories:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-11-1"></a>apt update
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-11-2"></a>apt install -y docker.io
</span></code></pre></div>
<p>Enable and start the Docker service:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-12-1"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>docker
</span></code></pre></div>
<p>(Optional) To avoid running Docker as root, add your user to the docker group and re-login.</p>
<p><strong>Clone the Redfish Mockup Server Repository</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-13-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/penmasters/Redfish-Mockup-Server.git
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-13-2"></a><span class="nb">cd</span><span class="w"> </span>Redfish-Mockup-Server
</span></code></pre></div>
<p><strong>Build the Container Image</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-14-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>redfish-mockup-server<span class="w"> </span>.
</span></code></pre></div>
<p><strong>Run the Redfish Mockup Server</strong></p>
<p>Start the container:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-15-1"></a>docker run --rm -p 8000:8000 redfish-mockup-server
</span></code></pre></div>
<p>The Redfish API is now available at:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-16-1"></a>http://127.0.0.1:8000/redfish/v1
</span></code></pre></div>
<p><strong>Verifying the Installation</strong></p>
<p>On both Rocky Linux and Ubuntu, you can verify that the simulator is running by
querying the Redfish service root:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-17-1"></a>curl<span class="w"> </span>http://127.0.0.1:8000/redfish/v1
</span></code></pre></div>
<p>A JSON response confirms that the mock server is working correctly.</p>
<p>At this point, the simulator can be used for:</p>
<ul>
<li>Exploring Redfish resources with curl</li>
<li>Viewing JSON responses in a web browser</li>
<li>Configuring Zabbix HTTP agent items</li>
<li>Building preprocessing and LLD examples</li>
</ul>
<div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-1"></a><span class="err">curl</span><span class="w"> </span><span class="err">h</span><span class="kc">tt</span><span class="err">p</span><span class="p">:</span><span class="c1">//127.0.0.1:8000/redfish/v1</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-2"></a><span class="p">{</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-3"></a><span class="w">    </span><span class="nt">&quot;@odata.id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/redfish/v1/&quot;</span><span class="p">,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-4"></a><span class="w">    </span><span class="nt">&quot;@odata.type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#ServiceRoot.v1_16_1.ServiceRoot&quot;</span><span class="p">,</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-5"></a><span class="w">    </span><span class="nt">&quot;AccountService&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-6"></a><span class="w">        </span><span class="nt">&quot;@odata.id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/redfish/v1/AccountService&quot;</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-7"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-8"></a><span class="w">    </span><span class="nt">&quot;CertificateService&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-9"></a><span class="w">        </span><span class="nt">&quot;@odata.id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/redfish/v1/CertificateService&quot;</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-10"></a><span class="err">...</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-11"></a><span class="err">...</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-12"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-13"></a><span class="w">    </span><span class="nt">&quot;UUID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;92384634-2938-2342-8820-489239905423&quot;</span><span class="p">,</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-14"></a><span class="w">    </span><span class="nt">&quot;UpdateService&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-15"></a><span class="w">        </span><span class="nt">&quot;@odata.id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/redfish/v1/UpdateService&quot;</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-18-16"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="ch04-zabbix-collecting-data-ipmi-monitoring-redfish-with-zabbix">Monitoring Redfish with Zabbix</h2>
<p>With the Redfish Mockup Server running, we can now move from exploration to actual
monitoring. The most straightforward way to monitor Redfish in Zabbix is by using an
HTTP agent item, which retrieves data from a REST endpoint and stores the response
for further processing.</p>
<p>This approach mirrors how Redfish is used in real environments and avoids the need
for any special protocols or poller types.</p>
<p><strong>Choosing the First Endpoint</strong></p>
<p>Every Redfish service exposes a well-defined entry point called the Service Root,
located at:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-19-1"></a>/redfish/v1
</span></code></pre></div>
<p>This endpoint is ideal for a first test because it:</p>
<ul>
<li>Is always present</li>
<li>Returns a small, predictable JSON document</li>
<li>Confirms basic connectivity and parsing</li>
</ul>
<p>In the mock environment, the full URL is:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-20-1"></a>http://127.0.0.1:8000/redfish/v1
</span></code></pre></div>
<p><strong>Creating a Test Host in Zabbix</strong></p>
<p>Start by creating a dedicated host for the Redfish simulator.</p>
<p>In the Zabbix frontend, go to <code>Data collection</code> ‚Üí <code>Hosts</code></p>
<ol>
<li>Click Create host</li>
<li>Set:<ul>
<li><strong>Host name:</strong> Redfish Mockup Server</li>
<li><strong>Interface:</strong> none required (HTTP agent does not use host interfaces)</li>
</ul>
</li>
<li>Assign the host to a suitable group, for example Redfish or Servers</li>
<li>Save the host</li>
</ol>
<hr />
<p><img alt="ipmi/../ch04-zabbix-collecting-data/ipmi/ch04.50_create_redfish_host.png" src="../ch04-zabbix-collecting-data/ipmi/ch04.50_create_redfish_host.png" /></p>
<p><em>4.50 create Redfish host</em></p>
<p>This host will represent the Redfish endpoint rather than a traditional server.
Next we can create an HTTP item on our host.</p>
<p><strong>Creating the HTTP Agent Item</strong></p>
<p>Next, create the actual monitoring item.</p>
<ul>
<li>Open the newly created host</li>
<li>Go to the Items tab</li>
<li>Click Create item</li>
</ul>
<p>Configure the item as follows:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Configuration</th>
<th style="text-align: left;">notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name:</strong></td>
<td style="text-align: left;">Redfish service root</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type:</strong></td>
<td style="text-align: left;">HTTP agent</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key:</strong></td>
<td style="text-align: left;">redfish.service.root</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>URL:</strong></td>
<td style="text-align: left;">http://127.0.0.1:8000/redfish/v1</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Request method</strong></td>
<td style="text-align: left;">GET</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Update interval</strong></td>
<td style="text-align: left;">1m</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information</strong></td>
<td style="text-align: left;">Text</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>No authentication or headers are required for the mock server.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>At this stage, we are deliberately storing the entire response. In the next
step, we will extract individual values.</p>
</details>
<p>After a short wait, the item should start collecting data. This can be verified
under <code>Monitoring</code> ‚Üí <code>Lastest data</code></p>
<p>If this works we can move over to the next step and create an item.</p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-extracting-a-value-with-json-preprocessing">Extracting a Value with JSON Preprocessing</h3>
<p>Let's create a dependent item by pressing on the '...' before our item <code>Redfish
service root</code> and select <code>create dependent item</code>.</p>
<p>Now we can create our dependent item so that we can extract a single value from
the master item using preprocessing.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Configuration</th>
<th style="text-align: left;">notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name:</strong></td>
<td style="text-align: left;">Redfish Version</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;">Dependent item</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;">redfish.version</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Master item</strong></td>
<td style="text-align: left;">Redfish service root</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information</strong></td>
<td style="text-align: left;">Character</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Update interval</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">not available inherited from master item</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Preprocessing :</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">- JSONPath</td>
<td style="text-align: left;">$.RedfishVersion</td>
<td style="text-align: left;">Add as preprocessing step</td>
</tr>
</tbody>
</table>
<p>Press <code>Add</code> to save the item.</p>
<p><img alt="ipmi/../ch04-zabbix-collecting-data/ipmi/ch04.51_create_dependent_item.png" src="../ch04-zabbix-collecting-data/ipmi/ch04.51_create_dependent_item.png" /></p>
<p><em>4.51 Dependent item</em></p>
<p>Let's go to our latest data page and have a look at our newly created item.</p>
<p><img alt="ipmi/../ch04-zabbix-collecting-data/ipmi/ch04.52_latest_data.png" src="../ch04-zabbix-collecting-data/ipmi/ch04.52_latest_data.png" /></p>
<p><em>4.52 Latest data</em></p>
<hr />
<h3 id="ch04-zabbix-collecting-data-ipmi-lld-example">LLD example</h3>
<details class="note" open="open">
<summary>Note</summary>
<p>If you have no idea how LLD (Low Level Discovery works it's best to skip
this for now and cover the LLD chapter first.)</p>
</details>
<p>Redfish exposes many resources as collections containing a Members array. This
structure is ideal for Zabbix Low-Level Discovery (LLD) because it allows
discovery rules to be implemented using JSONPath.</p>
<p>In this example, we will discover chassis resources from the Redfish endpoint:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-21-1"></a>/redfish/v1/Chassis
</span></code></pre></div>
<hr />
<h4 id="ch04-zabbix-collecting-data-ipmi-create-the-master-http-agent-item">Create the Master HTTP Agent Item</h4>
<p>First, create a master item that retrieves the chassis collection.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Configuration</th>
<th style="text-align: left;">notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Host</strong></td>
<td style="text-align: left;">Redfish Mockup Server</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Name:</strong></td>
<td style="text-align: left;">Redfish Chassis collection (raw)</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;">HTTP agent</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;">redfish.chassis.collection.raw</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information</strong></td>
<td style="text-align: left;">text</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Update interval</strong></td>
<td style="text-align: left;">5m</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>URL</strong></td>
<td style="text-align: left;">http://127.0.0.1:8000/redfish/v1/Chassis</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Request method</strong></td>
<td style="text-align: left;">GET</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>Save the item and confirm in Latest data that it returns JSON similar to:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-22-1"></a><span class="p">{</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-22-2"></a><span class="w">  </span><span class="nt">&quot;Members&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-22-3"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;@odata.id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/redfish/v1/Chassis/1U&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-22-4"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-22-5"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h4 id="ch04-zabbix-collecting-data-ipmi-create-the-lld-rule">Create the LLD Rule</h4>
<p>Next we can now create a discovery rule based on the master item we just made.
Press the <code>...</code> in front of the item and select <code>Create dependent discovery rule</code>.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Configuration</th>
<th style="text-align: left;">notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name:</strong></td>
<td style="text-align: left;">Discovery Redfish chassis</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;">Dependent item</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;">redfish.chassis.discovery</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Master item</strong></td>
<td style="text-align: left;">Redfish Chassis collection (raw)</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Preprocessing</strong></td>
<td style="text-align: left;">JSONPath</td>
<td style="text-align: left;">$.Members[*]</td>
</tr>
<tr>
<td style="text-align: left;"><strong>LLD macros</strong></td>
<td style="text-align: left;">{#CHASSIS_URI}</td>
<td style="text-align: left;">$['@odata.id']</td>
</tr>
</tbody>
</table>
<p><img alt="ipmi/../ch04-zabbix-collecting-data/ipmi/ch04.53_discovery_rule.png" src="../ch04-zabbix-collecting-data/ipmi/ch04.53_discovery_rule.png" /></p>
<p><em>4.53 LLD Discovery rule</em></p>
<p>The JSONPath will output each member object individually, for example:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-23-1"></a><span class="p">{</span><span class="w"> </span><span class="nt">&quot;@odata.id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/redfish/v1/Chassis/1U&quot;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>This is exactly what Zabbix expects for JSONPath-based LLD.</p>
<p>The LLD macros section define how values are extracted from each discovered object:</p>
<ul>
<li>The JSONPath must start with <code>$</code></li>
<li>The macro path is evaluated per discovered object</li>
</ul>
<p>After this step, Zabbix will discover:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-24-1"></a><span class="p">{</span><span class="err">#CHASSIS_URI</span><span class="p">}</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">/red</span><span class="kc">f</span><span class="err">ish/v</span><span class="mi">1</span><span class="err">/Chassis/</span><span class="mi">1</span><span class="err">U</span>
</span></code></pre></div>
<hr />
<h4 id="ch04-zabbix-collecting-data-ipmi-create-an-item-prototype-raw-chassis-data">Create an Item Prototype (Raw Chassis Data)</h4>
<p>Now that we have our discovery rule it's time to create an item prototype that queries each discovered chassis.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Configuration</th>
<th style="text-align: left;">notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name:</strong></td>
<td style="text-align: left;">Redfish chassis {#CHASSIS_URI} (raw)</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type:</strong></td>
<td style="text-align: left;">HTTP agent</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key:</strong></td>
<td style="text-align: left;">redfish.chassis.raw[{#CHASSIS_URI}]</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>URL:</strong></td>
<td style="text-align: left;">http://127.0.0.1:8000{#CHASSIS_URI}</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Request method</strong></td>
<td style="text-align: left;">GET</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Update interval</strong></td>
<td style="text-align: left;">5m</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information</strong></td>
<td style="text-align: left;">Text</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>This produces one HTTP item per discovered chassis.</p>
<p><img alt="ipmi/../ch04-zabbix-collecting-data/ipmi/ch04.54_item_prototype_raw.png" src="../ch04-zabbix-collecting-data/ipmi/ch04.54_item_prototype_raw.png" /></p>
<p><em>4.54 Item prototype raw</em></p>
<hr />
<h4 id="ch04-zabbix-collecting-data-ipmi-create-a-dependent-item-prototype-health">Create a Dependent Item Prototype (Health)</h4>
<p>Our next step is to extract the health and the status with dependent items
prototypes.</p>
<p>The chassis resource already contains a standard Status object:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-25-1"></a><span class="nt">&quot;Status&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-25-2"></a><span class="w">  </span><span class="nt">&quot;Health&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OK&quot;</span><span class="p">,</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-25-3"></a><span class="w">  </span><span class="nt">&quot;State&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#ch04-zabbix-collecting-data-ipmi-__codelineno-25-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>We can extract this cleanly using a dependent item.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Configuration</th>
<th style="text-align: left;">notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name:</strong></td>
<td style="text-align: left;">Chassis health</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;">Dependent item</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;">redfish.chassis.health[{#CHASSIS_URI}]</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Master item</strong></td>
<td style="text-align: left;">Redfish chassis {#CHASSIS_URI} (raw)</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information</strong></td>
<td style="text-align: left;">Character</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Preprocessing</strong></td>
<td style="text-align: left;">JSONPath</td>
<td style="text-align: left;">$.Status.Health</td>
</tr>
</tbody>
</table>
<p><img alt="ipmi/../ch04-zabbix-collecting-data/ipmi/ch04.55_item_prototype_health.png" src="../ch04-zabbix-collecting-data/ipmi/ch04.55_item_prototype_health.png" /></p>
<p><em>4.55 Dependent discovery item health</em></p>
<p>Once done clone this item and create one for the <code>Status state</code>. You can use
this JSONPath <code>$.Status.State</code> for it.</p>
<hr />
<h4 id="ch04-zabbix-collecting-data-ipmi-create-a-trigger-prototype">Create a Trigger Prototype</h4>
<p>And as a final step we can create a simple <code>Trigger prototype</code> to make the discovery useful.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Configuration</th>
<th style="text-align: left;">notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name:</strong></td>
<td style="text-align: left;">Chassis health is not OK</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Expression</strong></td>
<td style="text-align: left;">last(/Redfish Mockup Server/redfish.chassis.health[{#CHASSIS_URI}])&lt;&gt;"OK"</td>
<td style="text-align: left;">Adapt trigger names if needed</td>
</tr>
</tbody>
</table>
<p><img alt="ipmi/../ch04-zabbix-collecting-data/ipmi/ch04.56_trigger_prototype.png" src="../ch04-zabbix-collecting-data/ipmi/ch04.56_trigger_prototype.png" /></p>
<p><em>4.56 Trigger Prototype</em></p>
<hr />
<h2 id="ch04-zabbix-collecting-data-ipmi-conclusion">Conclusion</h2>
<p>Both IPMI and Redfish provide out-of-band management capabilities, but they
reflect very different design philosophies and operational eras. Understanding
these differences helps decide which technology to use ‚Äî and why many
environments are gradually transitioning from IPMI to Redfish.</p>
<table>
<thead>
<tr>
<th>Topic</th>
<th>IPMI</th>
<th>Redfish</th>
</tr>
</thead>
<tbody>
<tr>
<td>Standardization</td>
<td>Older, widely implemented standard</td>
<td>Modern DMTF standard designed for automation</td>
</tr>
<tr>
<td>Transport</td>
<td>Binary protocol over UDP (typically port 623)</td>
<td>RESTful API over HTTPS</td>
</tr>
<tr>
<td>Data format</td>
<td>Sensor-based, vendor-defined naming</td>
<td>Structured JSON with formal schemas</td>
</tr>
<tr>
<td>Security model</td>
<td>Historically weak, varies by firmware</td>
<td>Designed with modern security in mind</td>
</tr>
<tr>
<td>Authentication</td>
<td>Legacy mechanisms, cipher suites</td>
<td>HTTP authentication, sessions, tokens</td>
</tr>
<tr>
<td>Discoverability</td>
<td>Limited, often manual</td>
<td>Native via collections and <code>Members</code></td>
</tr>
<tr>
<td>Resource model</td>
<td>Individual sensors</td>
<td>Linked resources (<code>Systems</code>, <code>Chassis</code>, <code>Managers</code>)</td>
</tr>
<tr>
<td>Low-Level Discovery</td>
<td>Difficult and vendor-specific</td>
<td>Natural and scalable using JSONPath</td>
</tr>
<tr>
<td>Poller behavior</td>
<td>Specialized, limited scalability</td>
<td>Uses existing HTTP infrastructure</td>
</tr>
<tr>
<td>Template portability</td>
<td>Often vendor- and model-specific</td>
<td>Largely vendor-neutral</td>
</tr>
<tr>
<td>Automation friendliness</td>
<td>Limited</td>
<td>Designed for automation and APIs</td>
</tr>
<tr>
<td>Tooling</td>
<td><code>ipmitool</code> and vendor utilities</td>
<td><code>curl</code>, browsers, standard HTTP tools</td>
</tr>
<tr>
<td>Typical use today</td>
<td>Legacy fleets, basic hardware health</td>
<td>Modern platforms, scalable monitoring</td>
</tr>
</tbody>
</table>
<p>In practice, the choice is rarely binary.</p>
<p>IPMI remains valuable in environments with older hardware or where Redfish support
is limited or inconsistent. It provides reliable access to fundamental hardware
health metrics and continues to work well when deployed on isolated management
networks.</p>
<p>Redfish, on the other hand, is clearly the direction of the industry. Its REST
based design, structured data model, and native discoverability make it far better
suited for modern monitoring platforms such as Zabbix. Redfish scales naturally,
integrates cleanly with automation workflows, and is significantly easier to
reason about and troubleshoot.</p>
<p>For many organizations, the most realistic approach is coexistence: IPMI for
legacy systems, Redfish for new deployments.</p>
<h2 id="ch04-zabbix-collecting-data-ipmi-questions">Questions</h2>
<ul>
<li>What problem do IPMI and Redfish both aim to solve, and how do their approaches
  differ?</li>
<li>How does the Redfish resource model (Systems, Chassis, Managers) differ from
  IPMI's sensor based model?</li>
<li>What role does JSONPath play in making Redfish monitoring scalable?</li>
<li>When designing a new monitoring template, why is vendor neutrality important?</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-ipmi-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/discovery/low_level_discovery/examples/ipmi_sensors#overview">https://www.zabbix.com/documentation/current/en/manual/discovery/low_level_discovery/examples/ipmi_sensors#overview</a></li>
<li><a href="https://www.intel.com/content/dam/www/public/us/en/documents/product-briefs/ipmi-second-gen-interface-spec-v2-rev1-1.pdf">https://www.intel.com/content/dam/www/public/us/en/documents/product-briefs/ipmi-second-gen-interface-spec-v2-rev1-1.pdf</a></li>
<li><a href="https://github.com/ipmitool/ipmitool">https://github.com/ipmitool/ipmitool</a></li>
<li><a href="https://www.dmtf.org/standards/redfish">https://www.dmtf.org/standards/redfish</a></li>
<li><a href="https://github.com/DMTF/Redfish-Mockup-Server">https://github.com/DMTF/Redfish-Mockup-Server</a></li>
</ul></section><section class="print-page" id="ch04-zabbix-collecting-data-database-odbc" heading-number="9.17"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="database-checks-via-odbc">Database checks via odbc</h1>
<h2 id="ch04-zabbix-collecting-data-database-odbc-conclusion">Conclusion</h2>
<h2 id="ch04-zabbix-collecting-data-database-odbc-questions">Questions</h2>
<h2 id="ch04-zabbix-collecting-data-database-odbc-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch04-zabbix-collecting-data-database-agent" heading-number="9.18"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="database-checks-via-agent">Database checks via agent</h1>
<h2 id="ch04-zabbix-collecting-data-database-agent-conclusion">Conclusion</h2>
<h2 id="ch04-zabbix-collecting-data-database-agent-questions">Questions</h2>
<h2 id="ch04-zabbix-collecting-data-database-agent-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch04-zabbix-collecting-data-zabbix-trapper" heading-number="9.19"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="zabbix-trapper">Zabbix trapper</h1>
<p>So you already know what is the difference between <code>Active</code> and <code>Passive</code>
Zabbix agent item types. However, there is a third, special item type which
also starts with "Zabbix". And that is "Zabbix trapper".</p>
<p>Most likely not by coincidence it is named so, since by its nature it reminds
the "SNMP trap". Data in both cases is not expected to arrive in predefined
frequency, but rather "when needed" or "when something happens".</p>
<p>Zabbix trapper items are extremely useful when you have:</p>
<ul>
<li>places where Zabbix agent can't be installed</li>
<li>"heavy", long running scripts, which produce some valuable monitoring data</li>
<li>scripts that otherwise do some other things, but at some points you want to
send some data to be monitored (i.e. monitoring is just a part of the script
logic, not the main intent). For example, you send the duration of how long
your script was running</li>
<li>temporary or ad-hoc metrics (e.g. some historical data which was not
monitored at the time of occurrence to be analysed)</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-zabbix-trapper-how-to-send-data">How to send data?</h2>
<p>There are two ways to send values to Zabbix trapper item:</p>
<ul>
<li>using <code>zabbix_sender</code></li>
<li>via Zabbix API</li>
</ul>
<details class="info" open="open">
<summary>Info</summary>
<p>Zabbix trapper item receives data over same TCP port as Zabbix agent items
(10051) if <code>zabbix_sender</code> is used</p>
</details>
<p>In both cases, item configuration from Zabbix GUI perspective doesn't differ.
Once configuring Zabbix trapper items, main thing is to have unique meaningful
item key (it must be unique on host level) and type of information of your
choice. Type of information possibilities are same to classic Zabbix agent
items.</p>
<h2 id="ch04-zabbix-collecting-data-zabbix-trapper-hello-world">Hello World</h2>
<p>In this example, we will simply send a string "Hello!" to Zabbix trapper item.</p>
<p>First we will create Zabbix trapper item on Zabbix server. Navigate to template
or host and hit "Create item":</p>
<p><img alt="Zabbix trapper - first item" src="../ch04-zabbix-collecting-data/zabbix-trapper/ch04.xx-trapper-hello-world.png" /></p>
<p>Then we can go to CLI and employ <code>zabbix_sender</code> to pass agreed value to our
newly created Zabbix trapper item. You have to take item key from previous step,
we will use it here as <code>-k</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-0-1"></a>binary@linux:~$<span class="w"> </span>zabbix_sender<span class="w"> </span>-z<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;Zabbix server&quot;</span><span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;hello.world&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;Hello!&quot;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-0-2"></a>Response<span class="w"> </span>from<span class="w"> </span><span class="s2">&quot;127.0.0.1:10051&quot;</span>:<span class="w"> </span><span class="s2">&quot;processed: 1; failed: 0; total: 1; seconds spent: 0.000047&quot;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-0-3"></a>sent:<span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>skipped:<span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span>total:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-0-4"></a>binary@linux:~$
</span></code></pre></div>
<p>And that is about it! Our trapper item is updated.</p>
<p><img alt="Zabbix trapper - first item result" src="../ch04-zabbix-collecting-data/zabbix-trapper/ch04.xx-trapper-hello-world-result.png" /></p>
<details class="info" open="open">
<summary>Info</summary>
<p>Parameters used here are the following:</p>
<p><code>-z</code> - Zabbix server</p>
<p><code>-s</code> - host, where your trapper item resides</p>
<p><code>-k</code> - item key, same as you created in GUI</p>
<p><code>-o</code> - value itself</p>
<p>For more options, check <code>man zabbix_sender</code> or online documentation</p>
</details>
<h2 id="ch04-zabbix-collecting-data-zabbix-trapper-you-can-travel-in-time-with-zabbix_sender">You can "travel in time" with <code>zabbix_sender</code></h2>
<p>Typically you don't care about timestamps - when exactly the data was collected.
This is actually applicable to both Zabbix agent and Zabbix trapper items. You
simply set the checking frequency (in Zabbix agent item case) or control it on
your own (in Zabbix trapper item case). But in both cases you leave it for
Zabbix - data is collected at desired pace and that is mainly all that you care.</p>
<p>But what if you want to restrict / control the timestamps as well, not only
the data itself that is being collected?</p>
<p><code>zabbix_sender</code> offers one sometimes overlooked feature. It allows you to do
exactly what's described above - it allows you to "travel in time" with your
items. For this, we need to employ a combination of <code>zabbix_sender</code> options:</p>
<ul>
<li><code>-T, --with-timestamps</code></li>
<li><code>-i, --input-file</code></li>
</ul>
<details class="info" open="open">
<summary>Info</summary>
<p>Here is even one more overlooked feature of this approach - you actually
don't even need files necessarily. Providing <code>-</code> for <code>-i</code> means reading
from standard input</p>
</details>
<p><em>00 seconds</em></p>
<p>One of the examples when you might want to employ this feature is to force data
to be stored precisely at 00 seconds of the minute. Imagine you run a script
each minute and it might run for duration anything between 10 and 50 seconds.
This script in the end produces time in seconds, how long did it run - and you
send this duration to Zabbix via <code>zabbix_sender</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-3"></a><span class="nv">start_ts</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-5"></a>sleep<span class="w"> </span><span class="k">$((</span><span class="nv">RANDOM</span><span class="o">%</span><span class="m">40</span><span class="o">+</span><span class="m">10</span><span class="k">))</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-7"></a><span class="nv">end_ts</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-9"></a><span class="nv">duration</span><span class="o">=</span><span class="k">$((</span><span class="nv">end_ts</span><span class="o">-</span><span class="nv">start_ts</span><span class="k">))</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-11"></a>zabbix_sender<span class="w"> </span>-z<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;Zabbix server&quot;</span><span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;undefined.time&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="si">${</span><span class="nv">duration</span><span class="si">}</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-12"></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-1-13"></a><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</span></code></pre></div>
<p><img alt="Zabbix trapper - not aligned time" src="../ch04-zabbix-collecting-data/zabbix-trapper/ch04.xx-trapper-not-aligned-time.png" /></p>
<p>Problem here is that since script runs with chaotic durations, results will be
displayed on time axis in unequal intervals between collected values:</p>
<p><img alt="Zabbix trapper - not aligned time graph" src="../ch04-zabbix-collecting-data/zabbix-trapper/ch04.xx-trapper-not-aligned-time-graph.png" /></p>
<p>That is visually unappealing and we can easily fix it by forcing Zabbix to
store results not when the value was sent to Zabbix server, but at the 00
seconds of the minute the script was started:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-3"></a><span class="nv">start_ts</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-5"></a><span class="nv">item_value_ts</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="k">$(</span>date<span class="w"> </span>+%H:%M<span class="k">)</span><span class="w"> </span>+%s<span class="k">)</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-7"></a>sleep<span class="w"> </span><span class="k">$((</span><span class="nv">RANDOM</span><span class="o">%</span><span class="m">40</span><span class="o">+</span><span class="m">10</span><span class="k">))</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-9"></a><span class="nv">end_ts</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-10"></a>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-11"></a><span class="nv">duration</span><span class="o">=</span><span class="k">$((</span><span class="nv">end_ts</span><span class="o">-</span><span class="nv">start_ts</span><span class="k">))</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-12"></a>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-13"></a><span class="nv">sender_input</span><span class="o">=</span><span class="s2">&quot;\&quot;Zabbix server\&quot; undefined.time.00 </span><span class="si">${</span><span class="nv">item_value_ts</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">duration</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-14"></a>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-15"></a>zabbix_sender<span class="w"> </span>-z<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>-T<span class="w"> </span>-i<span class="w"> </span>-<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">sender_input</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-16"></a>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-2-17"></a><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</span></code></pre></div>
<p>Now the values are collected exactly at the 00 second of each minute:</p>
<p><img alt="Zabbix trapper - not aligned time" src="../ch04-zabbix-collecting-data/zabbix-trapper/ch04.xx-trapper-aligned-time.png" /></p>
<p>And our graph becomes smooth:</p>
<p><img alt="Zabbix trapper - aligned time graph" src="../ch04-zabbix-collecting-data/zabbix-trapper/ch04.xx-trapper-aligned-time-graph.png" /></p>
<p>The bigger the possible gaps between the values, the more such approach makes
sense.</p>
<p><em>Past incidents</em></p>
<p>Say you had some incident which had no or had poor monitoring. Say you regret it
and find some valuable data which you would like to visualize. With Zabbix
trapper items and combination of <code>-T</code> and <code>-i</code> options it is absolutely
possible. Just form sets of data from your data sources (e.g. logs) and feed
them into Zabbix by creating some temporary trapper items. You will then have a
view of what has happened, even if you didn't monitor it in real time.</p>
<p><img alt="Zabbix trapper - past incident" src="../ch04-zabbix-collecting-data/zabbix-trapper/ch04.xx-trapper-past-incident.png" /></p>
<p><em>Have some fun</em></p>
<p>Similar to above, but in more creative fashion, you can visualize some ASCII art
in Zabbix by creating sets of data aligned so in time and value amplitude, that
it would form some image. That is a fun way to entertain your colleagues or
just sharpen your skills in scripting!</p>
<p><img alt="Zabbix trapper - fun" src="../ch04-zabbix-collecting-data/zabbix-trapper/ch04.xx-trapper-fun.png" /></p>
<h2 id="ch04-zabbix-collecting-data-zabbix-trapper-using-zabbix-api-to-send-data">Using Zabbix API to send data</h2>
<p>Instead of using <code>zabbix_sender</code>, you can also send data via Zabbix API, by
using <code>history.push</code> method.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-3"></a><span class="nv">zbx_url</span><span class="o">=</span>http://127.0.0.1/zabbix/api_jsonrpc.php
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-4"></a><span class="nv">zbx_header</span><span class="o">=</span><span class="s2">&quot;Content-Type: application/json; charset=UTF-8&quot;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-5"></a><span class="nv">zbx_auth_token</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">0</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span>/token.conf<span class="k">)</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-7"></a><span class="nv">params</span><span class="o">=</span><span class="s2">&quot;[{\&quot;itemid\&quot;: </span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">, \&quot;value\&quot;: \&quot;</span><span class="si">${</span><span class="nv">2</span><span class="si">}</span><span class="s2">\&quot;}]&quot;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-9"></a><span class="nv">payload</span><span class="o">=</span><span class="s2">&quot;{\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;,\&quot;method\&quot;:\&quot;history.push\&quot;,\&quot;id\&quot;:1,\&quot;params\&quot;:</span><span class="si">${</span><span class="nv">params</span><span class="si">}</span><span class="s2">}&quot;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-10"></a>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-11"></a>curl<span class="w"> </span>-s<span class="w"> </span>--max-time<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-12"></a><span class="w">        </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-13"></a><span class="w">        </span>--data<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-14"></a><span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">zbx_header</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-15"></a><span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">zbx_auth_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-16"></a><span class="w">        </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">zbx_url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-3-18"></a><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</span></code></pre></div>
<p>So now by running this with specific Zabbix trapper item id and intended value,
you will update this item:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-1"></a>binary@linux:~$<span class="w"> </span>./history_push.sh<span class="w"> </span><span class="m">69272</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.&#39;</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-2"></a><span class="o">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-3"></a><span class="w">  </span><span class="s2">&quot;jsonrpc&quot;</span>:<span class="w"> </span><span class="s2">&quot;2.0&quot;</span>,
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-4"></a><span class="w">  </span><span class="s2">&quot;result&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-5"></a><span class="w">    </span><span class="s2">&quot;response&quot;</span>:<span class="w"> </span><span class="s2">&quot;success&quot;</span>,
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-6"></a><span class="w">    </span><span class="s2">&quot;data&quot;</span>:<span class="w"> </span><span class="o">[</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-7"></a><span class="w">      </span><span class="o">{</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-8"></a><span class="w">        </span><span class="s2">&quot;itemid&quot;</span>:<span class="w"> </span><span class="m">69272</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-9"></a><span class="w">      </span><span class="o">}</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-10"></a><span class="w">    </span><span class="o">]</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-11"></a><span class="w">  </span><span class="o">}</span>,
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-12"></a><span class="w">  </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-13"></a><span class="o">}</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-14"></a>binary@linux:~$<span class="w"> </span>./history_push.sh<span class="w"> </span><span class="m">69272</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.&#39;</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-15"></a><span class="o">{</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-16"></a><span class="w">  </span><span class="s2">&quot;jsonrpc&quot;</span>:<span class="w"> </span><span class="s2">&quot;2.0&quot;</span>,
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-17"></a><span class="w">  </span><span class="s2">&quot;result&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-18"></a><span class="w">    </span><span class="s2">&quot;response&quot;</span>:<span class="w"> </span><span class="s2">&quot;success&quot;</span>,
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-19"></a><span class="w">    </span><span class="s2">&quot;data&quot;</span>:<span class="w"> </span><span class="o">[</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-20"></a><span class="w">      </span><span class="o">{</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-21"></a><span class="w">        </span><span class="s2">&quot;itemid&quot;</span>:<span class="w"> </span><span class="m">69272</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-22"></a><span class="w">      </span><span class="o">}</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-23"></a><span class="w">    </span><span class="o">]</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-24"></a><span class="w">  </span><span class="o">}</span>,
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-25"></a><span class="w">  </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-26"></a><span class="o">}</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#ch04-zabbix-collecting-data-zabbix-trapper-__codelineno-4-27"></a>binary@linux:~$
</span></code></pre></div>
<p><img alt="Zabbix trapper - API item result" src="../ch04-zabbix-collecting-data/zabbix-trapper/ch04.xx-trapper-api-item-result.png" /></p>
<h2 id="ch04-zabbix-collecting-data-zabbix-trapper-conclusion">Conclusion</h2>
<p>If you work with Zabbix long enough, you will start having this feeling of
when to use "Zabbix trapper" items over classic "Zabbix agent" items. In some
particular cases they are extremely useful (or even the only option to go with).</p>
<p>In this section you have learned how to create simple Zabbix trapper item, as
well as some more advanced approaches.</p>
<p>Using Zabbix trapper is heavily related to more programmatic approach towards
updating item values, so if you are into programming and enjoy monitoring -
you should definitely try it out.</p>
<h2 id="ch04-zabbix-collecting-data-zabbix-trapper-questions">Questions</h2>
<ul>
<li>Do you need Zabbix agent if you want to use <code>zabbix_sender</code>?</li>
<li>Does Zabbix trapper item have checking interval?</li>
<li>Can you send text for Zabbix trapper items, or is it only for numerical data?</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-zabbix-trapper-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/trapper">https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/trapper</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manpages/zabbix_sender">https://www.zabbix.com/documentation/current/en/manpages/zabbix_sender</a></li>
</ul></section><section class="print-page" id="ch04-zabbix-collecting-data-external-checks" heading-number="9.20"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="external-checks">External checks</h1>
<h2 id="ch04-zabbix-collecting-data-external-checks-conclusion">Conclusion</h2>
<h2 id="ch04-zabbix-collecting-data-external-checks-questions">Questions</h2>
<h2 id="ch04-zabbix-collecting-data-external-checks-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch04-zabbix-collecting-data-browser" heading-number="9.21"><nav class='md-tags'><span class='md-tag'>advanced</span><span class='md-tag'>expert</span></nav><h1 id="browser-item">Browser item</h1>
<h2 id="ch04-zabbix-collecting-data-browser-foundational-concepts-and-synthetic-monitoring-architecture">Foundational Concepts and Synthetic Monitoring Architecture</h2>
<p>The introduction of the Browser Item in Zabbix 7.0 marked a significant
expansion of monitoring capabilities, allowing Zabbix to serve not only as a traditional
IT infrastructure monitoring tool but also as a powerful resource for monitoring
strategic web-based information. This item type enables synthetic monitoring, a
method that simulates the behavior of a real user, including multi-step journeys
(user journeys) such as logging in, navigating through menus, or completing a checkout
process.</p>
<h3 id="ch04-zabbix-collecting-data-browser-what-is-the-zabbix-browser-item">What is the Zabbix Browser Item?</h3>
<p>In essence, the Browser Item collects data by executing user-defined JavaScript code
in an automated browser environment via HTTP/HTTPS. Unlike simple HTTP requests,
this item simulates complex actions like clicks, text input, and dynamic navigation
within web applications. The ability to simulate the website in this manner, including
capturing screenshots and measuring performance, enables organizations to ensure
the availability and integrity of both internal websites and external strategic
information sources (such as government portals for tenders).</p>
<h3 id="ch04-zabbix-collecting-data-browser-the-technological-foundation-webdriver-api">The Technological Foundation: WebDriver API</h3>
<p>The functioning of the Browser Item relies on a crucial architectural dependency:
<strong>the WebDriver API</strong> (based on the W3C WebDriver standard). This is an established
framework, often implemented by solutions such as Selenium Server or a headless
WebDriver (e.g., ChromeDriver), which acts as the web testing endpoint. The Zabbix
Server or Proxy functions as the client; it sends the defined JavaScript commands
to this external endpoint, where the actual browser (usually Chrome in a standalone
container) is controlled. The results of the simulated session, including metrics
and error information, are then returned to Zabbix as a structured JSON object.</p>
<p><img alt="Architecture design" src="../ch04-zabbix-collecting-data/browser/ch03_xx_architecture.png" />
<em>CH03.xx Architecture Overview</em></p>
<h3 id="ch04-zabbix-collecting-data-browser-browser-item-vs-classic-web-scenarios-the-strategic-choice">Browser Item vs. Classic Web Scenarios: The Strategic Choice</h3>
<p>Before implementing the Browser Item, it is crucial to understand the difference
between it and the older, classic Web Scenarios. Classic web scenarios are based
on the HTTP Agent and execute steps sequentially, collecting only protocol-level
metrics such as download speed, response time, and the HTTP response code. They
check whether a predefined string is present in the HTML response and can perform
a simulated login, but they do not render the full Document Object Model (DOM)
of the page.</p>
<p>The Browser Item, conversely, simulates the entire browser stack. This is indispensable
for monitoring modern, complex JavaScript-based Single Page Applications (SPAs) or
other web pages where content is loaded asynchronously. Where classic scenarios fail
due to the lack of JavaScript execution, the Browser Item ensures the reliability of
synthetic checks by using a real browser engine. Furthermore, the Browser Item is the
only method within Zabbix that can capture visual snapshots (screenshots), which is
invaluable for troubleshooting. The implication of this superior functionality is that
Browser Items require significantly more CPU and memory on the WebDriver host and on
the Zabbix processes performing the polling.</p>
<h2 id="ch04-zabbix-collecting-data-browser-architectural-requirements-setting-up-the-webdriver-endpoint">Architectural Requirements: Setting up the WebDriver Endpoint</h2>
<p>A successful implementation of the Browser Item requires careful configuration of the
external web testing endpoint. The recommended and most robust method is to use Docker
containers to create an isolated, scalable Selenium Server environment.</p>
<h4 id="ch04-zabbix-collecting-data-browser-implementing-selenium-standalone-chrome-via-docker">Implementing Selenium Standalone Chrome via Docker</h4>
<p>The Zabbix system is designed to communicate robustly with a Selenium Standalone
Server using a Chrome browser engine. It is essential to launch the container with
the correct flags to enable stability and debugging.</p>
<p>The following docker run command is used to start the Selenium Server with Chrome
in detached mode (-d), allocating the necessary ports and memory :</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-browser-__codelineno-0-1"></a>docker run --name browser \
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch04-zabbix-collecting-data-browser-__codelineno-0-2"></a>-p 4444:4444 \
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch04-zabbix-collecting-data-browser-__codelineno-0-3"></a>-p 7900:7900 \
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch04-zabbix-collecting-data-browser-__codelineno-0-4"></a>--shm-size=&quot;2g&quot; \
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch04-zabbix-collecting-data-browser-__codelineno-0-5"></a>-d selenium/standalone-chrome:latest
</span></code></pre></div>
<p><strong>The parameters in this command serve specific, critical purposes :</strong></p>
<ol>
<li><strong><code>docker run --name browser</code>:</strong> This initiates a new Docker container named "browser"</li>
<li><strong><code>-p 4444:4444</code>:</strong> This is the primary communication port. It maps port 4444
   on the host machine to the container port. This is the port the Selenium Server
   uses to accept WebDriver commands from the Zabbix Browser Pollers.</li>
<li><strong><code>-p 7900:7900</code>:</strong> This port is optional but highly recommended for diagnostics.
   It maps the Virtual Network Computing (VNC) server port of the container,
   allowing an administrator to visually observe the automated browser in real
   time remotely (via a VNC client). This is crucial for debugging complex JavaScript
   scripts and unexpected web interactions.</li>
<li><strong><code>--shm-size="2g"</code>:</strong> This is a critical stability parameter. It allocates 2GB
   of shared memory to the container. Chrome requires a significant amount of
   shared memory (/dev/shm) to function correctly and stably under automation.
   Failing to set this can lead to unpredictable browser crashes or slow execution
   times that are difficult to diagnose from Zabbix.</li>
<li><strong><code>-d</code></strong>: Runs the container in detached mode, meaning it will run in the background.</li>
<li><strong><code>selenium/standalone-chrome:latest</code>:</strong> Specifies the Docker image to use.</li>
</ol>
<h4 id="ch04-zabbix-collecting-data-browser-validation-of-the-connectivity">Validation of the Connectivity</h4>
<p>Before configuring the Zabbix Server, the accessibility and functionality of the
WebDriver Endpoint must be validated. This eliminates network or container issues
as potential causes of subsequent Zabbix errors.</p>
<p>The validation steps are as follows :</p>
<ol>
<li><strong>Determine IP Address:</strong> Identify the IP address of the Docker interface
   (e.g., 192.0.2.1).</li>
<li><strong>Test Port Connectivity:</strong> Use nc (Ncat) to verify the connection to the
   WebDriver port:</li>
</ol>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-browser-__codelineno-1-1"></a>nc<span class="w"> </span>-zv<span class="w"> </span><span class="m">192</span>.0.2.1<span class="w"> </span><span class="m">4444</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch04-zabbix-collecting-data-browser-__codelineno-1-2"></a><span class="c1"># Expected output: Connection to 192.0.2.1 4444 port [tcp/*] succeeded!</span>
</span></code></pre></div>
3. Test Selenium Server Response: Use curl to confirm that the Selenium Server
   is serving a valid HTML response:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-browser-__codelineno-2-1"></a>curl<span class="w"> </span>-L<span class="w"> </span><span class="m">192</span>.0.2.1:4444
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch04-zabbix-collecting-data-browser-__codelineno-2-2"></a><span class="c1"># Expected output: HTML content, often starting with &lt;!DOCTYPE html&gt;...&lt;title&gt;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ch04-zabbix-collecting-data-browser-__codelineno-2-3"></a>Selenium<span class="w"> </span>Grid&lt;/title&gt;
</span></code></pre></div>
If these steps succeed, the external dependency is correctly configured, and it is
time to configure the Zabbix components themselves.</p>
<h2 id="ch04-zabbix-collecting-data-browser-zabbix-serverproxy-configuration-and-scalability">Zabbix Server/Proxy Configuration and Scalability</h2>
<p>Browser Items are executed by specific Zabbix processes called browser pollers.
These must be correctly configured on the Zabbix Server or Proxy responsible for
executing the synthetic checks.</p>
<h3 id="ch04-zabbix-collecting-data-browser-server-configuration-parameters-zabbix_serverconf">Server Configuration Parameters (zabbix_server.conf)</h3>
<p>Two parameters in the Zabbix server configuration file (/etc/zabbix/zabbix_server.conf
or zabbix_proxy.conf) are essential: WebDriverURL and StartBrowserPollers.</p>
<p><strong>WebDriverURL (Mandatory)</strong>
This parameter must specify the web testing endpoint configured before (our container).
This is a mandatory parameter, as the default value is empty. Without a valid URL,
Zabbix cannot initialize the WebDriver sessions.</p>
<p><code>Example: WebDriverURL=http://192.0.2.1:4444</code></p>
<p><strong>StartBrowserPollers (Scalability)</strong>
This controls the number of pre-forked Zabbix processes dedicated to executing and
processing Browser Item checks. The default value is 1, and the range is 0 to 1000.</p>
<p>Since browser automation is a CPU-intensive and time-consuming task, Browser Items
are inherently high-latency items. The number of pollers set N<sub>Pollers</sub>
determines how many synthetic checks Zabbix can initiate concurrently. It is a
common mistake to increase this number without increasing the capacity of the
WebDriver Endpoint (the number of simultaneous browser sessions Selenium can handle).
An imbalance here causes the Zabbix Queue Overview to grow, indicating that values
are taking too long to update.10 To optimize monitoring performance, the
N<sub>Pollers</sub> in Zabbix must be balanced with the actual parallel execution
capacity of the WebDriver host.</p>
<p>After modifying the configuration files, the service must be restarted:
<code>systemctl restart zabbix-server</code> (or <code>zabbix-proxy</code>).</p>
<h3 id="ch04-zabbix-collecting-data-browser-scalability-and-isolation-with-zabbix-proxies">Scalability and Isolation with Zabbix Proxies</h3>
<p>For large-scale monitoring or monitoring remote locations, using Zabbix Proxies
is highly recommended. The Browser Item functionality is available on both the
Server and the Proxy, meaning the CPU-intensive rendering and script execution
can be isolated to a dedicated Proxy environment.</p>
<p>The advantage of isolating synthetic checks on a Proxy is twofold: firstly, the
load on the central Zabbix Server is reduced, and secondly, the risk is avoided
that the high-resource-consuming browser automation interferes with the performance
of regular, critical infrastructure checks.</p>
<p>The table below summarizes the essential configuration parameters.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Purpose</th>
<th style="text-align: left;">Recommended Action</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>WebDriverURL</code></td>
<td style="text-align: left;">URL/IP of the WebDriver Endpoint (e.g., Selenium Server)</td>
<td style="text-align: left;">Mandatory to set. Format: http://<IP>:<Port>.</td>
</tr>
<tr>
<td style="text-align: left;"><code>StartBrowserPollers</code></td>
<td style="text-align: left;">Number of pre-forked processes for Browser Item checks</td>
<td style="text-align: left;">Increase this in line with the parallel capacity of the WebDriver host.</td>
</tr>
</tbody>
</table>
<h3 id="ch04-zabbix-collecting-data-browser-host-configuration-and-the-master-item">Host Configuration and the Master Item</h3>
<p>The following steps describe the necessary configuration in the Zabbix Frontend
to set up website monitoring.</p>
<h4 id="ch04-zabbix-collecting-data-browser-host-and-template-configuration">Host and Template Configuration</h4>
<ol>
<li><strong><code>Host Creation</code>:</strong> Create a new host representing the web application to be
   monitored (e.g., "Production Web Portal").</li>
<li><strong><code>Template Link</code>:</strong> Link the out-of-the-box template "Website by Browser"
   to this host. This template is designed for complex web applications and includes
   standard Master Items, Dependent Items, Triggers, and Dashboards.</li>
</ol>
<h3 id="ch04-zabbix-collecting-data-browser-host-macro-definitions">Host Macro Definitions</h3>
<p>The linked template typically uses User Macros to set dynamic parameters, keeping
the template reusable. These macros must be set at the Host level (via the Macros
tab -&gt; Inherited and host macros) :</p>
<ul>
<li>{$WEBSITE.DOMAIN}: Define the target URL or domain name to be monitored
  (e.g., git.zabbix.com/projects/ZBX/repos/zabbix/browse).</li>
<li>{$WEBSITE.GET.DATA.INTERVAL}: The update interval for the Master Item. Due to
  the high resource cost of a full browser check, a longer interval is often used
  (e.g., 15m).</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-browser-master-browser-item-configuration">Master Browser Item Configuration</h3>
<p>The Browser Item itself acts as the Master Item that returns a large, structured
JSON data set. Configuration at the item level is crucial for functionality :</p>
<ul>
<li><strong>Type:</strong> Select Browser.</li>
<li><strong>Key:</strong> Enter a unique key (e.g., web.browser.scenario[login_check]).</li>
<li><strong>Parameters:</strong> This is a list of name/value pairs passed as variables to the
  JavaScript script. This is the ideal place to define non-sensitive parameters
  (URLs, viewport sizes) and, using User Macros, sensitive credentials (usernames,
  passwords).</li>
<li><strong>Script:</strong> This is the central component where the JavaScript code for browser
  interaction is entered.</li>
<li><strong>Timeout:</strong> Set the maximum execution time of the JavaScript (range: 1‚Äì600 seconds).
  Exceeding this time results in an error. Since synthetic checks are inherently
  time-consuming, this value should be set generously, but not excessively, to
  prevent long-running checks from blocking the poller queues.</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-browser-scripting-advanced-browser-interactions-javascript-api">Scripting Advanced Browser Interactions (JavaScript API)</h3>
<p>The power of the Browser Item lies in the specialized JavaScript environment provided
by Zabbix. The JavaScript script directs the entire browser interaction and data
collection.</p>
<h4 id="ch04-zabbix-collecting-data-browser-the-zabbix-javascript-context-and-the-browser-object">The Zabbix JavaScript Context and the Browser Object</h4>
<p>The script has access to Zabbix's additions to the JavaScript language, particularly
the <strong>Browser objects</strong>. The central <code>Browser</code> object manages the WebDriver session;
it is initialized upon creation and terminated upon destruction. A single script
can support up to four <code>Browser</code> objects but they will share the same WebDriver
session internally.</p>
<p><strong>The basic workflow of any script includes :</strong></p>
<ul>
<li>Initialization of a <code>Browser</code> session, optionally with custom <code>chromeOptions</code>
  (e.g., --headless=new for performance).</li>
<li>Navigation to the starting URL (<code>browser.navigate(url)</code>).</li>
<li>Execution of the defined interactions.</li>
<li>Data collection via <code>browser.collectPerfEntries()</code> at crucial points.</li>
<li>Returning the results as a JSON string via <code>JSON.stringify(browser.getResult()</code>).</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-browser-running-browsers-in-headless-mode">Running Browsers in Headless Mode</h3>
<p>Most Zabbix environments run on Linux servers which do not have a GUI. A typical
browser expects an X11/Wayland display environment. Without one, Chrome or Firefox
fails with errors such as:</p>
<ul>
<li>‚ÄúMissing X server‚Äù</li>
<li>‚ÄúNo DISPLAY variable set‚Äù</li>
<li>‚ÄúGPU process initialization failed‚Äù</li>
</ul>
<p>The solution is Headless Mode, which allows Chrome/Firefox to run without a
graphical environment.</p>
<p><strong>Recommended Chrome options:</strong></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-browser-__codelineno-3-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">opts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Browser</span><span class="p">.</span><span class="nx">chromeOptions</span><span class="p">({</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch04-zabbix-collecting-data-browser-__codelineno-3-2"></a><span class="w">    </span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ch04-zabbix-collecting-data-browser-__codelineno-3-3"></a><span class="w">        </span><span class="s1">&#39;--headless=new&#39;</span><span class="p">,</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ch04-zabbix-collecting-data-browser-__codelineno-3-4"></a><span class="w">        </span><span class="s1">&#39;--no-sandbox&#39;</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ch04-zabbix-collecting-data-browser-__codelineno-3-5"></a><span class="w">        </span><span class="s1">&#39;--disable-gpu&#39;</span><span class="p">,</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ch04-zabbix-collecting-data-browser-__codelineno-3-6"></a><span class="w">        </span><span class="s1">&#39;--window-size=1920,1080&#39;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ch04-zabbix-collecting-data-browser-__codelineno-3-7"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ch04-zabbix-collecting-data-browser-__codelineno-3-8"></a><span class="p">});</span>
</span></code></pre></div>
<p>Why these flags matter:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--headless</code></td>
<td>Runs Chrome without GUI. Required.</td>
</tr>
<tr>
<td><code>--no-sandbox</code></td>
<td>Needed in SELinux/sandboxed server environments.</td>
</tr>
<tr>
<td><code>--disable-gpu</code></td>
<td>Prevents GPU-related crashes in headless mode.</td>
</tr>
<tr>
<td><code>--window-size</code></td>
<td>Ensures consistent screenshots and layout.</td>
</tr>
</tbody>
</table>
<h3 id="ch04-zabbix-collecting-data-browser-essential-methods-for-interaction-and-timing">Essential Methods for Interaction and Timing</h3>
<p>For executing complex interactions, the following methods of the <code>Browser</code> object
are crucial :</p>
<ul>
<li><code>navigate(url)</code>: Navigates the browser to the specified URL.</li>
<li><code>findElement(strategy, selector)</code>: Finds a single element on the page (e.g., an
  input field or button) using a location strategy (CSS, XPath )</li>
<li><code>sendKeys(text)/click()</code>: Methods of the returned Element object to enter text
  or click buttons.</li>
<li><code>setElementWaitTimeout(timeout)</code>: Sets the implicit wait time (in milliseconds)
  the browser uses when searching for elements. This is a critical method for
  making scripts robust against variable web page load times.</li>
<li><code>collectPerfEntries(mark)</code>: Collects performance data from the browser (based
  on the browser's Performance API). The optional mark parameter labels this
  snapshot, which is essential for measuring the duration of specific steps in
  a transaction (e.g., "open page" or "login").</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-browser-implementing-a-multi-step-login">Implementing a Multi-Step Login</h3>
<p>A common scenario is monitoring a login procedure. A robust script for this task
must dynamically handle credentials (passed as parameters/macros) and time each
step.
The script initializes a session, navigates, uses <code>findElement</code> to locate the
username and password fields (often via XPath or CSS selectors), and enters the
data using <code>sendKeys</code>. The login button is then clicked. Using
<code>collectPerfEntries()</code> immediately after navigation and again after clicking the
login button makes it possible to measure the pure page load time and the total
login time separately. Finally, the script should perform a check (e.g.,
<code>findElement</code> for the "Sign out" link) to validate the success of the transaction.</p>
<h3 id="ch04-zabbix-collecting-data-browser-defensive-scripting-and-error-handling">Defensive Scripting and Error Handling</h3>
<p>The stability of synthetic monitoring depends entirely on the quality of error
handling. Zabbix's JavaScript environment allows for robust error handling with
try...catch blocks.</p>
<ul>
<li><strong>Error Handling and Screenshots:</strong> When detecting an error (e.g., an element not
  found, a <code>WebdriverError</code> ), the <code>catch</code> block should capture a screenshot using
  <code>browser.getScreenshot()</code>. This Base64-encoded image is added to the JSON results.
  This provides immediate visual context of the error, resulting in significant
  time savings during debugging compared to just a textual error message.</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-browser-data-processing-preprocessing-and-visualization">Data Processing, Preprocessing, and Visualization</h2>
<p>The Master Browser Item produces a single, large JSON string containing all
collected data, including performance metrics, status information, and the
Base64 screenshot. To make this raw data useful for triggers, graphs, and
dashboards, <code>Dependent Items</code> and <code>Preprocessing</code> are necessary.</p>
<h3 id="ch04-zabbix-collecting-data-browser-extraction-via-dependent-items">Extraction via Dependent Items</h3>
<p>A Dependent Item is directly linked to its Master Item and obtains its value by
processing the Master Item's value. For every desired metric from the Browser
Item's JSON output, a separate Dependent Item must be created.</p>
<p>The configuration of a Dependent Item includes :</p>
<ul>
<li><strong>Type:</strong> Select Dependent item.</li>
<li><strong>Master item:</strong> Select the previously configured Browser Item.</li>
<li><strong>Type of information:</strong> Determines the data format (e.g., Numeric Float for times,
  Character for error messages, Binary for screenshots).</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-browser-preprocessing-jsonpath-for-metrics">Preprocessing: JSONPath for Metrics</h3>
<p>Preprocessing steps are used to extract the necessary data from the JSON
payload. The primary method for this is JSONPath. JSONPath allows the
administrator to execute queries on the JSON structure to isolate specific
values (such as the duration of the login step or an error code).</p>
<p>Once the value is extracted, the preprocessing pipeline must ensure that the data
type matches the "Type of information" of the Dependent Item.</p>
<h3 id="ch04-zabbix-collecting-data-browser-capturing-and-storing-screenshots">Capturing and Storing Screenshots</h3>
<p>The capture and visualization of screenshots is one of the most valued features
of the Browser Item.</p>
<ul>
<li><strong>Extraction:</strong> Create a Dependent Item specifically for the screenshot.</li>
<li><strong>Type of Information:</strong> Set this to Binary. This data type is specifically designed
  to store and display large binary data, such as Base64-encoded images.</li>
<li><strong>Preprocessing:</strong> Use JSONPath to extract the Base64-encoded string produced
  by <code>browser.getScreenshot()</code>. </li>
</ul>
<p>It is vital to consider storage limits. The Base64-encoded image may be a maximum
of 1 MB in size. This limit can theoretically be adjusted via the <code>ZBX_MAX_IMAGE_SIZE</code>
constant, but it is usually more practical to reduce the browser viewport using
<code>browser.setScreenSize(x,y)</code> in the JavaScript script to comply with the 1MB limit,
especially for complex pages.</p>
<h3 id="ch04-zabbix-collecting-data-browser-visualization">Visualization</h3>
<p>The stored binary data can be visualized directly in the Zabbix Frontend. The
<code>Item History Widget</code> on Zabbix Dashboards is optimized to display binary data
(such as the Base64 image). When the user hovers over or clicks the "Show"
option of the binary value, a pop-up window opens with the actual captured
image. This provides an immediate, visual overview of the web application's
status at the moment of the check.</p>
<h2 id="ch04-zabbix-collecting-data-browser-tips-troubleshooting-and-security">Tips, Troubleshooting and Security</h2>
<p>Effective management of the Browser Item requires proactive monitoring and attention
to performance and security.</p>
<h3 id="ch04-zabbix-collecting-data-browser-performance-optimization-best-practices">Performance Optimization Best Practices</h3>
<p>Synthetic monitoring is resource intensive. Balancing the Zabbix settings with the
underlying WebDriver infrastructure is essential.   </p>
<ul>
<li>
<p><strong>Timeout Optimization:</strong> In addition to the Zabbix Master Item Timeout parameter,
  script authors should actively use the internal JavaScript timeouts, such as
  <code>browser.setElementWaitTimeout(ms)</code> and <code>browser.setSessionTimeout(ms)</code> and,
  when needed, <code>browser.setScriptTimeout(ms)</code>.
  This ensures the script fails as quickly as possible if a
  step fails, releasing the costly Browser Poller sessions sooner for other checks.</p>
</li>
<li>
<p><strong>Data Retention Policy:</strong> Storing Base64-encoded images (Binary data) can lead
  to very rapid database growth. It is crucial to set an aggressive retention
  policy for the Dependent Items that store screenshots (e.g., 7 days history),
  while numerical performance metrics can maintain a longer retention (e.g., 90
  days trends).</p>
</li>
</ul>
<h3 id="ch04-zabbix-collecting-data-browser-troubleshooting-matrix">Troubleshooting Matrix</h3>
<p>Errors with Browser Items often fall into three categories: Network/Connectivity,
WebDriver-related (Selenium/Chrome), and Script Logics. The Zabbix Server logs
and the external WebDriver logs should be investigated jointly.</p>
<p><strong>Troubleshooting Matrix for Browser Items:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Problem/Error Message</th>
<th style="text-align: left;">Possible Cause</th>
<th style="text-align: left;">Diagnosis Tool</th>
<th style="text-align: left;">Solution/Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Failed to get JSON of the requested website</td>
<td style="text-align: left;">Zabbix cannot reach the WebDriverURL or the WebDriver is not responding correctly.</td>
<td style="text-align: left;">Zabbix Server log (zabbix_server.log); nc/curl to the WebDriver port 4444.</td>
<td style="text-align: left;">Check network connectivity, firewall rules, and the Selenium Server status.</td>
</tr>
<tr>
<td style="text-align: left;">Zabbix Queue backlog for Browser Items</td>
<td style="text-align: left;">Too few StartBrowserPollers set, or the WebDriver host is overloaded.</td>
<td style="text-align: left;">Zabbix Monitoring ‚Üí Queue Overview; OS metrics on the WebDriver host (CPU/RAM).</td>
<td style="text-align: left;">Increase StartBrowserPollers or scale the WebDriver infrastructure (e.g., via Proxies).</td>
</tr>
<tr>
<td style="text-align: left;">WebdriverError or unexplained crashes</td>
<td style="text-align: left;">Problems with the Chrome engine in the container, often due to insufficient shared memory.</td>
<td style="text-align: left;">Selenium Container logs; use VNC (port 7900) for visual debugging.</td>
<td style="text-align: left;">Confirm that the --shm-size="2g" parameter was used when starting the Docker container.</td>
</tr>
<tr>
<td style="text-align: left;">Timeouts on complex scripts</td>
<td style="text-align: left;">Implicit wait times are too short for dynamic content; Zabbix Timeout is too low.</td>
<td style="text-align: left;">Increase the Timeout at the item level; adjust setElementWaitTimeout in the JS.</td>
<td style="text-align: left;">Use try...catch to isolate the exact error position and generate a Base64 screenshot.</td>
</tr>
</tbody>
</table>
<h3 id="ch04-zabbix-collecting-data-browser-security-considerations">Security Considerations</h3>
<p>The deployment of a WebDriver Endpoint introduces an automated browser with web access.
This requires strict security measures.</p>
<ul>
<li>Network Isolation: The WebDriver Endpoint (ports 4444 and 7900) should only be
  accessible to the Zabbix Server or Proxy. Exposure to the public network is a
  serious risk. Use strict firewall rules to restrict access to the internal IP
  addresses of the Zabbix components.</li>
<li>Principle of Least Privilege: Ensure that all Zabbix processes, including the
  browser pollers, and the underlying Docker host and containers run under a
  non-privileged user (zabbix user). This limits potential damage if a vulnerability
  in the browser or WebDriver step is exploited.   </li>
</ul>
<h2 id="ch04-zabbix-collecting-data-browser-practical-example-monitor-httpswwwzabbixcom">Practical example : Monitor https://www.zabbix.com</h2>
<p>Scenario</p>
<ul>
<li>Navigate to https://www.zabbix.com/</li>
<li>Click the "GET ZABBIX" link</li>
<li>Wait for the Download page to load</li>
<li>Extract the : headline text</li>
<li>Collect performance timing</li>
<li>Return all results as JSON</li>
</ul>
<div class="language-JavaScript highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-1"></a><span class="c1">// Chrome settings (headless, sandbox, viewport)</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">opts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Browser</span><span class="p">.</span><span class="nx">chromeOptions</span><span class="p">({</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-3"></a><span class="w">    </span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-4"></a><span class="w">        </span><span class="s2">&quot;--headless=new&quot;</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-5"></a><span class="w">        </span><span class="s2">&quot;--no-sandbox&quot;</span><span class="p">,</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-6"></a><span class="w">        </span><span class="s2">&quot;--disable-gpu&quot;</span><span class="p">,</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-7"></a><span class="w">        </span><span class="s2">&quot;--window-size=1920,1080&quot;</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-8"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-9"></a><span class="p">});</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-11"></a><span class="kd">var</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-12"></a><span class="kd">var</span><span class="w"> </span><span class="nx">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-14"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-15"></a><span class="w">    </span><span class="nx">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Browser</span><span class="p">(</span><span class="nx">opts</span><span class="p">);</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-16"></a>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-17"></a><span class="w">    </span><span class="nx">browser</span><span class="p">.</span><span class="nx">setSessionTimeout</span><span class="p">(</span><span class="mf">15000</span><span class="p">);</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-18"></a><span class="w">    </span><span class="nx">browser</span><span class="p">.</span><span class="nx">setElementWaitTimeout</span><span class="p">(</span><span class="mf">10000</span><span class="p">);</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-19"></a><span class="w">    </span><span class="nx">browser</span><span class="p">.</span><span class="nx">setScreenSize</span><span class="p">(</span><span class="mf">1920</span><span class="p">,</span><span class="w"> </span><span class="mf">1080</span><span class="p">);</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-20"></a>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-21"></a><span class="w">    </span><span class="c1">// 1) Load homepage</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-22"></a><span class="w">    </span><span class="nx">browser</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="s2">&quot;https://www.zabbix.com/&quot;</span><span class="p">);</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-23"></a><span class="w">    </span><span class="nx">browser</span><span class="p">.</span><span class="nx">collectPerfEntries</span><span class="p">(</span><span class="s2">&quot;open_home&quot;</span><span class="p">);</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-24"></a>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-25"></a><span class="w">    </span><span class="c1">// 2) Click GET ZABBIX</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-26"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">btn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="s2">&quot;link text&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;GET ZABBIX&quot;</span><span class="p">);</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">btn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-28"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;cannot find &#39;GET ZABBIX&#39; link&quot;</span><span class="p">);</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-30"></a><span class="w">    </span><span class="nx">btn</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-31"></a>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-32"></a><span class="w">    </span><span class="nx">browser</span><span class="p">.</span><span class="nx">collectPerfEntries</span><span class="p">(</span><span class="s2">&quot;after_click&quot;</span><span class="p">);</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-33"></a>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-34"></a><span class="w">    </span><span class="c1">// 3) Extract H1 headline</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-35"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">h1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="s2">&quot;tag name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;h1&quot;</span><span class="p">);</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-36"></a><span class="w">    </span><span class="nx">out</span><span class="p">.</span><span class="nx">headline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">h1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">h1</span><span class="p">.</span><span class="nx">getText</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-37"></a>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-38"></a><span class="w">    </span><span class="c1">// Build result</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-39"></a><span class="w">    </span><span class="nx">out</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ok&quot;</span><span class="p">;</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-40"></a>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-41"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-42"></a>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-43"></a><span class="w">    </span><span class="c1">// Catch any JS or WebDriver error</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-44"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">BrowserError</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-45"></a><span class="w">        </span><span class="nx">browser</span><span class="p">.</span><span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-46"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-47"></a>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-48"></a><span class="w">    </span><span class="nx">out</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">;</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-49"></a><span class="w">    </span><span class="nx">out</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-50"></a>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-51"></a><span class="w">    </span><span class="c1">// Attach screenshot</span>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-52"></a><span class="w">    </span><span class="nx">out</span><span class="p">.</span><span class="nx">screenshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">getScreenshot</span><span class="p">();</span>
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-53"></a>
</span><span id="__span-4-54"><a id="__codelineno-4-54" name="__codelineno-4-54" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-54"></a><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-55"><a id="__codelineno-4-55" name="__codelineno-4-55" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-55"></a>
</span><span id="__span-4-56"><a id="__codelineno-4-56" name="__codelineno-4-56" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-56"></a><span class="w">    </span><span class="c1">// Zabbix BrowserResult (contains perf + duration + URL)</span>
</span><span id="__span-4-57"><a id="__codelineno-4-57" name="__codelineno-4-57" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-57"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">browser</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-58"><a id="__codelineno-4-58" name="__codelineno-4-58" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-58"></a><span class="w">        </span><span class="nx">out</span><span class="p">.</span><span class="nx">final_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">getUrl</span><span class="p">();</span>
</span><span id="__span-4-59"><a id="__codelineno-4-59" name="__codelineno-4-59" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-59"></a><span class="w">        </span><span class="nx">out</span><span class="p">.</span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">browser</span><span class="p">.</span><span class="nx">getResult</span><span class="p">();</span>
</span><span id="__span-4-60"><a id="__codelineno-4-60" name="__codelineno-4-60" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-60"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-61"><a id="__codelineno-4-61" name="__codelineno-4-61" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-61"></a>
</span><span id="__span-4-62"><a id="__codelineno-4-62" name="__codelineno-4-62" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-62"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">out</span><span class="p">);</span>
</span><span id="__span-4-63"><a id="__codelineno-4-63" name="__codelineno-4-63" href="#ch04-zabbix-collecting-data-browser-__codelineno-4-63"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="ch04-zabbix-collecting-data-browser-what-the-script-returns">What the Script Returns</h3>
<div class="language-js highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-1"></a><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-2"></a><span class="w">  </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ok&quot;</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-3"></a><span class="w">  </span><span class="s2">&quot;headline&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Zabbix Cloud&quot;</span><span class="p">,</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-4"></a><span class="w">  </span><span class="s2">&quot;final_url&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://www.zabbix.com/zabbix_cloud&quot;</span><span class="p">,</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-5"></a>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-6"></a><span class="w">  </span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-7"></a><span class="w">    </span><span class="s2">&quot;duration&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2.53</span><span class="p">,</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-8"></a><span class="w">    </span><span class="s2">&quot;performance_data&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-9"></a><span class="w">      </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-10"></a><span class="w">        </span><span class="s2">&quot;navigation&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-11"></a><span class="w">          </span><span class="s2">&quot;response_time&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0.19</span><span class="p">,</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-12"></a><span class="w">          </span><span class="s2">&quot;dom_content_loading_time&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-13"></a><span class="w">          </span><span class="s2">&quot;load_finished&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0.64</span><span class="p">,</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-14"></a><span class="w">          </span><span class="s2">&quot;encoded_size&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">17753</span><span class="p">,</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-15"></a><span class="w">          </span><span class="s2">&quot;total_size&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">102839</span><span class="p">,</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-16"></a><span class="w">          </span><span class="s2">&quot;redirect_count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-17"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-18"></a><span class="w">        </span><span class="s2">&quot;resource&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-19"></a><span class="w">          </span><span class="s2">&quot;response_time&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">12.37</span><span class="p">,</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-20"></a><span class="w">          </span><span class="s2">&quot;resource_fetch_time&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0.42</span><span class="p">,</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-21"></a><span class="w">          </span><span class="s2">&quot;count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">42</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-22"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-23"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-24"></a><span class="w">      </span><span class="s2">&quot;details&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-25"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-26"></a><span class="w">          </span><span class="s2">&quot;mark&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;open_home&quot;</span><span class="p">,</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-27"></a><span class="w">          </span><span class="s2">&quot;navigation&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* navigation timing for homepage */</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-28"></a><span class="w">          </span><span class="s2">&quot;resource&quot;</span><span class="o">:</span><span class="w">   </span><span class="p">{</span><span class="w"> </span><span class="cm">/* aggregated resource metrics */</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-29"></a><span class="w">          </span><span class="s2">&quot;user&quot;</span><span class="o">:</span><span class="w">       </span><span class="p">[</span><span class="w"> </span><span class="cm">/* optional marks set by the website itself */</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-30"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-31"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-32"></a><span class="w">          </span><span class="s2">&quot;mark&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;after_click&quot;</span><span class="p">,</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-33"></a><span class="w">          </span><span class="s2">&quot;navigation&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* navigation timing for /zabbix_cloud */</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-34"></a><span class="w">          </span><span class="s2">&quot;resource&quot;</span><span class="o">:</span><span class="w">   </span><span class="p">{</span><span class="w"> </span><span class="cm">/* aggregated resource metrics */</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-35"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-36"></a><span class="w">      </span><span class="p">],</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-37"></a><span class="w">      </span><span class="s2">&quot;marks&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-38"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;open_home&quot;</span><span class="p">,</span><span class="w">   </span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-39"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;after_click&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-40"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-41"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-42"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#ch04-zabbix-collecting-data-browser-__codelineno-5-43"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>On error, you'll see something like:</strong></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-2"></a><span class="w">  </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-3"></a><span class="w">  </span><span class="s2">&quot;error&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;cannot find &#39;GET ZABBIX&#39; link&quot;</span><span class="p">,</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-4"></a><span class="w">  </span><span class="s2">&quot;screenshot&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&lt;base64-encoded PNG&gt;&quot;</span><span class="p">,</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-5"></a><span class="w">  </span><span class="s2">&quot;final_url&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://www.zabbix.com/&quot;</span><span class="p">,</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-6"></a><span class="w">  </span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-7"></a><span class="w">    </span><span class="s2">&quot;duration&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">12.02</span><span class="p">,</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-8"></a><span class="w">    </span><span class="s2">&quot;error&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-9"></a><span class="w">      </span><span class="s2">&quot;http_status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-10"></a><span class="w">      </span><span class="s2">&quot;code&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-11"></a><span class="w">      </span><span class="s2">&quot;message&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;cannot find &#39;GET ZABBIX&#39; link&quot;</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#ch04-zabbix-collecting-data-browser-__codelineno-6-14"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="ch04-zabbix-collecting-data-browser-lets-go-over-what-everything-does-in-the-script">Let's go over what everything does in the script</h4>
<p><strong>Top-level fields (script-defined)</strong></p>
<ul>
<li>status
  High-level outcome of the synthetic scenario:<ul>
<li>"ok" ‚Äì the script completed the full user journey as intended.</li>
<li>"error" ‚Äì something failed (element not found, timeout, navigation error, etc.).</li>
</ul>
</li>
<li>headline
  The text content of the <code>&lt;h1&gt;</code> element on the final page after clicking GET ZABBIX.
  This is a functional assertion: ‚ÄúDid we end up on the expected page with the expected headline?‚Äù</li>
<li>final_url
  The final URL seen by the browser after all redirects and navigation.
  This allows you to verify whether the button still leads to /zabbix_cloud or was changed/redirected elsewhere.</li>
<li>error (optional)
  A human-readable explanation if something went wrong (for example: ‚Äúcannot find 'GET ZABBIX' link‚Äù).
  This is added by the script using err.toString() for quick diagnosis from the Zabbix frontend.</li>
<li>screenshot (optional, on error)
  A Base64-encoded PNG image captured at the time of failure.
  This allows the operator to see what the user would have seen at the moment of the error (login form, cookie banner, error page, etc.). It‚Äôs stored as a Binary dependent item.</li>
<li>result
  This is the BrowserResult object returned by Zabbix (browser.getResult()), which wraps:<ul>
<li>Timing and performance data</li>
<li>Duration of the scenario</li>
<li>Any internal error information</li>
<li>Marks set by browser.collectPerfEntries(...)</li>
</ul>
</li>
</ul>
<p><strong>Inside result</strong></p>
<ul>
<li>duration
  Total execution time of the Browser scenario in seconds, from start of the script to completion.
  This is useful as a high-level synthetic transaction time.</li>
<li>performance_data.summary.navigation<ul>
<li>Aggregated navigation metrics for the page load (in seconds), for example:</li>
<li>response_time ‚Äì backend response time (server + network).</li>
<li>dom_content_loading_time ‚Äì time until the DOM is ready (DOMContentLoaded).</li>
<li>load_finished ‚Äì time until the load event fires (page fully loaded).</li>
<li>encoded_size / total_size ‚Äì size of transferred and decoded content.</li>
<li>redirect_count ‚Äì number of redirects for the navigation.
You can think of this section as ‚Äúthe synthetic page-speed metrics from the browser‚Äôs point of view‚Äù.</li>
</ul>
</li>
<li>performance_data.summary.resource<ul>
<li>Aggregated metrics for all resources (images, CSS, JS, fonts, etc.):</li>
<li>count ‚Äì number of resources loaded.</li>
<li>resource_fetch_time ‚Äì time spent fetching resources.</li>
<li>response_time ‚Äì cumulative response time for resources.</li>
</ul>
</li>
<li>performance_data.details[]
An array with one entry per collectPerfEntries("mark") call in your script:<ul>
<li>Each element has:<ul>
<li>mark ‚Äì the label you passed (e.g. "open_home", "after_click").</li>
<li>navigation ‚Äì detailed timings for that navigation.</li>
<li>resource ‚Äì resource stats for that step.</li>
<li>user ‚Äì optional PerformanceEntry marks set by the website itself (e.g. third-party SDKs, analytics, etc.).</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This enables per-step decomposition of your user journey: open homepage vs. landing page after click, etc.
- marks[]
A list of all marks with their indices. Mostly useful if you need to correlate external tools with Zabbix data.</p>
<h3 id="ch04-zabbix-collecting-data-browser-dependent-items-screenshot-useful-metrics">Dependent items ‚Äì screenshot + useful metrics</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Master item</th>
<th style="text-align: left;">Type of information</th>
<th style="text-align: left;">Preprocessing</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Website screenshot (GET ZABBIX)</td>
<td style="text-align: left;">Dependent item</td>
<td style="text-align: left;">your Browser item</td>
<td style="text-align: left;">Binary</td>
<td style="text-align: left;">JSONPath</td>
<td style="text-align: left;">$.screenshot</td>
</tr>
<tr>
<td style="text-align: left;">GET ZABBIX ‚Äì headline</td>
<td style="text-align: left;">Dependent item</td>
<td style="text-align: left;">your Browser item</td>
<td style="text-align: left;">Binary</td>
<td style="text-align: left;">JSONPath</td>
<td style="text-align: left;">$.headline</td>
</tr>
</tbody>
</table>
<p>Since we only make screenshots when it fails also add a custom on fail option to
your item.</p>
<p><img alt="browser/../ch04-zabbix-collecting-data/browser/ch03_xx_discard-value.png" src="../ch04-zabbix-collecting-data/browser/ch03_xx_discard-value.png" />
<em>CH03 Discard Value</em></p>
<p><strong>A few other JSONPath regexes that you can use:</strong></p>
<ul>
<li>$.result.performance_data.details[0].navigation.duration</li>
<li>$.result.performance_data.details[1].navigation.duration</li>
<li>$.result.performance_data.summary.navigation.load_finished</li>
<li>$.result.duration</li>
<li>$.final_url
...</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-browser-conclusion">Conclusion</h2>
<p>The Zabbix Browser Item in version 8.0 represents a mature and powerful solution
for synthetic monitoring, essential for managing modern web applications. It surpasses
the limitations of classic Web Scenarios by enabling the realistic simulation of
complex multi-step user journeys, including capturing the visual state of the
application via screenshots.</p>
<p>The success of this functionality depends on a robust, orchestrated architecture,
where the Zabbix Server acts as the conductor and the external WebDriver Endpoint
(preferably Selenium Standalone Chrome in a Docker container with adequate shared
memory allocation) acts as the specialized executor.</p>
<p>Administrators should prioritize the following actions to ensure a stable and
scalable environment:</p>
<ul>
<li><strong>Dependency Validation:</strong> Configure and validate the external WebDriver Endpoint
  before configuring the Zabbix Server. Ensure adequate resource allocation,
  especially the <code>--shm-size="2g"</code> for Docker containers.</li>
<li><strong>Load-Based Scalability:</strong> Dynamically manage StartBrowserPollers and use Zabbix
  Proxies to isolate the synthetic workload from core infrastructure monitoring.</li>
<li><strong>Defensive Scripting:</strong> Invest time in writing robust JavaScript scripts that
  utilize setElementWaitTimeout and integrate error handling with screenshots,
  significantly reducing the Mean Time To Resolution (MTTR) upon failure.</li>
<li><strong>Efficient Data Processing:</strong> Use Dependent Items and JSONPath preprocessing to
  transform the Master Item's JSON payload into usable, individual metrics and
  binary stored screenshots, with an appropriate retention policy for the large
  binary items.</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-browser-questions">Questions</h2>
<ul>
<li>What key limitation of classic Web Scenarios does the Browser item solve, and
  why is this especially important for modern JavaScript-heavy applications?</li>
<li>Why is it generally a bad idea to run many Browser items directly on the main
  Zabbix server, and how can proxies help?</li>
<li>Why are screenshots stored as Binary items, and what are the main risks if you
  keep them for a long retention period?</li>
<li>What is the purpose of browser.setElementWaitTimeout() in your script, and what
  kind of failures do you prevent by tuning it correctly?</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-browser-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/browser">https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/browser</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/guides/monitor_browser">https://www.zabbix.com/documentation/current/en/manual/guides/monitor_browser</a></li>
<li><a href="https://blog.zabbix.com/monitoring-website-changes-with-zabbix-browser-item/31684/">https://blog.zabbix.com/monitoring-website-changes-with-zabbix-browser-item/31684/</a></li>
<li><a href="https://blog.zabbix.com/an-introduction-to-browser-monitoring/29245/">https://blog.zabbix.com/an-introduction-to-browser-monitoring/29245/</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/preprocessing/javascript/browser_item_javascript_objects">https://www.zabbix.com/documentation/current/en/manual/config/items/preprocessing/javascript/browser_item_javascript_objects</a></li>
</ul></section><section class="print-page" id="ch04-zabbix-collecting-data-calculated" heading-number="9.22"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="calculated-items">Calculated items</h1>
<p>As monitoring environments grow, so does the need to transform raw metrics into
meaningful, actionable information. Not every value you need exists on the host
itself. Sometimes the most important insights come from deriving new values, ratios,
differences, rates, percentages, or complex expressions combining several items.</p>
<p>In Zabbix, this capability is provided through calculated items. A calculated item
does not collect data from the host; instead, it produces values based on an
expression evaluated by the Zabbix server. This makes calculated items extremely
powerful for analytics, SLA reporting, performance ratios, and synthetic metrics
across multiple data sources.</p>
<p>In earlier Zabbix versions, calculated metrics were split into two different item
types:</p>
<ul>
<li>Calculated items</li>
<li>Aggregate items</li>
</ul>
<p>Both were powerful but came with inconsistent syntax and separate configuration
workflows. This led to confusion, especially when building larger monitoring
models or template driven designs.</p>
<p>Starting with Zabbix 7.0, these functions were unified into a single item type:
Calculated with a single expression syntax. All former aggregation logic per host,
per group, or cross group is now accessed directly through functions such as:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch04-zabbix-collecting-data-calculated-__codelineno-0-1"></a>avg<span class="o">()</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch04-zabbix-collecting-data-calculated-__codelineno-0-2"></a>sum<span class="o">()</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch04-zabbix-collecting-data-calculated-__codelineno-0-3"></a>percentile<span class="o">()</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch04-zabbix-collecting-data-calculated-__codelineno-0-4"></a>grpavg<span class="o">()</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch04-zabbix-collecting-data-calculated-__codelineno-0-5"></a>grpsum<span class="o">()</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch04-zabbix-collecting-data-calculated-__codelineno-0-6"></a>groupcount<span class="o">()</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch04-zabbix-collecting-data-calculated-__codelineno-0-7"></a>etc.
</span></code></pre></div>
<p>This unification dramatically simplifies the platform:</p>
<ul>
<li>One place to create derived values</li>
<li>One syntax to learn</li>
<li>One template model for all calculations</li>
<li>More powerful LLD integration</li>
</ul>
<p>Zabbix 8.0 continues this streamlined approach, making calculated items a
cornerstone for building analytics, SLA metrics, and higher-level abstractions.</p>
<hr />
<h2 id="ch04-zabbix-collecting-data-calculated-what-are-calculated-items">What Are Calculated Items?</h2>
<p>A calculated item is a an item whose value is produced entirely by the Zabbix
server. Instead of collecting external data, it uses:</p>
<ul>
<li>Other item values (last(), avg(), max(), etc.)</li>
<li>Arithmetic operations</li>
<li>Built-in functions</li>
<li>Data aggregation across hosts or host groups</li>
</ul>
<p>The formula is evaluated at a defined interval, and results are stored exactly
like any other metric.</p>
<p><strong>Calculated items are especially useful when:</strong></p>
<ul>
<li>You need ratios (e.g., CPU steal % vs. total CPU time)</li>
<li>You want to convert units (bytes ‚Üí megabytes)<ul>
<li>can also be done with preprocessing steps.</li>
</ul>
</li>
<li>You want to calculate deltas (difference between two counters)<ul>
<li>can also be done with preprocessing steps.</li>
</ul>
</li>
<li>You want to aggregate values across multiple interfaces, disks, or services</li>
<li>You want to normalize data (e.g., dividing by CPU count)</li>
<li>You want to create synthetic KPIs that do not exist natively</li>
</ul>
<hr />
<h2 id="ch04-zabbix-collecting-data-calculated-where-calculated-items-fit-in-the-zabbix-data-model">Where Calculated Items Fit in the Zabbix Data Model</h2>
<p>Calculated items are part of the broader set of Zabbix item types. They behave like:</p>
<ul>
<li>Dependent items (no host communication)</li>
<li>Preprocessed items (transformation of raw data)</li>
<li>Internal/virtual metrics (local to Zabbix)</li>
</ul>
<p>... but with a key distinction:</p>
<p>The source data does not trigger an update, only the calculated item's own
interval does. This means calculated items must be configured carefully to ensure:</p>
<ul>
<li>Their update interval matches the freshness of source data</li>
<li>Their formulas reference items that exist and return numeric values</li>
<li>They do not introduce unnecessary load through excessive recalculation</li>
</ul>
<hr />
<h2 id="ch04-zabbix-collecting-data-calculated-how-to-create-a-calculated-item">How to create a Calculated Item</h2>
<p>To create a calculated item:</p>
<ol>
<li>Open Data collection ‚Üí Hosts ‚Üí <your host> ‚Üí Items</li>
<li>Click Create item</li>
<li>Set Type: Calculated</li>
<li>Define:<ul>
<li>Name</li>
<li>Type: Calculated</li>
<li>Key (unique identifier)</li>
<li>Value type (Numeric, float, etc.)</li>
<li>Formula</li>
<li>Units (optional)</li>
<li>Update interval</li>
<li>History/Trend storage</li>
</ul>
</li>
<li>Save the item</li>
</ol>
<p><img alt="calculated/../ch04-zabbix-collecting-data/calculated/ch04.60-calculated-item.png" src="../ch04-zabbix-collecting-data/calculated/ch04.60-calculated-item.png" /></p>
<p><em>calculated-item</em></p>
<p><strong>Example Formula :</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch04-zabbix-collecting-data-calculated-__codelineno-1-1"></a>last<span class="o">(</span>/host/net.if.in<span class="o">[</span>eth0<span class="o">])</span><span class="w"> </span>+<span class="w"> </span>last<span class="o">(</span>/host/net.if.out<span class="o">[</span>eth0<span class="o">])</span>
</span></code></pre></div>
<p>Using this in our formula would calculate the total traffic by combining traffic
in with traffic out. This will only work if we have 2 exact items like this on
our host.</p>
<p>Another more useful example as the item net.if.total exists for the example
above could be the calculation of the interface utilization.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch04-zabbix-collecting-data-calculated-__codelineno-2-1"></a><span class="o">(</span><span class="w"> </span>last<span class="o">(</span>/host/net.if.total<span class="o">[</span>eth0<span class="o">])</span><span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">)</span><span class="w"> </span>/<span class="w"> </span>last<span class="o">(</span>/host/net.if.speed<span class="o">[</span>eth0<span class="o">])</span>
</span></code></pre></div>
<p>Again on our host we would need the item <code>net.if.total[eth0]</code> and
<code>net.if.speed[eth0]</code> for this to work.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Zabbix does not have an Built-in item net.if.speed but we can usually read
the speed from network devices like switches. In Linux you could use as
alternative method <code id="IFNAME">vfs.file.contents["/sys/class/net/{#IFNAME}/speed"]
where you replace</code>` with the correct interface name.</p>
</div>
<h2 id="ch04-zabbix-collecting-data-calculated-some-good-practices-for-calculated-items">Some good practices for Calculated items</h2>
<ol>
<li><strong>Align Update Intervals:</strong> If your source item updates every 60 seconds, avoid recalculating every 5 seconds.</li>
<li><strong>Always Validate Item Existence:</strong> If one referenced item is missing, the calculated item returns unsupported.</li>
<li><strong>Use Templates, Not Hosts:</strong> Especially important when building:<ul>
<li>CPU utilization ratios</li>
<li>Disk usage summaries</li>
<li>Network traffic rollups
   By using templates, calculated items become reusable and consistent across infrastructure.</li>
</ul>
</li>
<li><strong>Use Value Type Carefully:</strong><ul>
<li>Floating point is usually safer unless you specifically need integers.</li>
</ul>
</li>
<li><strong>Combine with LLD (Low-Level Discovery)</strong>
   Calculated LLD prototypes allow:<ul>
<li>Per-disk KPIs</li>
<li>Per-interface utilization percentages</li>
<li>Storage pool ratios</li>
<li>Multi-core CPU computations
`</li>
</ul>
</li>
</ol>
<h2 id="ch04-zabbix-collecting-data-calculated-practical-example">Practical Example</h2>
<h3 id="ch04-zabbix-collecting-data-calculated-analysing-network-latency-with-percentiles">Analysing Network Latency with Percentiles</h3>
<p><strong>The Crucial Role of Percentile Analysis in Network Quality</strong>
When assessing network latency, specifically using metrics like ICMP Ping response
time, relying solely on the average (mean) can be profoundly misleading a pitfall
analogous to analysing website performance without considering real world user
experience.</p>
<p><strong>Suppose :</strong></p>
<ul>
<li>99% of all ICMP responses are 5 ms</li>
<li>1% spike to 500 ms due to congestion</li>
</ul>
<p>In this case, the arithmetic mean latency will still appear negligible and highly
satisfactory. However, this statistical comfort masks a critical flaw: a significant
fraction of users the 1% are intermittently encountering severe, perceptible network
slowdowns.</p>
<p>To accurately capture the real network quality and expose these intermittent performance
degradations, engineers must employ percentile analysis. Key percentiles, such as
the P95 (95th percentile) or P99 (99th percentile), immediately reveal symptoms of
network issues that averages conceal.</p>
<p>The use of percentiles effectively exposes sporadic but critical issues, including:</p>
<ul>
<li><strong>Congestion:</strong> High traffic leading to packet queuing.</li>
<li><strong>Bufferbloat:</strong> Excessive buffering causing queueing delays.</li>
<li><strong>Microbursts:</strong> Short, sharp spikes in traffic volume.</li>
<li><strong>Jitter Spikes:</strong> Irregular variations in packet delay.</li>
</ul>
<p>Therefore, for a robust and accurate indication of the operational network quality
experienced by the majority of users, percentile analysis is indispensable.</p>
<p><strong>Required Item: ICMP Response Time</strong></p>
<p>Zabbix provides a built-in Simple Check for ICMP response time (fping-based).
For this exercise make sure the item is already on the system available as we
need it for our calculated item.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>Icmpping</td>
</tr>
<tr>
<td>Type</td>
<td>Simple check</td>
</tr>
<tr>
<td>Key</td>
<td>icmppingsec[&lt;target-IP&gt;]</td>
</tr>
<tr>
<td>Units</td>
<td>s</td>
</tr>
<tr>
<td>Update interval</td>
<td>typically 1‚Äì10 seconds</td>
</tr>
</tbody>
</table>
<p>The next step is to create our calculated item.</p>
<hr />
<p><strong>Calculated Item: P99 Network Latency (15 minutes)</strong></p>
<p>For effective trend analysis and anomaly detection, the system aggregates the
ICMP response times to derive the $99^{th}$ percentile using the last 15 minutes
of collected data.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>Network Latency P99 (15m)</td>
</tr>
<tr>
<td>Type</td>
<td>Calculated</td>
</tr>
<tr>
<td>Key</td>
<td>icmppingsec.p99 (example key)</td>
</tr>
<tr>
<td>Value type</td>
<td>Numeric (float)</td>
</tr>
<tr>
<td>Units</td>
<td>s</td>
</tr>
<tr>
<td>Update interval</td>
<td>30‚Äì60 seconds</td>
</tr>
</tbody>
</table>
<p><strong>Formula:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch04-zabbix-collecting-data-calculated-__codelineno-3-1"></a>percentile<span class="o">(</span>/&lt;HOST&gt;/icmppingsec<span class="o">[</span>&lt;target-IP&gt;<span class="o">]</span>,15m,99<span class="o">)</span>
</span></code></pre></div>
<p>With the monitoring item now collecting data, our immediate next step is to define
a trigger. This trigger will allow Zabbix to notify us instantly if the defined
threshold for network quality degradation is breached.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch04-zabbix-collecting-data-calculated-__codelineno-4-1"></a>last(/&lt;HOST\&gt;/icmppingsec.p99)&gt;0.150
</span></code></pre></div>
<p>This will alert us if the P99 ping latency goes above 150 ms.</p>
<h4 id="ch04-zabbix-collecting-data-calculated-what-this-trigger-detects">What This Trigger Detects</h4>
<p>This is not a simple reachability check (up/down).
This trigger detects:</p>
<ul>
<li>Congestion</li>
<li>Bufferbloat</li>
<li>Packet-queue delays</li>
<li>Bursty latency</li>
<li>Intermittent slow responses</li>
<li>Micro-outages impacting users</li>
</ul>
<p>It measures quality, not availability.
Average latency might look fine, but P99 tells you:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch04-zabbix-collecting-data-calculated-__codelineno-5-1"></a>‚Äú1%<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>packets<span class="w"> </span>are<span class="w"> </span>delayed<span class="w"> </span>more<span class="w"> </span>than<span class="w"> </span><span class="m">150</span><span class="w"> </span>ms<span class="w"> </span>‚Äî<span class="w"> </span>users<span class="w"> </span>notice<span class="w"> </span>this.‚Äù
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch04-zabbix-collecting-data-calculated-__codelineno-5-2"></a>or
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch04-zabbix-collecting-data-calculated-__codelineno-5-3"></a>This<span class="w"> </span>trigger<span class="w"> </span>fires<span class="w"> </span><span class="k">if</span><span class="w"> </span>the<span class="w"> </span>worst<span class="w"> </span>latency<span class="w"> </span><span class="o">(</span>top<span class="w"> </span><span class="m">1</span>%<span class="o">)</span><span class="w"> </span>over<span class="w"> </span>the<span class="w"> </span>last<span class="w"> </span><span class="m">15</span><span class="w"> </span>minutes<span class="w"> </span>is<span class="w"> </span>higher<span class="w"> </span>than<span class="w"> </span><span class="m">150</span><span class="w"> </span>ms.
</span></code></pre></div>
<p>This is far more meaningful for:</p>
<ul>
<li>Internet links</li>
<li>VPNs</li>
<li>WiFi infrastructure</li>
<li>Cloud interconnects</li>
<li>SD-WAN</li>
<li>VoIP/Video systems</li>
</ul>
<p>If we now go to latest data page we can take a look at our item and click on the
graph button at the end of the screen.</p>
<p><img alt="calculated/../ch04-zabbix-collecting-data/calculated/ch04.61-calculated-p99.png" src="../ch04-zabbix-collecting-data/calculated/ch04.61-calculated-p99.png" /></p>
<p><em>p99 graph</em></p>
<p>We now have a nice overview of the quality of our network thanks to our
calculated item. Now that we have seen how to create calculated items lets have
a look at aggregated items.</p>
<h2 id="ch04-zabbix-collecting-data-calculated-aggregated-items">Aggregated items</h2>
<p>Now that we've seen how Calculated Items allow us to perform mathematical operations
on data from a single host (like determining the P99 latency on one server), the
next logical step is to consider the wider picture: network-wide or service wide
performance.</p>
<p>This is where <strong>Aggregated Items</strong> come into play.</p>
<p><strong>What are Aggregated Items?</strong>
Simply put, an Aggregated Item gathers and processes data from multiple hosts,
host groups, or even other items across your entire monitored environment.</p>
<p>Think of it as the tool you use to calculate the health of an entire service for
instance, the average web server CPU load across your farm, or the total available
disk space for all hosts in your "Database Servers" group.</p>
<p>Aggregated Items enable the collection of crucial metrics that are inherently
distributed. They perform functions like:</p>
<ul>
<li><strong>Average (avg):</strong> The mean value across a set of items.</li>
<li><strong>Sum (sum):</strong> The total combined value (e.g., total incoming traffic).</li>
<li><strong>Minimum (min) / Maximum (max):</strong> The worst or best value recorded across the group.</li>
<li><strong>Count (count):</strong> The number of items that match a specific criteria (e.g., how many servers are currently unavailable).</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Item Type</th>
<th style="text-align: left;">Scope of Data</th>
<th style="text-align: left;">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Calculated</td>
<td style="text-align: left;">Single Host (or Item)</td>
<td style="text-align: left;">Mathematical transformation (e.g., P99, Rate of Change).</td>
</tr>
<tr>
<td style="text-align: left;">Aggregated</td>
<td style="text-align: left;">Multiple Hosts/Groups</td>
<td style="text-align: left;">Statistical combination (e.g., Average, Sum, Max).</td>
</tr>
</tbody>
</table>
<p>In short, while Calculated Items help you interpret the metric for one specific
device, Aggregated Items help you determine the collective status of a group of
devices or an entire service.</p>
<h3 id="ch04-zabbix-collecting-data-calculated-configuration-of-aggregated-items">Configuration of Aggregated Items</h3>
<p>Aggregated Items use a special <strong>item key</strong> that differs significantly from standard
data collection methods. Instead of defining a specific check (like <code>icmpping</code>),
you define a calculation that operates over a set of other items.</p>
<p>The general format for an Aggregated Item key is:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch04-zabbix-collecting-data-calculated-__codelineno-6-1"></a>&lt;aggregation_function&gt;[&lt;target_selector&gt;,&lt;item_key&gt;,&lt;time_shift&gt;]
</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Aggregation Function</strong></td>
<td style="text-align: left;">The statistical operation to perform (e.g., <code>avg</code>, <code>sum</code>, <code>max</code>, <code>min</code>, <code>count</code>, <code>foreach</code>).</td>
<td style="text-align: left;"><code>avg</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Target Selector</strong></td>
<td style="text-align: left;">Defines the scope of the aggregation: the hosts or groups to include.</td>
<td style="text-align: left;"><code>group:"Web Servers"</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Item Key</strong></td>
<td style="text-align: left;">Specifies the exact item to aggregate across the targets.</td>
<td style="text-align: left;"><code>system.cpu.load[all,avg1]</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Time Shift (Optional)</strong></td>
<td style="text-align: left;">A time window to shift the data collection back (for comparison).</td>
<td style="text-align: left;"><code>1h</code> (1 hour ago)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="ch04-zabbix-collecting-data-calculated-practical-examples-of-aggregated-items">Practical Examples of Aggregated Items</h3>
<p>Here are several common scenarios demonstrating how to define these powerful global metrics:</p>
<h4 id="ch04-zabbix-collecting-data-calculated-example-1-total-free-space-across-a-group">Example 1: Total Free Space Across a Group</h4>
<p><strong>Goal:</strong> Monitor the collective available disk space for all hosts in the
"Database Cluster" group to prevent a system-wide outage.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Configuration</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;"><code>sum[group:"Database Cluster",vfs.fs.size[/,,free]]</code></td>
<td style="text-align: left;">This key <strong>SUMS</strong> the free space (<code>vfs.fs.size[/,,free]</code>) from every host in the group.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Units</strong></td>
<td style="text-align: left;"><code>B</code> (Bytes)</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h4 id="ch04-zabbix-collecting-data-calculated-example-2-average-cpu-load-for-a-service">Example 2: Average CPU Load for a Service</h4>
<p><strong>Goal:</strong> Determine the overall average CPU load experienced by your primary web
service, which is running across the "Production Web" group.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Configuration</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;"><code>avg[group:"Production Web",system.cpu.load[all,avg1]]</code></td>
<td style="text-align: left;">This calculates the <strong>AVERAGE</strong> 1-minute CPU load across all servers in the group.</td>
</tr>
</tbody>
</table>
<h4 id="ch04-zabbix-collecting-data-calculated-example-3-counting-conditional-items-with-foreach">Example 3: Counting Conditional Items with <code>foreach</code></h4>
<p>The <strong><code>foreach</code></strong> function is a highly flexible tool that allows you to calculate
statistics based on a <strong>condition</strong> within the target set. Instead of aggregating
every item, you can aggregate only those that meet certain criteria.</p>
<p><strong>Goal:</strong> Count how many Linux hosts in the "All Servers" group currently have a
high CPU load (load average &gt; 4).</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Configuration</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;"><code>count[group:"All Servers",system.cpu.load[all,avg1],last,0,gt,4]</code></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of Information</strong></td>
<td style="text-align: left;">Numeric (integer)</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Units</strong></td>
<td style="text-align: left;"><code>hosts</code></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>In the example above, the <code>count</code> function is performed on the results of the
<code>foreach</code> mechanism (implied by the filters):</p>
<ul>
<li>It checks every host in <code>group:"All Servers"</code> for the item <code>system.cpu.load[all,avg1]</code>.</li>
<li>The final filters (<code>gt,4</code>) ensure the function only counts hosts where the
<strong>latest</strong> (<code>last</code>) value is <strong>greater than</strong> (<code>gt</code>) <strong>4</strong>. This gives you a clear
count of servers currently under heavy load.</li>
</ul>
<hr />
<h3 id="ch04-zabbix-collecting-data-calculated-other-aggregate-functions">Other Aggregate Functions</h3>
<p>Zabbix supports a wide array of aggregate functions beyond the basics shown here,
including statistics like standard deviation (<code>stddevpop</code>) and more specialized
counting and filtering.</p>
<p>For a complete list of all supported aggregate functions, including detailed syntax
and examples for <code>foreach</code>, consult the official Zabbix documentation.</p>
<h4 id="ch04-zabbix-collecting-data-calculated-troubleshooting-calculated-items">Troubleshooting Calculated Items</h4>
<ol>
<li>How to best troubleshoot unsupported calculated items.</li>
</ol>
<p><strong>Always Check first:</strong></p>
<ul>
<li>Does the formula reference items that do not exist?</li>
<li>Are value types compatible?</li>
<li>Does the function return something numeric?</li>
</ul>
<ol start="2">
<li>When you have incorrect values</li>
</ol>
<p><strong>Check :</strong></p>
<ul>
<li>Unit mismatch (bytes vs bits)</li>
<li>Wrong interval compared to source data</li>
<li>Missing parentheses in expression</li>
</ul>
<ol start="3">
<li>No Graphs Displaying</li>
</ol>
<p><strong>Ensure :</strong></p>
<ul>
<li>Value type is numeric</li>
<li>Units are properly set</li>
<li>History/trends retention is not zero</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-calculated-conclusion">Conclusion</h2>
<p>This chapter marks a critical turning point in our monitoring journey. We moved
beyond simply collecting raw data and focused on the true value of a robust system:
<strong>data transformation and interpretation.</strong> </p>
<p>Key Takeaways
- <strong>Percentile Power:</strong> We established that relying on average metrics can
  dangerously obscure intermittent performance issues like microbursts and congestion.
  Techniques like calculating the $99^{th}$ percentile ($P99$) with a Calculated
  Item provide a far more accurate representation of actual user experience and
  true network quality.
- <strong>Calculated Items:</strong> These tools allow us to apply complex mathematical logic,
  transformations, and filters to data collected from a single host, turning raw
  response times into actionable quality scores.
- <strong>Aggregated Items:</strong> We extended our view beyond the individual host by configuring
  Aggregated Items. Using functions like avg, sum, and the powerful conditional
  logic of foreach, we learned how to unify metrics from entire host groups or
  services to derive crucial metrics like service-wide free space or the total
  count of unhealthy hosts.</p>
<p>By mastering these two item types, you gain the ability to define metrics that
directly correlate with your business objectives not just the underlying machine
statistics. You can now build alerts and dashboards that clearly expose the health
of your entire infrastructure or service stack, replacing vague metrics with
concrete, measurable KPIs.</p>
<h2 id="ch04-zabbix-collecting-data-calculated-questions">Questions</h2>
<ul>
<li>What is the primary difference in data scope between a Calculated Item and an
  Aggregated Item?</li>
<li>If you wanted to track the rate of change (the difference between the last two
  readings) of a host's disk space, which type of Zabbix item would you use, and why?</li>
<li>Explain the purpose of the foreach function in Zabbix aggregation. How does it
  allow you to achieve a goal that a simple avg or sum function cannot?</li>
<li>You need to calculate the total incoming network traffic for all devices in
  the "Core Routers" host group. Write the correct Aggregated Item key using the
  sum function, assuming the item key for incoming traffic is net.if.in[eth0]</li>
</ul>
<h2 id="ch04-zabbix-collecting-data-calculated-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/appendix/functions/aggregate#aggregate-functions-1">https://www.zabbix.com/documentation/current/en/manual/appendix/functions/aggregate#aggregate-functions-1</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/calculated">https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/calculated</a></li>
</ul></section></section>
                    <section class='print-page md-section' id='section-10' heading-number='10'>
                        <h1>Chapter 05 : Triggers<a class='headerlink' href='#section-10' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch05-zabbix-triggers-chapter" heading-number="10.1"><h1 id="ch05-zabbix-triggers-chapter-setting-up-triggers">Setting up triggers</h1>
<p>In this chapter, we'll <strong>explore triggers in depth</strong>, starting with the basics
of setting up step triggers and progressively moving into <strong>advanced trigger configurations</strong>.
You'll gain a thorough understanding of how triggers work, ensuring you can leverage
them effectively to monitor your infrastructure.</p>
<p>We'll take a <strong>deep dive into the mechanics of triggers</strong>, examining how they evaluate
conditions and generate alerts. This section will also address the important topic
of <strong>monitoring and alerting fatigue</strong>, providing strategies to fine-tune your triggers
to reduce unnecessary alerts while maintaining optimal system oversight.</p>
<p>By the end, you'll have the knowledge to set up both simple and complex triggers,
helping you maintain a well balanced monitoring system that minimizes noise and
focuses on what truly matters.</p></section><section class="print-page" id="ch05-zabbix-triggers-triggers" heading-number="10.2"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="triggers">Triggers</h1>
<p>In the previous chapter we have been hard at work to collect our data from various
monitoring targets. Because of that our Zabbix environment is filled with useful
and important information about our IT infrastructure. However, when you want to
know something about your various different devices and applications you have to
go through a mountain of data. This is where triggers come in.</p>
<p>Triggers in Zabbix work as a way for us to collect a mountain worth of data, while
being alerted about what's important. It allows us to set our own expressions that
will define exactly when Zabbix should log and alert us about something happening
with our data. The easiest example being something like a CPU going to 90% utilization.</p>
<h2 id="ch05-zabbix-triggers-triggers-preparing-the-environment">Preparing the environment</h2>
<p>In the previous chapter we created some hosts to monitor the active Zabbix agent,
which are great for some example triggers. We created this host under the hostname
<code>zbx-agent-active-rocky</code> or <code>zbx-agent-active-windows</code>, either should work for
the example. We also should already have an item on this host to monitor the <code>Zabbix agent ping</code>
with item key <code>agent.ping</code>. Let's add one item to our <code>zbx-agent-active-*</code> host,
specifically to monitor the CPU load in percentage.</p>
<p><img align="center" alt="Zabbix Agent active CPU util" src="../ch05-zabbix-triggers/triggers/ch05.1-cpu-util-item.png" /></p>
<p><em>5.1 Zabbix Agent active CPU util item</em></p>
<p>Let's not forget to add the tag.</p>
<p><img align="center" alt="Zabbix Agent active CPU util tag" src="../ch05-zabbix-triggers/triggers/ch05.2-cpu-util-item-tag.png" /></p>
<p><em>5.2 Zabbix Agent active CPU util item tag</em></p>
<p>With this item created, we have two great examples on our Zabbix agent active host
for creating some basic triggers.</p>
<h2 id="ch05-zabbix-triggers-triggers-trigger-creation">Trigger creation</h2>
<p>Let's now create two very common triggers in our Zabbix environment. Go to <code>Data collection | Hosts</code>
and navigate to either your Linux or Windows <code>zbx-agent-active-*</code> host and click
on <code>Triggers</code>. In the top right corner you can now click on <code>Create trigger</code> to
start.</p>
<p><img align="center" alt="Empty trigger creation form" src="../ch05-zabbix-triggers/triggers/ch05.3-trigger-empty-top.png" /></p>
<p><em>5.3 Empty trigger creation form</em></p>
<p>To start with the basics we can see the follow information at the top part of our
trigger creation form.</p>
<ul>
<li><strong>Name</strong></li>
<li><strong>Event name: The name of the event and problem you will see Monitoring | Problems</strong></li>
<li><strong>Operational data</strong></li>
<li><strong>Severity</strong></li>
<li><strong>Expression</strong></li>
<li><strong>OK event generation</strong></li>
</ul>
<h3 id="ch05-zabbix-triggers-triggers-name">Name</h3>
<p>The name of the trigger is important as it will be used for the name of our events
and problems created from this trigger. For example if you would navigate to <code>Monitoring | Problems</code>,
the triggers you see here will probably have the same name as a trigger.</p>
<p>It doesn't have to be unique, meaning we can have multiple triggers with the same
name. As long as the combination of <code>Name</code> and <code>Expression</code> is unique.</p>
<p>Let's fill in <code>Zabbix agent not seen for &gt;5m</code>.</p>
<h3 id="ch05-zabbix-triggers-triggers-event-name">Event name</h3>
<p>The <code>Event name</code> is very similar to the <code>Name</code> field, as it will be used to name
the events and problems created from this trigger. However, when <code>Event name</code>
is used, the <code>Name</code> field will no longer form the name of events and problems.
<code>Event name</code> serves as an override for the <code>Name</code> field.</p>
<p>The <code>Event name</code> field allows us to create longer and used more extensive macro
functionality compared to the <code>Name</code> field. This is why it can be useful in some
scenarios, but it is not mandatory to use it.</p>
<p>Let's leave this empty for now.</p>
<h3 id="ch05-zabbix-triggers-triggers-operational-data">Operational data</h3>
<p>Whenever we create a trigger, once the trigger goes into a problem state it will
create a problem event in the background within Zabbix. This problem event in term
then creates a <code>Problem</code> in Zabbix which we can find under <code>Monitoring | Problems</code>.
It's important to keep in mind that event and problem names are always static. Even
when the trigger name or trigger event name is updated later, existing event and
problems will not get a new name until they resolve and go into problem state again.</p>
<p>This is where <code>Operational data</code> becomes useful. It can be used to show dynamic
information next to your problem names. This will allow you to for example use
a macro like <code>{ITEM.LASTVALUE}</code> to always show the latest item value related to
this triggers item(s).</p>
<p>Let's fill in <code>{ITEM.VALUE}</code> and <code>{ITEM.LASTVALUE}</code></p>
<h3 id="ch05-zabbix-triggers-triggers-severity">Severity</h3>
<p>This field is mandatory, as it is a selector we have to pick something with. By
default Zabbix sets it to <code>No classified</code>, which is a severity rarely used outside
of Zabbix internal problems. Instead we often pick one of the other 5 severities
to indicate how important a problem created from this trigger is.</p>
<p>For example, <code>Informational</code> is often used to indicate something we just want to
log. Specifically, often <code>Informational</code> is something we do not necessarily want
to see on our dashboards or receive external alerts from. <code>Disaster</code> on the other
end however is often used to indicate something that requires immediate attention.
The <code>Warning</code>, <code>Average</code> and <code>High</code> severities can be used to classify anything
in between. My favourite basic setup usually looks like below.</p>
<ul>
<li><strong>Informational: Just for logging and not showing on dashboards</strong></li>
<li><strong>Warning: Requires attention, shown on dashboards</strong></li>
<li><strong>Average: Requires more immediate attention, send out email or Slack/Teams message</strong></li>
<li><strong>High: Requires attention even out of office hours, send SMS or Signal message</strong></li>
<li><strong>Disaster: Problem with severe implications to the business, possible higher SMS or Signal escalation</strong></li>
</ul>
<p>This is of course just an example of how you could use the different severities
and it will depend on your organisation and setup if this is actually implemented
as such. The key here is that the severity can be used later to filter in various
locations. Like dashboards for showing problems and actions for sending out alerts.</p>
<p>Let's select <code>High</code> for now.</p>
<h3 id="ch05-zabbix-triggers-triggers-expression">Expression</h3>
<p>The expression of the trigger is arguably the most important part. This is where
we are going to define exactly how our trigger will detect the problem. Zabbix
comes with many different functions to detect problems in an almost unlimited number
of ways. But the basis is simple.</p>
<p>We collect values from an <code>Item</code> using a <code>Function</code> applied to a number of values
or time period (namely <code>Last of (T) Count/Time</code>). To this collect set of values
we set a operator and constant (namely <code>Result</code>) to indicate what we want the
result of our expression to be. This is in the end a whole lot of words to say,
more simply put, we select and item to collect values from and then state what
we want those values to look like to show a problem in Zabbix.</p>
<p>Let's click on the <code>Add</code> button now an used the expression builder. For <code>Item</code> we
select <code>Zabbix agent ping</code>, for <code>Function</code> we select <code>nodata</code>, for <code>Last of (T)</code>
we set <code>5m</code> and for <code>Result</code> we set <code>= 1</code>. Then press <code>Insert</code> to automatically
create the expression below.</p>
<p><img align="center" alt="Example trigger expression" src="../ch05-zabbix-triggers/triggers/ch05.4-trigger-expression-example.png" /></p>
<p><em>5.4 Example trigger expression</em></p>
<p>The expression is now built automatically and we do not need to write the whole
syntax correctly ourselves. This trigger will now detect if <code>nodata</code> (is true <code>=1</code>)
has been received on the item <code>agent.ping</code> for host <code>zbx-agent-active-rocky</code> (or
<code>zbx-agent-active-windows</code> if you used that instead). It will only detect that
however if <code>nodata</code> was received for more than 5 minutes (<code>,5m</code>).</p>
<p>The <code>nodata</code> function used in this trigger is a bit special, as it specifically
can trigger if no data was received (true <code>=1</code>) or if data was received (false <code>=0</code>)
over a time period. This is what we call a time based trigger in Zabbix, whereas
most other triggers only trigger when an item receives data instead. More on those
later.</p>
<h3 id="ch05-zabbix-triggers-triggers-ok-event-generation">OK event generation</h3>
<p>In the case of this trigger, <code>OK event generation</code> is set to <code>Expression</code>. This
means that the trigger expression will simply use the existing problem <code>Expression</code>
to detect when the trigger creates an <code>OK</code> event. With our <code>nodata</code> trigger this
will be whenever data has been received again, as the no data for 5 minutes will
no longer be true.</p>
<p>In short:</p>
<ul>
<li><strong>Trigger expression is true: Problem event is created and problem starts</strong></li>
<li><strong>Trigger expression is false: OK event is generated and existing problem resolves</strong></li>
</ul>
<p>Our trigger should now look like the image below.</p>
<p><img align="center" alt="Zabbix agent not seen for 5m trigger" src="../ch05-zabbix-triggers/triggers/ch05.5-trigger-01-example.png" /></p>
<p><em>5.5 Zabbix agent not seen for 5m trigger</em></p>
<p>Let's not forget to also add a tag to this trigger. On triggers in Zabbix the best
practice is to create a <code>Scope</code> tag to indicate what the trigger is going to be
about. We usually pick on of 5 options.</p>
<ul>
<li><strong>availability</strong></li>
<li><strong>performance</strong></li>
<li><strong>notification</strong></li>
<li><strong>security</strong></li>
<li><strong>capacity</strong></li>
</ul>
<p><img align="center" alt="Zabbix agent not seen for 5m trigger tag" src="../ch05-zabbix-triggers/triggers/ch05.6-trigger-01-example-tag.png" /></p>
<p><em>5.6 Zabbix agent not seen for 5m trigger tag</em></p>
<p>We can now click on the <code>Add</code> button at the bottom of the form and our trigger is done! If we stop our Zabbix agent with <code>systemctl stop zabbix-agent2</code> we should get a new problem after 5 minutes.</p>
<h2 id="ch05-zabbix-triggers-triggers-another-trigger">Another trigger</h2>
<p>Before we stop our chapter here though, let's go through one more trigger example. We also created a new item to monitor the monitoring target CPU utilization. A perfect example for another trigger. Let's create it like the image below.</p>
<p><img align="center" alt="CPU utilization over 90% trigger" src="../ch05-zabbix-triggers/triggers/ch05.7-trigger-02-example.png" /></p>
<p><em>5.7 CPU utilization over 90% trigger</em></p>
<p>Don't forget to add the tag <code>scope:performance</code> and then add the trigger by clicking the <code>Add</code> button at the bottom of the form.</p>
<p>Breaking down this expression we can see a very similar setup as the previous trigger. But this is not a time based trigger and it will not trigger based on a simple data being received or not. Instead this trigger uses the function <code>min</code> over a time period of 3 minutes (<code>3m</code>) and with the operator and constant <code>=&gt;90</code>.</p>
<p>Simply put, this trigger will be evaluated every time new data is received on the item <code>proc.cpu.util</code>. We created that item earlier, with an update interval of 1 minute (<code>1m</code>). In a time period of 3 minutes that means we could have received the following.</p>
<ul>
<li><strong>95%</strong></li>
<li><strong>80%</strong></li>
<li><strong>99%</strong></li>
</ul>
<p>In this case, the CPU utilization is spiking shortly over 90%. The problem however will not start, because we used the <code>min</code> function. Function <code>min</code> and <code>max</code> are some of the most useful function in Zabbix, as they can be used to filter spikes and drops respectively. Since we used <code>min</code> in our expression, the result will be <code>80%</code> as that is the minimum (smallest) value in our 3 minute time period. If our data looked like below however, the result would be different.</p>
<ul>
<li><strong>90%</strong></li>
<li><strong>99%</strong></li>
<li><strong>97%</strong></li>
</ul>
<p>In this case our minimum value is <code>90%</code>, which is indeed equal to or higher than 90 as stated in the expression with <code>=&gt;90</code>.</p>
<h2 id="ch05-zabbix-triggers-triggers-conclusion">Conclusion</h2>
<p>Triggers in Zabbix can be used to detect problems and automatically resolved them based on the data received on items in Zabbix. We do not have to create triggers for all of our items in Zabbix (see Zabbix dataflow in the previous chapter), but they can be useful on important data.</p>
<p>A few more tips to keep in mind when working with triggers. Make sure to keep your severities setup correctly, as this is one of the most important parameters for filtering later. They are very important to create alerting correctly later.</p>
<p>It is also a good idea to keep your trigger names short and descriptive. <code>CPU utilization &gt;90%</code> is a lot easier to understand than <code>CPU utilization on the server has been over 90% for the past three minutes</code>. People are usually in a rush, especially when there is a problem with IT infrastructure. The more reading you have to do in that situation, the less likely you are to see the issue straight away.</p>
<p>The best tip regarding triggers? A good trigger shows you the problem. A great trigger instantly makes you think of where to go and what to do to solve it.</p>
<h2 id="ch05-zabbix-triggers-triggers-questions">Questions</h2>
<h2 id="ch05-zabbix-triggers-triggers-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch05-zabbix-triggers-advanced-triggers" heading-number="10.3"><nav class='md-tags'><span class='md-tag'>expert</span></nav><h1 id="advanced-triggers">Advanced triggers</h1></section></section>
                    <section class='print-page md-section' id='section-11' heading-number='11'>
                        <h1>Chapter 06 : Templates<a class='headerlink' href='#section-11' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch06-zabbix-templates-chapter" heading-number="11.1"><h1 id="ch06-zabbix-templates-chapter-building-and-using-templates">Building and using templates</h1>
<p>A great way to guide users towards a <strong>deeper understanding of Zabbix</strong> is by
initially holding off on templates and gradually introducing them much like in
formal training. In this chapter, we'll start by explaining the <strong>basic usage
of default templates</strong> and how to find new ones, helping you get up and running
with minimal effort.</p>
<p>Once you're comfortable with default templates, we‚Äôll dive into <strong>building your
own templates</strong>, offering detailed instructions on customization and best practices.
We‚Äôll also cover how to <strong>share your templates</strong> within the Zabbix community,
fostering collaboration and knowledge exchange.</p>
<p>To round off, we'll feature <strong>Tags and Macros</strong>, explaining their roles within
templates and why they're most effective when understood in the context of
template usage. This structured approach will ensure you grasp the full potential
of templates and their associated features in Zabbix.</p>
<p>By the end of this chapter, you'll be well versed in both using and creating templates,
equipped to enhance your monitoring setup and contribute to the broader Zabbix ecosystem.</p></section><section class="print-page" id="ch06-zabbix-templates-templates" heading-number="11.2"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="working-with-templates">Working with templates</h1>
<p>Templates are one of the most fundamental building blocks in Zabbix. They define
what and how to monitor, and serve as reusable configuration blueprints that can
be applied to any number of hosts. By grouping related items, triggers, graphs,
discovery rules, and macros into a single logical entity, templates make it possible
to standardize and scale monitoring efficiently.</p>
<p>Zabbix 8.0 emphasizes a monolithic, self contained design. While template linking
is still supported for compatibility, the recommended approach is to use standalone
templates for simplicity and portability. A deliberate departure from the older
inheritance based approach. used in previous versions. This design philosophy makes
templates easier to export, share, and maintain, especially when managing multiple
environments or distributing monitoring logic across teams.</p>
<details class="info" open="open">
<summary>Fun fact</summary>
<p>In earlier releases such as Zabbix 3.0, there were only around 30‚Äì40 built-in
templates available out of the box. In contrast, Zabbix 8.0 ships with hundreds
of official templates and integrations, covering everything from operating systems
and databases to cloud platforms and network devices. This dramatic growth
highlights how Zabbix has evolved into a full-featured monitoring ecosystem
with native support for nearly any technology stack.</p>
</details>
<h2 id="ch06-zabbix-templates-templates-template-fundamentals">Template Fundamentals</h2>
<p>A template in Zabbix encapsulates all the elements required to monitor a specific
technology or system. This can range from a simple operating system agent to a
complex multi-layer application such as PostgreSQL, VMware, or Kubernetes.</p>
<p>Each template can include:</p>
<ul>
<li><strong>Items:</strong> definitions of data to collect (e.g., system.cpu.load, vfs.fs.size[/,free]).</li>
<li><strong>Triggers:</strong> logical expressions that evaluate collected data to identify problem
  conditions.</li>
<li><strong>Graphs:</strong> visual representations of collected metrics.</li>
<li><strong>Discovery Rules:</strong> automated mechanisms to detect entities (like filesystems
  or interfaces) and dynamically create item prototypes.</li>
<li><strong>Value Maps:</strong> mappings that translate raw data into human-readable text.</li>
<li><strong>Macros:</strong> reusable variables that make templates configurable and environment
  agnostic.</li>
<li><strong>Tags:</strong> metadata used for filtering, correlation, and alert routing.</li>
<li><strong>Dashboards:</strong> predefined visualization layouts attached to the template.</li>
</ul>
<p>Templates are linked to hosts to apply these monitoring definitions. Once linked,
the host immediately inherits all monitoring logic from the template.</p>
<h2 id="ch06-zabbix-templates-templates-the-monolithic-template-model">The Monolithic Template Model</h2>
<p>Before Zabbix 6.x, templates could be built hierarchically, using inheritance between
parent and child templates. While powerful, this approach often led to dependency
complexity, version mismatches, and export/import challenges.</p>
<p>Starting with Zabbix 6.4 and refined in 7.x, the preferred design is monolithic
templates meaning each template is self contained and does not rely on inheritance.
This makes templates easier to:</p>
<ul>
<li>Export and share as standalone YAML files.</li>
<li>Version control in Git or CI/CD environments.</li>
<li>Import without dependency conflicts.</li>
</ul>
<p>Monolithic templates are also simpler to maintain, as all configuration elements
are defined within one object, avoiding the ‚Äútemplate chain‚Äù problem where one
missing dependency breaks the import process.</p>
<h3 id="ch06-zabbix-templates-templates-template-uuids">Template UUIDs</h3>
<p>Starting with Zabbix 6.2, every configuration entity, including templates, is
assigned a Universally Unique Identifier (UUID). This fundamentally changed how
Zabbix tracks and synchronizes configuration objects across different environments.</p>
<h4 id="ch06-zabbix-templates-templates-purpose-of-uuids">Purpose of UUIDs</h4>
<p>Before UUIDs were introduced, Zabbix relied on template names to identify and match
templates during import/export. This created issues when two templates had identical
names or when renaming templates between environments.</p>
<p>UUIDs solve this problem by providing a persistent, globally unique reference for
each template, independent of its name or internal database ID.</p>
<h4 id="ch06-zabbix-templates-templates-benefits">Benefits</h4>
<ul>
<li><strong>Reliable synchronization:</strong> Imports and updates use the UUID, preventing duplication
  and mismatched merges.</li>
<li><strong>Conflict prevention:</strong> Avoids overwriting templates with the same name.</li>
<li><strong>Version-control stability:</strong> Git-based workflows can track the same object
  across environments.</li>
<li><strong>Improved automation:</strong> APIs and pipelines can safely address templates by UUID
  rather than numeric IDs.</li>
</ul>
<p>Example YAML template:</p>
<div class="language-YAML highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch06-zabbix-templates-templates-__codelineno-0-1"></a><span class="nt">zabbix_export</span><span class="p">:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch06-zabbix-templates-templates-__codelineno-0-2"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;8.0&#39;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch06-zabbix-templates-templates-__codelineno-0-3"></a><span class="w">  </span><span class="nt">templates</span><span class="p">:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch06-zabbix-templates-templates-__codelineno-0-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uuid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">a4c1d0f2d7de4a40a8b347afeb9a88df</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch06-zabbix-templates-templates-__codelineno-0-5"></a><span class="w">      </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Template</span><span class="nv"> </span><span class="s">OS</span><span class="nv"> </span><span class="s">Rocky</span><span class="nv"> </span><span class="s">Linux&#39;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch06-zabbix-templates-templates-__codelineno-0-6"></a><span class="w">      </span><span class="nt">groups</span><span class="p">:</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch06-zabbix-templates-templates-__codelineno-0-7"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Templates/Operating</span><span class="nv"> </span><span class="s">Systems/Linux&#39;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch06-zabbix-templates-templates-__codelineno-0-8"></a><span class="w">      </span><span class="nt">items</span><span class="p">:</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch06-zabbix-templates-templates-__codelineno-0-9"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uuid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">f0c1b836c81d4bba9419dc12bce7e411</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ch06-zabbix-templates-templates-__codelineno-0-10"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;System</span><span class="nv"> </span><span class="s">uptime&#39;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ch06-zabbix-templates-templates-__codelineno-0-11"></a><span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;system.uptime&#39;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ch06-zabbix-templates-templates-__codelineno-0-12"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ZABBIX_AGENT</span>
</span></code></pre></div>
<details class="info" open="open">
<summary>Behavior and Persistence</summary>
<p>The UUID remains constant even if the template is renamed or moved between
groups. However, when a template is cloned or copied, Zabbix generates new
UUIDs for the template and all of its entities. This ensures the cloned template
is treated as a distinct object and does not conflict with the original during
import, export, or API synchronization.</p>
</details>
<h4 id="ch06-zabbix-templates-templates-what-happens-when-you-clone-a-template">What Happens When You Clone a Template</h4>
<p>When you clone or copy a template (for example, to customize it), Zabbix creates
a completely new object. All nested entities like items, triggers, discovery rules,
dashboards, etc. will receive new UUIDs.</p>
<p>This means your cloned template is independent:</p>
<ul>
<li>It will not overwrite the original during imports.</li>
<li>It can coexist safely even if it has a similar name.</li>
<li>It is ideal for creating customized variants of official templates.</li>
</ul>
<details class="note" open="open">
<summary>Note</summary>
<p>If you manually remove or alter UUIDs in the YAML file, Zabbix treats it as
a new object on import.</p>
</details>
<details class="info" open="open">
<summary>Best practice</summary>
<p>Add a suffix or prefix such as (Custom) to distinguish cloned templates and
document their origin in the template notes like:
- Origin: Linux by Zabbix agent
- Based on UUID: a4c1d0f2d7de4a40a8b347afeb9a88df</p>
</details>
<h2 id="ch06-zabbix-templates-templates-template-groups">Template Groups</h2>
<p>Template groups in Zabbix are used for <code>organization</code> and <code>access control targeting</code>.
They provide a logical way to categorize templates (for example, Operating Systems,
Databases, Network Devices), but they do not themselves define access rights.</p>
<p>A template group itself does not carry permissions.
Instead, <code>user groups</code> are granted <code>permissions</code> on <code>template groups</code>.
These permissions determine whether members of a user group can view (read-only)
or modify (read-write) the templates contained within those groups when working
in the frontend.</p>
<p>In other words:</p>
<ul>
<li><strong>Template groups:</strong> organize and classify templates.</li>
<li><strong>User groups:</strong> hold the permissions that control access to those template groups.</li>
</ul>
<p>This model provides flexible role based access control (RBAC): administrators can
manage access centrally by assigning or revoking permissions for user groups
rather than editing individual templates.</p>
<p>If you like to make a new template group then they can be found under <code>Data collection</code>
‚Üí <code>Host groups</code> ‚Üí <code>Create template group</code></p>
<p><img alt="templates/../ch06-zabbix-templates/templates/ch06.01-template-group.png" src="../ch06-zabbix-templates/templates/ch06.01-template-group.png" /></p>
<h3 id="ch06-zabbix-templates-templates-permissions-and-access-control">Permissions and Access Control</h3>
<p>In Zabbix 8.0, access to templates is controlled by a combination of <code>user roles</code>
and <code>usergroup</code> permissions.</p>
<ul>
<li><strong>Roles</strong> define what actions a user can perform globally. Such as viewing problems,
  acknowledging events, or modifying configuration.</li>
<li><strong>User groups:</strong> define which objects the role can act on by granting <code>Read-only
  (RO)</code> or <code>Read-write (RW)</code> permissions to specific object groups (host groups,
  template groups, map groups, etc.).</li>
<li>Template groups are simply one of those object groups: a scope to which permissions
  can be applied.</li>
</ul>
<p>For example, a user role may allow configuration changes, but the user will only
be able to modify templates that belong to template groups where their user group
has RW access.</p>
<p>This separation provides precise control between what actions are allowed and where
they are allowed.</p>
<h4 id="ch06-zabbix-templates-templates-impact-of-template-permissions">Impact of template permissions</h4>
<p>Although template group permissions primarily govern configuration access, they
can also influence operational behavior in the frontend. When users view or interact
with problems, their ability to take certain actions depends both on their role
and their permissions for the underlying host or template.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Action</th>
<th style="text-align: center;">Read-only (RO)</th>
<th style="text-align: center;">Read-write (RW)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Acknowledge problem</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Add comment / update status</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Suppress problem</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Change problem severity</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Manually close problem</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Modify trigger severity</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
<tr>
<td style="text-align: left;">Edit or link templates</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
</tbody>
</table>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Read-only users can acknowledge or suppress issues but cannot change severity
or manually close problems.</p>
</details>
<p>As an example in Zabbix:</p>
<p>Consider two distinct user groups with different roles and permissions:</p>
<ul>
<li><strong>Operations (RO):</strong> Members can view hosts and problems, acknowledge or suppress
  issues, but cannot change severity levels or modify triggers.</li>
<li><strong>Monitoring Admins (RW):</strong> Members can edit templates, adjust trigger logic,
  and manually close problems.</li>
</ul>
<p>If both groups monitor hosts that use templates from Templates/Applications/Databases:</p>
<ul>
<li><strong>Operations:</strong> can acknowledge and suppress problems as part of daily triage.</li>
<li><strong>Monitoring Admins:</strong> can modify or tune the underlying template configuration
  when a systemic issue is detected.</li>
</ul>
<p>This segregation maintains stability. Operations staff can handle incidents, while
admins manage definitions.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>Template group permissions control configuration visibility, but operational
access (to data and problems) still depends on host group permissions.</p>
</details>
<h3 id="ch06-zabbix-templates-templates-permissions-and-roles-how-access-really-works">Permissions and Roles ‚Äì How Access Really Works</h3>
<p>Zabbix enforces permissions through user groups and roles, not through inheritance
between objects. There is no automatic propagation of permissions from template
groups to host groups or between templates and the hosts that use them.</p>
<ul>
<li>Roles determine what actions users may perform (view, edit, acknowledge,
  configure, etc.).</li>
<li>User groups determine where those actions may occur by assigning RO/RW/Deny
  rights on object groups.</li>
<li>Template groups and host groups are independent targets. A user with RW access
  to a host group does not automatically gain rights to the related template group,
  and vice versa.</li>
</ul>
<p>This clear separation ensures operational access (hosts) and configuration access
(templates) remain distinct, preventing unintended modifications.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>Roles (user, admin and super admin) define what you can do.
Usergroup permissions define where you can do it.</p>
</details>
<h3 id="ch06-zabbix-templates-templates-best-practices-for-permissions">Best Practices for Permissions</h3>
<ul>
<li><strong>Separate operational and design access:</strong> Grant RO rights to operations teams
  for monitoring, and RW rights to administrators maintaining templates.</li>
<li><strong>Align permissions logically:</strong> If a user group manages database hosts, grant
  them RW access to both the relevant host groups and the corresponding <code>Templates/Databases</code>
  group.</li>
<li><strong>Review permissions regularly:</strong> Periodically audit usergroup assignments to
  ensure only authorized teams have configuration privileges.</li>
<li><strong>Use clear naming conventions for groups:</strong> Distinguish functional scopes (Templates/OS/Linux)
  from organizational ones (Templates/Customers/Prod). This improves clarity when
  assigning permissions in large environments.</li>
</ul>
<h3 id="ch06-zabbix-templates-templates-template-subgroups">Template Subgroups</h3>
<p>Zabbix 3.2 introduced nested template groups (subgroups), enabling a hierarchical
structure similar to host groups. Subgroups allow administrators to build organized,
multi-level collections of templates, which improves navigation and permission
granularity.</p>
<p>Subgroups are created in Zabbix by adding a <code>/</code> in the group names. For example if we
want to create a group <code>Databases</code> as a subgroup of <code>Templates</code> then we only need
to create the new group like this: <code>Templates/Databases</code>. However it's
recommended to create <code>Templates</code> first.</p>
<p>Example hierarchy:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch06-zabbix-templates-templates-__codelineno-1-1"></a>Templates
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch06-zabbix-templates-templates-__codelineno-1-2"></a>‚îú‚îÄ‚îÄ Operating Systems
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch06-zabbix-templates-templates-__codelineno-1-3"></a>‚îÇ   ‚îú‚îÄ‚îÄ Linux
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch06-zabbix-templates-templates-__codelineno-1-4"></a>‚îÇ   ‚îú‚îÄ‚îÄ Windows
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ch06-zabbix-templates-templates-__codelineno-1-5"></a>‚îÇ   ‚îî‚îÄ‚îÄ Network Appliances
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ch06-zabbix-templates-templates-__codelineno-1-6"></a>‚îî‚îÄ‚îÄ Applications
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#ch06-zabbix-templates-templates-__codelineno-1-7"></a>    ‚îú‚îÄ‚îÄ Databases
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#ch06-zabbix-templates-templates-__codelineno-1-8"></a>    ‚îÇ   ‚îú‚îÄ‚îÄ PostgreSQL
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#ch06-zabbix-templates-templates-__codelineno-1-9"></a>    ‚îÇ   ‚îú‚îÄ‚îÄ MySQL
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#ch06-zabbix-templates-templates-__codelineno-1-10"></a>    ‚îÇ   ‚îî‚îÄ‚îÄ Oracle
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#ch06-zabbix-templates-templates-__codelineno-1-11"></a>    ‚îî‚îÄ‚îÄ Web Servers
</span></code></pre></div>
<ul>
<li><strong>Hierarchy for organization and permissions only:</strong> Subgroups do not change how
  templates link to hosts; they are purely structural.</li>
<li><strong>Automatic downward inheritance:</strong> If a user group has RW or RO access to a
  parent template group, that access automatically extends to all its existing
  subgroups. You can still assign explicit permissions on individual subgroups
  to override inherited rights.</li>
<li><strong>Parent-creation edge case:</strong> When you create a new parent group for an already
  existing subgroup (for example, creating Applications when Applications/Databases
  already exists), no permissions are automatically assigned to the new parent.
  Administrators must manually grant permissions on the parent group if required.</li>
<li><strong>Search and filtering benefits:</strong> The hierarchical view makes it easier to locate
  and manage templates in large environments.</li>
<li><strong>Consistency with host groups:</strong> Subgroup behavior and inheritance are identical
  for host groups and template groups, providing a uniform organizational model.</li>
</ul>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Use top-level groups for broad classifications (e.g., Templates/Applications)
and subgroups for vendor or technology specialization. Assign RW rights at
the top level for global administrators, and finer-grained access on subgroups
for specialized teams.</p>
</details>
<h2 id="ch06-zabbix-templates-templates-tags">Tags</h2>
<p>Tags are metadata elements used throughout Zabbix for event classification, filtering,
correlation, and alert routing. They attach semantic meaning to triggers, items,
or templates, helping to describe what the metric or event represents.</p>
<p><code>Data collection</code> ‚Üí <code>Templates</code> ‚Üí <code>Template</code> ‚Üí <code>Tags</code></p>
<p><img alt="templates/../ch06-zabbix-templates/templates/ch06.02-template-tags.png" src="../ch06-zabbix-templates/templates/ch06.02-template-tags.png" /></p>
<h3 id="ch06-zabbix-templates-templates-purpose-of-tags">Purpose of Tags</h3>
<ul>
<li><strong>Event correlation:</strong> tags are used by the event correlation engine to match
  or suppress related problems.</li>
<li><strong>Alerting and automation:</strong> tags appear in actions, allowing conditional notifications
  or escalations.</li>
<li><strong>Service mapping:</strong> tags link triggers and events to defined business services.</li>
<li><strong>Filtering:</strong> dashboards, reports, and API queries can filter by tag values.</li>
</ul>
<h3 id="ch06-zabbix-templates-templates-examples">Examples</h3>
<p>For a PostgreSQL database template:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch06-zabbix-templates-templates-__codelineno-2-1"></a><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch06-zabbix-templates-templates-__codelineno-2-2"></a><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span></code></pre></div></p>
<p>For a network device template:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch06-zabbix-templates-templates-__codelineno-3-1"></a><span class="nt">vendor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch06-zabbix-templates-templates-__codelineno-3-2"></a><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uplink</span>
</span></code></pre></div></p>
<h3 id="ch06-zabbix-templates-templates-some-good-practices-to-consider">Some good practices to consider</h3>
<ul>
<li>Use consistent naming for tag keys across templates (e.g., service, component,
  role).</li>
<li>Avoid over tagging; focus on attributes useful for filtering or alerting.</li>
<li>Use lower case, underscore separated keys for uniformity.</li>
</ul>
<h3 id="ch06-zabbix-templates-templates-tag-inheritance-and-merging-behavior">Tag Inheritance and Merging Behavior</h3>
<p>When templates are linked to hosts and hosts or items already define their own
tags ‚Äî Zabbix merges all tag sources into a single event level tag set.
Understanding this inheritance order is crucial for predictable alerting and correlation.</p>
<pre  class="mermaid"><code>flowchart TB
  %% --- TEMPLATED ENTITIES PATH (vertical) ---
  subgraph TEMPLATED["Templated entities"]
    direction TB
    TPL["Template tags:&#10;service=database&#10;component=backend"]
    H_TPL["Host tags (applied to templated entities):&#10;region=europe&#10;env=prod"]
    TPL_TRIG["Template trigger tags:&#10;severity=high"]
    TPL_ITEM["Template item tags:&#10;component=replication"]
    EV1["Event (templated trigger)&#10;Merged tags:&#10;service=database&#10;component=backend&#10;component=replication&#10;severity=high&#10;region=europe&#10;env=prod"]
    TPL --> H_TPL --> TPL_TRIG --> TPL_ITEM --> EV1
  end

  %% --- LOCAL ENTITIES PATH (vertical) ---
  subgraph LOCAL["Local entities (on Host)"]
    direction TB
    H_LOC["Host tags (local entities):&#10;site=be-brussels&#10;team=ops"]
    LOC_TRIG["Local trigger tags:&#10;class=local"]
    LOC_ITEM["Local item tags:&#10;sensor=temp"]
    EV2["Event (local trigger)&#10;Merged tags:&#10;site=be-brussels&#10;team=ops&#10;class=local&#10;sensor=temp"]
    H_LOC --> LOC_TRIG --> LOC_ITEM --> EV2
  end
</code></pre>
<p>Interpretation:</p>
<p>Zabbix merges tags from top to bottom.
Template level tags are the most general, while item level tags are the most specific.
All resulting tags flow into the generated event.</p>
<p><strong>Inheritance Order explained:</strong></p>
<ol>
<li>Item-level tags ‚Üí applied directly to collected metrics (most specific).</li>
<li>Trigger-level tags ‚Üí apply to problems generated by the trigger.</li>
<li>Host-level tags ‚Üí inherited only by items and triggers that originate from
   linked templates on that host (they do not apply automatically to locally
   defined host items/triggers).</li>
<li>Template-level tags ‚Üí base tags from all linked templates.</li>
</ol>
<p>The final event inherits all tags from these levels, with duplicates automatically
removed.</p>
<h4 id="ch06-zabbix-templates-templates-conflict-handling">Conflict Handling</h4>
<ul>
<li>If the same tag key appears multiple times with different values, all values are
  kept.</li>
<li>Duplicate key‚Äìvalue pairs are deduplicated.</li>
<li>Tags are additive, not overridden. Unlinking or clearing a template removes only
  that template‚Äôs tags from future events.</li>
</ul>
<p><strong>Example :</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Source</th>
<th style="text-align: left;">Tag Key</th>
<th style="text-align: left;">Tag Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Linux by Zabbix agent</td>
<td style="text-align: left;"><code>service</code></td>
<td style="text-align: left;"><code>os</code></td>
</tr>
<tr>
<td style="text-align: left;">PostgreSQL by Zabbix agent 2</td>
<td style="text-align: left;"><code>service</code></td>
<td style="text-align: left;"><code>database</code></td>
</tr>
<tr>
<td style="text-align: left;">Host</td>
<td style="text-align: left;"><code>region</code></td>
<td style="text-align: left;"><code>europe</code></td>
</tr>
<tr>
<td style="text-align: left;">Item</td>
<td style="text-align: left;"><code>component</code></td>
<td style="text-align: left;"><code>replication</code></td>
</tr>
</tbody>
</table>
<p>The resulting event tags will be:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch06-zabbix-templates-templates-__codelineno-4-1"></a><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">os</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch06-zabbix-templates-templates-__codelineno-4-2"></a><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch06-zabbix-templates-templates-__codelineno-4-3"></a><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">europe</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch06-zabbix-templates-templates-__codelineno-4-4"></a><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replication</span>
</span></code></pre></div></p>
<h4 id="ch06-zabbix-templates-templates-some-good-practices-when-tagging">Some good practices when tagging</h4>
<ul>
<li>Keep template level tags generic (e.g., service: database).</li>
<li>Use host level tags for environmental context (e.g., region: europe, customer:
  acme).</li>
<li>Apply item/trigger-level tags for event specificity (component: disk, component:
  replication).</li>
<li>Regularly audit merged event tags under Monitoring ‚Üí Problems ‚Üí Tags to verify
  inheritance behavior.</li>
</ul>
<h2 id="ch06-zabbix-templates-templates-template-macros">Template macros</h2>
<p>Macros are variables that make templates flexible and reusable. They define thresholds,
credentials, or paths that can be adjusted per environment without editing template
logic.</p>
<p><code>Data collection</code> ‚Üí <code>Templates</code> ‚Üí <code>Template</code> ‚Üí <code>Macros</code></p>
<p><img alt="templates/../ch06-zabbix-templates/templates/ch06.03-template-macros.png" src="../ch06-zabbix-templates/templates/ch06.03-template-macros.png" /></p>
<p>Example:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch06-zabbix-templates-templates-__codelineno-5-1"></a><span class="o">{</span><span class="nv">$CPU_UTIL_MAX</span><span class="o">}=</span><span class="m">90</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch06-zabbix-templates-templates-__codelineno-5-2"></a><span class="o">{</span><span class="nv">$MEMORY_WARN</span><span class="o">}=</span><span class="m">75</span>
</span></code></pre></div>
<p>Macros can be defined globally, at the template level, host-group level, or host
level, and can be overridden according to a strict precedence order.</p>
<h3 id="ch06-zabbix-templates-templates-macro-precedence-and-conflict-resolution">Macro Precedence and Conflict Resolution</h3>
<p>When multiple templates linked to the same host define the same macro, Zabbix
resolves conflicts by comparing template IDs.</p>
<p>:warning: The macro from the template with the lowest template ID takes precedence.</p>
<p>Example:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Template Name</th>
<th style="text-align: left;">Template ID</th>
<th style="text-align: left;">Macro</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Template OS Linux</td>
<td style="text-align: left;">10101</td>
<td style="text-align: left;"><code>{$CPU_UTIL_MAX}</code></td>
<td style="text-align: left;">85</td>
</tr>
<tr>
<td style="text-align: left;">Template App PostgreSQL</td>
<td style="text-align: left;">10115</td>
<td style="text-align: left;"><code>{$CPU_UTIL_MAX}</code></td>
<td style="text-align: left;">90</td>
</tr>
</tbody>
</table>
<p>‚Üí The oldest template (lowest ID) wins ‚Üí {$CPU_UTIL_MAX}=85.</p>
<p>Precedence Hierarchy:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Level</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1. Host macro</td>
<td style="text-align: left;">Defined on host</td>
<td style="text-align: left;">Highest priority</td>
</tr>
<tr>
<td style="text-align: left;">2. Template macro</td>
<td style="text-align: left;">Lowest template ID wins if duplicate</td>
<td style="text-align: left;">Applies to linked templates</td>
</tr>
<tr>
<td style="text-align: left;">3. Global macro</td>
<td style="text-align: left;">Default fallback</td>
<td style="text-align: left;">Lowest priority</td>
</tr>
</tbody>
</table>
<h4 id="ch06-zabbix-templates-templates-some-good-practices">Some good practices</h4>
<ul>
<li>Keep macro names unique within template families.</li>
<li>Use host-level overrides for environment-specific adjustments.</li>
<li>Document shared macros to prevent conflicts.</li>
</ul>
<h2 id="ch06-zabbix-templates-templates-value-maps">Value Maps</h2>
<p>Value maps convert raw numeric or coded values into meaningful, human readable text.
They make dashboards, triggers, and data views more intuitive. For example, turning
SNMP status codes like 1, 2, 3 into Up, Down, Unknown.</p>
<p><code>Data collection</code> ‚Üí <code>Templates</code> ‚Üí <code>Template</code> ‚Üí <code>Value maps</code></p>
<p><img alt="templates/../ch06-zabbix-templates/templates/ch06.04-template-value%20maps.png" src="../ch06-zabbix-templates/templates/ch06.04-template-value%20maps.png" /></p>
<h3 id="ch06-zabbix-templates-templates-scope-and-availability">Scope and Availability</h3>
<p>Value maps exist in two distinct scopes in Zabbix 8:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Scope</th>
<th style="text-align: left;">Created In</th>
<th style="text-align: left;">Can Be Used By</th>
<th style="text-align: left;">Shared With</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Template-level value map</strong></td>
<td style="text-align: left;">Inside a template definition</td>
<td style="text-align: left;">Items belonging to that same template</td>
<td style="text-align: left;">‚ùå Not accessible from other templates or hosts</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Host-level value map</strong></td>
<td style="text-align: left;">Directly on a specific host</td>
<td style="text-align: left;">Items defined directly on that host</td>
<td style="text-align: left;">‚ùå Not accessible by other hosts or templates</td>
</tr>
</tbody>
</table>
<details class="note" open="open">
<summary>Note</summary>
<p>There is no such thing as a global value map. Each map is strictly local to
its parent template or host. To reuse a map elsewhere, you must export/import
or recreate it under the new object.</p>
</details>
<h3 id="ch06-zabbix-templates-templates-types-of-mappings">Types of Mappings</h3>
<p>A value map can contain one or more mapping rules, which determine how an incoming
raw value is translated.</p>
<p>Zabbix 8 supports the following mapping rule types:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Mapping Type</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Exact value</strong></td>
<td style="text-align: left;">One-to-one translation of a specific value</td>
<td style="text-align: left;"><code>1 ‚Üí Up</code>, <code>2 ‚Üí Down</code>, <code>3 ‚Üí Unknown</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Range mapping</strong></td>
<td style="text-align: left;">Applies to any value within a range</td>
<td style="text-align: left;"><code>0‚Äì49 ‚Üí Normal</code>, <code>50‚Äì79 ‚Üí Warning</code>, <code>80‚Äì100 ‚Üí Critical</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Pattern (regex)</strong></td>
<td style="text-align: left;">Matches values by regular expression</td>
<td style="text-align: left;"><code>^ERR.* ‚Üí Error detected</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Default value</strong></td>
<td style="text-align: left;">Fallback if no other rule matches</td>
<td style="text-align: left;"><code>* ‚Üí Undefined</code></td>
</tr>
</tbody>
</table>
<p>Mappings are evaluated from top to bottom ‚Äî the first match wins.</p>
<h3 id="ch06-zabbix-templates-templates-example-template-level-value-map">Example: Template-Level Value Map</h3>
<p>In a custom Template Network Switch, you might define:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Raw value</th>
<th style="text-align: left;">Mapped text</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Interface Up</td>
</tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: left;">Interface Down</td>
</tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: left;">Interface Testing</td>
</tr>
<tr>
<td style="text-align: left;">*</td>
<td style="text-align: left;">Unknown State</td>
</tr>
</tbody>
</table>
<p>Items inside the template that return SNMP interface status (ifOperStatus) can
reference this value map directly.</p>
<h3 id="ch06-zabbix-templates-templates-example-host-level-value-map">Example: Host-Level Value Map</h3>
<p>For a specific host, e.g. Switch A, you might define:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Raw value</th>
<th style="text-align: left;">Mapped text</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Operational</td>
</tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: left;">Non-operational</td>
</tr>
</tbody>
</table>
<p>Only items defined directly on Switch A (not inherited from a template) can use
this map. If the same host a template is applied, that host will use the
template‚Äôs value map instead of the host-level one for items from the template.</p>
<h4 id="ch06-zabbix-templates-templates-some-good-practices-for-value-maps">Some good practices for value maps</h4>
<ul>
<li>Keep template level value maps technology specific (e.g. SNMP interface, SMART
  disk status).</li>
<li>Define host level maps only when customization is necessary for that device.</li>
<li>Maintain consistent naming conventions (Interface Status, Disk Health) across
  templates to simplify export/import.</li>
<li>If multiple templates require the same mapping logic, simply define identical
  value maps within each template. Zabbix does not provide cross-template sharing,
  so each template must contain its own copy of the map definition.</li>
</ul>
<h2 id="ch06-zabbix-templates-templates-template-dashboards">Template Dashboards</h2>
<p>Template dashboards allow you to attach pre-designed visual dashboards directly
to a template. When the template is linked to a host, Zabbix automatically creates
a <strong>host-specific dashboard instance</strong> based on that template. This makes it possible
to provide consistent visualizations for every host or application without manually
building dashboards for each one.</p>
<h3 id="ch06-zabbix-templates-templates-where-to-find-template-dashboards">Where to Find Template Dashboards</h3>
<p>Template dashboards can be accessed and edited under:</p>
<p><code>Data collection ‚Üí Templates ‚Üí [select template] ‚Üí Dashboards tab</code></p>
<p>Each template may include one or more dashboards.
When a host is linked to a template containing a dashboard, that dashboard appears
automatically under:</p>
<p><code>Monitoring ‚Üí Hosts ‚Üí [select host] ‚Üí Dashboards tab</code></p>
<p>This dashboard is generated dynamically for the selected host, showing metrics
and graphs populated with that host‚Äôs data.</p>
<h3 id="ch06-zabbix-templates-templates-purpose-and-use-cases">Purpose and Use Cases</h3>
<p>Template dashboards are most useful for application-level or host-specific visualization.
They provide a structured, ready-to-use view tailored to the technology being monitored.</p>
<p>Typical Use Cases:</p>
<ul>
<li>Application dashboards:<ul>
<li>A Template App PostgreSQL can include charts for query throughput, buffer
  cache hit ratio, replication delay, and trigger problem widgets.</li>
<li>When linked, each database instance automatically gains its own PostgreSQL
  performance dashboard.</li>
</ul>
</li>
<li>Operating system dashboards:<ul>
<li>Template OS Linux may display CPU load, memory utilization, filesystem usage,
  and system uptime widgets.</li>
</ul>
</li>
<li>Network device dashboards:<ul>
<li>Template Net Cisco SNMP could show interface bandwidth, packet errors, and
  uptime.</li>
</ul>
</li>
</ul>
<p>These dashboards ensure consistent presentation and help operators quickly understand
the health of any host using that template.</p>
<h3 id="ch06-zabbix-templates-templates-dashboard-components">Dashboard Components</h3>
<p>Template dashboards support the same widget types as user dashboards, including:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Widget Examples</th>
<th style="text-align: left;">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Data visualization</strong></td>
<td style="text-align: left;">Graphs, time series, top N</td>
<td style="text-align: left;">Show trends and metric comparisons</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Status views</strong></td>
<td style="text-align: left;">Problems, Item values, SLA widgets</td>
<td style="text-align: left;">Real-time status per host/application</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Service overview</strong></td>
<td style="text-align: left;">Business service state, SLA</td>
<td style="text-align: left;">Map triggers to service impact</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Layout elements</strong></td>
<td style="text-align: left;">Text, maps, URL embeds</td>
<td style="text-align: left;">Add context, documentation, or external views</td>
</tr>
</tbody>
</table>
<p>Each widget automatically substitutes host-specific data when rendered under
<code>Monitoring</code> ‚Üí <code>Hosts</code> ‚Üí <code>Dashboards</code>. No manual host configuration is required.</p>
<p><img alt="templates/../ch06-zabbix-templates/templates/ch06.05-template-dashboards.png" src="../ch06-zabbix-templates/templates/ch06.05-template-dashboards.png" /></p>
<h3 id="ch06-zabbix-templates-templates-some-good-practices_1">Some Good Practices</h3>
<ul>
<li><strong>Keep dashboards concise:</strong> Focus on the key health indicators of that application
  or system.</li>
<li><strong>Leverage macros:</strong> Use template macros (e.g., {$PG.DBNAME}) inside widgets
  to make them adaptive across instances.</li>
<li><strong>Group widgets logically:</strong> Use grid layout ‚Äî metrics at top, triggers below,
  historical trends on the side.</li>
<li><strong>Document context:</strong> Include a Text widget describing what each graph shows
  or what thresholds mean.</li>
<li><strong>Use template dashboards:</strong> for ‚Äúper-instance‚Äù visibility, and user dashboards
  for multi-host or environment-wide overviews.</li>
</ul>
<h3 id="ch06-zabbix-templates-templates-example-template-app-postgresql">Example: Template App PostgreSQL</h3>
<p>A typical Template App PostgreSQL dashboard might include:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Widget</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Graph</strong></td>
<td style="text-align: left;">PostgreSQL transactions per second</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Graph</strong></td>
<td style="text-align: left;">Replication lag in seconds</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Item Value</strong></td>
<td style="text-align: left;">Cache hit ratio (<code>pg.stat.cache.hit</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Problem Widget</strong></td>
<td style="text-align: left;">Current trigger status for this instance</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Text Widget</strong></td>
<td style="text-align: left;">Notes: tuning guide, connection info, etc.</td>
</tr>
</tbody>
</table>
<p>Once the template is linked to hosts db01, db02, and db03, Zabbix automatically
renders <strong>three dashboards,</strong> each showing real metrics for its respective instance.</p>
<h3 id="ch06-zabbix-templates-templates-advantages-of-template-dashboards">Advantages of Template Dashboards</h3>
<ul>
<li><strong>Consistency:</strong> every host or application gets the same visualization standard.</li>
<li><strong>Zero manual setup:</strong> dashboards appear automatically on linking.</li>
<li><strong>Version control:</strong> dashboards are stored inside templates and follow the same
  YAML export/import flow.</li>
<li><strong>Maintainability:</strong> when you update a template dashboard, all hosts using that
  template receive the new version automatically.</li>
<li><strong>Scalability:</strong> ideal for large environments ‚Äî one dashboard design scales to
  hundreds of hosts.</li>
</ul>
<h2 id="ch06-zabbix-templates-templates-template-management-operations">Template Management Operations</h2>
<p>Template management in Zabbix 8.0 offers multiple actions for maintaining, cloning,
cleaning, and synchronizing templates efficiently.</p>
<p>These operations are accessible under:</p>
<p><code>Data collection ‚Üí Hosts</code> on the host itself.</p>
<p><img alt="templates/../ch06-zabbix-templates/templates/ch06.06-template-unlink-clear.png" src="../ch06-zabbix-templates/templates/ch06.06-template-unlink-clear.png" /></p>
<h3 id="ch06-zabbix-templates-templates-unlink-vs-unlink-and-clear">Unlink vs. Unlink and Clear</h3>
<ul>
<li>
<p><strong>Unlink:</strong> Detaches the template from a host but retains all inherited items,
  triggers, and discovery rules on the host.</p>
</li>
<li>
<p><strong>Unlink and Clear:</strong> Removes the template and deletes all entities that originated
  from it (items, triggers, graphs, and discoveries).</p>
</li>
</ul>
<p>Use Unlink to preserve historical data, and Unlink and Clear when you need to remove
the monitoring logic completely.</p>
<h3 id="ch06-zabbix-templates-templates-clone">Clone</h3>
<p>The <code>clone</code> button creates an exact copy of an existing template, including all
items, triggers, dashboards, macros, and value maps. Every entity within the clone
receives a new UUID, ensuring full independence from the original.</p>
<p><code>Data collection</code> ‚Üí <code>Templates</code> on the template itself.</p>
<p><img alt="templates/../ch06-zabbix-templates/templates/ch06.07-template-delete-clear.png" src="../ch06-zabbix-templates/templates/ch06.07-template-delete-clear.png" /></p>
<p>Example:</p>
<p><code>Template OS Linux ‚Üí Clone ‚Üí Template OS Rocky Linux (Custom)</code></p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Always rename cloned templates immediately to reflect their intended purpose
or environment as we discussed before.</p>
</details>
<h3 id="ch06-zabbix-templates-templates-delete-vs-delete-and-clear">Delete vs. Delete and Clear</h3>
<ul>
<li><strong>Delete:</strong> Removes the template definition but leaves all items and triggers
  (now orphaned) on linked hosts.</li>
<li><strong>Delete and Clear:</strong> Deletes both the template and any entities created on
  linked hosts.</li>
</ul>
<p>When performing cleanup or migration, Delete and Clear ensures no residual items
remain in configuration cache.</p>
<details class="warning" open="open">
<summary>Warning</summary>
<p>Deletes happen immediately so there is no undo. Also deletes are performed
on the database immediately so a large scale delete could have a serious
performance impact.</p>
</details>
<h3 id="ch06-zabbix-templates-templates-mass-update-of-templates">Mass Update of Templates</h3>
<p>Zabbix 8 provides a Mass update feature to modify multiple templates simultaneously.
This is available via:</p>
<p><code>Data collection ‚Üí Templates ‚Üí Mass update</code></p>
<p>It‚Äôs particularly useful for enforcing consistent macro values, tags, or template
group structures across many templates.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Examples of Updatable Fields</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>General</strong></td>
<td style="text-align: left;">Template groups, name, description, tags</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Macros</strong></td>
<td style="text-align: left;">Add, update, or remove template-level macros</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Discovery rules</strong></td>
<td style="text-align: left;">Adjust update intervals or filter expressions</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dashboards</strong></td>
<td style="text-align: left;">Replace or refresh template dashboards</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Permissions</strong></td>
<td style="text-align: left;">Move templates between groups (changes RBAC context)</td>
</tr>
</tbody>
</table>
<h3 id="ch06-zabbix-templates-templates-behavior-and-cautions">Behavior and Cautions</h3>
<ul>
<li>Only the properties you select are overwritten.</li>
<li>Existing macros or tags with identical names are replaced.</li>
<li>Changes apply immediately; no rollback is available.</li>
<li>When moving templates to a different group, verify that related user groups have
  the proper permissions on that target group.</li>
</ul>
<h3 id="ch06-zabbix-templates-templates-some-good-practices_2">Some Good Practices</h3>
<ul>
<li>Use mass update for homogeneous template sets (for example, all OS templates or
  all network device templates).</li>
<li>For larger or version-controlled environments, rely on YAML export/import through
  Git or CI/CD to ensure traceability and change control.</li>
<li>Always test mass updates on a staging instance before production rollout.</li>
</ul>
<h2 id="ch06-zabbix-templates-templates-importing-and-exporting-templates">Importing and Exporting Templates</h2>
<p>Templates can be imported or exported in both YAML, JSON and XML formats, although
YAML is strongly preferred for readability and version control. It is also the
standard now in Zabbix.</p>
<h3 id="ch06-zabbix-templates-templates-exporting">Exporting</h3>
<p>Navigate to <code>Data collection</code> ‚Üí <code>Templates</code> ‚Üí <code>Select Your Template(s)</code> ‚Üí <code>Export</code>, then select <code>YAML</code>.</p>
<p><img alt="templates/../ch06-zabbix-templates/templates/ch06.08-template-export.png" src="../ch06-zabbix-templates/templates/ch06.08-template-export.png" /></p>
<p>A typical export looks like:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch06-zabbix-templates-templates-__codelineno-6-1"></a><span class="nt">zabbix_export</span><span class="p">:</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch06-zabbix-templates-templates-__codelineno-6-2"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;8.0&#39;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch06-zabbix-templates-templates-__codelineno-6-3"></a><span class="w">  </span><span class="nt">templates</span><span class="p">:</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ch06-zabbix-templates-templates-__codelineno-6-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uuid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">a4c1d0f2d7de4a40a8b347afeb9a88df</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ch06-zabbix-templates-templates-__codelineno-6-5"></a><span class="w">      </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Template</span><span class="nv"> </span><span class="s">OS</span><span class="nv"> </span><span class="s">Rocky</span><span class="nv"> </span><span class="s">Linux&#39;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#ch06-zabbix-templates-templates-__codelineno-6-6"></a><span class="w">      </span><span class="nt">groups</span><span class="p">:</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#ch06-zabbix-templates-templates-__codelineno-6-7"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Templates/Operating</span><span class="nv"> </span><span class="s">Systems/Linux&#39;</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#ch06-zabbix-templates-templates-__codelineno-6-8"></a><span class="w">      </span><span class="nt">macros</span><span class="p">:</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#ch06-zabbix-templates-templates-__codelineno-6-9"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">macro</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{$CPU_UTIL_MAX}&#39;</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#ch06-zabbix-templates-templates-__codelineno-6-10"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;90&#39;</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#ch06-zabbix-templates-templates-__codelineno-6-11"></a><span class="w">      </span><span class="nt">items</span><span class="p">:</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#ch06-zabbix-templates-templates-__codelineno-6-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;System</span><span class="nv"> </span><span class="s">uptime&#39;</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#ch06-zabbix-templates-templates-__codelineno-6-13"></a><span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;system.uptime&#39;</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#ch06-zabbix-templates-templates-__codelineno-6-14"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ZABBIX_AGENT</span>
</span></code></pre></div>
<h3 id="ch06-zabbix-templates-templates-importing-templates">Importing Templates</h3>
<p>The import process in Zabbix 8.0  is intelligent ‚Äî it compares UUIDs, detects
differences, and optionally merges or removes entities.
You can import templates via:</p>
<p><code>Data collection ‚Üí Templates ‚Üí Import</code></p>
<p>The button is on the upper right side of your window.</p>
<p><img alt="templates/../ch06-zabbix-templates/templates/ch06.09-template-export.png" src="../ch06-zabbix-templates/templates/ch06.09-template-export.png" /></p>
<p>Zabbix supports both <code>YAML</code> <code>JSON and</code>XML`, though YAML is preferred due to its
readability and UUID retention.</p>
<h3 id="ch06-zabbix-templates-templates-import-options-and-their-effects">Import Options and Their Effects</h3>
<p>When importing a template, the import dialog presents several options that determine
how conflicts and differences are handled:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Option</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Create new</strong></td>
<td style="text-align: left;">Import entities that do not exist yet</td>
<td style="text-align: left;">New templates and their entities are created</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Update existing</strong></td>
<td style="text-align: left;">Update entities that already exist based on matching UUIDs</td>
<td style="text-align: left;">Existing templates are modified to match the import file</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Delete missing</strong></td>
<td style="text-align: left;">Remove entities that exist in Zabbix but not in the import file</td>
<td style="text-align: left;">Entities absent from the import are deleted</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Replace existing template</strong></td>
<td style="text-align: left;">Forcefully overwrite all existing definitions</td>
<td style="text-align: left;">Full replacement, including dashboards and discovery rules</td>
</tr>
</tbody>
</table>
<h4 id="ch06-zabbix-templates-templates-uuid-based-matching">UUID-Based Matching</h4>
<p>Starting with Zabbix 6.2, template imports rely primarily on UUIDs, not names,
for matching.</p>
<ul>
<li>If the UUID exists, Zabbix updates that object ‚Äî even if the name differs.</li>
<li>If no UUID matches, Zabbix treats the object as new and creates it.</li>
<li>If an object shares the same name but has a different UUID, it is treated as
  a different entity ‚Äî no merge occurs.</li>
</ul>
<details class="tip" open="open">
<summary>Tip</summary>
<p>When re-importing from version-controlled YAML, always keep original UUIDs
intact. Editing or regenerating them will cause duplicates rather than updates.</p>
</details>
<h4 id="ch06-zabbix-templates-templates-diff-visualization">Diff Visualization</h4>
<p>Before confirming an import, Zabbix displays a visual diff screen showing what will change.
This interface uses color coding to illustrate modifications at a granular level:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Color</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">üü© <strong>Green</strong></td>
<td style="text-align: left;">Elements that will be added or new attribute values</td>
</tr>
<tr>
<td style="text-align: left;">üü• <strong>Red</strong></td>
<td style="text-align: left;">Elements that will be removed or replaced</td>
</tr>
</tbody>
</table>
<p>Zabbix compares entities by UUID and lists each difference per category, items,
triggers, graphs, macros, value maps, discovery rules, and dashboards.
Modified objects show their old values in red and new values in green, providing
a clear preview of all pending changes.</p>
<h4 id="ch06-zabbix-templates-templates-update-existing-behavior">‚ÄúUpdate Existing‚Äù Behavior</h4>
<p>When Update existing is enabled:</p>
<ul>
<li>Entities with matching UUIDs are updated.</li>
<li>Entities not in the import remain unchanged unless Delete missing is also checked.</li>
<li>Template-level fields (name, groups, description, macros, dashboards) are replaced
  by those from the import.</li>
</ul>
<p>This mode is ideal for incremental updates or synchronization with a Git-tracked source.</p>
<h4 id="ch06-zabbix-templates-templates-delete-missing-behavior">‚ÄúDelete Missing‚Äù Behavior</h4>
<p>With Delete missing enabled, Zabbix removes any element present in the database
but absent in the import file:</p>
<ul>
<li>Items, triggers, discovery rules, graphs, dashboards, and value maps</li>
<li>Orphaned macros and outdated entities</li>
</ul>
<details class="warning" open="open">
<summary>Warning</summary>
<p><strong>This action is destructive.</strong>
It permanently removes definitions and historical associations.
Use only when performing full synchronization from version-controlled sources
or replacing obsolete templates.</p>
</details>
<p>When both Update existing and Delete missing are checked, the import performs a
full sync. The resulting template will exactly match the import file.</p>
<h4 id="ch06-zabbix-templates-templates-error-handling">Error Handling</h4>
<p>Zabbix validates all entities before applying the import.
If inconsistencies are found, the import halts and reports detailed errors, such
as:</p>
<ul>
<li>Missing referenced value maps or linked templates</li>
<li>Invalid macro names or syntax</li>
<li>Circular template linkage</li>
<li>Version mismatches between export and server</li>
</ul>
<p>The error list shows affected entity names, allowing quick correction and re-import.</p>
<h4 id="ch06-zabbix-templates-templates-safe-import-workflow">Safe Import Workflow</h4>
<p>For production grade environments:</p>
<ul>
<li><strong>Export first:</strong> always back up current templates.</li>
<li><strong>Validate syntax:</strong> use yamllint or JSON validators.<ul>
<li>yamllint template.yaml</li>
<li>jq empty template.json</li>
</ul>
</li>
<li><strong>Preview diff:</strong> check additions (green) and deletions (red).</li>
<li><strong>Test in staging:</strong> confirm behavior before production import.</li>
<li><strong>Promote via automation:</strong> use the Zabbix API (configuration.import) for reproducible
  CI/CD deployments.</li>
</ul>
<p>???+ tip</p>
<div class="language-text highlight"><pre><span></span><code>  Automating template synchronization via API and Git ensures identical configurations
  across multiple Zabbix servers or environments.
</code></pre></div>
<h2 id="ch06-zabbix-templates-templates-conclusion">Conclusion</h2>
<p>Templates in Zabbix 8.0 are now fully self-contained, UUID-tracked, and automation 
ready. With improved import/export handling, color-coded diffs, and fine-grained
RBAC, they deliver both control and scalability.</p>
<p>By following some good practices, cloning instead of editing <code>built-ins</code>, organizing
templates by group and tag, tuning intervals, maintaining YAML or JSON in Git,
and verifying diffs before import, administrators achieve consistent, predictable
monitoring deployments.</p>
<p>Templates are no longer mere configuration helpers; they are core assets in a modern
observability strategy, enabling reproducible, automated, and standards driven
monitoring across diverse infrastructures.</p>
<h2 id="ch06-zabbix-templates-templates-questions">Questions</h2>
<ul>
<li>What are the main configuration elements a Zabbix template can contain, and how do they contribute to standardizing monitoring?</li>
<li>Explain what happens to UUIDs when a template is cloned.</li>
<li>Why is it important to preserve UUIDs when managing templates through YAML or Git?</li>
<li>Describe how tags are inherited when a template is applied to a host.</li>
<li>Which tags take precedence if both the host and the template define the same key?</li>
<li>Why can't a template-level value map be used by local host items?</li>
</ul>
<h2 id="ch06-zabbix-templates-templates-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/templates">https://www.zabbix.com/documentation/current/en/manual/config/templates</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/mapping">https://www.zabbix.com/documentation/current/en/manual/config/items/mapping</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/templates/template">https://www.zabbix.com/documentation/current/en/manual/config/templates/template</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/xml_export_import">https://www.zabbix.com/documentation/current/en/manual/xml_export_import</a></li>
<li><a href="https://git.zabbix.com/repos?visibility=public">https://git.zabbix.com/repos?visibility=public</a></li>
<li><a href="https://jsonpathfinder.com/">https://jsonpathfinder.com/</a></li>
<li><a href="https://www.yamllint.com/">https://www.yamllint.com/</a></li>
</ul></section></section>
                    <section class='print-page md-section' id='section-12' heading-number='12'>
                        <h1>Chapter 07 : Alerting<a class='headerlink' href='#section-12' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch07-zabbix-alerts-chapter" heading-number="12.1"><h1 id="ch07-zabbix-alerts-chapter-sending-out-alerts-with-zabbix">Sending out alerts with Zabbix</h1>
<p>After delving into templates, it's time to <strong>return to the data flow</strong> and bring
everything together by exploring integrations with powerful external services.
In this chapter, we‚Äôll <strong>complete the data flow journey</strong>, showing how to extend
Zabbix capabilities through seamless connections with third-party tools
and platforms.</p>
<p>We'll guide you through setting up <strong>integrations</strong> that enhance your monitoring
system, covering various use cases from alerting to data visualization and
automation. By integrating Zabbix with external services, you'll unlock new
levels of functionality, making your monitoring setup more dynamic and adaptable.</p>
<p>By the end, you'll have a well-rounded understanding of how to fully utilize
Zabbix data flow, augmented by strategic integrations that add value to your
infrastructure management.</p></section><section class="print-page" id="ch07-zabbix-alerts-media-types" heading-number="12.2"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="media-types">Media types</h1>
<h2 id="ch07-zabbix-alerts-media-types-conclusion">Conclusion</h2>
<h2 id="ch07-zabbix-alerts-media-types-questions">Questions</h2>
<h2 id="ch07-zabbix-alerts-media-types-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch07-zabbix-alerts-scripts" heading-number="12.3"><nav class='md-tags'><span class='md-tag'>advanced</span><span class='md-tag'>expert</span></nav><h1 id="scripts">Scripts</h1>
<h2 id="ch07-zabbix-alerts-scripts-conclusion">Conclusion</h2>
<h2 id="ch07-zabbix-alerts-scripts-questions">Questions</h2>
<h2 id="ch07-zabbix-alerts-scripts-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch07-zabbix-alerts-actions" heading-number="12.4"><nav class='md-tags'><span class='md-tag'>expert</span></nav><h1 id="actions">Actions</h1>
<h2 id="ch07-zabbix-alerts-actions-conclusion">Conclusion</h2>
<h2 id="ch07-zabbix-alerts-actions-questions">Questions</h2>
<h2 id="ch07-zabbix-alerts-actions-useful-urls">Useful URLs</h2></section></section>
                    <section class='print-page md-section' id='section-13' heading-number='13'>
                        <h1>Chapter 08 : LLD<a class='headerlink' href='#section-13' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch08-zabbix-lld-chapter" heading-number="13.1"><h1 id="ch08-zabbix-lld-chapter-using-low-level-discovery-to-automate">Using Low level discovery to automate</h1>
<p>In this chapter, we'll dive into <strong>Low-Level Discovery (LLD)</strong>, covering everything
there is to know about this powerful feature in Zabbix. LLD automates the creation
of hosts, items, triggers, and more, simplifying the management of large and
dynamic environments.</p>
<p>We'll also explain how to work with <strong>custom JSON</strong> in the context of LLD, showing
you how to tailor discovery rules to fit your unique needs. By mastering these
techniques, you'll be able to create highly adaptable monitoring setups that
respond to changes in your infrastructure with minimal manual intervention.</p>
<p>By the end of this chapter, you'll have a deep understanding of LLD, from basic
concepts to advanced customization, enabling you to leverage its full potential
in your Zabbix deployment.</p></section><section class="print-page" id="ch08-zabbix-lld-custom" heading-number="13.2"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="custom-low-level-discovery">Custom Low Level Discovery</h1>
<p>Zabbix's Low-Level Discovery (LLD) plays a crucial role in dynamically detecting
and managing monitored entities. While Zabbix provides built-in discovery rules,
real-world environments often demand more flexibility and customization.</p>
<p>In this chapter, we will explore custom LLD techniques, allowing you to create powerful,
tailored discovery mechanisms that go beyond standard templates. You'll learn how
to use scripts and custom rules to automatically detect and monitor services,
network interfaces, and other dynamic components within your infrastructure.</p>
<p>Whether you're monitoring cloud environments, network devices, or application-specific
metrics, mastering custom LLD will help you reduce manual work, improve accuracy,
and scale your monitoring effortlessly. Let‚Äôs dive in!</p>
<details class="note" open="open">
<summary>Note</summary>
<p>For this chapter we start with a working system with a proper configured agent
in passive mode. If you have no clue how to do this go back to chapter 01.</p>
</details>
<p>Zabbix <strong>Low-Level Discovery</strong> (LLD) provides a dynamic mechanism for automatically
creating monitoring elements based on discovered entities within your infrastructure.</p>
<p><strong>Core Functionality :</strong></p>
<p>LLD enables Zabbix to detect changes in your environment and create corresponding
items, triggers, and graphs without manual intervention. This automation is particularly
valuable when monitoring elements with fluctuating quantities or identifiers.</p>
<p><strong>Discovery Targets:</strong>
The discovery process can identify and monitor various system components including:</p>
<ul>
<li>File systems</li>
<li>CPUs</li>
<li>CPU cores</li>
<li>Network interfaces</li>
<li>SNMP OIDs</li>
<li>JMX objects</li>
<li>Windows services</li>
<li>Systemd services</li>
<li>Host interfaces</li>
<li>Anything based on custom scripts</li>
</ul>
<p>Through LLD, administrators can implement scalable monitoring solutions that automatically
adapt to infrastructure changes without requiring constant template modifications.</p>
<h2 id="ch08-zabbix-lld-custom-implementing-low-level-discovery-in-zabbix">Implementing Low-Level Discovery in Zabbix</h2>
<h3 id="ch08-zabbix-lld-custom-the-challenge-of-manual-configuration">The Challenge of Manual Configuration</h3>
<p>We could manually create each item but this would be a very time-consuming task
and impossible to manage in large environments. To enable automatic discovery of
our items or entities, we need discovery rules.</p>
<h3 id="ch08-zabbix-lld-custom-discovery-rules">Discovery Rules</h3>
<p>These rules send the necessary data to Zabbix for our discovery process. There 
is no limit to the various methods we can employ, the only requirement is that
the end result must be formatted in JSON. This output information is crucial as
it forms the foundation for creating our items.</p>
<h3 id="ch08-zabbix-lld-custom-prototypes-and-automation">Prototypes and Automation</h3>
<p>Once our discovery rule is in place, we can instruct Zabbix to automatically generate
items, triggers, graphs, and even host prototypes. These function as blueprints
directing Zabbix how to create those entities.</p>
<h3 id="ch08-zabbix-lld-custom-lld-macros">LLD Macros</h3>
<p>To enhance flexibility, Zabbix implements LLD macros. These macros always begin
with a # character before their name (e.g., {#FSNAME}). Acting as placeholders for
the values of discovered entities, Zabbix replaces these macros with the actual
discovered names of the items during the implementation process.</p>
<h3 id="ch08-zabbix-lld-custom-the-zabbix-low-level-discovery-workflow">The Zabbix Low-Level Discovery Workflow</h3>
<p>The workflow that Zabbix follows during Low-Level Discovery consists of four
distinct phases:</p>
<p><strong>Discovery Phase</strong>
* Zabbix executes the discovery item according to the defined discovery rule
* The item returns a JSON list of discovered entities</p>
<p><strong>Processing Phase</strong>
* Zabbix parses the JSON data and extracts the necessary information</p>
<p><strong>Creation Phase</strong>
* For each discovered entity, Zabbix creates items, triggers, and graphs based on
  the prototypes
* During this process, LLD macros are replaced with the actual discovered values</p>
<p><strong>Monitoring Phase</strong>
* Zabbix monitors the created items using standard monitoring procedures</p>
<h3 id="ch08-zabbix-lld-custom-advantages-of-lld-implementation">Advantages of LLD Implementation</h3>
<p>The benefits of implementing Low-Level Discovery are substantial:</p>
<ul>
<li><strong>Automation</strong> - Creation of items, triggers, graphs, and hosts becomes fully
  automated</li>
<li><strong>Scalability</strong> - Enables monitoring of large numbers of hosts or items without
  manual intervention</li>
<li><strong>Adaptability</strong> - Zabbix can dynamically adjust to environmental changes by 
  creating or removing entities as needed</li>
</ul>
<h2 id="ch08-zabbix-lld-custom-learning-lld-custom-script">Learning LLD custom script</h2>
<p>We begin our series with LLD based on custom scripts because, while it represents
one of the more complex topics, mastering this concept provides a solid foundation.
Once you understand this implementation approach, the other LLD topics will be
considerably easier to comprehend.</p>
<p>Below is a sample JSON structure that Zabbix can interpret for Low-Level Discovery:</p>
<div class="admonition info">
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch08-zabbix-lld-custom-__codelineno-0-1"></a><span class="p p-Indicator">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch08-zabbix-lld-custom-__codelineno-0-2"></a><span class="w">  </span><span class="s">&quot;data&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch08-zabbix-lld-custom-__codelineno-0-3"></a><span class="w">    </span><span class="p p-Indicator">{</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch08-zabbix-lld-custom-__codelineno-0-4"></a><span class="w">      </span><span class="s">&quot;{#FSNAME}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p p-Indicator">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch08-zabbix-lld-custom-__codelineno-0-5"></a><span class="w">      </span><span class="s">&quot;{#FSTYPE}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;ext4&quot;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch08-zabbix-lld-custom-__codelineno-0-6"></a><span class="w">    </span><span class="p p-Indicator">},</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch08-zabbix-lld-custom-__codelineno-0-7"></a><span class="w">    </span><span class="p p-Indicator">{</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch08-zabbix-lld-custom-__codelineno-0-8"></a><span class="w">      </span><span class="s">&quot;{#FSNAME}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/boot&quot;</span><span class="p p-Indicator">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch08-zabbix-lld-custom-__codelineno-0-9"></a><span class="w">      </span><span class="s">&quot;{#FSTYPE}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;ext4&quot;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ch08-zabbix-lld-custom-__codelineno-0-10"></a><span class="w">    </span><span class="p p-Indicator">},</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ch08-zabbix-lld-custom-__codelineno-0-11"></a><span class="w">    </span><span class="p p-Indicator">{</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ch08-zabbix-lld-custom-__codelineno-0-12"></a><span class="w">      </span><span class="s">&quot;{#FSNAME}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/data&quot;</span><span class="p p-Indicator">,</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#ch08-zabbix-lld-custom-__codelineno-0-13"></a><span class="w">      </span><span class="s">&quot;{#FSTYPE}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;xfs&quot;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#ch08-zabbix-lld-custom-__codelineno-0-14"></a><span class="w">    </span><span class="p p-Indicator">}</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#ch08-zabbix-lld-custom-__codelineno-0-15"></a><span class="w">  </span><span class="p p-Indicator">]</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#ch08-zabbix-lld-custom-__codelineno-0-16"></a><span class="p p-Indicator">}</span>
</span></code></pre></div>
</div>
<p>Upon receiving this JSON data, Zabbix processes the discovery information to identify
distinct file systems within the monitored environment. The system extracts and
maps the following elements:</p>
<ul>
<li>File system mount points: /, /boot, and /data</li>
<li>File system types: ext4 and xfs</li>
</ul>
<p>Zabbix automatically associates these discovered values with their corresponding
LLD macros {#FSNAME} for the mount points and {#FSTYPE} for the file system types.
This mapping enables dynamic creation of monitoring objects tailored to each specific
file system configuration.</p>
<h3 id="ch08-zabbix-lld-custom-creating-a-custom-script">Creating a custom script.</h3>
<p>In this example, we will develop a custom script to monitor user login activity on
our systems. This script will track the number of users currently logged into each
monitored host and report their login status.</p>
<p>The implementation requires placing a custom script in the appropriate location on
systems running Zabbix Agent (either version 1 or 2). Create the following script
in the <code>/usr/bin/</code> directory on each agent installed system:</p>
<div class="admonition info">
<p class="admonition-title">create our script</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch08-zabbix-lld-custom-__codelineno-1-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo vi /usr/bin/users-discovery.sh</span>
</span></code></pre></div>
</div>
<p>paste the following content in the file:</p>
<div class="admonition info">
<p class="admonition-title">users-discovery.sh</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch08-zabbix-lld-custom-__codelineno-2-1"></a><span class="c1">#!/bin/bash</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch08-zabbix-lld-custom-__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ch08-zabbix-lld-custom-__codelineno-2-3"></a><span class="c1"># Find all users with UID ‚â• 1000 of UID = 0 from /etc/passwd, except &quot;nobody&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ch08-zabbix-lld-custom-__codelineno-2-4"></a><span class="nt">ALL_USERS=$(awk -F</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;($3</span><span class="nv"> </span><span class="s">&gt;=</span><span class="nv"> </span><span class="s">1000</span><span class="nv"> </span><span class="s">||</span><span class="nv"> </span><span class="s">$3</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">0)</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">$1</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&quot;nobody&quot;</span><span class="nv"> </span><span class="s">{print</span><span class="nv"> </span><span class="s">$1}&#39;</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/passwd)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ch08-zabbix-lld-custom-__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ch08-zabbix-lld-custom-__codelineno-2-6"></a><span class="c1"># Find all active users</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ch08-zabbix-lld-custom-__codelineno-2-7"></a><span class="l l-Scalar l-Scalar-Plain">ACTIVE_USERS=$(who | awk &#39;{print $1}&#39; | sort | uniq)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#ch08-zabbix-lld-custom-__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#ch08-zabbix-lld-custom-__codelineno-2-9"></a><span class="c1"># Begin JSON-output</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#ch08-zabbix-lld-custom-__codelineno-2-10"></a><span class="l l-Scalar l-Scalar-Plain">echo -n &#39;{&quot;data&quot;:[&#39;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#ch08-zabbix-lld-custom-__codelineno-2-11"></a><span class="l l-Scalar l-Scalar-Plain">FIRST=1</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#ch08-zabbix-lld-custom-__codelineno-2-12"></a><span class="l l-Scalar l-Scalar-Plain">for USER in $ALL_USERS; do</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#ch08-zabbix-lld-custom-__codelineno-2-13"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"># Check if the user is active</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#ch08-zabbix-lld-custom-__codelineno-2-14"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">if echo &quot;$ACTIVE_USERS&quot; | grep -q &quot;^$USER$&quot;; then</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#ch08-zabbix-lld-custom-__codelineno-2-15"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">ACTIVE=&quot;yes&quot;</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#ch08-zabbix-lld-custom-__codelineno-2-16"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">else</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#ch08-zabbix-lld-custom-__codelineno-2-17"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">ACTIVE=&quot;no&quot;</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#ch08-zabbix-lld-custom-__codelineno-2-18"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">fi</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#ch08-zabbix-lld-custom-__codelineno-2-19"></a>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#ch08-zabbix-lld-custom-__codelineno-2-20"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"># JSON-format</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#ch08-zabbix-lld-custom-__codelineno-2-21"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">if [ $FIRST -eq 0 ]; then echo -n &#39;,&#39;; fi</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#ch08-zabbix-lld-custom-__codelineno-2-22"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">echo -n &quot;{\&quot;{#USERNAME}\&quot;:\&quot;$USER\&quot;, \&quot;{#ACTIVE}\&quot;:\&quot;$ACTIVE\&quot;}&quot;</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#ch08-zabbix-lld-custom-__codelineno-2-23"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">FIRST=0</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#ch08-zabbix-lld-custom-__codelineno-2-24"></a><span class="l l-Scalar l-Scalar-Plain">done</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#ch08-zabbix-lld-custom-__codelineno-2-25"></a><span class="l l-Scalar l-Scalar-Plain">echo &#39;]}&#39;</span>
</span></code></pre></div>
</div>
<p>Once you have created the script don't forget to make it executable.</p>
<div class="admonition info">
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch08-zabbix-lld-custom-__codelineno-3-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo chmod +x /usr/bin/users-discovery.sh</span>
</span></code></pre></div>
</div>
<p>The script will be executed by the Zabbix agent and will return discovery data
about user sessions in the JSON format required for Low-Level Discovery processing.</p>
<p>Once deployed, this script will function as the data collection mechanism for our
user monitoring solution, enabling Zabbix to dynamically discover user sessions
and track login/logout activities across your infrastructure.</p>
<p><strong>User Provisioning for Testing</strong></p>
<p>Let's establish additional test user accounts on our system to ensure we have
sufficient data for validating our monitoring implementation. This will provide
a more comprehensive testing environment beyond the default root account and your
personal user account. Feel free to add as many users as you like.</p>
<div class="admonition info">
<p class="admonition-title">create some users</p>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch08-zabbix-lld-custom-__codelineno-4-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo for user in sven brian cartman kenny; do sudo useradd $user; done</span>
</span></code></pre></div>
Create a password for every user so that we can login on the console
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch08-zabbix-lld-custom-__codelineno-5-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo passwd &lt;user&gt;</span>
</span></code></pre></div></p>
</div>
<h3 id="ch08-zabbix-lld-custom-creating-a-template">Creating a Template</h3>
<p>It is always considered best practice to work with a template. The first step is
to create a template for the LLD rules.  </p>
<p>Navigate to <strong>Data collection</strong>, select <strong>Templates</strong>, and click <strong>Create template</strong>
in the upper-right corner.  </p>
<p>Fill in the required information, specifying at least a <strong>template name</strong> and 
the <strong>template group</strong> it belongs to.</p>
<p><img alt="lld user template" src="../ch08-zabbix-lld/custom-lld/template-lld-users.png" /></p>
<p>Once the template is created click on <code>Discovery</code> in the template between <code>Dashboards</code>
and <code>Web</code>. In the upper right corner of the screen you see now a button <code>create discovery rule</code>.</p>
<p>We will nog create our discovery rule that will import the <code>JSON</code> from our script.
Click on the button.</p>
<p>Fill in the needed information like on the screenshot :</p>
<p><img alt="discovery rule" src="../ch08-zabbix-lld/custom-lld/template-discovery-rule.png" /></p>
<h3 id="ch08-zabbix-lld-custom-creating-a-template-for-lld-rules">Creating a Template for LLD Rules</h3>
<ul>
<li><strong>Type</strong>: Set to <strong>Zabbix agent</strong>, as the agent is configured to work in passive
  mode. If the agent is properly configured for active mode, <strong>Zabbix agent (active)</strong>
  can be used instead. Passive mode allows polling information from the script.  </li>
<li><strong>Key</strong>: This key acts as a reference sent to the agent, instructing it on which
  script to execute.  </li>
<li><strong>Update Interval</strong>: Determines how often Zabbix executes the script. For detecting
  newly created users, an interval of <strong>one hour</strong> is a reasonable setting.</li>
</ul>
<details class="note" open="open">
<summary>Note</summary>
<p>If you put the update interval for the discovery rule too frequent like every
minute, then this will have a negative impact on the performance. In our case
it's a small JSON file but most of the time it will contain much more data.</p>
</details>
<p>Once everything is filled in we can save the template.</p>
<p>Login to your console on the host that you would like to monitor and go to the
following path. </p>
<div class="admonition info">
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch08-zabbix-lld-custom-__codelineno-6-1"></a><span class="l l-Scalar l-Scalar-Plain">cd `/etc/zabbix/zabbix_agent2.d/`</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch08-zabbix-lld-custom-__codelineno-6-2"></a><span class="l l-Scalar l-Scalar-Plain">or in case you are using Agent 1</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch08-zabbix-lld-custom-__codelineno-6-3"></a><span class="l l-Scalar l-Scalar-Plain">cd `/etc/zabbix/zabbix_agentd.d/`</span>
</span></code></pre></div>
</div>
<h3 id="ch08-zabbix-lld-custom-creating-the-user-parameter-configuration">Creating the User Parameter Configuration</h3>
<p>The next step is to create the <strong>userparameter-users.conf</strong> file in this directory.
This file will define the reference key <strong>users.discovery</strong> from the LLD rule and
map it to the corresponding script. By doing this, Zabbix can associate the item
key with the correct script execution.</p>
<div class="admonition info">
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch08-zabbix-lld-custom-__codelineno-7-1"></a><span class="l l-Scalar l-Scalar-Plain">vi userparameter-users.conf</span>
</span></code></pre></div>
</div>
<p>Add the following line in the config file and save it.</p>
<div class="admonition info">
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch08-zabbix-lld-custom-__codelineno-8-1"></a>UserParameter=users.discovery,/usr/bin/users-discovery.sh
</span></code></pre></div>
</div>
<details class="note" open="open">
<summary>Note</summary>
<p>When you add a new <code>UserParameter</code> to the agent we need to restart the agent
to pick up the new config or use the config option <code>-R userparameter_reload</code>
on our agent this will apply the new configuration but only works on UserParameters
not on other changes in the agent configuration.</p>
</details>
<h3 id="ch08-zabbix-lld-custom-saving-the-template-and-preparing-the-monitored-host">Saving the Template and Preparing the Monitored Host</h3>
<p>After entering all the required details, save the template to apply the configuration.<br />
Next, access the console of the host you want to monitor and navigate to the following
directory.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>Zabbix agent has a new option since 6.0, <code>userparameter_reload</code>. This allows
us to reload the config for the userparameters and makes a restart of the agent
not necessary.</p>
</details>
<h3 id="ch08-zabbix-lld-custom-testing-the-configuration">Testing the Configuration</h3>
<p>With the setup complete, it is time to perform some tests.  </p>
<ol>
<li>Navigate to <strong>Data collection</strong> and select <strong>Hosts</strong>.  </li>
<li>Link the newly created template to the appropriate host in the Zabbix frontend.  </li>
<li>Once the template is linked, go to the <strong>Discovery</strong> section.  </li>
<li>Click on the discovery rule created earlier, <strong>Active users</strong>.  </li>
<li>At the bottom of the screen, locate the <strong>Test</strong> button and click on it.  </li>
<li>In the popup window, press <strong>Get value and test</strong>.  </li>
</ol>
<p>If everything is configured correctly, Zabbix will retrieve the expected value and
store it in the database.</p>
<p><img alt="lld-test" src="../ch08-zabbix-lld/custom-lld/lld-discovery-test.png" /></p>
<p>If all went well you should have received some data back in JSON like you see here, 
depending on the number of users you made and what name you gave them.</p>
<div class="admonition info">
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch08-zabbix-lld-custom-__codelineno-9-1"></a><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ch08-zabbix-lld-custom-__codelineno-9-2"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#ch08-zabbix-lld-custom-__codelineno-9-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#ch08-zabbix-lld-custom-__codelineno-9-4"></a><span class="w">      </span><span class="nt">&quot;{#USERNAME}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;root&quot;</span><span class="p">,</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#ch08-zabbix-lld-custom-__codelineno-9-5"></a><span class="w">      </span><span class="nt">&quot;{#ACTIVE}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#ch08-zabbix-lld-custom-__codelineno-9-6"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#ch08-zabbix-lld-custom-__codelineno-9-7"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#ch08-zabbix-lld-custom-__codelineno-9-8"></a><span class="w">      </span><span class="nt">&quot;{#USERNAME}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;brian&quot;</span><span class="p">,</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#ch08-zabbix-lld-custom-__codelineno-9-9"></a><span class="w">      </span><span class="nt">&quot;{#ACTIVE}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#ch08-zabbix-lld-custom-__codelineno-9-10"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#ch08-zabbix-lld-custom-__codelineno-9-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#ch08-zabbix-lld-custom-__codelineno-9-12"></a><span class="w">      </span><span class="nt">&quot;{#USERNAME}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sven&quot;</span><span class="p">,</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#ch08-zabbix-lld-custom-__codelineno-9-13"></a><span class="w">      </span><span class="nt">&quot;{#ACTIVE}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#ch08-zabbix-lld-custom-__codelineno-9-14"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#ch08-zabbix-lld-custom-__codelineno-9-15"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#ch08-zabbix-lld-custom-__codelineno-9-16"></a><span class="w">      </span><span class="nt">&quot;{#USERNAME}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cartman&quot;</span><span class="p">,</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#ch08-zabbix-lld-custom-__codelineno-9-17"></a><span class="w">      </span><span class="nt">&quot;{#ACTIVE}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#ch08-zabbix-lld-custom-__codelineno-9-18"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#ch08-zabbix-lld-custom-__codelineno-9-19"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#ch08-zabbix-lld-custom-__codelineno-9-20"></a><span class="w">      </span><span class="nt">&quot;{#USERNAME}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kenny&quot;</span><span class="p">,</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#ch08-zabbix-lld-custom-__codelineno-9-21"></a><span class="w">      </span><span class="nt">&quot;{#ACTIVE}&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#ch08-zabbix-lld-custom-__codelineno-9-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#ch08-zabbix-lld-custom-__codelineno-9-23"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#ch08-zabbix-lld-custom-__codelineno-9-24"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<h3 id="ch08-zabbix-lld-custom-creating-prototype-items">Creating prototype items.</h3>
<p>With our Low-Level Discovery (LLD) rule in place, we are ready to create our LLD
item prototype. Follow these steps to configure the item prototype correctly:</p>
<ol>
<li>
<p><strong>Navigating to Item Prototype Configuration</strong>
   - Open your template in Zabbix.
   - Click on the <strong>Discovery</strong> tab.
   - Navigate to <strong>Item Prototypes</strong>.
   - Click on <strong>Create Item Prototype</strong> in the upper-right corner.</p>
</li>
<li>
<p><strong>Configuring the Item Prototype</strong>
   Several key fields must be completed for the prototype to function correctly:</p>
</li>
</ol>
<ul>
<li>
<p><strong>Name:</strong></p>
<ul>
<li>Use the macro <code>{#USERNAME}</code> to create dynamically generated item names.</li>
<li>Example: <code>User {#USERNAME} login status</code>.</li>
</ul>
</li>
<li>
<p><strong>Type:</strong></p>
<ul>
<li>Select <code>Zabbix agent</code> as the item type to facilitate testing.</li>
</ul>
</li>
<li>
<p><strong>Key:</strong></p>
<ul>
<li>The item key must be unique.</li>
<li>Utilize macros to ensure a unique key for each item instance.</li>
</ul>
</li>
<li>
<p><strong>Type of Information:</strong></p>
<ul>
<li>Defines the format of the received data.</li>
<li>Since our script returns <code>0</code> or <code>1</code>, set this to <code>Numeric</code>.</li>
</ul>
</li>
<li>
<p><strong>Update Interval:</strong></p>
<ul>
<li>Determines how frequently the item is checked.</li>
<li>A reasonable interval for checking user online status is <code>1m</code> (one minute).</li>
</ul>
</li>
</ul>
<p>With these configurations, your LLD item prototype is ready for deployment.</p>
<p><img alt="create lld item" src="../ch08-zabbix-lld/custom-lld/lld-item-create.png" /></p>
<h3 id="ch08-zabbix-lld-custom-configuring-the-agent-to-listen-for-lld-items">Configuring the Agent to Listen for LLD Items</h3>
<p>Our LLD item will retrieve data from the key custom.user[{#USERNAME}], so the next
step is to configure the agent to listen for this key.</p>
<ul>
<li>Edit the <code>userparameter-users.conf</code> file that was created earlier on the <code>Zabbix agent</code>.</li>
<li>Add the following line to the configuration file:</li>
</ul>
<div class="admonition info">
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch08-zabbix-lld-custom-__codelineno-10-1"></a>UserParameter=custom.user[*],who | grep -c &quot;$1&quot;
</span></code></pre></div>
</div>
<ul>
<li>This configuration ensures that the agent listens for requests using the
  <code>custom.user[{#USERNAME}]</code> key.</li>
<li>The <code>{#USERNAME}</code> macro is dynamically replaced with usernames extracted from
  the discovery rule.</li>
</ul>
<details class="note" open="open">
<summary>Note</summary>
<p>Important: After making changes to the configuration file, restart the <code>Zabbix agent</code>
or reload the configuration to apply the new settings.</p>
</details>
<p>With these configurations in place, your LLD item prototype is fully set up and ready
for deployment.</p>
<h3 id="ch08-zabbix-lld-custom-testing-our-lld-items">Testing our lld items</h3>
<p>Before we put things in production we can of course test it. Press the <code>test</code> button
at the bottom. Fill in the needed information: </p>
<ul>
<li><strong>Host address</strong> : the IP or DNS name where we have our scripts configured on our agent.</li>
<li><strong>Port</strong> : the agent port. This should be 10050 unless you have changed it for some reason.</li>
<li><strong>Macros</strong> : map the macro with one of the user names you have configured on your system.</li>
</ul>
<p>Press <code>Get value</code> and if all goes well Zabbix will return the value 1 or 0 depending
if the user is online or not.</p>
<p><img alt="test lld item" src="../ch08-zabbix-lld/custom-lld/lld-test-item.png" /></p>
<p>Apply the template to your host and have a look at the latest data. Things should
slowly start to populate.</p>
<h3 id="ch08-zabbix-lld-custom-adding-lld-triggers">Adding LLD triggers</h3>
<p>Let's go back to our template to our <code>Discovery</code> and select <code>Trigger prototype</code>.
Click on the top right on <code>Create trigger prototype</code>.
Fill in the following fields:</p>
<ul>
<li><strong>Name</strong> : <code>User {#USERNAME} is logged in</code> Again we want our information to be
  more dynamic so we make use of our macros in the name of our trigger.</li>
<li><strong>Severity</strong> : We select the severity level here. <code>Information</code> seems high enough.</li>
<li><strong>Expression</strong> : We want to get a notification if someone is online you can
  make use of the <code>Add</code> button or just copy : <code>last(/Discover users/custom.user[{#USERNAME}])=1</code></li>
</ul>
<p><img alt="lld trigger" src="../ch08-zabbix-lld/custom-lld/lld-trigger.png" /></p>
<details class="note" open="open">
<summary>Note</summary>
<p>Copying the Expression will only work if you used the same name for the
template and item key.</p>
</details>
<p>You can  now log in with a user that we created before or root and have a look at
our dashboard. A notification should popup soon to inform you that a user was
logged in.</p>
<p><img alt="user root logged" src="../ch08-zabbix-lld/custom-lld/lld-user-root-loggedin.png" /></p>
<h3 id="ch08-zabbix-lld-custom-creating-lld-overrides">Creating LLD overrides.</h3>
<p>Having our notifications when users log in on our systems is a nice security feature
but i'm more worried when a user logs in with root then when for example Brian
logs in. When root logs in I would like to get the alert <code>High</code> instead of <code>Information</code>.</p>
<p>This is possible in Zabbix when we make use of overrides. Overrides allow us to
change the behaviour of our triggers under certain conditions.</p>
<p>Go to the template to the discovery rule <code>Active users</code>. Click on the tab <code>Overrides</code>.
Press on the button <code>Add</code> and fill in the needed information.</p>
<ul>
<li><strong>Name</strong> : A useful name for our override in our case we call it <code>high severity for user root</code>.</li>
<li><strong>Filters</strong> : Here we filter for certain information that we find in our LLD 
  macros. In our case we look in the macro <code>{#USERNAME}</code> for the user <code>root</code>.</li>
</ul>
<p><img alt="lld override" src="../ch08-zabbix-lld/custom-lld/lld-override.png" /></p>
<ul>
<li><strong>Operation</strong> : Here we define what needs to happen. We want to manipulate the
  trigger so select for object <code>Trigger prototype</code> and select that we want to modify
  the <code>Severity</code> and select <code>High</code>. This will modify the severity of our trigger
  and change it to <code>High</code> if the user that is detected is the user <code>root</code>.</li>
</ul>
<p><img alt="lld override operation " src="../ch08-zabbix-lld/custom-lld/lld-override-operation.png" /></p>
<details class="note" open="open">
<summary>Note</summary>
<p>It can take a while before changes are applied to your host. Don't panic this
is normal the discovery rule usually only updates every hour. If you like to
force this just go to your discovery rule on the host, select it and press <code>Execute now</code>.</p>
</details>
<p>Once everything is changed you can login on your system with the user <code>root</code> and
one of the other users. As you will see both triggers will fire off but with
different severity levels.</p>
<p><img alt="lld different severity" src="../ch08-zabbix-lld/custom-lld/lld-users-override.png" /></p>
<h1 id="ch08-zabbix-lld-custom-conclusion">Conclusion</h1>
<h1 id="ch08-zabbix-lld-custom-question">Question</h1>
<h1 id="ch08-zabbix-lld-custom-useful-urls">Useful URLs</h1></section><section class="print-page" id="ch08-zabbix-lld-lld-with-dependent-items" heading-number="13.3"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="low-level-discovery-with-dependent-items">Low Level Discovery with Dependent items</h1>
<p>Efficiency in monitoring isn't just about automation it's also about minimizing
resource usage. Low-Level Discovery (LLD) with dependent items in Zabbix offers
a powerful way to reduce agent load and database overhead by collecting data once
and extracting multiple metrics from it.</p>
<p>Instead of creating separate item queries for each discovered entity, dependent
items allow you to process a single data source such as a JSON response, log entry,
or SNMP bulk data and extract relevant metrics dynamically. This approach significantly
optimizes performance while maintaining full automation.</p>
<p>In this chapter, we'll explore how to implement LLD with dependent items, configure
preprocessing rules, and leverage this technique to make your Zabbix monitoring
more efficient, scalable, and resource friendly by using a practical example.</p>
<p>Let‚Äôs get started!</p>
<hr />
<details class="note" open="open">
<summary>Note</summary>
<p>For this chapter we start with a working system with a passive Zabbix agent.
You can always refer to Chapter 01 if you like to know how to setup Zabbix.
It can be a good start to have a look at our previous topic <code>Custom LLD</code> to get
a better understanding on how LLD works.</p>
</details>
<h2 id="ch08-zabbix-lld-lld-with-dependent-items-creating-our-custom-data">Creating our custom data</h2>
<p>Before we can implement our Low-Level Discovery (LLD) rule, we first need relevant
data to work with. Consider a scenario where a print server provides a list of printers
along with their status in JSON format. This structured data will serve as the foundation
for our discovery process.  </p>
<div class="admonition info">
<p class="admonition-title">Example data</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-2"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-4"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Color Printer 1&quot;</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-5"></a><span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OK&quot;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-6"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-7"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-8"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Color Printer 2&quot;</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-9"></a><span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OK&quot;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-10"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-12"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;B&amp;W Printer 1&quot;</span><span class="p">,</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-13"></a><span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OK&quot;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-14"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-15"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-16"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;B&amp;W Printer 2&quot;</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-17"></a><span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NOK&quot;</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-19"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-0-20"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<p>On your Zabbix server, log in and create a text file containing the example data
that will serve as the master item for our Low-Level Discovery (LLD) rule.</p>
<ol>
<li><strong>Access the Server</strong>: Log in to your Zabbix server via SSH or directly.</li>
<li><strong>Create the File</strong>: Run the following command to store the JSON data:</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Run the following command:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-1"></a>echo
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-2"></a>&#39;{
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-3"></a>  &quot;data&quot;: [
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-4"></a>    {
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-5"></a>      &quot;name&quot;: &quot;Color Printer 1&quot;,
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-6"></a>      &quot;status&quot;: &quot;OK&quot;
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-7"></a>    },
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-8"></a>    {
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-9"></a>      &quot;name&quot;: &quot;Color Printer 2&quot;,
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-10"></a>      &quot;status&quot;: &quot;OK&quot;
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-11"></a>    },
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-12"></a>    {
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-13"></a>      &quot;name&quot;: &quot;B&amp;W Printer 1&quot;,
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-14"></a>      &quot;status&quot;: &quot;OK&quot;
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-15"></a>    },
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-16"></a>    {
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-17"></a>      &quot;name&quot;: &quot;B&amp;W Printer 2&quot;,
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-18"></a>      &quot;status&quot;: &quot;NOK&quot;
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-19"></a>    }
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-20"></a>  ]
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-1-21"></a>}&#39; | sudo tee /home/printer-status.txt &gt; /dev/null
</span></code></pre></div>
</div>
<ol start="3">
<li><strong>Verify the File</strong>: Ensure the file is correctly created by running:</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Test the file</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-2-1"></a>cat /home/printer-status.json
</span></code></pre></div>
</div>
<h2 id="ch08-zabbix-lld-lld-with-dependent-items-create-a-master-item">Create a master item</h2>
<p>We are now ready to create an item in Zabbix to get the information in to our
master item. But first we need to create a host.</p>
<p>Go to <code>Data collection | Hosts</code> and click <code>Create host</code>. Fill in the <code>Host name</code>
and the <code>Host group</code> and create an <code>Agent interface</code>. Those are the only things
we need for our host and press <code>Add</code>.</p>
<p>Go to the host and click on <code>items</code> the next step will be to create our item so
that we can retrieve the data from our printers.</p>
<p><img alt="Create Host" src="../ch08-zabbix-lld/dependent%20lld/ch08-dependent-lld-create-host.png" />
<em>8.1 Create host</em></p>
<details class="note" open="open">
<summary>Note</summary>
<p>Remember this is just an example file we made in real life you will use probably
a <code>HHTP agent</code> or a <code>Zabbix agent</code> to retrieve real life data.</p>
</details>
<p>Click on top right of the page on <code>Create item</code> to create a new item so that we
can retrieve our master items data.</p>
<p>Once the <code>New Item</code> popup is on the screen fill in the following details:</p>
<ul>
<li><strong>Name</strong> : RAW : Printer status page</li>
<li><strong>Type</strong> : Zabbix agent</li>
<li><strong>Key</strong> : vfs.file.contents[/home/printer-status.txt]</li>
</ul>
<p><img alt="Create lld item" src="../ch08-zabbix-lld/dependent%20lld/ch08-dependent-lld-item.png" />
<em>8.2 Create a LLD item</em></p>
<p>Before you press <code>Add</code> let's test our item first to see if we can retrieve the
data we need.</p>
<p>Press <code>Test</code> at the bottom of the page a popup will come and you can press at the
bottom of the page <code>Get value and test</code> or <code>Get value</code> just above. Both should work
and return you the information form the txt file.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>When you press <code>Get value</code> it
will show you the value as is retrieved from the host. <code>Get value and test</code> on
the other hand will also try to execute other pre processing steps if there are
any. So the output of the data could be different. Also if you use secret macros
Zabbix will not resolve them you will need to fill in the correct information
first by yourself.</p>
</details>
<p><img alt="test lld item" src="../ch08-zabbix-lld/dependent%20lld/ch08-dependent-lld-test-item.png" />
<em>8.3 Test LLD item</em></p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Keep a copy of the output somewhere you will need it in the following steps
to create your LLD rule and LLD items etc ...</p>
</details>
<h2 id="ch08-zabbix-lld-lld-with-dependent-items-create-lld-discovery">Create LLD Discovery</h2>
<p>To create a discovery rule first to go <code>Discovery rules</code> on the top next to Items,
Triggers and Graphs and click on <code>Create discovery rule</code>.</p>
<p><img alt="Create discovery rule" src="../ch08-zabbix-lld/dependent%20lld/ch08-dependent-lld-create-discovery.png" />
<em>8.4 Create a discovery rule</em></p>
<p>Before configuring our Low-Level Discovery (LLD) rule, we can test our JSON queries
using tools like <a href="https://www.jsonquerytool.com/">JSON Query Tool</a>. If we apply the
query <code>$..name</code>, it extracts all printer names, while <code>$..status</code> retrieves
their statuses.</p>
<p>However, referring to the <a href="https://www.zabbix.com/documentation/current/en/manual/discovery/low_level_discovery">Zabbix documentation</a>,
we see that starting from <strong>Zabbix 4.2</strong>, the expected JSON format for LLD has changed.
The <code>data</code> object is no longer required; instead, LLD now supports a direct JSON
array. This update enables features like <strong>item value preprocessing</strong> and
<strong>custom JSONPath queries</strong> for macro extraction.</p>
<p>While Zabbix still accepts legacy JSON structures containing a <code>data</code> object for
backward compatibility, its use is discouraged. If the JSON consists of a single
object with a <code>data</code> array, Zabbix will automatically extract its content using
<code>$.data</code>. Additionally, LLD now allows <strong>user-defined macros</strong> with custom JSONPath
expressions.  </p>
<p>Due to these changes, we cannot use the filters <code>$..name</code> or <code>$..status</code> directly.
Instead, we must use <code>$.name</code> and <code>$.status</code> for proper extraction. With this
understanding, let's proceed with creating our LLD rule.  </p>
<p>Head over to the <code>LLD macros</code> tab in our Discovery rule and map the following macros
with our JSONpath filters to extract the needed info so that we can use it later
in our LLD items, triggers, graphs .... .</p>
<ul>
<li><strong>{#PRINTER.NAME}</strong> : Map it with <code>$.name</code>.</li>
<li><strong>{#PRINTER.STATUS}</strong> : Map it with <code>$.status</code>.</li>
</ul>
<p><img alt="LLD Macros" src="../ch08-zabbix-lld/dependent%20lld/ch08-dependent-lld-create-lldmacro.png" />
<em>8.5 Create a LLD Macro</em></p>
<p>When ready press <code>Update</code> at the bottom of the page.</p>
<h2 id="ch08-zabbix-lld-lld-with-dependent-items-creating-a-low-level-discovery-lld-item">Creating a Low-Level Discovery (LLD) Item</h2>
<p>After defining the discovery rule and mapping the data to the corresponding LLD
macros, the next step is to create an LLD item. This is done through item prototypes.</p>
<ol>
<li>Navigate to the <code>Item prototypes</code> tab.  </li>
<li>Click Create <code>item prototype</code> in the upper-right corner.  </li>
<li>Configure the following parameters:  </li>
</ol>
<ul>
<li><strong>Name</strong>: <code>Status from {#PRINTER.NAME}</code>  </li>
<li><strong>Type</strong>: <code>Dependent item</code>  </li>
<li><strong>Key</strong>: <code>status.[{{#PRINTER.NAME}}]</code>  </li>
<li><strong>Type of information</strong>: <code>Text</code>  </li>
<li><strong>Master Item</strong>: Select the previously created raw item.  </li>
</ul>
<p>This setup ensures that the discovered printer statuses are correctly assigned and
processed through the LLD mechanism.  </p>
<p><img alt="LLD Item create" src="../ch08-zabbix-lld/dependent%20lld/ch08-dependent-lld-create-llditem.png" />
<em>8.6 Create a LLD item</em></p>
<p>Before saving the item, navigate to the <code>Preprocessing</code> tab to define the necessary
preprocessing steps. These steps will ensure that the extracted data is correctly
formatted for Zabbix. Configure the following preprocessing steps:</p>
<ol>
<li><strong>JSONPath</strong>: $.data..[?(@.name=='{#PRINTER.NAME}')].status.first()</li>
<li><strong>Replace</strong>:<br />
   - Convert <code>NOK</code> to <code>false</code>.<br />
   - This step is required because Zabbix does not recognize <code>NOK</code> as a boolean
     value but does recognize <code>false</code>.</li>
<li><strong>Boolean to Decimal</strong>:<br />
   - This conversion transforms boolean values into numerical representation
   (<code>1</code> for <code>OK</code>, <code>0</code> for <code>false</code>).
   - Numeric values are more suitable for graphing and analysis in Zabbix.</li>
<li><strong>Type of Information</strong>:<br />
   - Set to <strong>Numeric</strong> to ensure proper data processing and visualization.</li>
</ol>
<h3 id="ch08-zabbix-lld-lld-with-dependent-items-understanding-the-jsonpath-expression">Understanding the JSONPath Expression</h3>
<p>To derive the correct JSONPath query, use a tool such as the <code>JSON Query Tool</code>
(<a href="https://www.jsonquerytool.com/">https://www.jsonquerytool.com/</a>). This tool
allows testing and refining JSON queries using real data retrieved from the raw item.</p>
<p>The JSONPath query used in this case is:</p>
<div class="admonition info">
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-3-1"></a>$.data..[?(@.name==&#39;{#PRINTER.NAME}&#39;)].status.first()
</span></code></pre></div>
</div>
<h3 id="ch08-zabbix-lld-lld-with-dependent-items-breakdown-of-the-jsonpath-syntax">Breakdown of the JSONPath Syntax</h3>
<ul>
<li><strong><code>$</code></strong> ‚Üí Refers to the root of the JSON document.</li>
<li><strong><code>.data</code></strong> ‚Üí Accesses the <code>data</code> key within the JSON structure.</li>
<li><strong><code>..</code></strong> ‚Üí The recursive descent operator, searching through all nested levels
  for matching elements.</li>
<li><strong><code>[?(@.name=='{#PRINTER.NAME}')]</code></strong> ‚Üí A filter expression that:</li>
<li>Uses <code>?(@.name=='Color Printer 1')</code> to match objects where the <code>name</code> field
    equals <code>"Color Printer 1"</code>.</li>
<li><code>{#PRINTER.NAME}</code> is a Zabbix macro that dynamically replaces
    <code>"Color Printer 1"</code> with the discovered printer name.</li>
<li><strong><code>@</code></strong> ‚Üí Represents the current element being evaluated.</li>
<li><strong><code>.status</code></strong> ‚Üí Retrieves the <code>status</code> field from the filtered result.</li>
<li><strong><code>.first()</code></strong> ‚Üí Returns only the first matching <code>status</code> value instead of
  an array.</li>
<li>Without <code>.first()</code>, the result would be <code>["OK"]</code> instead of <code>"OK"</code>.</li>
</ul>
<p>By applying these preprocessing steps, we ensure that the extracted printer status
is correctly formatted and can be efficiently used for monitoring and visualization
in Zabbix.</p>
<h2 id="ch08-zabbix-lld-lld-with-dependent-items-optimizing-data-collection-and-discovery-performance">Optimizing Data Collection and Discovery Performance</h2>
<p>Before finalizing our configuration, we need to make an important adjustment.
The current settings may negatively impact system performance due to an overly frequent
update interval.</p>
<p>Navigate to <code>Data collection</code>|<code>Hosts</code> and click on <code>Items</code>. Select the <code>RAW item</code>
that was created in the first step.</p>
<p>By default, the update interval is set to <code>1 minute</code>. This means the item is
refreshed every minute, and since our LLD rule is based on this item, Zabbix will
rediscover printers every minute as well. While this ensures timely updates, it
is inefficient and can impact performance.</p>
<p>A common best practice is to configure <strong>discovery rules</strong> to run no more than
<code>once per hour</code>. However, since our <code>LLD item</code> relies on this same RAW item, an
hourly interval would be too infrequent for monitoring printer status updates.
To strike a balance between efficiency and real-time monitoring, we can apply
a <code>preprocessing trick</code>.</p>
<p>Go to the <code>Preprocessing</code> tab and add the following preprocessing step:</p>
<ul>
<li><strong>Discard unchanged with heartbeat</strong> ‚Üí <code>1h</code></li>
</ul>
<p>This ensures that the database is updated <code>only when a status change occurs</code>. If
no status change is detected, <code>no new entry is written to the database</code>, reducing
unnecessary writes and improving performance. However, to ensure some data is
still recorded, the status will be written to the database at least <code>once per hour</code>,
even if no changes occur.</p>
<p>Before saving the changes, we can further optimize storage by preventing the
master item from being stored in the database. Navigate back to the <code>Item</code> tab and
set <code>History</code> to <code>Do not store</code>.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>If you change your mind and want to keep the history then our preprocessing step
will at least not save it every minute but only when there are changes or once
every hour.</p>
</details>
<p>The RAW item is only used to feed data into the <strong>LLD discovery rule</strong> and <code>LLD items</code>.
Since we do not need to retain historical data for this master item,
<code>discarding it</code> saves database space and improves efficiency.</p>
<p>By applying these optimizations, we ensure that our monitoring system remains
efficient while still capturing necessary status updates.</p>
<h2 id="ch08-zabbix-lld-lld-with-dependent-items-creating-a-low-level-discovery-lld-filter">Creating a Low-Level Discovery (LLD) Filter</h2>
<p>Now lets have some fun and use a script that generates the output of our text file
with random statuses so that we have a more close to real live environment.
Create in the folder where your <code>printer-status.txt</code> file is a new file called
<code>printer-demo.py</code> and paste following content in it.</p>
<div class="admonition info">
<p class="admonition-title">python script</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-1"></a>#!/usr/bin/env python3
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-3"></a>import json
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-4"></a>import os
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-6"></a>STATUS_FILE = &quot;printer-status.txt&quot;
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-8"></a># Define printers
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-9"></a>printers = [
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-10"></a>    {&quot;name&quot;: &quot;Color Printer 1&quot;, &quot;status&quot;: &quot;OK&quot;},
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-11"></a>    {&quot;name&quot;: &quot;Color Printer 2&quot;, &quot;status&quot;: &quot;OK&quot;},
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-12"></a>    {&quot;name&quot;: &quot;B&amp;W Printer 1&quot;, &quot;status&quot;: &quot;OK&quot;},
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-13"></a>    {&quot;name&quot;: &quot;B&amp;W Printer 2&quot;, &quot;status&quot;: &quot;NOK&quot;},
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-14"></a>    {&quot;name&quot;: &quot;This is not a printer&quot;, &quot;status&quot;: &quot;NOK&quot;}
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-15"></a>]
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-16"></a>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-17"></a># Check if the status file exists
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-18"></a>if os.path.exists(STATUS_FILE):
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-19"></a>    # Read the existing status from the file
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-20"></a>    with open(STATUS_FILE, &quot;r&quot;) as f:
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-21"></a>        output = json.load(f)
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-22"></a>    printers = output[&quot;data&quot;]
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-23"></a>else:
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-24"></a>    # If no file, set initial values
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-25"></a>    output = {&quot;data&quot;: printers}
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-26"></a>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-27"></a># Toggle statuses
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-28"></a>for printer in printers:
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-29"></a>    printer[&quot;status&quot;] = &quot;NOK&quot; if printer[&quot;status&quot;] == &quot;OK&quot; else &quot;OK&quot;
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-30"></a>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-31"></a># Write the new status to file
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-32"></a>with open(STATUS_FILE, &quot;w&quot;) as f:
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-33"></a>    json.dump({&quot;data&quot;: printers}, f, indent=2)
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-34"></a>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#ch08-zabbix-lld-lld-with-dependent-items-__codelineno-4-35"></a>print(f&quot;Printer status updated and written to {STATUS_FILE}&quot;)
</span></code></pre></div>
</div>
<p>Once you have created the script make it executable with <code>chmod +x printer-demo.py</code>
and then run the script with the following command <code>./printer-demo.py</code>.</p>
<p>If you cannot run the script then check the python environment or try to run it
as <code>python printer-demo.py</code>.</p>
<p>This script will change the status of our printers you can verify this in the
<code>Latest data</code> page.</p>
<p><img alt="Latest data updated" src="../ch08-zabbix-lld/dependent%20lld/ch08-dependent-lld-create-latestdata-updated.png" />
<em>8.7 Latest data</em></p>
<p>But hey wait as we can see there is an extra devices detected with the name
<code>This is not a printer</code> and Zabbix hasn't detected any status for it .....</p>
<p>That we don't have any status yet is normal remember we did a check only once per
hour with our Preprocessing step so first time the data was changed the new device
was detected. If the status from the device changes again zabbix will create an update
for the item and a status will be processed.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>Low Level will work in 2 steps first step is the detection of the new devices
and second step is populating the items with the correct data. Remember that
we did an item interval of 1m so it can take up to 1m before our items gets a
new value.</p>
</details>
<p>Lets see now how we can remove the device <code>this is not a printer</code> from our list
since we don't want to monitor this one.</p>
<p>Let's go back to our LLD discovery rule this time to the tab Filters and add the
following to the fields:</p>
<ul>
<li><strong>Label</strong> : {#PRINTER.NAME} <code>does not match</code></li>
<li><strong>regular expression</strong> : <code>{$PRINTERS.NOT.TO.DETECT}</code></li>
</ul>
<p><img alt="LLD Filters" src="../ch08-zabbix-lld/dependent%20lld/ch08-dependent-lld-create-filters.png" />
<em>8.8 LLD Filters</em></p>
<p>Press update and go to our Host and click on the tab <code>Macros</code>. Here we will create
our macro and link it with a regular expression.
Fill in the following values :</p>
<ul>
<li><strong>Macro</strong>: {$PRINTERS.NOT.TO.DETECT}</li>
<li><strong>Value</strong> : ^This is not a printer$</li>
</ul>
<p><img alt="Filter macros" src="../ch08-zabbix-lld/dependent%20lld/ch08-dependent-lld-create-filter-macro.png" />
<em>8.9 LLD Filter Macros</em></p>
<p>After executing our discovery rule and sending updated values to Zabbix, we can
verify the filter's effectiveness by checking the <code>Latest data</code> view, where the
excluded device no longer appears.</p>
<p>When navigating to the <code>Items</code> section of our host, we'll observe that the previously
discovered item for the filtered device now displays a <code>Disabled</code> status with an
accompanying orange exclamation mark icon. Hovering over this icon reveals the
system notification: <code>The item is not discovered anymore and has been disabled,
will be deleted in 6d 23h 36m.</code></p>
<p>This automatic cleanup behavior for undiscovered items follows Zabbix's default
retention policy, which can be customized by modifying the <code>Keep lost resources period</code>
parameter in the Discovery rule settings to align with your organization's monitoring
governance requirements.</p>
<p>This concludes our chapter.</p>
<h2 id="ch08-zabbix-lld-lld-with-dependent-items-conclusion">Conclusion</h2>
<p>Low-Level Discovery in Zabbix represents a powerful approach to dynamic monitoring
that scales efficiently with your infrastructure. Through this chapter, we've explored
how the combination of LLD with dependent items and discovery filters creates a robust
framework for automated monitoring that remains both comprehensive and manageable.</p>
<p>By implementing dependent items within discovery rules, we've seen how to build
sophisticated monitoring relationships without the performance overhead of multiple
direct checks. This approach not only reduces the load on monitored systems but
also simplifies the overall monitoring architecture by establishing clear parent-child
relationships between metrics.</p>
<p>The strategic application of LLD filters, as demonstrated in our examples, transforms
raw discovery data into precisely targeted monitoring. Instead of drowning in irrelevant
metrics, your Zabbix instance now focuses only on what matters to your organization's
specific needs. Whether filtering by regex patterns, system types, or operational
states, these filters act as the gatekeepers that maintain monitoring relevance
as your environment expands.</p>
<p>Perhaps most importantly, the techniques covered in this chapter enable truly scalable
monitoring that grows automatically with your infrastructure. New servers, applications,
or network devices are seamlessly incorporated into your monitoring framework without
manual intervention, ensuring that visibility expands in lockstep with your environment.</p>
<p>As you implement these concepts in your own Zabbix deployments, remember that effective
monitoring is about balance and capturing sufficient detail while avoiding data overload.
The combination of LLD, dependent items, and thoughtful filtering provides exactly
this balance, giving you the tools to build monitoring systems that scale without
sacrificing depth or precision.</p>
<p>With these techniques at your disposal, your Zabbix implementation can evolve from
a basic monitoring tool to an intelligent system that adapts to your changing infrastructure,
providing actionable insights without constant reconfiguration.</p>
<h2 id="ch08-zabbix-lld-lld-with-dependent-items-questions">Questions</h2>
<ul>
<li>How do LLD filters change the monitoring paradigm from "collect everything"
  to a more targeted approach?</li>
<li>How does Zabbix LLD fundamentally differ from traditional static monitoring
  approaches ?</li>
<li>Break down the components of the JSONPath expression $.data..[?(@.name=='{#PRINTER.NAME}')].status.first()
  and explain how each part contributes to extracting the correct data.</li>
<li>How would you modify the example to monitor printer ink levels in addition to
  printer status?</li>
</ul>
<h2 id="ch08-zabbix-lld-lld-with-dependent-items-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.jsonquerytool.com/">https://www.jsonquerytool.com/</a></li>
<li><a href="https://regex101.com/">https://regex101.com/</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/discovery/low_level_discovery#filter">https://www.zabbix.com/documentation/current/en/manual/discovery/low_level_discovery#filter</a></li>
<li><a href="https://blog.zabbix.com/lld-filtering-with-macros/24959/">https://blog.zabbix.com/lld-filtering-with-macros/24959/</a></li>
</ul></section></section>
                    <section class='print-page md-section' id='section-14' heading-number='14'>
                        <h1>Chapter 09 : Extending Zabbix<a class='headerlink' href='#section-14' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch09-zabbix-extending-chapter" heading-number="14.1"><h1 id="ch09-zabbix-extending-chapter-leveraging-custom-items-for-extending-the-zabbix-environment">Leveraging custom items for extending the Zabbix environment</h1>
<p>In this chapter, we'll take a <strong>deep dive into extending Zabbix functionality</strong>
beyond its default item options. We'll cover the <strong>script item</strong>, <strong>external checks</strong>,
<strong>remote commands</strong>, <strong>user parameters</strong>, and other advanced features that allow
you to customize and expand your monitoring capabilities.</p>
<p>You'll learn how to use these tools to <strong>integrate custom logic</strong>, monitor external
applications, and automate tasks, making Zabbix an even more powerful and flexible
solution tailored to your specific needs. </p>
<p>By the end, you'll have the skills to push Zabbix beyond its default configuration,
unlocking new possibilities for complex and unique monitoring scenarios.</p></section><section class="print-page" id="ch09-zabbix-extending-frontend-scripts" heading-number="14.2"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="frontend-scripts">Frontend Scripts</h1>
<p>So, you're diving into the world of Zabbix frontend scripts, and you're in for 
a treat! These little powerhouses unlock a whole new level of flexibility within
your Zabbix environment. Imagine being able to trigger custom actions directly from
your Zabbix interface ‚Äì whether it's as an action operation responding to an alert,
a manual intervention on a host, or a targeted response to a specific event.</p>
<p>What's truly exciting is <em>where</em> you can weave these scripts into your daily Zabbix
workflow. Picture adding custom menu items right within your <strong>Hosts</strong>, <strong>Problems</strong>,
<strong>Dashboards</strong>, and even your <strong>Maps</strong> sections. This means the information and
tools you need are always at your fingertips.</p>
<p>Ultimately, frontend scripts empower you to extend Zabbix far beyond it's out-of-the-box
capabilities. They provide that crucial extra layer of customization, allowing you
to seamlessly integrate your own scripts and workflows directly into the Zabbix
frontend. Get ready to harness this power and tailor Zabbix precisely to your needs!</p>
<h2 id="ch09-zabbix-extending-frontend-scripts-creating-a-frontend-scripts">Creating a frontend scripts</h2>
<p>For this example, we'll work with a frontend script I developed that lets you put
hosts in maintenance mode. This script makes it possible to add a convenient option
in your GUI, allowing you to place hosts in maintenance with just a few clicks.
You can download the script from our GitHub repository :</p>
<p><a href="https://github.com/penmasters/trikke76-fork/blob/master/maintenance/">https://github.com/penmasters/trikke76-fork/blob/master/maintenance/</a></p>
<p>The original version can be found here:</p>
<p><a href="https://github.com/Trikke76/Zabbix/tree/master/maintenance">https://github.com/Trikke76/Zabbix/tree/master/maintenance</a></p>
<div class="admonition info">
<p class="admonition-title">Download this script and place it in <code>/usr/bin/</code> </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch09-zabbix-extending-frontend-scripts-__codelineno-0-1"></a>cd /usr/bin/
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch09-zabbix-extending-frontend-scripts-__codelineno-0-2"></a>sudo dnf install wget -y
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch09-zabbix-extending-frontend-scripts-__codelineno-0-3"></a>wget https://raw.githubusercontent.com/Trikke76/Zabbix/refs/heads/master/maintenance/zabbix-maintenance.py -P /usr/bin/
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch09-zabbix-extending-frontend-scripts-__codelineno-0-4"></a>chmod +x /usr/bin/zabbix-maintenance.py
</span></code></pre></div>
</div>
<p>Our Python script relies on an additional package that needs to be installed before
running. Make sure you have this dependency set up on your system before executing the script.</p>
<div class="admonition info">
<p class="admonition-title">install python3-requests</p>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch09-zabbix-extending-frontend-scripts-__codelineno-1-1"></a>dnf install python3-requests
</span></code></pre></div>
Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch09-zabbix-extending-frontend-scripts-__codelineno-2-1"></a>sudo apt install python3-requests
</span></code></pre></div></p>
</div>
<details class="note" open="open">
<summary>Note</summary>
<p>For the user you can use the user <code>Admin</code> or you can create a new user. but
make sure this user has enough permissions to create a maintenance mode.
It's best practice to create a dedicated user for this in production.</p>
</details>
<p>Starting with Zabbix 7.2, token-based authentication is required when working with
the API. Each user can create their own tokens, while the <code>Super admin</code> has management
privileges over all tokens.</p>
<p>To create a token for your Admin user:</p>
<ul>
<li>Navigate to <code>User settings</code></li>
<li>Select the <code>API tokens</code> sections</li>
</ul>
<p><img alt="User API" src="../ch09-zabbix-extending/scripts/ch09-scripts-user.png" /></p>
<p><em>9.1 User API</em></p>
<p>After selecting <code>API tokens</code> from the menu, you'll land on the <code>API tokens</code> page.
Look for the <code>Create API</code> token button in the top right corner and click it to
begin the creation process.</p>
<p><img alt="Create API" src="../ch09-zabbix-extending/scripts/ch09-create-api.png" /></p>
<p><em>9.2 Create API page</em></p>
<p>A popup window will appear for creating your new API token. You'll need to provide
a unique <code>Name</code> for your token. While there's an option to set an expiration date,
we'll keep our token active indefinitely by leaving the time limit settings unchanged.</p>
<p><img alt="New API token" src="../ch09-zabbix-extending/scripts/ch09-new-api-token.png" /></p>
<p><em>9.3 Create new API token</em></p>
<p>A confirmation popup will display your newly created API token, showing the <code>Auth token</code>
string generated by Zabbix. Be sure to copy or write down this token immediately,
as it will no longer be visible once you click <code>Close</code>. If you lose this token,
you'll need to delete it and create a new one. There's no way to retrieve or view
the token again through the interface.</p>
<p><img alt="API Token Created" src="../ch09-zabbix-extending/scripts/ch09-api-token-added.png" /></p>
<p><em>9.4 Added API token</em></p>
<p>The next step is updating our script with the proper connection details. Edit the
script and modify the variables to include your Zabbix server's correct URL and
the token you just created. Pay attention to whether your server uses HTTP or HTTPS
protocol. Be sure the URL in your script matches your actual server configuration.</p>
<div class="admonition info">
<p class="admonition-title">Replace variables</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch09-zabbix-extending-frontend-scripts-__codelineno-3-1"></a>sudo vi /usr/bin/zabbix-maintenance.py
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch09-zabbix-extending-frontend-scripts-__codelineno-4-1"></a>ZABBIX_API_URL = &quot;https://zabbix-url.be/api_jsonrpc.php&quot;
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch09-zabbix-extending-frontend-scripts-__codelineno-4-2"></a>ZABBIX_API_TOKEN = &quot;API TOKEN&quot;
</span></code></pre></div></p>
</div>
<p>Now that our script is properly configured, we need to set it up in the Zabbix
interface. From the main Zabbix menu, navigate to <code>Alerts</code> and then select <code>Scripts</code>
from the dropdown to access the scripts configuration area.</p>
<p><img alt="Alerts scripts menu" src="../ch09-zabbix-extending/scripts/ch09-Alert-scripts-menu.png" /></p>
<p><em>9.5 Scripts menu</em></p>
<p>You should already see a few existing script  like <code>Ping</code>, <code>Traceroute</code>, .... that's
normal those where created with the installation of Zabbix. Press the button <code>Create scripts</code>
on the top right corner. A now form will popup where we will configure our maintenance
script. Fill out the following fields:</p>
<ul>
<li><em>Name:</em> Create maintenance no data collection</li>
<li><em>Scope</em> : Manual host action</li>
<li><em>Menu path</em> : Maintenance</li>
<li><em>Type</em> : Script </li>
<li><em>Execute on</em> : Zabbix proxy or server</li>
<li><em>Commands</em> : <code>/usr/bin/zabbix-maintenance.py create "{HOST.HOST}" {MANUALINPUT} no</code></li>
</ul>
<p>At the bottom we have a tab <code>Advanced configuration</code> Click on this and extra configuration
options will appear.</p>
<p>As you probably noticed we used in our <code>Command</code> the macro <code>{MANUALINPUT}</code> this
will be used to gather information from a user prompt. This allows us to ask
the user to fill in the time he wants to place the host in maintenance.</p>
<ul>
<li><em>Enable user input</em> : yes</li>
<li><em>Input prompt</em> : How many minutes do you want to place the host in maintenance ?</li>
<li><em>Input type</em> : String (A dropdown box can also be used in case you have a list of options)</li>
<li><em>Default string</em> : 60 (but we can use anything this will just be the default answer)</li>
<li><em>Input validation rule</em> : <code>(\d+)</code> (our regex in perl to only allow digits)</li>
<li><em>Enable confirmation</em> : yes</li>
<li><em>Confirmation text</em> : Are you sure ?</li>
</ul>
<p>If everything went well you should end up with a similar looking page :</p>
<p><img alt="Script form" src="../ch09-zabbix-extending/scripts/ch09-script-form.png" /></p>
<p><em>9.6 Script form</em></p>
<details class="note" open="open">
<summary>Note</summary>
<p>It is possible that you cannot select the Execute on <code>Zabbix server</code> and that
you see a warning <em>Global script execution on Zabbix server is disabled by
server configuration.</em> In this case, you will have to edit the Zabbix server
configuration file and change the config <code>EnableGlobalScripts=0</code> to
<code>EnableGlobalScripts=0</code> and restart the service.</p>
</details>
<p>When your are ready press <code>Add</code> at the bottom of the form. Let's test our script
to see if it works.</p>
<h3 id="ch09-zabbix-extending-frontend-scripts-testing-the-frontend-script">Testing the frontend script</h3>
<p>In Zabbix go to the menu <code>Monitoring</code> =&gt; <code>Hosts</code> and click on the host <code>Zabbix server</code>
and from the <code>scripts</code> menu select <code>Maintenance</code> and click on the sub Menu
<code>Create maintenance no data collection</code>. You should see a popup asking you how 
many minutes you like to place the host in maintenance.</p>
<p><img alt="Monitoring host" src="../ch09-zabbix-extending/scripts/ch09-host-testing-script.png" /></p>
<p><em>9.7 Create maintenance</em></p>
<p>When we click continue however we get a popup telling us that Zabbix cannot execute the script.</p>
<p><img alt="error execute" src="../ch09-zabbix-extending/scripts/ch09-error-execute-script.png" /></p>
<p><em>9.8 Error executing script</em></p>
<p>This error is normal Zabbix has an option in the configuration file of the <code>Zabbix server</code>
and the proxy that blocks the execution of global scripts. </p>
<p>We get a notification that <code>Zabbix</code> cannot execute the script. The config file
has an option to block global executions by default in the server or proxy config
activate the option "EnableGlobalScripts=1". Go to the <code>Zabbix server</code> configuration
file with you favourite editor and enable the parameter and restart the server service. </p>
<p>If all goes well this time you will see a popup telling you it was successful this time.</p>
<p><img alt="Maintenance ok" src="../ch09-zabbix-extending/scripts/ch09-ok-execute-script.png" /></p>
<p><em>9.9 Maintenance successful</em></p>
<p>When we look in our Zabbix menu under <code>Data collection</code> =&gt; <code>Maintenance</code> we can see
that a new maintenance was created for our host with the time we had specified.
This will allow us to create Maintenance windows for hosts from the frontend with
only a few clicks.</p>
<p>Even better we are now able to allow certain non <code>Admin</code> users to create <code>maintenance periods</code>
for hosts without the need to give special access rights or create special profiles.
We have in our config of our script the option to limit the use of this <code>frontend script</code>
to certain <code>Host groups</code> and <code>User groups</code>.</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>You can now create the same script but add the option <code>yes</code> instead of <code>no</code>
when it comes to data collection and you can also create a script to delete
the maintenance period by just replacing <code>create</code> with <code>delete</code> and remove
all options after "{HOST.HOST}". This way you are able to create <code>maintenance periods</code>
and delete them when not needed anymore per host.</p>
</details>
<h2 id="ch09-zabbix-extending-frontend-scripts-conclusion">Conclusion</h2>
<p>Congratulations! You've reached the end of this journey into Zabbix frontend scripts.
By now, you should have a solid understanding of how to create, implement, and manage
these tools to extend Zabbix's functionality.</p>
<p>We've covered a lot of ground, from the initial steps of crafting your own scripts
to seamlessly integrating them into the Zabbix frontend. You've learned how to gather
user input to make your scripts more dynamic and versatile, and, crucially, how to
configure user and host permissions to maintain a secure and controlled Zabbix environment.</p>
<p>The ability to tailor Zabbix to your specific needs with frontend scripts is a
significant advantage. It allows you to automate repetitive tasks, streamline workflows,
and gain deeper insights into your infrastructure. Whether you're automating routine
checks, creating custom dashboards, or integrating with external systems, the
knowledge you've gained here will enable you to effectively leverage Zabbix.</p>
<p>Remember, the examples and techniques presented in this book provide a foundation.
The true power of Zabbix frontend scripts lies in their flexibility and your ability
to adapt them to your specific needs. As you continue to explore and experiment,
you'll discover new ways to enhance your monitoring capabilities and optimize
your Zabbix setup.</p>
<h2 id="ch09-zabbix-extending-frontend-scripts-questions">Questions</h2>
<ul>
<li>Why are Zabbix frontend scripts useful?</li>
<li>What are some ways Zabbix frontend scripts can help automate tasks?</li>
<li>Why is it important to configure user and host permissions when using Zabbix frontend scripts?</li>
</ul>
<h2 id="ch09-zabbix-extending-frontend-scripts-useful-urls">Useful URLs</h2>
<ul>
<li>https://blog.zabbix.com/setting-up-manual-ticket-creation-using-zabbix-frontend-scripts/15550/</li>
<li>https://www.zabbix.com/documentation/current/en/manual/web_interface/frontend_sections/administration/scripts</li>
<li>https://github.com/Trikke76/Zabbix/tree/master/maintenance</li>
</ul></section><section class="print-page" id="ch09-zabbix-extending-user-parameters" heading-number="14.3"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="user-parameters">User Parameters</h1>
<h2 id="ch09-zabbix-extending-user-parameters-what-is-userparameter-and-when-to-use-it">What is <code>UserParameter</code> and when to use it?</h2>
<p><code>UserParameter</code> is one of the ways to tell Zabbix agent that you want to
collect something custom.</p>
<p>"Custom" in this context of data collection means something that is not already
provided as an item by Zabbix agent. So before implementing anything custom, be
sure that Zabbix doesn't provide it already out-of-the-box - either directly or
in combination with some other Zabbix native features, such as preprocessing or
dependent items. For example, you would not use it to measure CPU load, since
Zabbix agent has <code>system.cpu.load[]</code> item. Or you would not use it for simply
getting one line from some file because there is <code>vfs.file.contents[]</code> which
you can combine with preprocessing to extract specific line.</p>
<p>Configuring <code>UserParameter</code> is pretty straightforward and benefits can be
enormous, depending on your abilities to correctly collect and structure the
data of your interest. In the end, it is something that Zabbix agent executes
in order to collect data. It can be simple one liner or some sophisticated
sequence of commands. So it is highly related to one's ability to write those
"to be executed" commands in neat and efficient manner.</p>
<p>Main benefit of <code>UserParameter</code> is that logic behind data collection can be
absolutely anything. You have total freedom, there is no dependency on specific
technologies, programming languages or frameworks. There is basically one main
requirement ‚Äì Zabbix agent should be able to execute whatever you provide for
it as a command and it should produce some (hopefully meaningful) output.</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p><code>UserParameter</code> can be used not only to collect data, but also as a custom
LLD (Low level discovery) rule.</p>
</details>
<p>There are some other methods that allow you to collect custom data:</p>
<ul>
<li><code>zabbix_sender</code></li>
<li>Zabbix API (via <code>history.push</code>)</li>
<li><code>system.run[]</code> item</li>
</ul>
<p>Those are all great ways and have some clear use cases when you want to use each
of them. However, <code>UserParameter</code> is probably the most common and most widely
adopted way. It is kind of a perfect balance between simplicity in setting it
up and flexibility it brings. For example:</p>
<ul>
<li>once setting <code>UserParameter</code> up you don't have to care about running it and
also about checking interval. Zabbix agent will take care of running it and
you'll set checking frequency in Zabbix GUI once creating item there (opposite
to <code>zabbix_sender</code> case which is kind of a standalone in relation to Zabbix
server, thus you have to take care of running it on your own)</li>
<li>there is no need to take care of communication with Zabbix server itself or
knowing your item ID (opposite to Zabbix API approach)</li>
</ul>
<h2 id="ch09-zabbix-extending-user-parameters-creating-a-userparameter">Creating a <code>UserParameter</code></h2>
<p><code>UserParameter</code> is available for any OS where Zabbix agent can be installed. In
the following section we will talk about configuring it under Linux. However,
same main principles of configuring <code>UserParameter</code> on other systems are also
applicable.</p>
<h3 id="ch09-zabbix-extending-user-parameters-most-simple-implementation">Most simple implementation</h3>
<p>In most simple case, Zabbix agent configuration could be enriched with some
<code>UserParameter</code> directives directly in its main configuration. It has this
section in <code>zabbix_agent.conf</code>:</p>
<details class="info" open="open">
<summary>Default <code>UserParameter</code> section from <code>zabbix_agent.conf</code></summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch09-zabbix-extending-user-parameters-__codelineno-0-1"></a>### Option: UserParameter
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch09-zabbix-extending-user-parameters-__codelineno-0-2"></a>#       User-defined parameter to monitor. There can be several user-defined parameters.
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch09-zabbix-extending-user-parameters-__codelineno-0-3"></a>#       Format: UserParameter=&lt;key&gt;,&lt;shell command&gt;
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch09-zabbix-extending-user-parameters-__codelineno-0-4"></a>#       See &#39;zabbix_agentd&#39; directory for examples.
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch09-zabbix-extending-user-parameters-__codelineno-0-5"></a>#
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch09-zabbix-extending-user-parameters-__codelineno-0-6"></a># Mandatory: no
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch09-zabbix-extending-user-parameters-__codelineno-0-7"></a># Default:
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch09-zabbix-extending-user-parameters-__codelineno-0-8"></a># UserParameter=
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch09-zabbix-extending-user-parameters-__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ch09-zabbix-extending-user-parameters-__codelineno-0-10"></a>UserParameter=my.user.parameter,echo &quot;Hello World&quot;
</span></code></pre></div>
</details>
<h3 id="ch09-zabbix-extending-user-parameters-most-simple-implementation-the-better-way">Most simple implementation: the better way</h3>
<p>However, you should avoid such approach as above and better stick to keeping
your <code>UserParameter</code> definitions in separate files under <code>zabbix_agentd.d</code> (or
some other directory of your choice) for Zabbix agent to include:</p>
<details class="info" open="open">
<summary>Default <code>Include</code> section from <code>zabbix_agent.conf</code></summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch09-zabbix-extending-user-parameters-__codelineno-1-1"></a>### Option: Include
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch09-zabbix-extending-user-parameters-__codelineno-1-2"></a>#       You may include individual files or all files in a directory in the configuration file.
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch09-zabbix-extending-user-parameters-__codelineno-1-3"></a>#       Installing Zabbix will create include directory in /usr/local/etc, unless modified during the compile time.
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch09-zabbix-extending-user-parameters-__codelineno-1-4"></a>#
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ch09-zabbix-extending-user-parameters-__codelineno-1-5"></a># Mandatory: no
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ch09-zabbix-extending-user-parameters-__codelineno-1-6"></a># Default:
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#ch09-zabbix-extending-user-parameters-__codelineno-1-7"></a># Include=
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#ch09-zabbix-extending-user-parameters-__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#ch09-zabbix-extending-user-parameters-__codelineno-1-9"></a>Include=/etc/zabbix/zabbix_agentd.d/*.conf
</span></code></pre></div>
</details>
<details class="note" open="open">
<summary>Note</summary>
<p>For "Zabbix agent 2" this default <code>Include</code> directory is
<code>Include=/etc/zabbix/zabbix_agent2.d/*.conf</code></p>
</details>
<p>Here is an example of such <code>.conf</code> file:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch09-zabbix-extending-user-parameters-__codelineno-2-1"></a>binary@binary:~$<span class="w"> </span>cat<span class="w"> </span>/etc/zabbix/zabbix_agentd.d/userparameter_book.conf
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch09-zabbix-extending-user-parameters-__codelineno-2-2"></a><span class="nv">UserParameter</span><span class="o">=</span>my.user.parameter,echo<span class="w"> </span><span class="s2">&quot;Hello World&quot;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ch09-zabbix-extending-user-parameters-__codelineno-2-3"></a>binary@binary:~$
</span></code></pre></div>
<p>This way you have much cleaner approach of creating <code>UserParameter</code>
definitions. You can group them logically, you are not affected by main
configuration changes after Zabbix agent version upgrades, etc.</p>
<p>Please note, that you can specify as many <code>UserParameter</code> lines as you wish in
one such <code>.conf</code> file. That is how you can group them - by splitting into
different files if they have something in common.</p>
<h3 id="ch09-zabbix-extending-user-parameters-most-simple-implementation-the-best-way">Most simple implementation: the best way</h3>
<p>In case your <code>UserParameter</code> is not a one liner or just a few commands, you
should better store it as a script and define it in a way that this script is
being called, not a long sequence of commands. Technically script is also a
sequence of commands, but much easier to maintain, especially as it grows.</p>
<p>So our final first <code>UserParameter</code> configuration could be such:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch09-zabbix-extending-user-parameters-__codelineno-3-1"></a>binary@binary:~$<span class="w"> </span>cat<span class="w"> </span>/etc/zabbix/zabbix_agentd.d/userparameter_book.conf
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch09-zabbix-extending-user-parameters-__codelineno-3-2"></a><span class="nv">UserParameter</span><span class="o">=</span>my.user.parameter,/opt/scripts/binary/my.sh
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ch09-zabbix-extending-user-parameters-__codelineno-3-3"></a>binary@binary:~$<span class="w"> </span>cat<span class="w"> </span>/opt/scripts/binary/my.sh
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ch09-zabbix-extending-user-parameters-__codelineno-3-4"></a><span class="c1">#!/bin/bash</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ch09-zabbix-extending-user-parameters-__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ch09-zabbix-extending-user-parameters-__codelineno-3-6"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello World&quot;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ch09-zabbix-extending-user-parameters-__codelineno-3-7"></a>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ch09-zabbix-extending-user-parameters-__codelineno-3-8"></a><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#ch09-zabbix-extending-user-parameters-__codelineno-3-9"></a>binary@binary:~$
</span></code></pre></div>
<details class="warning" open="open">
<summary>Warning</summary>
<p>IMPORTANT! You must restart Zabbix agent after adding new <code>UserParameter</code>
(or use <code>zabbix_agentd -R userparameter_reload</code>)</p>
</details>
<h3 id="ch09-zabbix-extending-user-parameters-creating-item-on-zabbix-server-side">Creating item on Zabbix server side</h3>
<p>So we just learned about adding <code>UserParameter</code> on Zabbix agent side. But in
order for it to be collecting data, Zabbix server must also know about it.
Good thing is that instructing Zabbix server is really easy. It is not different
from creating any other item. The only difference is that you have to pay
attention to item key - it must match with the one you just configured on agent
side.</p>
<p>So just hit "Create item" on your host (or, of course, better on your template)
and fill in all the needed fields:</p>
<p><img alt="New Custom Item" src="../ch09-zabbix-extending/user-parameters/ch09-user-parameters-new-item.png" /></p>
<p>Depending on the nature of the data that you are collecting, set correct "Type
of information" as well as needed "Update interval". Once you are finished,
you will see data being collected:</p>
<p><img alt="New Custom Item - Result" src="../ch09-zabbix-extending/user-parameters/ch09-user-parameters-new-item-result.png" /></p>
<h3 id="ch09-zabbix-extending-user-parameters-creating-flexible-userparameter">Creating flexible <code>UserParameter</code></h3>
<p>Sometimes it's useful to have ability to pass some parameters for your
<code>UserParameter</code>. To be able to do so, configuration is a bit different. Once
creating <code>UserParameter</code>, you must use <code>[*]</code> along with your custom item key.
For example, let's create an item which will draw sine wave. It will accept
several parameters so we can draw different waves:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-1"></a>binary@binary:~$<span class="w"> </span>cat<span class="w"> </span>/etc/zabbix/zabbix_agentd.d/userparameter_sin.conf
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-2"></a><span class="nv">UserParameter</span><span class="o">=</span>sin<span class="o">[</span>*<span class="o">]</span>,/opt/scripts/binary/sin.sh<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="nv">$2</span><span class="w"> </span><span class="nv">$3</span><span class="w"> </span><span class="nv">$4</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-3"></a>binary@binary:~$<span class="w"> </span>cat<span class="w"> </span>/opt/scripts/binary/sin.sh
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-4"></a><span class="c1">#!/bin/bash</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-6"></a><span class="c1"># $1 - frequency multiplier (times_pi)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-7"></a><span class="c1"># $2 - amplitude</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-8"></a><span class="c1"># $3 - phase shift in multiples of pi</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-9"></a><span class="c1"># $4 - period length in seconds</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-11"></a><span class="nv">times_pi</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-12"></a><span class="nv">amplitude</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-13"></a><span class="nv">time_shift</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-14"></a><span class="nv">period</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$4</span><span class="s2">&quot;</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-15"></a>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-16"></a><span class="nv">pi</span><span class="o">=</span><span class="m">3</span>.141592653589793
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-17"></a>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-18"></a><span class="nv">now</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nv">period</span><span class="w"> </span><span class="k">))</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-19"></a>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-20"></a><span class="nv">value</span><span class="o">=</span><span class="k">$(</span>bc<span class="w"> </span>-l<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-21"></a><span class="s">scale=14</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-22"></a><span class="s">${amplitude} * s( (${time_shift} * ${pi}) + 2 * ${pi} * ${times_pi} * ${now} / ${period} )</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-23"></a><span class="s">EOF</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-24"></a><span class="k">)</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-25"></a>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-26"></a><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;%.8f\n&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-27"></a>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-28"></a><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#ch09-zabbix-extending-user-parameters-__codelineno-4-29"></a>binary@binary:~$
</span></code></pre></div>
<p>So now once creating items, we can provide parameters in <code>[]</code> part of item
keys, like:</p>
<p><img alt="New Custom Item" src="../ch09-zabbix-extending/user-parameters/ch09-user-parameters-new-flexible-item.png" /></p>
<p>Given that we want multiple different waves, we will clone such item with
different sets of parameters and end up in having all of them being collected:</p>
<p><img alt="New Custom Item - Result" src="../ch09-zabbix-extending/user-parameters/ch09-user-parameters-new-flexible-item-result.png" /></p>
<details class="note" open="open">
<summary>Note</summary>
<p>If you use <code>awk</code> in <code>UserParameter</code>, pay attention to using double dollar
sign <code>$$</code>, so that positional references remain unaltered, for example:
<code>UserParameter=demo.awk[*],echo $1 $2 | awk '{print $$2}'</code></p>
</details>
<h2 id="ch09-zabbix-extending-user-parameters-tips-and-tricks">Tips and tricks</h2>
<p><em>Test before going live</em></p>
<p>As mentioned, you need to restart Zabbix agent after adding new checks. If you
add them incorrectly, agent will stop and fail to start once being restarted,
thus better idea is to check it in advance with <code>zabbix_agentd -t</code>. For
example, here we have duplicated entries (same item key defined twice):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch09-zabbix-extending-user-parameters-__codelineno-5-1"></a>zabbix@binary:/$<span class="w"> </span>cat<span class="w"> </span>/etc/zabbix/zabbix_agentd.d/userparameter_book.conf
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch09-zabbix-extending-user-parameters-__codelineno-5-2"></a><span class="nv">UserParameter</span><span class="o">=</span>my.user.parameter,echo<span class="w"> </span><span class="s2">&quot;Hello World&quot;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch09-zabbix-extending-user-parameters-__codelineno-5-3"></a><span class="nv">UserParameter</span><span class="o">=</span>my.user.parameter,echo<span class="w"> </span><span class="s2">&quot;Hello World 2&quot;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ch09-zabbix-extending-user-parameters-__codelineno-5-4"></a>zabbix@binary:/$<span class="w"> </span>zabbix_agentd<span class="w"> </span>-t<span class="w"> </span>my.user.parameter
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ch09-zabbix-extending-user-parameters-__codelineno-5-5"></a>zabbix_agentd<span class="w"> </span><span class="o">[</span><span class="m">1505972</span><span class="o">]</span>:<span class="w"> </span>ERROR:<span class="w"> </span>cannot<span class="w"> </span>load<span class="w"> </span>user<span class="w"> </span>parameters:<span class="w"> </span>user<span class="w"> </span>parameter<span class="w"> </span><span class="s2">&quot;my.user.parameter,echo &quot;</span>Hello<span class="w"> </span>World<span class="w"> </span><span class="m">2</span><span class="s2">&quot;&quot;</span>:<span class="w"> </span>key<span class="w"> </span><span class="s2">&quot;my.user.parameter&quot;</span><span class="w"> </span>already<span class="w"> </span>exists
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#ch09-zabbix-extending-user-parameters-__codelineno-5-6"></a>zabbix@binary:/$
</span></code></pre></div>
<p>After removing the duplicate and checking once again, we will get value for the
defined item:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch09-zabbix-extending-user-parameters-__codelineno-6-1"></a>zabbix@binary:/$<span class="w"> </span>cat<span class="w"> </span>/etc/zabbix/zabbix_agentd.d/userparameter_book.conf
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch09-zabbix-extending-user-parameters-__codelineno-6-2"></a><span class="nv">UserParameter</span><span class="o">=</span>my.user.parameter,echo<span class="w"> </span><span class="s2">&quot;Hello World&quot;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch09-zabbix-extending-user-parameters-__codelineno-6-3"></a>zabbix@binary:/$<span class="w"> </span>zabbix_agentd<span class="w"> </span>-t<span class="w"> </span>my.user.parameter
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ch09-zabbix-extending-user-parameters-__codelineno-6-4"></a>my.user.parameter<span class="w">                             </span><span class="o">[</span>t<span class="p">|</span>Hello<span class="w"> </span>World<span class="o">]</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ch09-zabbix-extending-user-parameters-__codelineno-6-5"></a>zabbix@binary:/$
</span></code></pre></div>
<p><em>Make it executable and reachable</em></p>
<p>If <code>UserParameter</code> is a script and your environment is *nix, don't forget to
make it executable. Also, you will most likely craft your script under some
different user than the one Zabbix agent is running under (user <code>zabbix</code> by
default), so make sure this very user can run it (e.g. permissions to reach
script itself or do anything that is being done inside the script). Best way to
test it is to switch to this user and try to run it. For example, here we
forget that one of the directories in path where our script lives is not
reachable by anyone except us. So, it might look like this script is working,
but it is working just for us:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-1"></a>binary@binary:~$<span class="w"> </span>/opt/scripts/binary/my.sh
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-2"></a>Hello<span class="w"> </span>World
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-3"></a>binary@binary:~$<span class="w"> </span>sudo<span class="w"> </span>-u<span class="w"> </span>zabbix<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cd / &amp;&amp; exec bash&quot;</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-4"></a>zabbix@binary:/$<span class="w"> </span>/opt/scripts/binary/my.sh
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-5"></a>bash:<span class="w"> </span>/opt/scripts/binary/my.sh:<span class="w"> </span>Permission<span class="w"> </span>denied
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-6"></a>zabbix@binary:/$<span class="w"> </span>whoami
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-7"></a>zabbix
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-8"></a>zabbix@binary:/$<span class="w"> </span><span class="nb">exit</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-9"></a><span class="nb">exit</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-10"></a>binary@binary:~$<span class="w"> </span>namei<span class="w"> </span>-mo<span class="w"> </span>/opt/scripts/binary/my.sh
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-11"></a>f:<span class="w"> </span>/opt/scripts/binary/my.sh
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-12"></a><span class="w"> </span>drwxr-xr-x<span class="w"> </span>root<span class="w">   </span>root<span class="w">   </span>/
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-13"></a><span class="w"> </span>drwxr-xr-x<span class="w"> </span>root<span class="w">   </span>root<span class="w">   </span>opt
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-14"></a><span class="w"> </span>drwxrwxrwt<span class="w"> </span>root<span class="w">   </span>root<span class="w">   </span>scripts
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-15"></a><span class="w"> </span>drwxrwx---<span class="w"> </span>binary<span class="w"> </span>binary<span class="w"> </span>binary
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-16"></a><span class="w"> </span>-rwxrwxr-x<span class="w"> </span>binary<span class="w"> </span>binary<span class="w"> </span>my.sh
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#ch09-zabbix-extending-user-parameters-__codelineno-7-17"></a>binary@binary:~$
</span></code></pre></div>
<p><em>Be as fast as possible</em></p>
<p>Always pay attention to how long it takes for your <code>UserParameter</code> to collect
data. If it runs for too long you might hit Zabbix agent timeout. This timeout
is configurable on item level, so you can adjust it:</p>
<p><img alt="Custom Item - Timeout" src="../ch09-zabbix-extending/user-parameters/ch09-user-parameters-timeout.png" /></p>
<p>Also, be wise with number of such items. If you have many, especially more
heavy ones, observe if it doesn't affect overall agent (or even host itself!)
performance in collecting data. If checks are set to be in "active" mode and
run for relatively long time, they will eventually start blocking other active
checks, because active checks (on classic Agent, not Agent 2) are not processed
in parallel.</p>
<p><em>Use dependent items for splitting</em></p>
<p>If there are many similar data points to be collected, avoid having separate
<code>UserParameter</code> for each of them. Better have one master "text" type of item
with some structured format and apply dependent items on top.</p>
<p><em>Using UnsafeUserParameters</em></p>
<p>Some symbols are not allowed by default to be passed in arguments for the
<code>UserParameter</code>.</p>
<p>These are <code>\ ' " ` * ? [ ] { } ~ $ ! &amp; ; ( ) &lt; &gt; | # @</code>, plus newline
character.</p>
<p>If you really need it, you can enable it by setting <code>UnsafeUserParameters=1</code> in
Zabbix agent configuration.</p>
<p>One good example when you would like to enable it is if you want to pass
regular expressions as parameters. Their syntax often contains symbols in this
forbidden list.</p>
<h2 id="ch09-zabbix-extending-user-parameters-conclusion">Conclusion</h2>
<p>When setting up monitoring in whatever area, you will inevitably deal with a
need to monitor something "custom". Zabbix offers multiple ways to achieve it,
<code>UserParameter</code> being one of the most widely used.</p>
<p>In this section you have learned how to create simple custom checks, as well as
something more advanced.</p>
<p>As long as you are able to write some code which fulfils your custom needs,
Zabbix will be there to help you collect and visualize it!</p>
<h2 id="ch09-zabbix-extending-user-parameters-questions">Questions</h2>
<ul>
<li>Can you only use shell scripts as <code>UserParameter</code> under Linux?</li>
<li>Is it possible to pass some custom parameters for your <code>UserParameter</code>?</li>
<li>Your have a <code>UserParameter</code> that can produce both positive and negative
numbers as an output. Which "Type of information" will you choose once creating
item?</li>
</ul>
<h2 id="ch09-zabbix-extending-user-parameters-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/userparameters">https://www.zabbix.com/documentation/current/en/manual/config/items/userparameters</a></li>
<li><a href="https://blog.zabbix.com/extending-zabbix-the-power-of-scripting/">https://blog.zabbix.com/extending-zabbix-the-power-of-scripting/</a></li>
</ul></section></section>
                    <section class='print-page md-section' id='section-15' heading-number='15'>
                        <h1>Chapter 10 : Discovery<a class='headerlink' href='#section-15' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch10-zabbix-discovery-network-host-discovery" heading-number="15.1"><h1 id="ch10-zabbix-discovery-network-host-discovery-automating-adding-hosts-with-network-discovery">Automating adding hosts with network discovery</h1>
<p>In this chapter, we'll explore the powerful automation features in Zabbix called
<strong>network discovery</strong>. This tools are essential
for scaling your monitoring efforts by minimizing manual configuration and
ensuring new devices and services are seamlessly integrated into your Zabbix
environment.</p>
<p>We'll dive into <strong>network discovery</strong>, which can be used to scan a network for hosts, especially in large or rapidly changing environments.
We'll cover how to set up network discovery rules that allow us to find
hosts on the network with the Zabbix server or proxy, reducing administrative overhead and ensuring
all relevant data is captured efficiently.</p>
<p>By the end of this chapter, you'll have a thorough understanding of how to leverage
network discovery to create a more automated, scalable, and
efficient monitoring system.</p>
<h2 id="ch10-zabbix-discovery-network-host-discovery-conclusion">Conclusion</h2>
<h2 id="ch10-zabbix-discovery-network-host-discovery-questions">Questions</h2>
<h2 id="ch10-zabbix-discovery-network-host-discovery-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch10-zabbix-discovery-active-agent-autoregistration" heading-number="15.2"><h1 id="ch10-zabbix-discovery-active-agent-autoregistration-automating-adding-hosts-with-active-agent-autoregistration">Automating adding hosts with active agent autoregistration</h1>
<p>In this chapter, we'll explore the powerful automation features in Zabbix called
<strong>active agent autoregistration</strong>. This tools are essential
for scaling your monitoring efforts by minimizing manual configuration and
ensuring new devices and services are seamlessly integrated into your Zabbix
environment.</p>
<p>We'll dive into <strong>active agent autoregistration</strong>, which simplifies the
management of Zabbix agents, especially in large or rapidly changing environments.
We'll cover how to set up autoregistration rules that allow agents to register
themselves with the Zabbix server, reducing administrative overhead and ensuring
all relevant data is captured efficiently.</p>
<p>By the end of this chapter, you'll have a thorough understanding of how to leverage
active agent autoregistration to create a more automated, scalable, and
efficient monitoring system.</p>
<h2 id="ch10-zabbix-discovery-active-agent-autoregistration-conclusion">Conclusion</h2>
<h2 id="ch10-zabbix-discovery-active-agent-autoregistration-questions">Questions</h2>
<h2 id="ch10-zabbix-discovery-active-agent-autoregistration-useful-urls">Useful URLs</h2></section></section>
                    <section class='print-page md-section' id='section-16' heading-number='16'>
                        <h1>Chapter 11 : Visualisation<a class='headerlink' href='#section-16' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch11-zabbix-visualisation-graphs" heading-number="16.1"><h1 id="ch11-zabbix-visualisation-graphs-using-the-built-in-graphs">Using the built-in Graphs</h1>
<h2 id="ch11-zabbix-visualisation-graphs-conclusion">Conclusion</h2>
<h2 id="ch11-zabbix-visualisation-graphs-questions">Questions</h2>
<h2 id="ch11-zabbix-visualisation-graphs-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch11-zabbix-visualisation-dashboards" heading-number="16.2"><h1 id="ch11-zabbix-visualisation-dashboards-setting-up-dashboards">Setting up Dashboards</h1>
<h2 id="ch11-zabbix-visualisation-dashboards-conclusion">Conclusion</h2>
<h2 id="ch11-zabbix-visualisation-dashboards-questions">Questions</h2>
<h2 id="ch11-zabbix-visualisation-dashboards-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch11-zabbix-visualisation-maps" heading-number="16.3"><h1 id="ch11-zabbix-visualisation-maps-creating-maps-for-better-overviews">Creating Maps for better overviews</h1>
<h2 id="ch11-zabbix-visualisation-maps-conclusion">Conclusion</h2>
<h2 id="ch11-zabbix-visualisation-maps-questions">Questions</h2>
<h2 id="ch11-zabbix-visualisation-maps-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch11-zabbix-visualisation-built-in-reports" heading-number="16.4"><h1 id="ch11-zabbix-visualisation-built-in-reports-using-the-zabbix-built-in-reports">Using the Zabbix built in reports</h1>
<h2 id="ch11-zabbix-visualisation-built-in-reports-conclusion">Conclusion</h2>
<h2 id="ch11-zabbix-visualisation-built-in-reports-questions">Questions</h2>
<h2 id="ch11-zabbix-visualisation-built-in-reports-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch11-zabbix-visualisation-automated-pdf-reports" heading-number="16.5"><h1 id="ch11-zabbix-visualisation-automated-pdf-reports-creating-automated-pdf-reports">Creating automated PDF reports</h1>
<h2 id="ch11-zabbix-visualisation-automated-pdf-reports-conclusion">Conclusion</h2>
<h2 id="ch11-zabbix-visualisation-automated-pdf-reports-questions">Questions</h2>
<h2 id="ch11-zabbix-visualisation-automated-pdf-reports-useful-urls">Useful URLs</h2></section></section>
                    <section class='print-page md-section' id='section-17' heading-number='17'>
                        <h1>Chapter 12 : Zabbix API<a class='headerlink' href='#section-17' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch12-zabbix-api-chapter" heading-number="17.1"><h1 id="ch12-zabbix-api-chapter-zabbix-api">Zabbix API</h1>
<p>The Zabbix API is a crucial part for anyone looking to expand the capabilities of their Zabbix environment, automate time-consuming tasks and get information for usage in other systems. In this chapter we will go over various of these capabilities to expand our knowledge of the Zabbix API.</p></section><section class="print-page" id="ch12-zabbix-api-self-engaging" heading-number="17.2"><h1 id="ch12-zabbix-api-self-engaging-self-engaging">Self-engaging</h1>
<p>Welcome to Zabbix API self engaging methods. All upcoming chapters will address
the tools available to allow software to re-engage with itself. It is like
developing a small service(s) which runs on the top of Zabbix and do exactly
the tasks we told to do.
This is like simulating an extra employee in the company.</p>
<h2 id="ch12-zabbix-api-self-engaging-api-variables">API variables</h2>
<p>To start to engage with Zabbix API:</p>
<p>Create a dedicated service user. Go to <strong>Users</strong> =&gt; <strong>Users</strong>,
click <strong>Create user</strong>, set Username <strong>api</strong>,
install Groups <strong>No access to the frontend</strong>,
Under <strong>Permissions</strong> tab, assign user role <strong>Super admin role</strong>
which will automatically give user type <strong>Super admin</strong>.</p>
<p><img alt="Create API user" src="../ch12-zabbix-api/self-engaging/ch12.01-create-api-user.png" /></p>
<p><em>12.1
Create API user</em></p>
<p>Permissions tab:</p>
<p><img alt="API user permissions" src="../ch12-zabbix-api/self-engaging/ch12.02-api-user-permissions.png" /> </p>
<p><em>12.2
API user role and user type</em></p>
<p>Under <strong>Users</strong> =&gt; <strong>API tokens</strong> press <strong>New API token</strong>,
assign user <strong>api</strong>. We can uncheck <strong>Set expiration date and time</strong>,
press <strong>Add</strong>. Copy macro to clipboard.</p>
<p><img alt="Add token to user object" src="../ch12-zabbix-api/self-engaging/ch12.03-token-added-to-user.png" /> </p>
<p><em>12.3
Add token to user object</em></p>
<p>Visit <strong>Administration</strong> =&gt; <strong>Macros</strong> and install macro.
To simulate all upcoming chapters much faster,
consider running token in plain text.</p>
<p>Token <code>dafa06e74403ca317112cf5ddd3357b2ad2a2c5cb348665f294a53b4058cfbcf</code>
must be placed:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch12-zabbix-api-self-engaging-__codelineno-0-1"></a><span class="p p-Indicator">{</span><span class="nv">$ZABBIX.API.TOKEN</span><span class="p p-Indicator">}</span>
</span></code></pre></div>
<p>Address <code>https://zabbix.book.the</code> of the frontend server must be used via:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch12-zabbix-api-self-engaging-__codelineno-1-1"></a><span class="p p-Indicator">{</span><span class="nv">$ZABBIX.URL</span><span class="p p-Indicator">}</span>
</span></code></pre></div>
<p>Later throughout chapters,
we will use a reference on the API endpoint in a format of:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch12-zabbix-api-self-engaging-__codelineno-2-1"></a><span class="p p-Indicator">{</span><span class="nv">$ZABBIX.URL</span><span class="p p-Indicator">}</span><span class="l l-Scalar l-Scalar-Plain">/api_jsonrpc.php</span>
</span></code></pre></div>
<p>Now we can take new 2 variables and install globally:</p>
<p><img alt="User macros" src="../ch12-zabbix-api/self-engaging/ch12.04-user-macro-global.png" /></p>
<p><em>12.4
User macros</em></p>
<h2 id="ch12-zabbix-api-self-engaging-first-api-call">First API call</h2>
<p>If you feel new to Zabbix API,
try this curl example from Zabbix frontend server.</p>
<p>Set bash variables:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch12-zabbix-api-self-engaging-__codelineno-3-1"></a><span class="nv">ZABBIX_API_TOKEN</span><span class="o">=</span><span class="s2">&quot;dafa06e74403ca317112cf5ddd3357b2ad2a2c5cb348665f294a53b4058cfbcf&quot;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch12-zabbix-api-self-engaging-__codelineno-3-2"></a><span class="nv">ZABBIX_URL</span><span class="o">=</span><span class="s2">&quot;https://zabbix.book.the/api_jsonrpc.php&quot;</span>
</span></code></pre></div>
<p>This snippet is tested and compatible with version 7.0/7.4:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch12-zabbix-api-self-engaging-__codelineno-4-1"></a>curl<span class="w"> </span>--insecure<span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch12-zabbix-api-self-engaging-__codelineno-4-2"></a>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json-rpc&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch12-zabbix-api-self-engaging-__codelineno-4-3"></a>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="nv">$ZABBIX_API_TOKEN</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch12-zabbix-api-self-engaging-__codelineno-4-4"></a>--data<span class="w"> </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;proxy.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;name&quot;]},&quot;id&quot;:1}&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ch12-zabbix-api-self-engaging-__codelineno-4-5"></a><span class="nv">$ZABBIX_URL</span>
</span></code></pre></div></p>
<p>Setting Bearer token in header is available and recommended since 7.0.</p>
<p>Setting a static token is available since 6.0. In version 6.0,
the token is not in header, but inside JSON body like this:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch12-zabbix-api-self-engaging-__codelineno-5-1"></a>curl<span class="w"> </span>--insecure<span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch12-zabbix-api-self-engaging-__codelineno-5-2"></a>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json-rpc&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch12-zabbix-api-self-engaging-__codelineno-5-3"></a>--data<span class="w"> </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;proxy.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;host&quot;]},&quot;auth&quot;:&quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$ZABBIX_API_TOKEN</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;,&quot;id&quot;:1}&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ch12-zabbix-api-self-engaging-__codelineno-5-4"></a><span class="nv">$ZABBIX_URL</span>
</span></code></pre></div></p>
<h2 id="ch12-zabbix-api-self-engaging-host-group-membership-http-agent">Host group membership (HTTP agent)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case</p>
<p>Every time an email arrives
user would love to see all host groups the host belongs.</p>
</div>
<hr />
<div class="admonition info">
<p class="admonition-title">Implementation</p>
<p>Use {HOST.HOST} as an input for the "host.get" API method and find out about
host group membership. Format reply in one line, store it in inventory.</p>
</div>
<hr />
<p>An item type "HTTP agent" is fastest way to run a single Zabbix API call and
retrieve back result. This is possible since Zabbix 6.0 where configuring
a static session token becomes possible.
An upcoming solution is tested and works on version 7.0/7.4</p>
<p>Create new <strong>HTTP agent</strong> item</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Item name</strong></td>
<td style="text-align: left;"><code>host.get</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>HTTP agent</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;"><code>host.get</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information</strong></td>
<td style="text-align: left;"><code>Text</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>URL</strong></td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Request type</strong></td>
<td style="text-align: left;"><code>POST</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Request body type</strong></td>
<td style="text-align: left;"><code>JSON data</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Update interval</strong></td>
<td style="text-align: left;"><code>1d</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Populates host inventory field</strong></td>
<td style="text-align: left;"><code>Site rack location</code></td>
</tr>
</tbody>
</table>
<p>Request body:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch12-zabbix-api-self-engaging-__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch12-zabbix-api-self-engaging-__codelineno-6-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch12-zabbix-api-self-engaging-__codelineno-6-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;host.get&quot;</span><span class="p">,</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ch12-zabbix-api-self-engaging-__codelineno-6-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ch12-zabbix-api-self-engaging-__codelineno-6-5"></a><span class="w">        </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;hostgroups&quot;</span><span class="p">],</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#ch12-zabbix-api-self-engaging-__codelineno-6-6"></a><span class="w">        </span><span class="nt">&quot;selectHostGroups&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;extend&quot;</span><span class="p">,</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#ch12-zabbix-api-self-engaging-__codelineno-6-7"></a><span class="w">        </span><span class="nt">&quot;filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;host&quot;</span><span class="p">:[</span><span class="s2">&quot;{HOST.HOST}&quot;</span><span class="p">]}</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#ch12-zabbix-api-self-engaging-__codelineno-6-8"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#ch12-zabbix-api-self-engaging-__codelineno-6-9"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#ch12-zabbix-api-self-engaging-__codelineno-6-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>Headers</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Authorization</strong></td>
<td style="text-align: left;"><code>Bearer {$ZABBIX.API.TOKEN}</code></td>
</tr>
</tbody>
</table>
<p><img alt="User macros" src="../ch12-zabbix-api/self-engaging/ch12.05-host-get.png" /></p>
<p><em>12.5
Host get method via HTTP agent item</em></p>
<p>Preprocessing steps</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">JSONPath</td>
<td style="text-align: left;"><code>$.result[0].hostgroups[*].name</code></td>
</tr>
<tr>
<td style="text-align: left;">JavaScript</td>
<td style="text-align: left;"><code>return JSON.parse(value).join(',');</code></td>
</tr>
</tbody>
</table>
<p><img alt="User macros" src="../ch12-zabbix-api/self-engaging/ch12.06-host-get-preprocessing.png" /></p>
<p><em>12.6
Preprocessing</em></p>
<p>Last step is to store the outcome in the inventory.
Scroll down to the bottom of HTTP agent item and select an inventory field
for example "Site rack location".</p>
<p>To access suggested inventory field, we must use:
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch12-zabbix-api-self-engaging-__codelineno-7-1"></a>{INVENTORY.SITE.RACK}
</span></code></pre></div></p>
<p>To include extra information inside the message template follow this lead:</p>
<p><img alt="Inventory fields in media type" src="../ch12-zabbix-api/self-engaging/ch12.07-use-invenotry-field-in-media-type-with-numbers.png" /></p>
<p><em>12.7
Inventory fields in media type</em></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If data collection is done by Zabbix proxy, it is possible the proxy
is incapable to reach Zabbix frontend server due to limitation in firewall.
Use <code>curl -kL "https://zabbix.book.the"</code> to test!</p>
</div>
<hr />
<h2 id="ch12-zabbix-api-self-engaging-auto-close-problem-webhook">Auto close problem (Webhook)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case</p>
<p>Due to reason of not being able to find a recovery expression for a trigger,
need to close the event automatically after certain time.</p>
</div>
<hr />
<div class="admonition info">
<p class="admonition-title">Implementation</p>
<p>Trigger settings must support <code>Allow manual close</code>. On trigger which needs
to be auto closed there must be a tag <code>auto</code> with a value <code>close</code>.
An action will invoke a webhook which will use Zabbix API to close event.</p>
</div>
<hr />
<p>To implement, visit <strong>Alerts</strong> =&gt; <strong>Scripts</strong>, press <strong>Create script</strong></p>
<p><img alt="Auto close problem" src="../ch12-zabbix-api/self-engaging/ch12.13-zabbix-api-auto-close-problem-webhook.png" /> </p>
<p><em>12.13
Auto close problem</em></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;"><code>Automatically close problem</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Scope</strong></td>
<td style="text-align: left;"><code>Action operation</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>Webhook</code></td>
</tr>
</tbody>
</table>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">eventid</td>
<td style="text-align: left;"><code>{EVENT.ID}</code></td>
</tr>
<tr>
<td style="text-align: left;">msg</td>
<td style="text-align: left;"><code>Auto closed by API</code></td>
</tr>
<tr>
<td style="text-align: left;">token</td>
<td style="text-align: left;"><code>{$ZABBIX.API.TOKEN}</code></td>
</tr>
<tr>
<td style="text-align: left;">url</td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
</tbody>
</table>
<p>Script:
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch12-zabbix-api-self-engaging-__codelineno-8-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ch12-zabbix-api-self-engaging-__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ch12-zabbix-api-self-engaging-__codelineno-8-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#ch12-zabbix-api-self-engaging-__codelineno-8-4"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="p">);</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#ch12-zabbix-api-self-engaging-__codelineno-8-5"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#ch12-zabbix-api-self-engaging-__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#ch12-zabbix-api-self-engaging-__codelineno-8-7"></a><span class="kd">var</span><span class="w"> </span><span class="nx">eventAcknowledge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#ch12-zabbix-api-self-engaging-__codelineno-8-8"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;event.acknowledge&quot;,&quot;params&quot;:{&quot;eventids&quot;:&quot;&#39;</span><span class="o">+</span><span class="nx">params</span><span class="p">.</span><span class="nx">eventid</span><span class="o">+</span><span class="s1">&#39;&quot;,&quot;action&quot;:1,&quot;message&quot;:&quot;&#39;</span><span class="o">+</span><span class="nx">params</span><span class="p">.</span><span class="nx">msg</span><span class="o">+</span><span class="s1">&#39;&quot;},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#ch12-zabbix-api-self-engaging-__codelineno-8-9"></a><span class="p">));</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#ch12-zabbix-api-self-engaging-__codelineno-8-10"></a>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#ch12-zabbix-api-self-engaging-__codelineno-8-11"></a><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">eventAcknowledge</span><span class="p">);</span>
</span></code></pre></div></p>
<p>For the triggers which need to be closed automatically, we need to:</p>
<p>1) Set <code>Allow manual close</code> checkbox ON</p>
<p><img alt="Allow manual close" src="../ch12-zabbix-api/self-engaging/ch12.08-trigger-configuration-allow-manual-close.png" /> </p>
<p><em>12.8
Allow manual close</em></p>
<p>2) Install tag <code>auto</code> with value <code>close</code></p>
<p><img alt="Install trigger tags" src="../ch12-zabbix-api/self-engaging/ch12.09-trigger-configuration-install-tags.png" /> </p>
<p><em>12.9
Trigger tags</em></p>
<p>Go to <strong>Alerts</strong> =&gt; <strong>Actions</strong> =&gt; <strong>Trigger actions</strong></p>
<p>Create an action which will be targetable
by using tag name <code>auto</code> with a tag value <code>close</code>.</p>
<p><img alt="Set up conditions for action" src="../ch12-zabbix-api/self-engaging/ch12.10-create-new-action-install-conditions.png" /> </p>
<p><em>12.10
Conditions for action</em></p>
<p>It's important to not create operation step 1, but start operation with step 2:</p>
<p><img alt="A delayed operation" src="../ch12-zabbix-api/self-engaging/ch12.11-create-new-action-install-operations.png" /></p>
<p><em>12.11
A delayed operation</em></p>
<p>The <strong>Default operation step duration</strong> field will serve the purpose
to tell how long the event will be in problem state. </p>
<p><img alt="Default operation step" src="../ch12-zabbix-api/self-engaging/ch12.12-default-operation-step-duration.png" /></p>
<p><em>12.12
Close event later</em></p>
<p>This solution has been tested with 7.0/7.4</p>
<h2 id="ch12-zabbix-api-self-engaging-self-destructive-host-webhook">Self destructive host (Webhook)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case</p>
<p>On a big infrastructure with thousands of devices there is no human who can
track which devices are deprovisioned.
Need to automatically remove unhealthy devices.</p>
</div>
<hr />
<div class="admonition info">
<p class="admonition-title">Implementation</p>
<p>Problem events such as "Zabbix agent is not available"
or "No SNMP data collection" sitting too long in problem state
will invoke a webhook to delete the host.</p>
</div>
<hr />
<p>To implement, visit <strong>Alerts</strong> =&gt; <strong>Scripts</strong>, press <strong>Create script</strong></p>
<p><img alt="Delete host webhook" src="../ch12-zabbix-api/self-engaging/ch12.14-delete-host-webhook.png" /> </p>
<p><em>12.13
Auto close problem</em></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;"><code>Delete host</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Scope</strong></td>
<td style="text-align: left;"><code>Action operation</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>Webhook</code></td>
</tr>
</tbody>
</table>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">hostid</td>
<td style="text-align: left;"><code>{HOST.ID}</code></td>
</tr>
<tr>
<td style="text-align: left;">token</td>
<td style="text-align: left;"><code>{$ZABBIX.API.TOKEN}</code></td>
</tr>
<tr>
<td style="text-align: left;">url</td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
</tbody>
</table>
<p>Script:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch12-zabbix-api-self-engaging-__codelineno-9-1"></a><span class="c1">// delete host via Zabbix API</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ch12-zabbix-api-self-engaging-__codelineno-9-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#ch12-zabbix-api-self-engaging-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#ch12-zabbix-api-self-engaging-__codelineno-9-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#ch12-zabbix-api-self-engaging-__codelineno-9-5"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="p">);</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#ch12-zabbix-api-self-engaging-__codelineno-9-6"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#ch12-zabbix-api-self-engaging-__codelineno-9-7"></a>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#ch12-zabbix-api-self-engaging-__codelineno-9-8"></a><span class="kd">var</span><span class="w"> </span><span class="nx">hostDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#ch12-zabbix-api-self-engaging-__codelineno-9-9"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;host.delete&quot;,&quot;params&quot;:[&#39;</span><span class="o">+</span><span class="nx">params</span><span class="p">.</span><span class="nx">hostid</span><span class="o">+</span><span class="s1">&#39;],&quot;id&quot;:1}&#39;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#ch12-zabbix-api-self-engaging-__codelineno-9-10"></a><span class="p">));</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#ch12-zabbix-api-self-engaging-__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#ch12-zabbix-api-self-engaging-__codelineno-9-12"></a><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">hostDelete</span><span class="p">);</span>
</span></code></pre></div>
<p>To setup action, the trigger must running a tag <code>delete</code> with value <code>host</code>.
The conditions can be to target tag plus value and trigger severity:</p>
<p><img alt="Delete host action conditions" src="../ch12-zabbix-api/self-engaging/ch12.15-delete-host-action-conditions.png" /> </p>
<p><em>12.15
Delete host target tag and tag value</em></p>
<p>Here we are running a delayed action with a step number 31.
Because default duration is 1d, the host will be deleted after 30 days.</p>
<p><img alt="Delete host action operations" src="../ch12-zabbix-api/self-engaging/ch12.16-delete-host-action-operations.png" /></p>
<p><em>12.16
Delete host operations</em></p>
<h2 id="ch12-zabbix-api-self-engaging-replace-host-visible-name-script-item">Replace host Visible name (Script item)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case</p>
<p>Replace host "Visible name" with a name which is already stored in inventory</p>
</div>
<hr />
<div class="admonition info">
<p class="admonition-title">Implementation</p>
<p>The "Script" item, will read metadata for all hosts. Will read the <strong>Name</strong>
field stored inside inventory and compare with current <strong>Visible name</strong> of
host. If inventory field is empty, the visible field will not be replaced.</p>
</div>
<hr />
<p>This is maximum efficiency to run a single API call once per day.
If nothing needs to be done, "host.update" API calls will not be wasted.
No SQL UPDATE operations for the Zabbix database :)</p>
<p>Go to <strong>Data collection</strong> =&gt; <strong>Hosts</strong> =&gt; press <strong>Create host</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Host name</strong></td>
<td style="text-align: left;"><code>Update host Visible name</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Host groups</strong></td>
<td style="text-align: left;"><code>Daily Zabbix API calls</code></td>
</tr>
</tbody>
</table>
<p>Go to <strong>Items</strong> and press <strong>Create item</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;"><code>Visible name</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>Script</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;"><code>visible.name</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information</strong></td>
<td style="text-align: left;"><code>Text</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Update interval</strong></td>
<td style="text-align: left;"><code>1d</code></td>
</tr>
</tbody>
</table>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">token</td>
<td style="text-align: left;"><code>{$ZABBIX.API.TOKEN}</code></td>
</tr>
<tr>
<td style="text-align: left;">url</td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
</tbody>
</table>
<p>Script:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch12-zabbix-api-self-engaging-__codelineno-10-1"></a><span class="c1">// load all parameters in memory</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch12-zabbix-api-self-engaging-__codelineno-10-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ch12-zabbix-api-self-engaging-__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ch12-zabbix-api-self-engaging-__codelineno-10-4"></a><span class="c1">// new API call</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#ch12-zabbix-api-self-engaging-__codelineno-10-5"></a><span class="kd">var</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#ch12-zabbix-api-self-engaging-__codelineno-10-6"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="p">);</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#ch12-zabbix-api-self-engaging-__codelineno-10-7"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#ch12-zabbix-api-self-engaging-__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#ch12-zabbix-api-self-engaging-__codelineno-10-9"></a><span class="c1">// obtain Bare minimum fields: host &quot;Visible name&quot; and inventory &quot;Name&quot;</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#ch12-zabbix-api-self-engaging-__codelineno-10-10"></a><span class="kd">var</span><span class="w"> </span><span class="nx">hostData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#ch12-zabbix-api-self-engaging-__codelineno-10-11"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;host.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;hostid&quot;,&quot;inventory&quot;,&quot;name&quot;,&quot;host&quot;],&quot;selectInventory&quot;:[&quot;name&quot;]},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#ch12-zabbix-api-self-engaging-__codelineno-10-12"></a><span class="p">)).</span><span class="nx">result</span><span class="p">;</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#ch12-zabbix-api-self-engaging-__codelineno-10-13"></a>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#ch12-zabbix-api-self-engaging-__codelineno-10-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">listOfErrors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#ch12-zabbix-api-self-engaging-__codelineno-10-15"></a><span class="kd">var</span><span class="w"> </span><span class="nx">listOfSuccess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#ch12-zabbix-api-self-engaging-__codelineno-10-16"></a>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#ch12-zabbix-api-self-engaging-__codelineno-10-17"></a><span class="c1">// iterate through host list</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#ch12-zabbix-api-self-engaging-__codelineno-10-18"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">h</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">hostData</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">h</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#ch12-zabbix-api-self-engaging-__codelineno-10-19"></a>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#ch12-zabbix-api-self-engaging-__codelineno-10-20"></a><span class="w">    </span><span class="c1">// validate if inventory &quot;name&quot; element exists</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#ch12-zabbix-api-self-engaging-__codelineno-10-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#ch12-zabbix-api-self-engaging-__codelineno-10-22"></a>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#ch12-zabbix-api-self-engaging-__codelineno-10-23"></a><span class="w">        </span><span class="c1">// if &quot;name&quot; field is not empty</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#ch12-zabbix-api-self-engaging-__codelineno-10-24"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#ch12-zabbix-api-self-engaging-__codelineno-10-25"></a>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#ch12-zabbix-api-self-engaging-__codelineno-10-26"></a><span class="w">            </span><span class="c1">// compare if inventory name is not the same as host visible name</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#ch12-zabbix-api-self-engaging-__codelineno-10-27"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#ch12-zabbix-api-self-engaging-__codelineno-10-28"></a>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#ch12-zabbix-api-self-engaging-__codelineno-10-29"></a><span class="w">                </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Host visible name field, host: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; need to reinstall visible name&#39;</span><span class="p">);</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#ch12-zabbix-api-self-engaging-__codelineno-10-30"></a>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#ch12-zabbix-api-self-engaging-__codelineno-10-31"></a><span class="w">                </span><span class="c1">// formulate payload for easy printing for troubleshoting</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#ch12-zabbix-api-self-engaging-__codelineno-10-32"></a><span class="w">                </span><span class="nx">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;host.update&quot;,&quot;params&quot;:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#ch12-zabbix-api-self-engaging-__codelineno-10-33"></a><span class="w">                    </span><span class="s1">&#39;hostid&#39;</span><span class="o">:</span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">hostid</span><span class="p">,</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#ch12-zabbix-api-self-engaging-__codelineno-10-34"></a><span class="w">                    </span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">name</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#ch12-zabbix-api-self-engaging-__codelineno-10-35"></a><span class="w">                    </span><span class="p">})</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;,&quot;id&quot;:1}&#39;</span><span class="p">;</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#ch12-zabbix-api-self-engaging-__codelineno-10-36"></a>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#ch12-zabbix-api-self-engaging-__codelineno-10-37"></a><span class="w">                </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Host visible name field, payload: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">payload</span><span class="p">);</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#ch12-zabbix-api-self-engaging-__codelineno-10-38"></a>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#ch12-zabbix-api-self-engaging-__codelineno-10-39"></a><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#ch12-zabbix-api-self-engaging-__codelineno-10-40"></a><span class="w">                    </span><span class="nx">hostUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">payload</span><span class="p">));</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#ch12-zabbix-api-self-engaging-__codelineno-10-41"></a>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42" href="#ch12-zabbix-api-self-engaging-__codelineno-10-42"></a><span class="w">                    </span><span class="c1">// save API errors, like name already exists:</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43" href="#ch12-zabbix-api-self-engaging-__codelineno-10-43"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">hostUpdate</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">listOfErrors</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="o">:</span><span class="nx">hostUpdate</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span><span class="s1">&#39;origin&#39;</span><span class="o">:</span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">host</span><span class="p">})</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44" href="#ch12-zabbix-api-self-engaging-__codelineno-10-44"></a>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45" href="#ch12-zabbix-api-self-engaging-__codelineno-10-45"></a><span class="w">                    </span><span class="c1">// save successfull operation:</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46" href="#ch12-zabbix-api-self-engaging-__codelineno-10-46"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">hostUpdate</span><span class="p">.</span><span class="nx">result</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">listOfSuccess</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">hostUpdate</span><span class="p">.</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47" href="#ch12-zabbix-api-self-engaging-__codelineno-10-47"></a>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48" href="#ch12-zabbix-api-self-engaging-__codelineno-10-48"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49" href="#ch12-zabbix-api-self-engaging-__codelineno-10-49"></a><span class="w">                </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-50"><a id="__codelineno-10-50" name="__codelineno-10-50" href="#ch12-zabbix-api-self-engaging-__codelineno-10-50"></a><span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="s1">&#39;noo&#39;</span><span class="p">;</span>
</span><span id="__span-10-51"><a id="__codelineno-10-51" name="__codelineno-10-51" href="#ch12-zabbix-api-self-engaging-__codelineno-10-51"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52" href="#ch12-zabbix-api-self-engaging-__codelineno-10-52"></a>
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53" href="#ch12-zabbix-api-self-engaging-__codelineno-10-53"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54" href="#ch12-zabbix-api-self-engaging-__codelineno-10-54"></a>
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55" href="#ch12-zabbix-api-self-engaging-__codelineno-10-55"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56" href="#ch12-zabbix-api-self-engaging-__codelineno-10-56"></a>
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57" href="#ch12-zabbix-api-self-engaging-__codelineno-10-57"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58" href="#ch12-zabbix-api-self-engaging-__codelineno-10-58"></a>
</span><span id="__span-10-59"><a id="__codelineno-10-59" name="__codelineno-10-59" href="#ch12-zabbix-api-self-engaging-__codelineno-10-59"></a><span class="p">}</span>
</span><span id="__span-10-60"><a id="__codelineno-10-60" name="__codelineno-10-60" href="#ch12-zabbix-api-self-engaging-__codelineno-10-60"></a>
</span><span id="__span-10-61"><a id="__codelineno-10-61" name="__codelineno-10-61" href="#ch12-zabbix-api-self-engaging-__codelineno-10-61"></a><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="s1">&#39;listOfSuccess&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">listOfSuccess</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;errors&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">listOfErrors</span><span class="w"> </span><span class="p">});</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The chances of having duplicate host names are still possible. In this case,
the script will continue to parse all hosts and will retry update operation.
Ensure $.listOfErrors in output is an empty list.</p>
</div>
<hr />
<p>All together</p>
<p><img alt="Script item, host Visible name" src="../ch12-zabbix-api/self-engaging/ch12.17-script-item-host-visible-name.png" /></p>
<p><em>12.17
Script item, host Visible name</em></p>
<p>The item will be sit at host level and serve a purpose of cronjob</p>
<p><img alt="Script item ready" src="../ch12-zabbix-api/self-engaging/ch12.18-script-item-ready.png" /></p>
<p><em>12.18
Script item ready</em></p>
<p>This is tested and works with Zabbix 7.0</p>
<h2 id="ch12-zabbix-api-self-engaging-cleanup-unused-zbx-interfaces-webhook">Cleanup unused ZBX interfaces (Webhook)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case 1</p>
<p>Default "Host availability" widget will print "Unknown" interfaces
if none of Zabbix agent passive checks are using it.
Need to remove interface to get "Unknown" interface number closer to 0</p>
</div>
<hr />
<p><img alt="Unknown ZBX passive interfaces" src="../ch12-zabbix-api/self-engaging/ch12.19-host-availability-unknown-passive-agent-checks.png" /></p>
<p><em>12.19
Unknown ZBX passive interfaces</em></p>
<div class="admonition tip">
<p class="admonition-title">Use case 2</p>
<p>Active checks by design do not require an interface. Having a defined
interface will mislead the team to understand how active checks actually
works.</p>
</div>
<hr />
<div class="admonition tip">
<p class="admonition-title">Use case 3</p>
<p>https://cloud.zabbix.com/ is good for server monitoring with active checks.
While registering new servers, the IP address of host interface is not
relatable to infrastructure.
Remove the interface to make setup look more clean.</p>
</div>
<hr />
<div class="admonition info">
<p class="admonition-title">Implementation</p>
<p>To bring aboard a host, run a webhook to validate if an interface is used
by any passive Zabbix agent items. If it's not used, then remove interface.</p>
</div>
<hr />
<p>To implement, visit <strong>Alerts</strong> =&gt; <strong>Scripts</strong>, press <strong>Create script</strong></p>
<p><img alt="Remove unused ZBX interfaces" src="../ch12-zabbix-api/self-engaging/ch12.20-remove-unused-zbx-hosts.png" /></p>
<p><em>12.20
Remove unused ZBX interfaces</em></p>
<p>Webhook</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;"><code>Remove unused ZBX interfaces</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Scope</strong></td>
<td style="text-align: left;"><code>Action operation</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>Webhook</code></td>
</tr>
</tbody>
</table>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">debug</td>
<td style="text-align: left;"><code>4</code></td>
</tr>
<tr>
<td style="text-align: left;">host</td>
<td style="text-align: left;"><code>{HOST.HOST}</code></td>
</tr>
<tr>
<td style="text-align: left;">token</td>
<td style="text-align: left;"><code>{$ZABBIX.API.TOKEN}</code></td>
</tr>
<tr>
<td style="text-align: left;">url</td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
</tbody>
</table>
<p>Script:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch12-zabbix-api-self-engaging-__codelineno-11-1"></a><span class="c1">// Load all variables</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ch12-zabbix-api-self-engaging-__codelineno-11-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#ch12-zabbix-api-self-engaging-__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#ch12-zabbix-api-self-engaging-__codelineno-11-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#ch12-zabbix-api-self-engaging-__codelineno-11-5"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="p">);</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#ch12-zabbix-api-self-engaging-__codelineno-11-6"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#ch12-zabbix-api-self-engaging-__codelineno-11-7"></a>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#ch12-zabbix-api-self-engaging-__codelineno-11-8"></a><span class="c1">// Pick up hostid</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#ch12-zabbix-api-self-engaging-__codelineno-11-9"></a><span class="kd">var</span><span class="w"> </span><span class="nx">hostid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#ch12-zabbix-api-self-engaging-__codelineno-11-10"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;host.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;hostid&quot;],&quot;filter&quot;:{&quot;host&quot;:[&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">host</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;]}},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#ch12-zabbix-api-self-engaging-__codelineno-11-11"></a><span class="p">)).</span><span class="nx">result</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">hostid</span><span class="p">;</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#ch12-zabbix-api-self-engaging-__codelineno-11-12"></a>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#ch12-zabbix-api-self-engaging-__codelineno-11-13"></a><span class="c1">// Extract all passive Zabbix agent interfaces</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#ch12-zabbix-api-self-engaging-__codelineno-11-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#ch12-zabbix-api-self-engaging-__codelineno-11-15"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;hostinterface.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;interfaceid&quot;,&quot;main&quot;],&quot;filter&quot;:{&quot;type&quot;:&quot;1&quot;},&quot;hostids&quot;:&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">hostid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#ch12-zabbix-api-self-engaging-__codelineno-11-16"></a><span class="p">)).</span><span class="nx">result</span><span class="p">;</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#ch12-zabbix-api-self-engaging-__codelineno-11-17"></a>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#ch12-zabbix-api-self-engaging-__codelineno-11-18"></a><span class="c1">// If any ZBX interface was found then proceed fetching all items because need to find out if any items use an interface</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#ch12-zabbix-api-self-engaging-__codelineno-11-19"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">allAgentInterfaces</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#ch12-zabbix-api-self-engaging-__codelineno-11-20"></a><span class="w">    </span><span class="c1">// Fetch all items which are defined at host level and ask which item use passive ZBX agent interface</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#ch12-zabbix-api-self-engaging-__codelineno-11-21"></a><span class="w">    </span><span class="c1">// Simple check items (like icmpping) also can use zabbix agent interface</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#ch12-zabbix-api-self-engaging-__codelineno-11-22"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">items_with_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#ch12-zabbix-api-self-engaging-__codelineno-11-23"></a><span class="w">        </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;item.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;type&quot;,&quot;interfaces&quot;],&quot;hostids&quot;:&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">hostid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;,&quot;selectInterfaces&quot;:&quot;query&quot;},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#ch12-zabbix-api-self-engaging-__codelineno-11-24"></a><span class="w">    </span><span class="p">)).</span><span class="nx">result</span><span class="p">;</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#ch12-zabbix-api-self-engaging-__codelineno-11-25"></a><span class="p">}</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#ch12-zabbix-api-self-engaging-__codelineno-11-26"></a>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#ch12-zabbix-api-self-engaging-__codelineno-11-27"></a><span class="c1">// Define an interface array. This is required if more than one ZBX interface exists on host level</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#ch12-zabbix-api-self-engaging-__codelineno-11-28"></a><span class="kd">var</span><span class="w"> </span><span class="nx">interfacesInUse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#ch12-zabbix-api-self-engaging-__codelineno-11-29"></a>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#ch12-zabbix-api-self-engaging-__codelineno-11-30"></a><span class="c1">// Iterate through all ZBX interfaces</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#ch12-zabbix-api-self-engaging-__codelineno-11-31"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">zbx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">zbx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">zbx</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#ch12-zabbix-api-self-engaging-__codelineno-11-32"></a>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#ch12-zabbix-api-self-engaging-__codelineno-11-33"></a><span class="w">    </span><span class="c1">// Go through all items which is defined at host level</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#ch12-zabbix-api-self-engaging-__codelineno-11-34"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="kr">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="kr">int</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">items_with_int</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="kr">int</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#ch12-zabbix-api-self-engaging-__codelineno-11-35"></a>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#ch12-zabbix-api-self-engaging-__codelineno-11-36"></a><span class="w">        </span><span class="c1">// There are many items which does not need interface. Specifically analyze the ones which has an interface defined</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#ch12-zabbix-api-self-engaging-__codelineno-11-37"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">items_with_int</span><span class="p">[</span><span class="kr">int</span><span class="p">].</span><span class="nx">interfaces</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#ch12-zabbix-api-self-engaging-__codelineno-11-38"></a>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#ch12-zabbix-api-self-engaging-__codelineno-11-39"></a><span class="w">            </span><span class="c1">// There is an interface found for the item</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#ch12-zabbix-api-self-engaging-__codelineno-11-40"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">items_with_int</span><span class="p">[</span><span class="kr">int</span><span class="p">].</span><span class="nx">interfaces</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">interfaceid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">zbx</span><span class="p">].</span><span class="nx">interfaceid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41" href="#ch12-zabbix-api-self-engaging-__codelineno-11-41"></a><span class="w">                </span><span class="c1">// Put this item in list which use an interface</span>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42" href="#ch12-zabbix-api-self-engaging-__codelineno-11-42"></a><span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43" href="#ch12-zabbix-api-self-engaging-__codelineno-11-43"></a><span class="w">                </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;itemid&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">items_with_int</span><span class="p">[</span><span class="kr">int</span><span class="p">].</span><span class="nx">itemid</span><span class="p">;</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44" href="#ch12-zabbix-api-self-engaging-__codelineno-11-44"></a><span class="w">                </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;interfaceid&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">zbx</span><span class="p">].</span><span class="nx">interfaceid</span><span class="p">;</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45" href="#ch12-zabbix-api-self-engaging-__codelineno-11-45"></a><span class="w">                </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;main&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">zbx</span><span class="p">].</span><span class="nx">main</span><span class="p">;</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46" href="#ch12-zabbix-api-self-engaging-__codelineno-11-46"></a><span class="w">                </span><span class="nx">interfacesInUse</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47" href="#ch12-zabbix-api-self-engaging-__codelineno-11-47"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48" href="#ch12-zabbix-api-self-engaging-__codelineno-11-48"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49" href="#ch12-zabbix-api-self-engaging-__codelineno-11-49"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50" href="#ch12-zabbix-api-self-engaging-__codelineno-11-50"></a><span class="p">}</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51" href="#ch12-zabbix-api-self-engaging-__codelineno-11-51"></a>
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52" href="#ch12-zabbix-api-self-engaging-__codelineno-11-52"></a><span class="c1">// Final scan to identify if any interface is wasted</span>
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53" href="#ch12-zabbix-api-self-engaging-__codelineno-11-53"></a><span class="kd">var</span><span class="w"> </span><span class="nx">needToDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54" href="#ch12-zabbix-api-self-engaging-__codelineno-11-54"></a><span class="kd">var</span><span class="w"> </span><span class="nx">evidenceOfDeletedInterfaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55" href="#ch12-zabbix-api-self-engaging-__codelineno-11-55"></a><span class="kd">var</span><span class="w"> </span><span class="nx">mainNotUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56" href="#ch12-zabbix-api-self-engaging-__codelineno-11-56"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">defined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">defined</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">defined</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57" href="#ch12-zabbix-api-self-engaging-__codelineno-11-57"></a>
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58" href="#ch12-zabbix-api-self-engaging-__codelineno-11-58"></a><span class="w">    </span><span class="c1">// Scan all items</span>
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59" href="#ch12-zabbix-api-self-engaging-__codelineno-11-59"></a><span class="w">    </span><span class="nx">needToDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60" href="#ch12-zabbix-api-self-engaging-__codelineno-11-60"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">interfacesInUse</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">used</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61" href="#ch12-zabbix-api-self-engaging-__codelineno-11-61"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">defined</span><span class="p">].</span><span class="nx">interfaceid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">interfacesInUse</span><span class="p">[</span><span class="nx">used</span><span class="p">].</span><span class="nx">interfaceid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62" href="#ch12-zabbix-api-self-engaging-__codelineno-11-62"></a><span class="w">            </span><span class="nx">needToDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63" href="#ch12-zabbix-api-self-engaging-__codelineno-11-63"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64" href="#ch12-zabbix-api-self-engaging-__codelineno-11-64"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65" href="#ch12-zabbix-api-self-engaging-__codelineno-11-65"></a>
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66" href="#ch12-zabbix-api-self-engaging-__codelineno-11-66"></a><span class="w">    </span><span class="c1">// If flag was not turned off, then no items with this interface were found. No items are using this interface. Safe to delete</span>
</span><span id="__span-11-67"><a id="__codelineno-11-67" name="__codelineno-11-67" href="#ch12-zabbix-api-self-engaging-__codelineno-11-67"></a><span class="w">    </span><span class="c1">// Delete all slaves first</span>
</span><span id="__span-11-68"><a id="__codelineno-11-68" name="__codelineno-11-68" href="#ch12-zabbix-api-self-engaging-__codelineno-11-68"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">needToDelete</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">defined</span><span class="p">].</span><span class="nx">main</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-69"><a id="__codelineno-11-69" name="__codelineno-11-69" href="#ch12-zabbix-api-self-engaging-__codelineno-11-69"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">deleteInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-11-70"><a id="__codelineno-11-70" name="__codelineno-11-70" href="#ch12-zabbix-api-self-engaging-__codelineno-11-70"></a><span class="w">            </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;hostinterface.delete&quot;,&quot;params&quot;:[&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">defined</span><span class="p">].</span><span class="nx">interfaceid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;],&quot;id&quot;:1}&#39;</span>
</span><span id="__span-11-71"><a id="__codelineno-11-71" name="__codelineno-11-71" href="#ch12-zabbix-api-self-engaging-__codelineno-11-71"></a><span class="w">        </span><span class="p">));</span>
</span><span id="__span-11-72"><a id="__codelineno-11-72" name="__codelineno-11-72" href="#ch12-zabbix-api-self-engaging-__codelineno-11-72"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-11-73"><a id="__codelineno-11-73" name="__codelineno-11-73" href="#ch12-zabbix-api-self-engaging-__codelineno-11-73"></a><span class="w">        </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;deleted&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">deleteInt</span><span class="p">;</span>
</span><span id="__span-11-74"><a id="__codelineno-11-74" name="__codelineno-11-74" href="#ch12-zabbix-api-self-engaging-__codelineno-11-74"></a><span class="w">        </span><span class="nx">evidenceOfDeletedInterfaces</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</span><span id="__span-11-75"><a id="__codelineno-11-75" name="__codelineno-11-75" href="#ch12-zabbix-api-self-engaging-__codelineno-11-75"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-76"><a id="__codelineno-11-76" name="__codelineno-11-76" href="#ch12-zabbix-api-self-engaging-__codelineno-11-76"></a>
</span><span id="__span-11-77"><a id="__codelineno-11-77" name="__codelineno-11-77" href="#ch12-zabbix-api-self-engaging-__codelineno-11-77"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">needToDelete</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">defined</span><span class="p">].</span><span class="nx">main</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-78"><a id="__codelineno-11-78" name="__codelineno-11-78" href="#ch12-zabbix-api-self-engaging-__codelineno-11-78"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">mainNotUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">defined</span><span class="p">].</span><span class="nx">interfaceid</span><span class="p">;</span>
</span><span id="__span-11-79"><a id="__codelineno-11-79" name="__codelineno-11-79" href="#ch12-zabbix-api-self-engaging-__codelineno-11-79"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-80"><a id="__codelineno-11-80" name="__codelineno-11-80" href="#ch12-zabbix-api-self-engaging-__codelineno-11-80"></a>
</span><span id="__span-11-81"><a id="__codelineno-11-81" name="__codelineno-11-81" href="#ch12-zabbix-api-self-engaging-__codelineno-11-81"></a><span class="p">}</span>
</span><span id="__span-11-82"><a id="__codelineno-11-82" name="__codelineno-11-82" href="#ch12-zabbix-api-self-engaging-__codelineno-11-82"></a>
</span><span id="__span-11-83"><a id="__codelineno-11-83" name="__codelineno-11-83" href="#ch12-zabbix-api-self-engaging-__codelineno-11-83"></a><span class="c1">// Delete main interface at the end</span>
</span><span id="__span-11-84"><a id="__codelineno-11-84" name="__codelineno-11-84" href="#ch12-zabbix-api-self-engaging-__codelineno-11-84"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">mainNotUsed</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-85"><a id="__codelineno-11-85" name="__codelineno-11-85" href="#ch12-zabbix-api-self-engaging-__codelineno-11-85"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">deleteInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-11-86"><a id="__codelineno-11-86" name="__codelineno-11-86" href="#ch12-zabbix-api-self-engaging-__codelineno-11-86"></a><span class="w">        </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;hostinterface.delete&quot;,&quot;params&quot;:[&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">mainNotUsed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;],&quot;id&quot;:1}&#39;</span>
</span><span id="__span-11-87"><a id="__codelineno-11-87" name="__codelineno-11-87" href="#ch12-zabbix-api-self-engaging-__codelineno-11-87"></a><span class="w">    </span><span class="p">));</span>
</span><span id="__span-11-88"><a id="__codelineno-11-88" name="__codelineno-11-88" href="#ch12-zabbix-api-self-engaging-__codelineno-11-88"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-11-89"><a id="__codelineno-11-89" name="__codelineno-11-89" href="#ch12-zabbix-api-self-engaging-__codelineno-11-89"></a><span class="w">    </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;deleted&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">deleteInt</span><span class="p">;</span>
</span><span id="__span-11-90"><a id="__codelineno-11-90" name="__codelineno-11-90" href="#ch12-zabbix-api-self-engaging-__codelineno-11-90"></a><span class="w">    </span><span class="nx">evidenceOfDeletedInterfaces</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</span><span id="__span-11-91"><a id="__codelineno-11-91" name="__codelineno-11-91" href="#ch12-zabbix-api-self-engaging-__codelineno-11-91"></a><span class="p">}</span>
</span><span id="__span-11-92"><a id="__codelineno-11-92" name="__codelineno-11-92" href="#ch12-zabbix-api-self-engaging-__codelineno-11-92"></a>
</span><span id="__span-11-93"><a id="__codelineno-11-93" name="__codelineno-11-93" href="#ch12-zabbix-api-self-engaging-__codelineno-11-93"></a><span class="kd">var</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-11-94"><a id="__codelineno-11-94" name="__codelineno-11-94" href="#ch12-zabbix-api-self-engaging-__codelineno-11-94"></a><span class="w">    </span><span class="s2">&quot;allAgentInterfaces&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">,</span>
</span><span id="__span-11-95"><a id="__codelineno-11-95" name="__codelineno-11-95" href="#ch12-zabbix-api-self-engaging-__codelineno-11-95"></a><span class="w">    </span><span class="s2">&quot;interfacesInUse&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">interfacesInUse</span><span class="p">,</span>
</span><span id="__span-11-96"><a id="__codelineno-11-96" name="__codelineno-11-96" href="#ch12-zabbix-api-self-engaging-__codelineno-11-96"></a><span class="w">    </span><span class="s2">&quot;evidenceOfDeletedInterfaces&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">evidenceOfDeletedInterfaces</span>
</span><span id="__span-11-97"><a id="__codelineno-11-97" name="__codelineno-11-97" href="#ch12-zabbix-api-self-engaging-__codelineno-11-97"></a><span class="p">});</span>
</span><span id="__span-11-98"><a id="__codelineno-11-98" name="__codelineno-11-98" href="#ch12-zabbix-api-self-engaging-__codelineno-11-98"></a>
</span><span id="__span-11-99"><a id="__codelineno-11-99" name="__codelineno-11-99" href="#ch12-zabbix-api-self-engaging-__codelineno-11-99"></a><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Auto remove unused ZBX agent passive interfaces: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">output</span><span class="p">)</span>
</span><span id="__span-11-100"><a id="__codelineno-11-100" name="__codelineno-11-100" href="#ch12-zabbix-api-self-engaging-__codelineno-11-100"></a>
</span><span id="__span-11-101"><a id="__codelineno-11-101" name="__codelineno-11-101" href="#ch12-zabbix-api-self-engaging-__codelineno-11-101"></a><span class="k">return</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span></code></pre></div>
<p>To make webhook in action visit <strong>Alerts</strong> =&gt; <strong>Actions</strong>
=&gt; <strong>Autoregistration actions</strong>. Press <strong>Create action</strong>. For example to auto
register Linux servers, we can target a pattern ".lnx" inside the hostname.</p>
<p><img alt="Conditions for ZBX active checks" src="../ch12-zabbix-api/self-engaging/ch12.21-autoreg-conditions.png" /></p>
<p><em>12.21
Conditions for ZBX active checks</em></p>
<p>The operations will use newly made webhook</p>
<p><img alt="Operations of Zabbix agent autoregistration" src="../ch12-zabbix-api/self-engaging/ch12.22-autoreg-actions.png" /></p>
<p><em>12.22
Operations of Zabbix agent autoregistration</em></p>
<p>The complete picture is</p>
<p><img alt="Zabbix agent autoregistration completed" src="../ch12-zabbix-api/self-engaging/ch12.23-autoreg-completed.png" /></p>
<p><em>12.23
Zabbix agent autoregistration completed</em></p>
<h2 id="ch12-zabbix-api-self-engaging-read-log-file-from-yyyymmdd-filename-script">Read log file from YYYY.MM.DD filename (Script)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case</p>
<p>Requirement is to read a filename
with today's pattern YYYY.MM.DD or YYYY_MM_DD or YYYYMMDD.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Popular solution 1 - logrt</p>
<p>Using "logrt" item key can be used to cover use case.
However in case hundreds of files in directory, the CPU will have impact.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Popular solution 2 - LLD rule</p>
<p>We Zabbix LLD rule to find the files in directory.
This method do not allow to store all data inside same itemid.
When files are deleted from server, the items in Zabbix will get unsupported.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Alternative solution</p>
<p>We will use Zabbix API to create a global variables YYYY, MM, DD.
Those will be universally available by any host, template.
The "cronjob host" will run at least once per day
and reinstall the date right after the midnight.
Inside template level there will be a single/static item key
which will be able to read today's log.</p>
</div>
<p>Go to <strong>Data collection</strong> =&gt; <strong>Hosts</strong> =&gt; press <strong>Create host</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Host name</strong></td>
<td style="text-align: left;"><code>Dude</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Host groups</strong></td>
<td style="text-align: left;"><code>Cronjob</code></td>
</tr>
</tbody>
</table>
<p>Go to <strong>Items</strong> and press <strong>Create item</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;"><code>Create or update global macro</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>Script</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;"><code>create.or.update.global.macro</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information</strong></td>
<td style="text-align: left;"><code>Text</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Update interval</strong></td>
<td style="text-align: left;"><code>0</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Custom intervals: Scheduling</strong></td>
<td style="text-align: left;"><code>h0m1s1</code></td>
</tr>
</tbody>
</table>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1_year</td>
<td style="text-align: left;"><code>{$DATE:arg1.year}</code></td>
</tr>
<tr>
<td style="text-align: left;">2_month</td>
<td style="text-align: left;"><code>{$DATE:arg2.month}</code></td>
</tr>
<tr>
<td style="text-align: left;">3_day</td>
<td style="text-align: left;"><code>{$DATE:arg3.day}</code></td>
</tr>
<tr>
<td style="text-align: left;">4_hour</td>
<td style="text-align: left;"><code>{$DATE:arg4.hour}</code></td>
</tr>
<tr>
<td style="text-align: left;">5_minute</td>
<td style="text-align: left;"><code>{$DATE:arg5.minute}</code></td>
</tr>
<tr>
<td style="text-align: left;">6_second</td>
<td style="text-align: left;"><code>{$DATE:arg6.seconds}</code></td>
</tr>
<tr>
<td style="text-align: left;">token</td>
<td style="text-align: left;"><code>{$ZABBIX.API.TOKEN}</code></td>
</tr>
<tr>
<td style="text-align: left;">url</td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
</tbody>
</table>
<p>The script to create and maintain global variables:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch12-zabbix-api-self-engaging-__codelineno-12-1"></a><span class="c1">// load all variables into memory</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ch12-zabbix-api-self-engaging-__codelineno-12-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">),</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#ch12-zabbix-api-self-engaging-__codelineno-12-3"></a><span class="w">    </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#ch12-zabbix-api-self-engaging-__codelineno-12-4"></a>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#ch12-zabbix-api-self-engaging-__codelineno-12-5"></a><span class="c1">// function to always print seconds, minutes, hours as 2 digits, even it its a 1 digit character</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#ch12-zabbix-api-self-engaging-__codelineno-12-6"></a><span class="kd">function</span><span class="w"> </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">length</span><span class="p">,</span><span class="w"> </span><span class="kr">char</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#ch12-zabbix-api-self-engaging-__codelineno-12-7"></a><span class="w">    </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#ch12-zabbix-api-self-engaging-__codelineno-12-8"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#ch12-zabbix-api-self-engaging-__codelineno-12-9"></a><span class="w">        </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">char</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#ch12-zabbix-api-self-engaging-__codelineno-12-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#ch12-zabbix-api-self-engaging-__codelineno-12-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#ch12-zabbix-api-self-engaging-__codelineno-12-12"></a><span class="p">}</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#ch12-zabbix-api-self-engaging-__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#ch12-zabbix-api-self-engaging-__codelineno-12-14"></a><span class="c1">// define macros to check/create without &#39;{$&#39; an &#39;}&#39;</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#ch12-zabbix-api-self-engaging-__codelineno-12-15"></a><span class="kd">var</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#ch12-zabbix-api-self-engaging-__codelineno-12-16"></a><span class="w">    </span><span class="s1">&#39;DATE:arg1.year&#39;</span><span class="p">,</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#ch12-zabbix-api-self-engaging-__codelineno-12-17"></a><span class="w">    </span><span class="s1">&#39;DATE:arg2.month&#39;</span><span class="p">,</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#ch12-zabbix-api-self-engaging-__codelineno-12-18"></a><span class="w">    </span><span class="s1">&#39;DATE:arg3.day&#39;</span><span class="p">,</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#ch12-zabbix-api-self-engaging-__codelineno-12-19"></a><span class="w">    </span><span class="s1">&#39;DATE:arg4.hour&#39;</span><span class="p">,</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#ch12-zabbix-api-self-engaging-__codelineno-12-20"></a><span class="w">    </span><span class="s1">&#39;DATE:arg5.minute&#39;</span><span class="p">,</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#ch12-zabbix-api-self-engaging-__codelineno-12-21"></a><span class="w">    </span><span class="s1">&#39;DATE:arg6.seconds&#39;</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#ch12-zabbix-api-self-engaging-__codelineno-12-22"></a><span class="p">];</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#ch12-zabbix-api-self-engaging-__codelineno-12-23"></a>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#ch12-zabbix-api-self-engaging-__codelineno-12-24"></a><span class="c1">// prepare values for replacement. order is important</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#ch12-zabbix-api-self-engaging-__codelineno-12-25"></a><span class="kd">var</span><span class="w"> </span><span class="nx">valuesToInsert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#ch12-zabbix-api-self-engaging-__codelineno-12-26"></a><span class="w">    </span><span class="nx">now</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">().</span><span class="nx">toString</span><span class="p">(),</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#ch12-zabbix-api-self-engaging-__codelineno-12-27"></a><span class="w">    </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#ch12-zabbix-api-self-engaging-__codelineno-12-28"></a><span class="w">    </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getDate</span><span class="p">(),</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#ch12-zabbix-api-self-engaging-__codelineno-12-29"></a><span class="w">    </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getHours</span><span class="p">(),</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#ch12-zabbix-api-self-engaging-__codelineno-12-30"></a><span class="w">    </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">(),</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#ch12-zabbix-api-self-engaging-__codelineno-12-31"></a><span class="w">    </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">(),</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#ch12-zabbix-api-self-engaging-__codelineno-12-32"></a><span class="p">];</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#ch12-zabbix-api-self-engaging-__codelineno-12-33"></a>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#ch12-zabbix-api-self-engaging-__codelineno-12-34"></a><span class="kd">var</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#ch12-zabbix-api-self-engaging-__codelineno-12-35"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="p">);</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#ch12-zabbix-api-self-engaging-__codelineno-12-36"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#ch12-zabbix-api-self-engaging-__codelineno-12-37"></a>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#ch12-zabbix-api-self-engaging-__codelineno-12-38"></a><span class="kd">var</span><span class="w"> </span><span class="nx">allGlobalMacrosBefore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#ch12-zabbix-api-self-engaging-__codelineno-12-39"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;usermacro.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;globalmacroid&quot;,&quot;macro&quot;,&quot;value&quot;],&quot;globalmacro&quot;:true},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#ch12-zabbix-api-self-engaging-__codelineno-12-40"></a><span class="p">)).</span><span class="nx">result</span><span class="p">;</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#ch12-zabbix-api-self-engaging-__codelineno-12-41"></a>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#ch12-zabbix-api-self-engaging-__codelineno-12-42"></a><span class="c1">// prepare much compact array which holds only necessary values</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#ch12-zabbix-api-self-engaging-__codelineno-12-43"></a><span class="kd">var</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#ch12-zabbix-api-self-engaging-__codelineno-12-44"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">allGlobalMacrosBefore</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">a</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#ch12-zabbix-api-self-engaging-__codelineno-12-45"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#ch12-zabbix-api-self-engaging-__codelineno-12-46"></a><span class="w">        </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;macro update compare: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">allGlobalMacrosBefore</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; with &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">);</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#ch12-zabbix-api-self-engaging-__codelineno-12-47"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">allGlobalMacrosBefore</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48" href="#ch12-zabbix-api-self-engaging-__codelineno-12-48"></a><span class="w">            </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;macro update: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">allGlobalMacrosBefore</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; === &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">);</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49" href="#ch12-zabbix-api-self-engaging-__codelineno-12-49"></a><span class="w">            </span><span class="nx">target</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">allGlobalMacrosBefore</span><span class="p">[</span><span class="nx">a</span><span class="p">]);</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50" href="#ch12-zabbix-api-self-engaging-__codelineno-12-50"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51" href="#ch12-zabbix-api-self-engaging-__codelineno-12-51"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52" href="#ch12-zabbix-api-self-engaging-__codelineno-12-52"></a><span class="p">}</span>
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53" href="#ch12-zabbix-api-self-engaging-__codelineno-12-53"></a>
</span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54" href="#ch12-zabbix-api-self-engaging-__codelineno-12-54"></a><span class="c1">// check if the amount of macros to maintain match existing macro. this portion will execute if run template for the first time</span>
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55" href="#ch12-zabbix-api-self-engaging-__codelineno-12-55"></a><span class="kd">var</span><span class="w"> </span><span class="nx">macroExists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-12-56"><a id="__codelineno-12-56" name="__codelineno-12-56" href="#ch12-zabbix-api-self-engaging-__codelineno-12-56"></a><span class="kd">var</span><span class="w"> </span><span class="nx">allCreateOperation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-12-57"><a id="__codelineno-12-57" name="__codelineno-12-57" href="#ch12-zabbix-api-self-engaging-__codelineno-12-57"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">macrosToCheck</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-58"><a id="__codelineno-12-58" name="__codelineno-12-58" href="#ch12-zabbix-api-self-engaging-__codelineno-12-58"></a><span class="w">    </span><span class="c1">// something is missing, need to find what. open every macro which is known by Zabbix</span>
</span><span id="__span-12-59"><a id="__codelineno-12-59" name="__codelineno-12-59" href="#ch12-zabbix-api-self-engaging-__codelineno-12-59"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-60"><a id="__codelineno-12-60" name="__codelineno-12-60" href="#ch12-zabbix-api-self-engaging-__codelineno-12-60"></a><span class="w">        </span><span class="c1">// reset the counter, so far macro has not been found</span>
</span><span id="__span-12-61"><a id="__codelineno-12-61" name="__codelineno-12-61" href="#ch12-zabbix-api-self-engaging-__codelineno-12-61"></a><span class="w">        </span><span class="nx">macroExists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-12-62"><a id="__codelineno-12-62" name="__codelineno-12-62" href="#ch12-zabbix-api-self-engaging-__codelineno-12-62"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">a</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-63"><a id="__codelineno-12-63" name="__codelineno-12-63" href="#ch12-zabbix-api-self-engaging-__codelineno-12-63"></a><span class="w">            </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;look for missing macro update: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">target</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; VS {$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">);</span>
</span><span id="__span-12-64"><a id="__codelineno-12-64" name="__codelineno-12-64" href="#ch12-zabbix-api-self-engaging-__codelineno-12-64"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">target</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-65"><a id="__codelineno-12-65" name="__codelineno-12-65" href="#ch12-zabbix-api-self-engaging-__codelineno-12-65"></a><span class="w">                </span><span class="nx">macroExists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-12-66"><a id="__codelineno-12-66" name="__codelineno-12-66" href="#ch12-zabbix-api-self-engaging-__codelineno-12-66"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-12-67"><a id="__codelineno-12-67" name="__codelineno-12-67" href="#ch12-zabbix-api-self-engaging-__codelineno-12-67"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-68"><a id="__codelineno-12-68" name="__codelineno-12-68" href="#ch12-zabbix-api-self-engaging-__codelineno-12-68"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-69"><a id="__codelineno-12-69" name="__codelineno-12-69" href="#ch12-zabbix-api-self-engaging-__codelineno-12-69"></a>
</span><span id="__span-12-70"><a id="__codelineno-12-70" name="__codelineno-12-70" href="#ch12-zabbix-api-self-engaging-__codelineno-12-70"></a><span class="w">        </span><span class="c1">// if the list was completed and macro was not found then create a new</span>
</span><span id="__span-12-71"><a id="__codelineno-12-71" name="__codelineno-12-71" href="#ch12-zabbix-api-self-engaging-__codelineno-12-71"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">macroExists</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-72"><a id="__codelineno-12-72" name="__codelineno-12-72" href="#ch12-zabbix-api-self-engaging-__codelineno-12-72"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">createNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-12-73"><a id="__codelineno-12-73" name="__codelineno-12-73" href="#ch12-zabbix-api-self-engaging-__codelineno-12-73"></a><span class="w">                </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;usermacro.createglobal&quot;,&quot;params&quot;:{&quot;macro&quot;:&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;,&quot;value&quot;:&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">valuesToInsert</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-12-74"><a id="__codelineno-12-74" name="__codelineno-12-74" href="#ch12-zabbix-api-self-engaging-__codelineno-12-74"></a><span class="w">            </span><span class="p">));</span>
</span><span id="__span-12-75"><a id="__codelineno-12-75" name="__codelineno-12-75" href="#ch12-zabbix-api-self-engaging-__codelineno-12-75"></a><span class="w">            </span><span class="nx">allCreateOperation</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">createNew</span><span class="p">);</span>
</span><span id="__span-12-76"><a id="__codelineno-12-76" name="__codelineno-12-76" href="#ch12-zabbix-api-self-engaging-__codelineno-12-76"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-77"><a id="__codelineno-12-77" name="__codelineno-12-77" href="#ch12-zabbix-api-self-engaging-__codelineno-12-77"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-78"><a id="__codelineno-12-78" name="__codelineno-12-78" href="#ch12-zabbix-api-self-engaging-__codelineno-12-78"></a><span class="p">}</span>
</span><span id="__span-12-79"><a id="__codelineno-12-79" name="__codelineno-12-79" href="#ch12-zabbix-api-self-engaging-__codelineno-12-79"></a>
</span><span id="__span-12-80"><a id="__codelineno-12-80" name="__codelineno-12-80" href="#ch12-zabbix-api-self-engaging-__codelineno-12-80"></a><span class="c1">// prepare payload what needs to be updated</span>
</span><span id="__span-12-81"><a id="__codelineno-12-81" name="__codelineno-12-81" href="#ch12-zabbix-api-self-engaging-__codelineno-12-81"></a><span class="kd">var</span><span class="w"> </span><span class="nx">dataForUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-12-82"><a id="__codelineno-12-82" name="__codelineno-12-82" href="#ch12-zabbix-api-self-engaging-__codelineno-12-82"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">m</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-83"><a id="__codelineno-12-83" name="__codelineno-12-83" href="#ch12-zabbix-api-self-engaging-__codelineno-12-83"></a><span class="w">    </span><span class="c1">// iterate through importand macro names</span>
</span><span id="__span-12-84"><a id="__codelineno-12-84" name="__codelineno-12-84" href="#ch12-zabbix-api-self-engaging-__codelineno-12-84"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">n</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-85"><a id="__codelineno-12-85" name="__codelineno-12-85" href="#ch12-zabbix-api-self-engaging-__codelineno-12-85"></a><span class="w">        </span><span class="c1">// compare the macro name</span>
</span><span id="__span-12-86"><a id="__codelineno-12-86" name="__codelineno-12-86" href="#ch12-zabbix-api-self-engaging-__codelineno-12-86"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">target</span><span class="p">[</span><span class="nx">m</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-87"><a id="__codelineno-12-87" name="__codelineno-12-87" href="#ch12-zabbix-api-self-engaging-__codelineno-12-87"></a><span class="w">            </span><span class="c1">// if value is not correct at the moment</span>
</span><span id="__span-12-88"><a id="__codelineno-12-88" name="__codelineno-12-88" href="#ch12-zabbix-api-self-engaging-__codelineno-12-88"></a><span class="w">            </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;about to macro update: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">target</span><span class="p">[</span><span class="nx">m</span><span class="p">].</span><span class="nx">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; VS &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">valuesToInsert</span><span class="p">[</span><span class="nx">n</span><span class="p">]);</span>
</span><span id="__span-12-89"><a id="__codelineno-12-89" name="__codelineno-12-89" href="#ch12-zabbix-api-self-engaging-__codelineno-12-89"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Number</span><span class="p">(</span><span class="nx">target</span><span class="p">[</span><span class="nx">m</span><span class="p">].</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">valuesToInsert</span><span class="p">[</span><span class="nx">n</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-90"><a id="__codelineno-12-90" name="__codelineno-12-90" href="#ch12-zabbix-api-self-engaging-__codelineno-12-90"></a><span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-12-91"><a id="__codelineno-12-91" name="__codelineno-12-91" href="#ch12-zabbix-api-self-engaging-__codelineno-12-91"></a><span class="w">                </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;globalmacroid&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">[</span><span class="nx">m</span><span class="p">].</span><span class="nx">globalmacroid</span><span class="p">;</span>
</span><span id="__span-12-92"><a id="__codelineno-12-92" name="__codelineno-12-92" href="#ch12-zabbix-api-self-engaging-__codelineno-12-92"></a><span class="w">                </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">valuesToInsert</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span>
</span><span id="__span-12-93"><a id="__codelineno-12-93" name="__codelineno-12-93" href="#ch12-zabbix-api-self-engaging-__codelineno-12-93"></a><span class="w">                </span><span class="nx">dataForUpdate</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</span><span id="__span-12-94"><a id="__codelineno-12-94" name="__codelineno-12-94" href="#ch12-zabbix-api-self-engaging-__codelineno-12-94"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-95"><a id="__codelineno-12-95" name="__codelineno-12-95" href="#ch12-zabbix-api-self-engaging-__codelineno-12-95"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-96"><a id="__codelineno-12-96" name="__codelineno-12-96" href="#ch12-zabbix-api-self-engaging-__codelineno-12-96"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-97"><a id="__codelineno-12-97" name="__codelineno-12-97" href="#ch12-zabbix-api-self-engaging-__codelineno-12-97"></a><span class="p">}</span>
</span><span id="__span-12-98"><a id="__codelineno-12-98" name="__codelineno-12-98" href="#ch12-zabbix-api-self-engaging-__codelineno-12-98"></a>
</span><span id="__span-12-99"><a id="__codelineno-12-99" name="__codelineno-12-99" href="#ch12-zabbix-api-self-engaging-__codelineno-12-99"></a><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;about to macro update: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">dataForUpdate</span><span class="p">));</span>
</span><span id="__span-12-100"><a id="__codelineno-12-100" name="__codelineno-12-100" href="#ch12-zabbix-api-self-engaging-__codelineno-12-100"></a>
</span><span id="__span-12-101"><a id="__codelineno-12-101" name="__codelineno-12-101" href="#ch12-zabbix-api-self-engaging-__codelineno-12-101"></a>
</span><span id="__span-12-102"><a id="__codelineno-12-102" name="__codelineno-12-102" href="#ch12-zabbix-api-self-engaging-__codelineno-12-102"></a><span class="c1">// if there is anything to update (usually seconds has been changed)</span>
</span><span id="__span-12-103"><a id="__codelineno-12-103" name="__codelineno-12-103" href="#ch12-zabbix-api-self-engaging-__codelineno-12-103"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dataForUpdate</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-104"><a id="__codelineno-12-104" name="__codelineno-12-104" href="#ch12-zabbix-api-self-engaging-__codelineno-12-104"></a><span class="kd">var</span><span class="w"> </span><span class="nx">allUpdateOperations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-12-105"><a id="__codelineno-12-105" name="__codelineno-12-105" href="#ch12-zabbix-api-self-engaging-__codelineno-12-105"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;usermacro.updateglobal&quot;,&quot;params&quot;:&#39;</span><span class="o">+</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">dataForUpdate</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="s1">&#39;,&quot;id&quot;:1}&#39;</span>
</span><span id="__span-12-106"><a id="__codelineno-12-106" name="__codelineno-12-106" href="#ch12-zabbix-api-self-engaging-__codelineno-12-106"></a><span class="p">));</span>
</span><span id="__span-12-107"><a id="__codelineno-12-107" name="__codelineno-12-107" href="#ch12-zabbix-api-self-engaging-__codelineno-12-107"></a><span class="p">}</span>
</span><span id="__span-12-108"><a id="__codelineno-12-108" name="__codelineno-12-108" href="#ch12-zabbix-api-self-engaging-__codelineno-12-108"></a>
</span><span id="__span-12-109"><a id="__codelineno-12-109" name="__codelineno-12-109" href="#ch12-zabbix-api-self-engaging-__codelineno-12-109"></a>
</span><span id="__span-12-110"><a id="__codelineno-12-110" name="__codelineno-12-110" href="#ch12-zabbix-api-self-engaging-__codelineno-12-110"></a><span class="c1">// output</span>
</span><span id="__span-12-111"><a id="__codelineno-12-111" name="__codelineno-12-111" href="#ch12-zabbix-api-self-engaging-__codelineno-12-111"></a><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-12-112"><a id="__codelineno-12-112" name="__codelineno-12-112" href="#ch12-zabbix-api-self-engaging-__codelineno-12-112"></a><span class="w">    </span><span class="s1">&#39;allCreateOperation&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">allCreateOperation</span><span class="p">,</span>
</span><span id="__span-12-113"><a id="__codelineno-12-113" name="__codelineno-12-113" href="#ch12-zabbix-api-self-engaging-__codelineno-12-113"></a><span class="w">    </span><span class="s1">&#39;allUpdateOperations&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">allUpdateOperations</span>
</span><span id="__span-12-114"><a id="__codelineno-12-114" name="__codelineno-12-114" href="#ch12-zabbix-api-self-engaging-__codelineno-12-114"></a><span class="p">})</span>
</span></code></pre></div>
<p><img alt="Reinstall YYYY-MM-DD" src="../ch12-zabbix-api/self-engaging/ch12.24-yyyy-mm-dd.png" /></p>
<p><em>12.24
Create or reinstall global macros</em></p>
<p>After running a script now, there are global variables available:</p>
<p><img alt="Reinstall YYYY-MM-DD" src="../ch12-zabbix-api/self-engaging/ch12.25-yyyy-mm-dd-result.png" /></p>
<p><em>12.24
Global YYYY, MM, DD macros</em></p>
<p>For log item monitoring we can use native log item key:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch12-zabbix-api-self-engaging-__codelineno-13-1"></a>log[/var/log/zabbix/backup_{$DATE:arg1.year}.{$DATE:arg2.month}.{$DATE:arg3.day}.log]
</span></code></pre></div>
<p>In case need to analyze a single summary where file size is less than 16 MB, then can use:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch12-zabbix-api-self-engaging-__codelineno-14-1"></a>vfs.file.contents[/var/log/backup/summary_{$DATE:arg1.year}.{$DATE:arg2.month}.{$DATE:arg3.day}.txt]
</span></code></pre></div></section></section>
                    <section class='print-page md-section' id='section-18' heading-number='18'>
                        <h1>Chapter 13 : Advanced set up and security<a class='headerlink' href='#section-18' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch13-advanced-security-chapter" heading-number="18.1"><h1 id="ch13-advanced-security-chapter-advanced-set-up-and-security">Advanced set-up and security</h1>
<p>In today's interconnected IT landscape, monitoring systems like Zabbix have become
critical infrastructure components, offering visibility into the health and performance
of entire networks. However, these powerful monitoring tools also represent potential
security vulnerabilities if not properly secured. This chapter will explores the
essential combination of SELinux and security best practices to harden your Zabbix
deployment against modern threats.</p>
<p>Security is not an optional feature but a fundamental requirement for any monitoring
solution. Zabbix, with its extensive reach across your infrastructure, has access
to sensitive system information and often operates with elevated privileges.
Without proper security controls, a compromised monitoring system can become a
launchpad for lateral movement across your network, potentially exposing critical
business data and systems.</p>
<p>We'll explore how SELinux's mandatory access control framework provides an additional
security layer beyond traditional permissions, and how proper configuration can
dramatically reduce your attack surface. You'll learn practical, implementable
security measures that balance protection with functionality, ensuring your monitoring
capabilities remain intact while defending against both external and internal threats.</p>
<p>Whether you're a system administrator, security professional, or IT manager, understanding
these security principles will help you transform your Zabbix deployment from a
potential liability into a secure asset within your security architecture.</p></section><section class="print-page" id="ch13-advanced-security-selinux-zabbix" heading-number="18.2"><h1 id="ch13-advanced-security-selinux-zabbix-selinux-and-zabbix">SELinux and Zabbix</h1>
<p>SELinux (Security-Enhanced Linux) provides mandatory access control for Zabbix by
enforcing security policies that restrict what the Zabbix processes can do, even
when running as root.</p>
<p>SELinux contexts are a core component of how SELinux implements security control.
Think of contexts as labels that are assigned to every object in the system (files, processes, ports, etc.).
These labels determine what can interact with what.</p>
<h3 id="ch13-advanced-security-selinux-zabbix-selinux-enforcement-mode">SELinux Enforcement Mode</h3>
<p>For SELinux to actually provide security protection, it needs to be set to "enforcing" mode. There are three possible modes for SELinux:</p>
<ul>
<li><strong>Enforcing</strong> - SELinux security policy is enforced. Actions that violate policy are blocked and logged.</li>
<li><strong>Permissive</strong> - SELinux security policy is not enforced but violations are logged. This is useful for debugging.</li>
<li><strong>Disabled</strong> - SELinux is completely turned off.</li>
</ul>
<p>You can check the current SELinux mode with the getenforce command:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-0-1"></a><span class="l l-Scalar l-Scalar-Plain">getenforce</span>
</span></code></pre></div>
<p>This should return : Enforcing</p>
<p>To properly secure Zabbix with SELinux, the system should be in <code>Enforcing</code> mode. If it's not, you can change it temporarily:</p>
<h5 id="ch13-advanced-security-selinux-zabbix-set-to-enforcing-immediately-until-reboot">Set to enforcing immediately (until reboot)</h5>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-1-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo setenforce 1</span>
</span></code></pre></div>
<p>For permanent configuration, edit /etc/selinux/config and set:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-2-1"></a><span class="l l-Scalar l-Scalar-Plain">SELINUX=Enforcing</span>
</span></code></pre></div>
<h3 id="ch13-advanced-security-selinux-zabbix-basic-structure-of-an-selinux-context">Basic Structure of an SELinux Context</h3>
<p>An SELinux context typically consists of four parts:</p>
<ul>
<li><strong>User</strong>: The SELinux user identity (not the same as Linux users)</li>
<li><strong>Role</strong>: What roles the user can enter</li>
<li><strong>Type</strong>: The domain for processes or type for files (most important part)</li>
<li><strong>Level</strong>: Optional MLS (Multi-Level Security) sensitivity level</li>
</ul>
<p>When displayed, these appear in the format: user:role:type:level</p>
<h3 id="ch13-advanced-security-selinux-zabbix-how-contexts-work-in-practice">How Contexts Work in Practice</h3>
<p>In the Zabbix SELinux configuration, several security types are defined to control access:</p>
<ul>
<li><strong>zabbix_t</strong>: The domain in which the Zabbix server process runs</li>
<li><strong>zabbix_port_t</strong>: Type assigned to network ports that Zabbix uses</li>
<li><strong>zabbix_var_run_t</strong>: Type for Zabbix runtime socket files</li>
<li><strong>httpd_t</strong>: The domain for the Apache web server process</li>
</ul>
<p>The SELinux policy allows specific permissions between these types:</p>
<p>Zabbix server can connect to its own Unix stream sockets
Zabbix server can connect to network ports labeled as zabbix_port_t
Zabbix server can create and remove socket files in directories labeled as zabbix_var_run_t</p>
<p>The web server (httpd) can connect to Zabbix ports, allowing the web frontend to
communicate with the Zabbix server.
These permissions ensure Zabbix components can communicate properly while maintaining
SELinux security boundaries.</p>
<p>When Zabbix tries to access a file or network resource, SELinux checks if the context
of the Zabbix process is allowed to access the context of that resource according to
policy rules.</p>
<h3 id="ch13-advanced-security-selinux-zabbix-viewing-contexts">Viewing Contexts</h3>
<div class="admonition info">
<p class="admonition-title">You can view the contexts of files using:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-3-1"></a><span class="l l-Scalar l-Scalar-Plain">ls -Z /path/to/zabbix/files</span>
</span></code></pre></div>
</div>
<div class="admonition info">
<p class="admonition-title">And for the processes:</p>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-4-1"></a><span class="l l-Scalar l-Scalar-Plain">ps -eZ | grep zabbix&quot;</span>
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-5-1"></a><span class="l l-Scalar l-Scalar-Plain">system_u:system_r:unconfined_service_t:s0 691 ?  00:02:20 zabbix_agent2</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch13-advanced-security-selinux-zabbix-__codelineno-5-2"></a><span class="l l-Scalar l-Scalar-Plain">system_u:system_r:zabbix_t:s0       707 ?        00:00:59 zabbix_server</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch13-advanced-security-selinux-zabbix-__codelineno-5-3"></a><span class="l l-Scalar l-Scalar-Plain">system_u:system_r:zabbix_t:s0      1203 ?        00:02:00 zabbix_server</span>
</span></code></pre></div></p>
</div>
<div class="admonition info">
<p class="admonition-title">And for log files</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-6-1"></a><span class="l l-Scalar l-Scalar-Plain">ls -alZ /var/log/zabbix/zabbix_server.log</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch13-advanced-security-selinux-zabbix-__codelineno-6-2"></a><span class="l l-Scalar l-Scalar-Plain">```yaml</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch13-advanced-security-selinux-zabbix-__codelineno-6-3"></a><span class="l l-Scalar l-Scalar-Plain">-rw-rw-r--. 1 zabbix zabbix system_u:object_r:zabbix_log_t:s0 11857 Apr 26 22:02 /var/log/zabbix/zabbix_server.log</span>
</span></code></pre></div>
</div>
<h3 id="ch13-advanced-security-selinux-zabbix-zabbix-selinux-policy-package">Zabbix-selinux-policy Package</h3>
<p>The zabbix-selinux-policy package is a specialized SELinux policy module designed
specifically for Zabbix deployments. It provides pre-configured SELinux policies
that allow Zabbix components to function properly while running in an SELinux enforced
environment.</p>
<p>Key Functions of the Package:</p>
<ul>
<li><strong>Pre-defined Contexts</strong> : Contains proper SELinux context definitions for Zabbix
  binaries, configuration files, log directories, and other resources.</li>
<li><strong>Port Definitions</strong> : Registers standard Zabbix ports (like 10050 for agent, 10051 for server)
  in the SELinux policy so they can be used without triggering denials.</li>
<li><strong>Access Rules</strong>: Defines which operations Zabbix processes can perform, like writing
  to log files, connecting to databases, and communicating over networks.</li>
<li><strong>Boolean Toggles</strong>: Provides SELinux boolean settings specific to Zabbix that can
  enable/disable certain functionalities without having to write custom policies.</li>
</ul>
<p>Benefits of Using the Package:</p>
<ul>
<li><strong>Simplified Deployment</strong> : Reduces the need for manual SELinux policy adjustments when
  installing Zabbix.</li>
<li><strong>Security by Default</strong>: Ensures Zabbix operates with minimal required permissions rather than running in permissive mode.</li>
<li><strong>Maintained Compatibility</strong>: The package is updated alongside Zabbix to ensure compatibility with new features.</li>
</ul>
<h4 id="ch13-advanced-security-selinux-zabbix-installation-and-usage">Installation and Usage</h4>
<p>The package is typically installed alongside other Zabbix components:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-7-1"></a><span class="l l-Scalar l-Scalar-Plain">dnf install zabbix-selinux-policy</span>
</span></code></pre></div>
<p>After installation, the SELinux contexts are automatically applied to standard Zabbix
paths and ports. If you use non-standard configurations, you may still need to make
manual adjustments.
This package essentially bridges the gap between Zabbix's operational requirements
and SELinux's strict security controls, making it much easier to run Zabbix securely
without compromising on monitoring capabilities.</p>
<h3 id="ch13-advanced-security-selinux-zabbix-for-zabbix-to-function-properly-with-selinux-enabled">For Zabbix to function properly with SELinux enabled:</h3>
<p>Zabbix binaries and configuration files need appropriate SELinux labels (typically zabbix_t context)
Network ports used by Zabbix must be properly defined in SELinux policy
Database connections require defined policies for Zabbix to communicate with MySQL/PostgreSQL
File paths for monitoring, logging, and temporary files need correct contexts</p>
<p>When issues occur, they typically manifest as denied operations in SELinux audit logs. Administrators can either:</p>
<p>Use audit2allow to create custom policy modules for legitimate Zabbix operations
Apply proper context labels using semanage and restorecon commands
Configure boolean settings to enable specific Zabbix functionality</p>
<p>This combination creates defense-in-depth by ensuring that even if Zabbix is compromised,
the attacker remains constrained by SELinux policies, limiting potential damage to
your systems.</p>
<h4 id="ch13-advanced-security-selinux-zabbix-zabbix-selinux-boolean">Zabbix SELinux Boolean</h4>
<p>One of the most convenient aspects of the SELinux implementation for Zabbix is the
use of "booleans". simple on/off switches that control specific permissions. These
allow you to fine-tune SELinux policies without needing to understand complex policy
writing. Key Zabbix booleans include:</p>
<ul>
<li><strong>zabbix_can_network</strong>: Controls whether Zabbix can initiate network connections</li>
<li><strong>httpd_can_connect_zabbix</strong>: Controls whether the web server can connect to Zabbix</li>
<li><strong>zabbix_run_sudo</strong>: Controls whether Zabbix can execute sudo commands</li>
</ul>
<div class="admonition info">
<p class="admonition-title">You can view these settings with:</p>
</div>
<p><code>yaml
    getsebool -a | grep zabbix</code>
And you can toggle them as needed with setsebool.</p>
<h3 id="ch13-advanced-security-selinux-zabbix-enable-zabbix-network-connections-persistent-across-reboots">Enable Zabbix network connections (persistent across reboots)</h3>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-8-1"></a><span class="l l-Scalar l-Scalar-Plain">setsebool -P zabbix_can_network on</span>
</span></code></pre></div>
<p>These booleans make it much easier to securely deploy Zabbix while maintaining SELinux
protection, as you can enable only the specific capabilities that your Zabbix implementation
needs without compromising overall system security.</p>
<h3 id="ch13-advanced-security-selinux-zabbix-creating-custom-rules">Creating custom rules</h3>
<p>When running Zabbix in environments with SELinux enabled, you may encounter permission
issues when Zabbix attempts to execute certain utilities like fping. This occurs
because fping uses setuid (SUID) permissions, and SELinux's default policies prevent
Zabbix from executing such binaries for security reasons.</p>
<p>There are different solutions to this problem:</p>
<ul>
<li><strong>Method 1: Automated Policy Generation :</strong></li>
</ul>
<p>The most straightforward approach is to use the audit2allow utility to analyse
SELinux denial messages and generate appropriate policies:</p>
<p>First, capture the denial events from the audit log:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-9-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo grep zabbix /var/log/audit/audit.log | grep fping | audit2allow -M zabbix_fping</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Install the generated policy module:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-10-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo semodule -i zabbix_fping.pp</span>
</span></code></pre></div>
</div>
<div class="admonition info">
<p class="admonition-title">Apply the correct SELinux context to the fping binary:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-11-1"></a><span class="l l-Scalar l-Scalar-Plain">sudo chcon -t fping_exec_t /usr/sbin/fping</span>
</span></code></pre></div>
</div>
<ul>
<li><strong>Method 2: Manual Policy Creation :</strong></li>
</ul>
<p>For more control or in situations where audit logs aren't available, you can manually
create a custom policy:</p>
<p>Create a policy file named zabbix_fping.te with the following content:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-1"></a><span class="l l-Scalar l-Scalar-Plain">module zabbix_fping 1.0;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-3"></a><span class="l l-Scalar l-Scalar-Plain">require {</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-4"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">type zabbix_t;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-5"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">type fping_t;</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-6"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">type fping_exec_t;</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-7"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">class file { execute execute_no_trans getattr open read };</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-8"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">class capability net_raw;</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-9"></a><span class="l l-Scalar l-Scalar-Plain">}</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-10"></a>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-11"></a><span class="l l-Scalar l-Scalar-Plain">#============= zabbix_t ==============</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-12"></a><span class="l l-Scalar l-Scalar-Plain">allow zabbix_t fping_exec_t:file { execute execute_no_trans getattr open read };</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#ch13-advanced-security-selinux-zabbix-__codelineno-12-13"></a><span class="l l-Scalar l-Scalar-Plain">allow zabbix_t self:capability net_raw;</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Compile the policy module:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-13-1"></a><span class="l l-Scalar l-Scalar-Plain">checkmodule -M -m -o zabbix_fping.mod zabbix_fping.te</span>
</span></code></pre></div>
</div>
<div class="admonition info">
<p class="admonition-title">Package the compiled module:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-14-1"></a><span class="l l-Scalar l-Scalar-Plain">semodule_package -o zabbix_fping.pp -m zabbix_fping.mod</span>
</span></code></pre></div>
</div>
<div class="admonition info">
<p class="admonition-title">Install the policy module:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch13-advanced-security-selinux-zabbix-__codelineno-15-1"></a><span class="l l-Scalar l-Scalar-Plain">semodule -i zabbix_fping.pp</span>
</span></code></pre></div>
</div>
<h2 id="ch13-advanced-security-selinux-zabbix-securing-zabbix-admin">Securing zabbix admin</h2>
<h2 id="ch13-advanced-security-selinux-zabbix-https">HTTPS</h2>
<h2 id="ch13-advanced-security-selinux-zabbix-db-certs">DB certs</h2>
<h2 id="ch13-advanced-security-selinux-zabbix-conclusion">Conclusion</h2>
<h2 id="ch13-advanced-security-selinux-zabbix-questions">Questions</h2>
<ul>
<li>Why does SELinux prevent Zabbix from executing fping by default?</li>
<li>In what situations might you need to create custom SELinux policies for other Zabbix monitoring tools?</li>
<li>What are the key differences between using audit2allow and manually creating a custom policy module?</li>
</ul>
<h2 id="ch13-advanced-security-selinux-zabbix-useful-urls">Useful URLs</h2>
<ul>
<li>https://www.zabbix.com/documentation/7.2/en/manual/installation/install_from_packages/rhel?hl=SELinux#selinux-configuration</li>
<li>https://www.systutorials.com/docs/linux/man/8-zabbix_selinux/</li>
<li>https://man.linuxreviews.org/man8/zabbix_agent_selinux.8.html</li>
<li>https://phoenixnap.com/kb/selinux</li>
</ul></section><section class="print-page" id="ch13-advanced-security-securing-frontend" heading-number="18.3"><h1 id="ch13-advanced-security-securing-frontend-securing-the-frontend">Securing the frontend</h1>
<p>The frontend is what we use to login into our system. The Zabbix frontend will
connect to our Zabbix server and our database.
But we also send information from our laptop to the frontend. It's important that
when we enter our credentials that we can do this in a safe way.
So it makes sense to make use of certificates and one way to do this is by making
use of Self-Signed certificates.</p>
<p>To give you a better understanding of why your browser will warn you when using
self signed certificates, we have to know that when we request an SSL certificate
from an official Certificate Authority (CA) that you submit a Certificate Signing
request (CSR) to them. They in return provide you with a Signed SSL certificate.
For this they make use of their root certificate and private key.
Our browser comes with a copy of the root certificate (CA) from various authorities
or it can access it from the OS. This is why our self signed certificates are not
trusted by our browser, we don't have any CA validation. Our only workaround is to
create our own root certificate and private key.</p>
<h2 id="ch13-advanced-security-securing-frontend-understanding-the-concepts">Understanding the concepts</h2>
<h3 id="ch13-advanced-security-securing-frontend-how-to-create-an-ssl-certificate">How to create an SSL certificate</h3>
<p><br /></p>
<p><img alt="SSL Ok" src="../ch13-advanced-security/securing-frontend/ssl-ca.png" /></p>
<h2 id="ch13-advanced-security-securing-frontend-how-ssl-works-client-server-flow">How SSL works - Client - Server flow</h2>
<p><img alt="SSL Ok" src="../ch13-advanced-security/securing-frontend/ssl-workflow.png" />
<br /></p>
<details class="note" open="open">
<summary>Note</summary>
<p>Borrowed the designs from https://www.youtube.com/watch?v=WqgzYuHtnIM
this video explains well how SSL works.</p>
</details>
<h2 id="ch13-advanced-security-securing-frontend-securing-the-frontend-with-self-signed-certificates">Securing the frontend with self signed Certificates</h2>
<p>To configure this there are a few steps that we need to follow:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch13-advanced-security-securing-frontend-__codelineno-0-1"></a>- Generate a private key for the CA ( Certificate Authority )
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch13-advanced-security-securing-frontend-__codelineno-0-2"></a>- Generate a root certificate
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch13-advanced-security-securing-frontend-__codelineno-0-3"></a>- Generating CA-Authenticated Certificates
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch13-advanced-security-securing-frontend-__codelineno-0-4"></a>- Generate a Certificate Signing Request (CSR)
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch13-advanced-security-securing-frontend-__codelineno-0-5"></a>- Generate an X509 V3 certificate extension configuration file
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch13-advanced-security-securing-frontend-__codelineno-0-6"></a>- Generate the certificate using our CSR, the CA private key, the CA certificate,
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch13-advanced-security-securing-frontend-__codelineno-0-7"></a>  and the config file
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch13-advanced-security-securing-frontend-__codelineno-0-8"></a>- Copy the SSL certificates to our Virtual Host
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch13-advanced-security-securing-frontend-__codelineno-0-9"></a>- Adapt your Nginx Zabbix config
</span></code></pre></div>
<h3 id="ch13-advanced-security-securing-frontend-generate-a-private-key-for-the-ca">Generate a private key for the CA</h3>
<p>First step is to make a folder named SSL so we can create our certificates and safe them:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch13-advanced-security-securing-frontend-__codelineno-1-1"></a>&gt;- mkdir ~/ssl
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch13-advanced-security-securing-frontend-__codelineno-1-2"></a>&gt;- cd ~/ssl
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch13-advanced-security-securing-frontend-__codelineno-1-3"></a>&gt;- openssl ecparam -out myCA.key -name prime256v1 -genkey
</span></code></pre></div>
<p>Let's explain all the options;</p>
<blockquote>
<ul>
<li>openssl : The tool to use the OpenSSL library, this library provides us with
   cryptographic functions and utilities.</li>
<li>out myCA.key : This part of the command specifies the output file name for the
   generated private key. </li>
<li>name prime256v1: Name of the elliptic curve; X9.62/SECG curve over a 256 bit
   prime field</li>
<li>ecparam: This command is used to manipulate or generate EC parameter files.</li>
<li>genkey: This option will generate a EC private key using the specified parameters.</li>
</ul>
</blockquote>
<h3 id="ch13-advanced-security-securing-frontend-generate-a-root-certificate">Generate a Root Certificate</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch13-advanced-security-securing-frontend-__codelineno-2-1"></a>openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span>-new<span class="w"> </span>-nodes<span class="w"> </span>-key<span class="w"> </span>myCA.key<span class="w"> </span>-sha256<span class="w"> </span>-days<span class="w"> </span><span class="m">1825</span><span class="w"> </span>-out<span class="w"> </span>myCA.pem
</span></code></pre></div>
<p>Let's explain all the options;</p>
<blockquote>
<ul>
<li>openssl: The command-line tool for OpenSSL.</li>
<li>req: This command is used for X.509 certificate signing request (CSR) management.</li>
<li>x509: This option specifies that a self-signed certificate should be created.</li>
<li>new: This option is used to generate a new certificate.</li>
<li>nodes: This option indicates that the private key should not be encrypted.
   It will generates a private key without a passphrase, making it more convenient
   but potentially less secure.</li>
<li>key myCA.key: This specifies the private key file (myCA.key) to be used in
   generating the certificate.</li>
<li>sha256: This option specifies the hash algorithm to be used for the certificate.
   In this case, SHA-256 is chosen for stronger security.</li>
<li>days 1825: This sets the validity period of the certificate in days. Here, it‚Äôs
   set to 1825 days (5 years).</li>
<li>out myCA.pem: This specifies the output file name for the generated certificate.
   In this case, ‚ÄúmyCA.pem.‚Äù</li>
</ul>
</blockquote>
<p>The information you enter is not so important but it's best to fill it in as good
as possible. Just make sure you enter for CN you IP or DNS.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch13-advanced-security-securing-frontend-__codelineno-3-1"></a>You are about to be asked to enter information that will be incorporated
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch13-advanced-security-securing-frontend-__codelineno-3-2"></a>into your certificate request.
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ch13-advanced-security-securing-frontend-__codelineno-3-3"></a>What you are about to enter is what is called a Distinguished Name or a DN.
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ch13-advanced-security-securing-frontend-__codelineno-3-4"></a>There are quite a few fields but you can leave some blank
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ch13-advanced-security-securing-frontend-__codelineno-3-5"></a>For some fields there will be a default value,
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ch13-advanced-security-securing-frontend-__codelineno-3-6"></a>If you enter &#39;.&#39;, the field will be left blank.
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ch13-advanced-security-securing-frontend-__codelineno-3-7"></a>-----
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ch13-advanced-security-securing-frontend-__codelineno-3-8"></a>Country Name (2 letter code) [XX]:BE
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#ch13-advanced-security-securing-frontend-__codelineno-3-9"></a>State or Province Name (full name) []:vlaams-brabant
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#ch13-advanced-security-securing-frontend-__codelineno-3-10"></a>Locality Name (eg, city) [Default City]:leuven
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#ch13-advanced-security-securing-frontend-__codelineno-3-11"></a>Organization Name (eg, company) [Default Company Ltd]:
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#ch13-advanced-security-securing-frontend-__codelineno-3-12"></a>Organizational Unit Name (eg, section) []:
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#ch13-advanced-security-securing-frontend-__codelineno-3-13"></a>Common Name (eg, your name or your server&#39;s hostname) []:192.168.0.134
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#ch13-advanced-security-securing-frontend-__codelineno-3-14"></a>Email Address []:
</span></code></pre></div>
<h3 id="ch13-advanced-security-securing-frontend-generating-ca-authenticated-certificates">Generating CA-Authenticated Certificates</h3>
<p>It's probably good practice to use de dns name of your website in the name of
the private key. As we use in this case no DNS but an IP address I will use
the fictive dns zabbix.mycompany.internal.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch13-advanced-security-securing-frontend-__codelineno-4-1"></a>openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>zabbix.mycompany.internal.key<span class="w"> </span><span class="m">2048</span>
</span></code></pre></div>
<h3 id="ch13-advanced-security-securing-frontend-generate-a-certificate-signing-request-csr">Generate a Certificate Signing Request (CSR)</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch13-advanced-security-securing-frontend-__codelineno-5-1"></a>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-key<span class="w"> </span>zabbix.mycompany.internal.key<span class="w"> </span>-out<span class="w"> </span>zabbix.mycompany.internal.csr
</span></code></pre></div>
<p>You will be asked the same set of questions as above. Once again your answers hold
minimal significance and in our case no one will inspect the certificate so they
matter even less.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch13-advanced-security-securing-frontend-__codelineno-6-1"></a>You are about to be asked to enter information that will be incorporated
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch13-advanced-security-securing-frontend-__codelineno-6-2"></a>into your certificate request.
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch13-advanced-security-securing-frontend-__codelineno-6-3"></a>What you are about to enter is what is called a Distinguished Name or a DN.
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ch13-advanced-security-securing-frontend-__codelineno-6-4"></a>There are quite a few fields but you can leave some blank
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ch13-advanced-security-securing-frontend-__codelineno-6-5"></a>For some fields there will be a default value,
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#ch13-advanced-security-securing-frontend-__codelineno-6-6"></a>If you enter &#39;.&#39;, the field will be left blank.
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#ch13-advanced-security-securing-frontend-__codelineno-6-7"></a>-----
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#ch13-advanced-security-securing-frontend-__codelineno-6-8"></a>Country Name (2 letter code) [XX]:BE
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#ch13-advanced-security-securing-frontend-__codelineno-6-9"></a>State or Province Name (full name) []:vlaams-brabant
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#ch13-advanced-security-securing-frontend-__codelineno-6-10"></a>Locality Name (eg, city) [Default City]:leuven
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#ch13-advanced-security-securing-frontend-__codelineno-6-11"></a>Organization Name (eg, company) [Default Company Ltd]:
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#ch13-advanced-security-securing-frontend-__codelineno-6-12"></a>Organizational Unit Name (eg, section) []:
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#ch13-advanced-security-securing-frontend-__codelineno-6-13"></a>Common Name (eg, your name or your server&#39;s hostname) []:192.168.0.134
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#ch13-advanced-security-securing-frontend-__codelineno-6-14"></a>Email Address []:
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#ch13-advanced-security-securing-frontend-__codelineno-6-15"></a>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#ch13-advanced-security-securing-frontend-__codelineno-6-16"></a>Please enter the following &#39;extra&#39; attributes
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#ch13-advanced-security-securing-frontend-__codelineno-6-17"></a>to be sent with your certificate request
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#ch13-advanced-security-securing-frontend-__codelineno-6-18"></a>A challenge password []:
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#ch13-advanced-security-securing-frontend-__codelineno-6-19"></a>An optional company name []:
</span></code></pre></div>
<h3 id="ch13-advanced-security-securing-frontend-generate-an-x509-v3-certificate-extension-configuration-file">Generate an X509 V3 certificate extension configuration file.</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch13-advanced-security-securing-frontend-__codelineno-7-1"></a><span class="c1"># vi zabbix.mycompany.internal.ext</span>
</span></code></pre></div>
<p>Add the following lines in your certificate extension file. Replace IP or DNS
with your own values.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch13-advanced-security-securing-frontend-__codelineno-8-1"></a><span class="nv">authorityKeyIdentifier</span><span class="o">=</span>keyid,issuer
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ch13-advanced-security-securing-frontend-__codelineno-8-2"></a><span class="nv">basicConstraints</span><span class="o">=</span>CA:FALSE
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ch13-advanced-security-securing-frontend-__codelineno-8-3"></a><span class="nv">keyUsage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>digitalSignature,<span class="w"> </span>nonRepudiation,<span class="w"> </span>keyEncipherment,<span class="w"> </span>dataEncipherment
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#ch13-advanced-security-securing-frontend-__codelineno-8-4"></a><span class="nv">subjectAltName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>@alt_names
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#ch13-advanced-security-securing-frontend-__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#ch13-advanced-security-securing-frontend-__codelineno-8-6"></a><span class="o">[</span>alt_names<span class="o">]</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#ch13-advanced-security-securing-frontend-__codelineno-8-7"></a>IP.1<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">192</span>.168.0.133
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#ch13-advanced-security-securing-frontend-__codelineno-8-8"></a><span class="c1">#DNS.1 = MYDNS (You can use DNS if you have a dns name if you use IP then use the</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#ch13-advanced-security-securing-frontend-__codelineno-8-9"></a>above<span class="w"> </span>line<span class="o">)</span>
</span></code></pre></div>
<h3 id="ch13-advanced-security-securing-frontend-generate-the-certificate-using-our-csr-the-ca-private-key-the-ca-certificate">Generate the certificate using our CSR, the CA private key, the CA certificate,</h3>
<p>and the config file</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch13-advanced-security-securing-frontend-__codelineno-9-1"></a>openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-in<span class="w"> </span>zabbix.mycompany.internal.csr<span class="w"> </span>-CA<span class="w"> </span>myCA.pem<span class="w"> </span>-CAkey<span class="w"> </span>myCA.key<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ch13-advanced-security-securing-frontend-__codelineno-9-2"></a>-CAcreateserial<span class="w"> </span>-out<span class="w"> </span>zabbix.mycompany.internal.crt<span class="w"> </span>-days<span class="w"> </span><span class="m">825</span><span class="w"> </span>-sha256<span class="w"> </span>-extfile<span class="w"> </span>zabbix.mycompany.internal.ext
</span></code></pre></div>
<h3 id="ch13-advanced-security-securing-frontend-copy-the-ssl-certificates-to-our-virtual-host">Copy the SSL certificates to our Virtual Host</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch13-advanced-security-securing-frontend-__codelineno-10-1"></a>cp<span class="w"> </span>zabbix.mycompany.internal.crt<span class="w"> </span>/etc/pki/tls/certs/.<span class="w"> </span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch13-advanced-security-securing-frontend-__codelineno-10-2"></a>cp<span class="w"> </span>zabbix.mycompany.internal.key<span class="w"> </span>/etc/pki/tls/private/.
</span></code></pre></div>
<h4 id="ch13-advanced-security-securing-frontend-import-the-ca-in-linux-rhel">Import the CA in Linux (RHEL)</h4>
<p>We need to update the CA certificate‚Äôs, run the below command to update the CA certs.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch13-advanced-security-securing-frontend-__codelineno-11-1"></a>cp myCA.pem /etc/pki/ca-trust/source/anchors/myCA.crt
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ch13-advanced-security-securing-frontend-__codelineno-11-2"></a>update-ca-trust extract
</span></code></pre></div>
<h4 id="ch13-advanced-security-securing-frontend-import-the-ca-in-osx">Import the CA in OSX</h4>
<ul>
<li>Open the macOS Keychain app.</li>
<li>Navigate to File &gt; Import Items</li>
<li>Choose your private key file (i.e., myCA.pem)</li>
<li>Search for the ‚ÄúCommon Name‚Äù you provided earlier.</li>
<li>Double-click on your root certificate in the list.</li>
<li>Expand the Trust section.</li>
<li>Modify the ‚ÄúWhen using this certificate:‚Äù dropdown to ‚ÄúAlways Trust‚Äù.</li>
<li>Close the certificate window.</li>
</ul>
<h4 id="ch13-advanced-security-securing-frontend-import-the-ca-in-windows">Import the CA in Windows</h4>
<ul>
<li>Open the ‚ÄúMicrosoft Management Console‚Äù by pressing Windows + R, typing mmc, and
  clicking Open.</li>
<li>Navigate to File &gt; Add/Remove Snap-in.</li>
<li>Select Certificates and click Add.</li>
<li>Choose Computer Account and proceed by clicking Next.</li>
<li>Select Local Computer and click Finish.</li>
<li>Click OK to return to the MMC window.</li>
<li>Expand the view by double-clicking Certificates (local computer).</li>
<li>Right-click on Certificates under ‚ÄúObject Type‚Äù in the middle column, select
  All Tasks, and then Import.</li>
<li>Click Next, followed by Browse. Change the certificate extension dropdown next
  to the filename field to All Files (<em>.</em>) and locate the myCA.pem file.</li>
<li>Click Open, then Next.</li>
<li>Choose ‚ÄúPlace all certificates in the following store.‚Äù with ‚ÄúTrusted Root
  Certification Authorities store‚Äù as the default. Proceed by clicking Next, then
  Finish, to finalize the wizard.</li>
<li>If all went well you should find your certificate under Trusted Root Certification
  Authorities &gt; Certificates</li>
</ul>
<details class="warning" open="open">
<summary>Warning</summary>
<p>You also need to import the myCA.crt file in your OS we are not an official
CA so we have to import it in our OS and tell it to trust this Certificate.
This action depends on the OS you use.</p>
</details>
<p>As you are using OpenSSL, you should also create a strong Diffie-Hellman group,
which is used in negotiating Perfect Forward Secrecy with clients.
You can do this by typing:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch13-advanced-security-securing-frontend-__codelineno-12-1"></a>openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048
</span></code></pre></div>
<h4 id="ch13-advanced-security-securing-frontend-adapt-your-nginx-zabbix-config">Adapt your Nginx Zabbix config</h4>
<p>Add the following lines to your Nginx configuration, modifying the file paths as needed.
Replace the the already existing lines with port 80 with this configuration. This
will enable SSL and HTTP2.</p>
<div class="admonition info">
<p class="admonition-title">Adapt the Nginx config</p>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch13-advanced-security-securing-frontend-__codelineno-13-1"></a># vi /etc/nginx/conf.d/zabbix.conf
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch13-advanced-security-securing-frontend-__codelineno-14-1"></a>server {
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch13-advanced-security-securing-frontend-__codelineno-14-2"></a>        listen          443 http2 ssl;
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#ch13-advanced-security-securing-frontend-__codelineno-14-3"></a>        listen          [::]:443 http2 ssl;
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#ch13-advanced-security-securing-frontend-__codelineno-14-4"></a>        server_name     &lt;ip qddress&gt;;
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#ch13-advanced-security-securing-frontend-__codelineno-14-5"></a>        ssl_certificate /etc/ssl/certs/zabbix.mycompany.internal.crt;
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#ch13-advanced-security-securing-frontend-__codelineno-14-6"></a>        ssl_certificate_key /etc/pki/tls/private/zabbix.mycompany.internal.key;
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#ch13-advanced-security-securing-frontend-__codelineno-14-7"></a>        ssl_dhparam /etc/ssl/certs/dhparam.pem;
</span></code></pre></div></p>
<p>To redirect traffic from port 80 to 443 we can add the following lines above our
https block:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch13-advanced-security-securing-frontend-__codelineno-15-1"></a>server {
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#ch13-advanced-security-securing-frontend-__codelineno-15-2"></a>       listen         80;
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#ch13-advanced-security-securing-frontend-__codelineno-15-3"></a>       server_name    _; #dns or ip is also possible
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#ch13-advanced-security-securing-frontend-__codelineno-15-4"></a>       return         301 https://$host$request_uri;
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#ch13-advanced-security-securing-frontend-__codelineno-15-5"></a>}
</span></code></pre></div>
Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch13-advanced-security-securing-frontend-__codelineno-16-1"></a>ToDo
</span></code></pre></div></p>
</div>
<h4 id="ch13-advanced-security-securing-frontend-adapt-your-apache-zabbix-config">Adapt your Apache Zabbix config</h4>
<h4 id="ch13-advanced-security-securing-frontend-restart-all-services-and-allow-https-traffic">Restart all services and allow https traffic</h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch13-advanced-security-securing-frontend-__codelineno-17-1"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>php-fpm.service
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#ch13-advanced-security-securing-frontend-__codelineno-17-2"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#ch13-advanced-security-securing-frontend-__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#ch13-advanced-security-securing-frontend-__codelineno-17-4"></a>firewall-cmd<span class="w"> </span>--add-service<span class="o">=</span>https<span class="w"> </span>--permanent
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#ch13-advanced-security-securing-frontend-__codelineno-17-5"></a>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div>
<p>When we go to our url <code>http://&lt;IP or DNS&gt;/</code> we get redirected to our <code>https://</code> page and when we check we can see that our site is secure:</p>
<p><img alt="SSL Ok" src="../ch13-advanced-security/securing-frontend/cert-ok.png" /></p>
<details class="note" open="open">
<summary>Note</summary>
<ul>
<li>To be even more secure have a loot at https://cipherlist.eu/ this page maintains a list of strong ciphers that you can use so secure your Nginx even more.<br /></li>
<li>You can test your nginx config with 'nginx -t' before you restart.<br /></li>
<li>For HTTP/2 to work you need at least nginx 1.9.5 or later</li>
</ul>
</details>
<h2 id="ch13-advanced-security-securing-frontend-securing-the-frontend-with-lets-encrypt-on-nginx">Securing the Frontend with Let's Encrypt on Nginx</h2>
<p>Creating a certificate with Let's Encrypt is quite easy the only thing you need
is a domain. With a valid dns record set. Once this is in place you can with a
few command in place add SSL to your website.</p>
<h3 id="ch13-advanced-security-securing-frontend-setup-lets-encrypt-with-a-dns-server">Setup Let's Encrypt with a DNS server</h3>
<p>You have a DNS server and everything is properly configured, configuration this
is going to be easy.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch13-advanced-security-securing-frontend-__codelineno-18-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>epel-release
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ch13-advanced-security-securing-frontend-__codelineno-18-2"></a>dnf<span class="w"> </span>install<span class="w"> </span>certbot<span class="w"> </span>python3-certbot-nginx
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ch13-advanced-security-securing-frontend-__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ch13-advanced-security-securing-frontend-__codelineno-18-4"></a><span class="c1"># Make sure you have added your domain in the file /etc/nginx/conf.d/zabbix.com</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#ch13-advanced-security-securing-frontend-__codelineno-18-5"></a><span class="c1"># rename the file</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#ch13-advanced-security-securing-frontend-__codelineno-18-6"></a>mv<span class="w"> </span>/etc/nginx/conf.d/zabix.conf<span class="w"> </span>/etc/nginx/conf.d/&lt;yourdomain.com&gt;
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#ch13-advanced-security-securing-frontend-__codelineno-18-7"></a>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#ch13-advanced-security-securing-frontend-__codelineno-18-8"></a><span class="c1"># run certbot replace yourdomain.com with your own domain </span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#ch13-advanced-security-securing-frontend-__codelineno-18-9"></a>certbot<span class="w"> </span>--nginx<span class="w"> </span>-d<span class="w"> </span>yourdomain.com<span class="w"> </span>-d<span class="w"> </span>www.yourdomain.com
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch13-advanced-security-securing-frontend-__codelineno-19-1"></a><span class="c1"># add firewall config</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#ch13-advanced-security-securing-frontend-__codelineno-19-2"></a>firewall-cmd<span class="w"> </span>--permanent<span class="w"> </span>--add-service<span class="o">=</span>https
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#ch13-advanced-security-securing-frontend-__codelineno-19-3"></a>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch13-advanced-security-securing-frontend-__codelineno-20-1"></a><span class="c1"># Obtain the SSL certificate</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#ch13-advanced-security-securing-frontend-__codelineno-20-2"></a>sudo<span class="w"> </span>certbot<span class="w"> </span>--nginx<span class="w"> </span>-d<span class="w"> </span>yourdomain.com<span class="w"> </span>-d<span class="w"> </span>www.yourdomain.com
</span></code></pre></div>
<p>This will install the certificates automatic in your configuration file. In case
you had not renamed your file with the domain name you have alter the config
file yourself.
You can take a look for an example to the next topic.</p>
<h3 id="ch13-advanced-security-securing-frontend-setup-lets-encrypt-without-local-a-dns-server">Setup Let;s encrypt without local a DNS server</h3>
<p>In case you like to test this at home it's a bit more complex if you don't have a
DNS server at home but still possible with DNS-01 if you have bought a domain and
are able to configure the TXT records for this domain. In this case we can use
get.acme.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch13-advanced-security-securing-frontend-__codelineno-21-1"></a><span class="c1"># Install the needed packages</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#ch13-advanced-security-securing-frontend-__codelineno-21-2"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>epel-release
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#ch13-advanced-security-securing-frontend-__codelineno-21-3"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>certbot<span class="w"> </span>python3-certbot-nginx
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#ch13-advanced-security-securing-frontend-__codelineno-21-4"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>tar<span class="w"> </span>gzip<span class="w"> </span>openssl<span class="w"> </span>cronie
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#ch13-advanced-security-securing-frontend-__codelineno-21-5"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bind-utils<span class="w"> </span><span class="c1"># gives `dig`</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#ch13-advanced-security-securing-frontend-__codelineno-21-6"></a>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#ch13-advanced-security-securing-frontend-__codelineno-21-7"></a><span class="c1"># Install the acme script and add it to you path</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#ch13-advanced-security-securing-frontend-__codelineno-21-8"></a>curl<span class="w"> </span>https://get.acme.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#ch13-advanced-security-securing-frontend-__codelineno-21-9"></a><span class="nb">exec</span><span class="w"> </span>bash
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#ch13-advanced-security-securing-frontend-__codelineno-21-10"></a>acme.sh<span class="w"> </span>--version
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#ch13-advanced-security-securing-frontend-__codelineno-21-11"></a>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#ch13-advanced-security-securing-frontend-__codelineno-21-12"></a><span class="c1"># Activate crond and setup the certificate.</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#ch13-advanced-security-securing-frontend-__codelineno-21-13"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>crond
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#ch13-advanced-security-securing-frontend-__codelineno-21-14"></a>acme.sh<span class="w"> </span>--set-default-ca<span class="w"> </span>--server<span class="w"> </span>letsencrypt
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#ch13-advanced-security-securing-frontend-__codelineno-21-15"></a>acme.sh<span class="w"> </span>--issue<span class="w"> </span>-d<span class="w"> </span>&lt;mydomain.com&gt;<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;*.&lt;mydomain.com&gt;&#39;</span><span class="w"> </span>--dns<span class="w"> </span>--yes-I-know-dns-manual-mode-enough-go-ahead-please
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#ch13-advanced-security-securing-frontend-__codelineno-21-16"></a>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#ch13-advanced-security-securing-frontend-__codelineno-21-17"></a><span class="c1"># The script had provided you with 2 TXT records add them to your domain and</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#ch13-advanced-security-securing-frontend-__codelineno-21-18"></a><span class="c1"># check if they are properly configured. It can take a few minutes before other</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#ch13-advanced-security-securing-frontend-__codelineno-21-19"></a><span class="c1"># DNS servers pickup the config change.</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#ch13-advanced-security-securing-frontend-__codelineno-21-20"></a>dig<span class="w"> </span>+short<span class="w"> </span>TXT<span class="w"> </span>_acme-challenge.&lt;mydomain.com&gt;<span class="w"> </span>@8.8.8.8
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#ch13-advanced-security-securing-frontend-__codelineno-21-21"></a>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#ch13-advanced-security-securing-frontend-__codelineno-21-22"></a><span class="c1"># Try to renew the certificate and copy it to your webserver</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#ch13-advanced-security-securing-frontend-__codelineno-21-23"></a>acme.sh<span class="w"> </span>--renew<span class="w"> </span>-d<span class="w"> </span>&lt;mydomain.com&gt;<span class="w"> </span>--ecc<span class="w"> </span>--dns<span class="w"> </span>--yes-I-know-dns-manual-mode-enough-go-ahead-please
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#ch13-advanced-security-securing-frontend-__codelineno-21-24"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/ssl/&lt;mydomain&gt;
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#ch13-advanced-security-securing-frontend-__codelineno-21-25"></a>acme.sh<span class="w"> </span>--install-cert<span class="w"> </span>-d<span class="w"> </span>&lt;mydomain.com&gt;<span class="w"> </span>--ecc<span class="w"> </span>--key-file<span class="w"> </span>/etc/ssl/&lt;mydomain&gt;/site.key<span class="w"> </span>--fullchain-file<span class="w"> </span>/etc/ssl/&lt;mydomain&gt;/site.fullchain.pem<span class="w">  </span>--reloadcmd
</span></code></pre></div>
<p>Next step is to alter your NGINX config and open the firewall on port 443</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch13-advanced-security-securing-frontend-__codelineno-22-1"></a><span class="c1"># Configure the firewall</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#ch13-advanced-security-securing-frontend-__codelineno-22-2"></a>firewall-cmd<span class="w"> </span>--add-service<span class="o">=</span>https<span class="w"> </span>--permanent
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#ch13-advanced-security-securing-frontend-__codelineno-22-3"></a>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ch13-advanced-security-securing-frontend-__codelineno-23-1"></a><span class="c1"># Add to your hosts file the domain zabbix.&lt;mydomain.com&gt;</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#ch13-advanced-security-securing-frontend-__codelineno-23-2"></a>vi<span class="w"> </span>/etc/hosts
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ch13-advanced-security-securing-frontend-__codelineno-24-1"></a><span class="c1"># Alter your NGINX config</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#ch13-advanced-security-securing-frontend-__codelineno-24-2"></a>vi<span class="w"> </span>/etc/nginx/conf.d/zabbix.conf
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#ch13-advanced-security-securing-frontend-__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#ch13-advanced-security-securing-frontend-__codelineno-24-4"></a>server<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#ch13-advanced-security-securing-frontend-__codelineno-24-5"></a><span class="w">        </span>listen<span class="w">          </span><span class="m">443</span><span class="w"> </span>ssl<span class="p">;</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#ch13-advanced-security-securing-frontend-__codelineno-24-6"></a><span class="w">        </span>server_name<span class="w">     </span>zabbix.mydoamin.com<span class="p">;</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#ch13-advanced-security-securing-frontend-__codelineno-24-7"></a><span class="w">        </span>ssl_certificate<span class="w">     </span>/etc/ssl/mydomain/site.fullchain.pem<span class="p">;</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#ch13-advanced-security-securing-frontend-__codelineno-24-8"></a><span class="w">        </span>ssl_certificate_key<span class="w"> </span>/etc/ssl/mydomain/site.key<span class="p">;</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#ch13-advanced-security-securing-frontend-__codelineno-24-9"></a><span class="w">        </span>ssl_protocols<span class="w">       </span>TLSv1.2<span class="w"> </span>TLSv1.3<span class="p">;</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#ch13-advanced-security-securing-frontend-__codelineno-24-10"></a><span class="w">        </span>ssl_ciphers<span class="w">         </span>HIGH:!aNULL:!MD5<span class="p">;</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ch13-advanced-security-securing-frontend-__codelineno-25-1"></a><span class="c1"># Add a forward from port 80 to 443</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#ch13-advanced-security-securing-frontend-__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#ch13-advanced-security-securing-frontend-__codelineno-25-3"></a>vi<span class="w"> </span>/etc/nginx/conf.d/no-ssl-zabbix.conf
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#ch13-advanced-security-securing-frontend-__codelineno-25-4"></a>server<span class="o">{</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#ch13-advanced-security-securing-frontend-__codelineno-25-5"></a><span class="w">    </span>listen<span class="w">  </span><span class="m">80</span><span class="p">;</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#ch13-advanced-security-securing-frontend-__codelineno-25-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">301</span><span class="w"> </span>https://<span class="nv">$host$request_uri</span>?<span class="p">;</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#ch13-advanced-security-securing-frontend-__codelineno-25-7"></a><span class="o">}</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ch13-advanced-security-securing-frontend-__codelineno-26-1"></a><span class="c1"># restart the NGINX webserver</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#ch13-advanced-security-securing-frontend-__codelineno-26-2"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx
</span></code></pre></div>
<p>You can now browse to the url zabbix.mydomain.com and you should have a working
certificate.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>You should probably add a bit more security to your webserver this is only
the bare minimum to make ssl working, A good place to start is probably
https://cipherlist.eu/</p>
</details>
<h2 id="ch13-advanced-security-securing-frontend-securing-the-frontend-with-lets-encrypt-on-nginx_1">Securing the Frontend with Let's Encrypt on Nginx</h2></section><section class="print-page" id="ch13-advanced-security-agent-security" heading-number="18.4"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="securing-the-zabbix-agent-with-encryption">Securing the Zabbix agent with encryption</h1>
<p>In chapter 4 we have learned how to set up our Zabbix agent in both the active and the passive mode. In an internal network, this might be all you need to do for your monitoring of Linux, Unix and Windows systems. But what if you need to monitor a Zabbix agent host over the internet or what if you'd just like to add an additional layer of security. This is where Zabbix agent encryption comes in. </p>
<p>There are two basic methods to encrypt your Zabbix agent and they apply to both passive and active agents.
- Pre-shared keys
- Certificates</p>
<p>Both provide a secure method of encrypting the communication between your Zabbix agent and Zabbix server or proxy. So let's dive into both of them.</p>
<h2 id="ch13-advanced-security-agent-security-pre-shared-keys">Pre-shared keys</h2>
<p>Whenever you start working with Zabbix agent encryption, pre-shared keys are the easiest method to provide an additional layer of security on your internal networks or encrypt internet connected agents. They are easy to understand and do not require maintenance, as they are a set and forget kind of encryption method.</p>
<p>The basis is simple, Zabbix agent uses a pre-shared key (PSK) identity and a PSK string. We set these up both on the Zabbix agent and Zabbix server side to encrypt the communication between them. If you are using Zabbix proxies, the Zabbix server will make sure the proxies know about the pre-shared keys (do not forget to encrypt proxy communication).</p>
<ul>
<li><em>PSK identity</em>: A non-secret UTF-8 string. </li>
<li><em>PSK string</em>: A secret between 128 bit (16 Bytes, 32 character hexadecimal) and 2048 bit (256 Bytes, 512 character hexadecimal) string.</li>
</ul>
<details class="important note" open="open">
<summary>Important</summary>
<p>The combination of the PSK identity and PSK string has to be unique. There can not be two PSKs with the same identity string but different values.
We have to keep this in mind when setting up the PSK identity and I usually use something that cannot be duplicate like the hostname of the host we're encrypting.</p>
</details>
<p>Let's login to the CLI of a host with the Zabbix agent installed. We are going to edit the Zabbix agent 2 configuration file to allow for PSK encryption.</p>
<div class="admonition info">
<p class="admonition-title">Edit Zabbix agent 2 configuration file</p>
<p>Linux CLI
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch13-advanced-security-agent-security-__codelineno-0-1"></a>vim<span class="w"> </span>/etc/zabbix/zabbix_agent2.conf
</span></code></pre></div></p>
</div>
<p>In the configuration file there are 4 parameters we need to edit. By default they aren't set, but we will set them as specified below.</p>
<div class="admonition info">
<p class="admonition-title">Zabbix agent 2 configuration file encryption parameters</p>
<p>Linux CLI
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch13-advanced-security-agent-security-__codelineno-1-1"></a><span class="nv">TLSConnect</span><span class="o">=</span>psk
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch13-advanced-security-agent-security-__codelineno-1-2"></a><span class="nv">TLSAccept</span><span class="o">=</span>psk
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch13-advanced-security-agent-security-__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch13-advanced-security-agent-security-__codelineno-1-4"></a><span class="nv">TLSPSKIdentity</span><span class="o">=</span>zbx-agent-active-rocky
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ch13-advanced-security-agent-security-__codelineno-1-5"></a><span class="nv">TLSPSKFile</span><span class="o">=</span>/etc/zabbix/agent.psk
</span></code></pre></div></p>
</div>
<p>I've used <code>zbx-agent-active-rocky</code> as the identity, as that is the hostname on my server and I will use unique PSK keys for each host. If you want to use a default identity/key pair you could use something like <code>agent-default-key</code> as the identity and use the same key on each host (less secure). </p>
<ul>
<li><em>TLSConnect</em>: This parameter makes sure that when the Zabbix agent connects in active mode it will either use <code>unencrypted</code>, <code>psk</code>, or <code>cert</code> to connect.</li>
<li><em>TLSAccept</em>: This parameter makes sure that when the Zabbix agent is connected to in passive mode it will either use <code>unencrypted</code>, <code>psk</code>, or <code>cert</code> to allow the connection.</li>
<li><em>TLSPSKIdentity</em>: The plain text non-secret identity used for PSK encryption.</li>
<li><em>TLSPSKFile</em>: The path to the file where the secret PSK is stored.</li>
</ul>
<p>As you might have noticed, I have set both <code>TLSConnect</code> and <code>TLSAccept</code>. This is something recommended to always do to safeguard against configuration mistakes. Let's say you only use the Active Zabbix agent connection, but left <code>TLSConnect</code> set to <code>unencrypted</code>. If your Zabbix agent allows passive agent connections (due to configuration error, history or on purpose) an unencrypted connection will still be allowed. Recommendation, set both alway unless you have a good reason not to.</p>
<p>We're not done with the configuration on the Zabbix agent side however, we still need to create the PSK. There is a simple command to execute and create the PSK.</p>
<div class="admonition info">
<p class="admonition-title">Create agent.psk file with new pre-shared key</p>
<p>Linux CLI
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch13-advanced-security-agent-security-__codelineno-2-1"></a>openssl<span class="w"> </span>rand<span class="w"> </span>-hex<span class="w"> </span><span class="m">128</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/zabbix/agent.psk<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
</span></code></pre></div></p>
</div>
<p>This will not only create the 128 Bytes (1024 bit and 256 Hex characters) PSK, it will also add it to the file we specified in the Zabbix agent configuration file under <code>TLSPSKFile=/etc/zabbix/agent.psk</code>. We can check to see what the PSK looks like.</p>
<div class="admonition info">
<p class="admonition-title">Show agent.psk file with new pre-shared key</p>
<p>Linux CLI
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch13-advanced-security-agent-security-__codelineno-3-1"></a>cat<span class="w"> </span>/etc/zabbix/agent.psk
</span></code></pre></div></p>
</div>
<p>We get a string the looks like this:</p>
<div class="admonition info">
<p class="admonition-title">agent.psk file contents</p>
<p>Linux CLI
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch13-advanced-security-agent-security-__codelineno-4-1"></a>b1b3b66f2cff98285f3e0ee495bf44660dd6620be2f972207315e45ab030637ae0aa6f18033e86a0ea3a7fca600f793246ced7003351be13342a831ac860f74498153237d3528357a0fea9b0266d34ba18afe086187d6e1e00c6ff4d78433e4dd7e695099c3664903716a0e3a5bf017efc1354ce779715cff274b79ff5aab1d9
</span></code></pre></div></p>
</div>
<p>Do not use the above PSK as it is now of course compromised (everyone reading the book has it). But it shows you what it would look like and we can now copy it for later use in the Zabbix frontend, as well as store it in a password vault perhaps.</p>
<p>Before we go on to the Zabbix frontend however, let's make sure the file where we stored the PSK in is secure.</p>
<div class="admonition info">
<p class="admonition-title">agent.psk file security settings</p>
<p>Linux CLI
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch13-advanced-security-agent-security-__codelineno-5-1"></a>sudo<span class="w"> </span>chown<span class="w"> </span>zabbix:zabbix<span class="w"> </span>/etc/zabbix/agent.psk
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch13-advanced-security-agent-security-__codelineno-5-2"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">400</span><span class="w"> </span>/etc/zabbix/agent.psk
</span></code></pre></div></p>
</div>
<p>This will make sure only the zabbix user on your Linux system has read only access. Now let's move on to the Zabbix frontend and find our <code>zbx-agent-active-rocky</code> host under <code>Data collection</code> | <code>Hosts</code>.</p>
<p>Open you host configuration and go to the <code>Encryption</code> tab. By default it will be set to not use encryption.</p>
<p><img align="center" alt="Unencrypted agent" src="../ch13-advanced-security/securing-agent/ch13.xx-frontend-agent-host-no-encryption.png" />
<em>13.xx Unencrypted agent settings</em></p>
<p>Let's fill our the details here, just as we did on the Zabbix agent host side.</p>
<p><img align="center" alt="Encrypted agent" src="../ch13-advanced-security/securing-agent/ch13.xx-frontend-agent-host-encryption.png" /></p>
<p><em>13.xx Encrypted agent settings</em></p>
<p>As you can see, even though this is an Active Zabbix agent, I set up encryption requirements for both. Click on the <code>Update</code> button to save these changes and go back to the Zabbix agent host CLI to restart the agent.</p>
<div class="admonition info">
<p class="admonition-title">Restart to make encryption settings take effect.</p>
<p>Linux CLI
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch13-advanced-security-agent-security-__codelineno-6-1"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>zabbix-agent2
</span></code></pre></div></p>
</div>
<p>Your agent icon should remain green and you should now see that the agent is encrypted.</p>
<p><img align="center" alt="Encrypted agent status" src="../ch13-advanced-security/securing-agent/ch13.xx-frontend-agent-host-encryption-status.png" /></p>
<p><em>13.xx Encrypted agent status</em></p>
<h3 id="ch13-advanced-security-agent-security-active-agent-autoregistration">Active agent autoregistration</h3>
<p>Another thing you might want to do is encrypt all of the Zabbix agents in active mode that are being registered into Zabbix automatically. This process called autoregistration was discussed in detail in chapter 10. What we did not cover however is how to encrypt this process.</p>
<p>When you navigate to <code>Administration</code> | <code>General</code> | <code>Autoregistration</code> there are not many options available. As you can see we are using <code>No encryption</code> by default. </p>
<p><img align="center" alt="Autoregistration without encryption" src="../ch13-advanced-security/securing-agent/ch13.xx-autoregistration-no-encryption.png" />
<em>13.xx Autoregistration without encryption</em></p>
<p>We can only change this <code>PSK</code> to encrypt all of the autoregistered Zabbix agents. There is no certificate option for autoregistration. But, we can now do the following setup.</p>
<p><img align="center" alt="Autoregistration with encryption" src="../ch13-advanced-security/securing-agent/ch13.xx-autoregistration-encryption.png" />
<em>13.xx Autoregistration with encryption</em></p>
<p>This will allow us to define our PSK identity and PSK value on the agents configured for autoregistration. </p>
<div class="admonition info">
<p class="admonition-title">Zabbix agent 2 configuration file encryption parameters</p>
<p>Linux CLI
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch13-advanced-security-agent-security-__codelineno-7-1"></a><span class="nv">TLSConnect</span><span class="o">=</span>psk
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch13-advanced-security-agent-security-__codelineno-7-2"></a><span class="nv">TLSAccept</span><span class="o">=</span>psk
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch13-advanced-security-agent-security-__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#ch13-advanced-security-agent-security-__codelineno-7-4"></a><span class="nv">TLSPSKIdentity</span><span class="o">=</span>agent-default-key
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#ch13-advanced-security-agent-security-__codelineno-7-5"></a><span class="nv">TLSPSKFile</span><span class="o">=</span>/etc/zabbix/agent.psk
</span></code></pre></div></p>
</div>
<p>Keep in mind that <code>/etc/zabbix/agent.psk</code> should contain the same PSK value on every single agent we configure for autoregistration. We cannot use different keys, as the identity/value pair has to be unique. </p>
<p>This means that we do not have a unique PSK per Zabbix agent, decreasing our security. If one agent has its PSK compromised, you have to consider all agents compromised. There are a few options to work with this however.</p>
<ul>
<li>Make sure you automate the Zabbix agent installation process. Quickly allowing you to rotate PSK keys when necessary.</li>
<li>Do not share you PSK with possible customers you are monitoring. Use manually configured unique PSK values for them.</li>
<li>If you want, you can use autoregistration with PSK for the initial agent registration. Manually changed the PSK later or just for important infrastructure.</li>
</ul>
<h2 id="ch13-advanced-security-agent-security-certificates">Certificates</h2>
<p>Pre-shared keys are simple and they work well to encrypt your agents fast and effectively. They do have a fundamental flaw however, once it is known we can easily impersonate it. Identity theft is not a joke and for that reason we are going to issues certificates to counter that issue. </p>
<p>Keep in mind, you can also use public certificates. But to keep things executable from the book we are going to use self-signed certificates here. Choose whichever you prefer.</p>
<h3 id="ch13-advanced-security-agent-security-certificate-authority-generation">Certificate Authority generation</h3>
<p>First, let's create the certificate authority (CA). </p>
<p>!!! info ‚ÄúCreate CA private key‚Äù
    Linux CLI
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch13-advanced-security-agent-security-__codelineno-8-1"></a>openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>the-zabbix-book-ca.key<span class="w"> </span><span class="m">4096</span>
</span></code></pre></div></p>
<p>Next, we create a self-signed CA certificate. This certificate will be trusted by all Zabbix components.</p>
<p>!!! info ‚ÄúCreate CA certificate‚Äù
    Linux CLI
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch13-advanced-security-agent-security-__codelineno-9-1"></a>openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span>-new<span class="w"> </span>-nodes<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ch13-advanced-security-agent-security-__codelineno-9-2"></a>-key<span class="w"> </span>the-zabbix-book-ca.key<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#ch13-advanced-security-agent-security-__codelineno-9-3"></a>-sha256<span class="w"> </span>-days<span class="w"> </span><span class="m">3650</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#ch13-advanced-security-agent-security-__codelineno-9-4"></a>-out<span class="w"> </span>the-zabbix-book-ca.crt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#ch13-advanced-security-agent-security-__codelineno-9-5"></a>-subj<span class="w"> </span><span class="s2">&quot;/CN=The Zabbix Book Issuing CA/O=The Zabbix Book/OU=Monitoring&quot;</span>
</span></code></pre></div></p>
<ul>
<li>3650 days gives us a 10-year CA lifetime</li>
<li>Anyone with the key file can sign valid Zabbix certificates, so keep it secret.</li>
<li>As you can see we used <code>The Zabbix Book</code> in our CN/CA. Treat this as <code>Your Company Name here</code>. </li>
</ul>
<p>Executing these commands should give us 2 files.</p>
<ul>
<li><em>the-zabbix-book-ca.key</em>: keep secret</li>
<li><em>the-zabbix-book-ca.crt</em>: distribute to all Zabbix components</li>
</ul>
<p>Let's move these files to the home folder on the server.</p>
<p>!!! info ‚ÄúMove the CA files‚Äù
    Linux CLI
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch13-advanced-security-agent-security-__codelineno-10-1"></a>mv<span class="w"> </span>the-zabbix-book-ca.key<span class="w"> </span>/home/zabbix/the-zabbix-book-ca.key
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch13-advanced-security-agent-security-__codelineno-10-2"></a>mv<span class="w"> </span>the-zabbix-book-ca.crt<span class="w"> </span>/home/zabbix/the-zabbix-book-ca.crt
</span></code></pre></div></p>
<p>Then we make sure they are secured.</p>
<p>!!! info ‚ÄúSecure CA private key‚Äù
    Linux CLI
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch13-advanced-security-agent-security-__codelineno-11-1"></a>sudo<span class="w"> </span>chown<span class="w"> </span>zabbix:zabbix<span class="w"> </span>/home/zabbix/the-zabbix-book-ca.key<span class="w"> </span>/home/zabbix/the-zabbix-book-ca.crt
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ch13-advanced-security-agent-security-__codelineno-11-2"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">400</span><span class="w"> </span>/home/zabbix/the-zabbix-book-ca.key
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#ch13-advanced-security-agent-security-__codelineno-11-3"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">444</span><span class="w"> </span>/home/zabbix/the-zabbix-book-ca.crt
</span></code></pre></div></p>
<p>Since anyone with the key file can sign valid Zabbix certificates it is recommended to do these steps on a secure server where you will distribute the certificates from</p>
<h3 id="ch13-advanced-security-agent-security-certificate-generation">Certificate generation</h3>
<p>Next up, we are going to generate the certificate for the Zabbix agent to use. Here it is also recommended to use a unique certificate for each Zabbix agent you'd like to encrypt.</p>
<p>We will need the CA key we issues earlier in this step. Let's first generate the key.</p>
<p>!!! info ‚ÄúCreate agent private key‚Äù
    Linux CLI
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch13-advanced-security-agent-security-__codelineno-12-1"></a>openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>zabbix_agent.key<span class="w"> </span><span class="m">2048</span>
</span></code></pre></div></p>
<p>Then we create the certificate signing request (CSR).</p>
<p>!!! info ‚ÄúCreate Zabbix agent CSR‚Äù
    Linux CLI
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch13-advanced-security-agent-security-__codelineno-13-1"></a>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#ch13-advanced-security-agent-security-__codelineno-13-2"></a>-key<span class="w"> </span>zabbix_agent.key<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#ch13-advanced-security-agent-security-__codelineno-13-3"></a>-out<span class="w"> </span>zabbix_agent.csr<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#ch13-advanced-security-agent-security-__codelineno-13-4"></a>-subj<span class="w"> </span><span class="s2">&quot;/CN=www01/OU=Servers/O=The Zabbix Book&quot;</span>
</span></code></pre></div></p>
<p>Lastly, we sign the CSR with the CA. This is what makes it a ‚Äúreal‚Äù certificate in our environment.</p>
<p>!!! info ‚ÄúSign agent certificate with CA‚Äù
Linux CLI
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch13-advanced-security-agent-security-__codelineno-14-1"></a>openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch13-advanced-security-agent-security-__codelineno-14-2"></a>-in<span class="w"> </span>zabbix_agent.csr<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#ch13-advanced-security-agent-security-__codelineno-14-3"></a>-CA<span class="w"> </span>the-zabbix-book-ca.crt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#ch13-advanced-security-agent-security-__codelineno-14-4"></a>-CAkey<span class="w"> </span>the-zabbix-book-ca.key<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#ch13-advanced-security-agent-security-__codelineno-14-5"></a>-CAcreateserial<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#ch13-advanced-security-agent-security-__codelineno-14-6"></a>-out<span class="w"> </span>zabbix_agent.crt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#ch13-advanced-security-agent-security-__codelineno-14-7"></a>-days<span class="w"> </span><span class="m">825</span><span class="w"> </span>-sha256
</span></code></pre></div></p>
<p>We now have our Zabbix agent certificate and private key:
    ‚Ä¢   <em>zabbix_agent.key</em>: Keep secret on the agent
    ‚Ä¢   <em>zabbix_agent.crt</em>: Public certificate for the agent
    ‚Ä¢   <em>the-zabbix-book-ca.crt</em>: CA certificate the agent uses to trust the Zabbix server/proxy</p>
<p>The CSR is no longer needed after signing.</p>
<p>!!! info ‚ÄúRemove CSR file‚Äù
    Linux CLI
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch13-advanced-security-agent-security-__codelineno-15-1"></a>rm<span class="w"> </span>-f<span class="w"> </span>zabbix_agent.csr
</span></code></pre></div></p>
<p>Let's move these files to a folder where we can use them from the Zabbix agent.</p>
<p>!!! info ‚ÄúMove the CA files‚Äù
    Linux CLI
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch13-advanced-security-agent-security-__codelineno-16-1"></a>mv<span class="w"> </span>zabbix_agent.key<span class="w"> </span>/home/zabbix/the-zabbix-book-ca.key
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#ch13-advanced-security-agent-security-__codelineno-16-2"></a>mv<span class="w"> </span>zabbix_agent.crt<span class="w"> </span>/home/zabbix/the-zabbix-book-ca.crt
</span></code></pre></div></p>
<p>Of course it will also be important to secure the files.</p>
<p>!!! info ‚ÄúMove the CA files‚Äù
    Linux CLI
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch13-advanced-security-agent-security-__codelineno-17-1"></a>sudo<span class="w"> </span>chown<span class="w"> </span>zabbix:zabbix<span class="w"> </span>/home/zabbix/zabbix_agent.key<span class="w"> </span>/home/zabbix/zabbix_agent.crt
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#ch13-advanced-security-agent-security-__codelineno-17-2"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">400</span><span class="w"> </span>/home/zabbix/zabbix_agent.key
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#ch13-advanced-security-agent-security-__codelineno-17-3"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">444</span><span class="w"> </span>/home/zabbix/zabbix_agent.crt
</span></code></pre></div></p>
<h3 id="ch13-advanced-security-agent-security-setting-up-the-agent-configuration">Setting up the agent configuration</h3>
<p>Lastly, it will be important to set up the Zabbix agent for the certificate to be used by it. Let's edit the Zabbix agent configuration file and add the following parameters.</p>
<p>!!! info ‚ÄúMove the CA files‚Äù
    Linux CLI
    <div class="language-ini highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch13-advanced-security-agent-security-__codelineno-18-1"></a><span class="na">TLSConnect</span><span class="o">=</span><span class="s">cert</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ch13-advanced-security-agent-security-__codelineno-18-2"></a><span class="na">TLSAccept</span><span class="o">=</span><span class="s">cert</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ch13-advanced-security-agent-security-__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ch13-advanced-security-agent-security-__codelineno-18-4"></a><span class="na">TLSCAFile</span><span class="o">=</span><span class="s">/home/zabbix/the-zabbix-book-ca.crt</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#ch13-advanced-security-agent-security-__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#ch13-advanced-security-agent-security-__codelineno-18-6"></a><span class="na">TLSCertFile</span><span class="o">=</span><span class="s">/home/zabbix/pki/zabbix_agent.crt</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#ch13-advanced-security-agent-security-__codelineno-18-7"></a><span class="na">TLSKeyFile</span><span class="o">=</span><span class="s">/home/zabbix/pki/zabbix_agent.key</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#ch13-advanced-security-agent-security-__codelineno-18-8"></a>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#ch13-advanced-security-agent-security-__codelineno-18-9"></a><span class="na">TLSServerCertIssuer</span><span class="o">=</span><span class="s">CN=The Zabbix Book Issuing CA,O=The Zabbix Book,OU=Monitoring</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#ch13-advanced-security-agent-security-__codelineno-18-10"></a><span class="na">TLSServerCertSubject</span><span class="o">=</span><span class="s">CN=zabbix-server,OU=Monitoring,O=The Zabbix Book</span>
</span></code></pre></div></p>
<p>!!! info ‚ÄúRestart to make certificate encryption take effect‚Äù
    Linux CLI
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch13-advanced-security-agent-security-__codelineno-19-1"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>zabbix-agent2
</span></code></pre></div></p>
<p>Moving to the Zabbix frontend, all that's left to do is edit our host configuration under <code>Data collection</code> | <code>Hosts</code> and add the following information under <code>Encryption</code>.</p>
<p><img align="center" alt="Encrypted agent certificate" src="../ch13-advanced-security/securing-agent/ch13.xx-agent-certificate-encryption.png" /></p>
<p><em>13.xx Encrypted agent settings certificate</em></p>
<h2 id="ch13-advanced-security-agent-security-conclusion">Conclusion</h2>
<p>If you want simple to set up security for your Zabbix agent, use pre-shared keys. They are secure, especially when using 2048-bit (512 hexadecimal digits) and if possible unique pre-shared keys for each agent.</p>
<p>If you want some more layers of security, certificates do provide more security in the way they work alone. With certificate expiry, we are forced to set up good certificate management software to make managing the many certificates doable. Furthermore, certificates provide impersonation resistance by allowing us to restrict issuer/subject.</p>
<p>If you are using active agent autoregistration pre-shared keys seems like your only viable option out of the box. We are forced to use a single pre=shared key for this method, and as such it is less secure. This can still be a good option to provide that additional layer of security on internal networks. </p>
<h2 id="ch13-advanced-security-agent-security-questions">Questions</h2>
<h2 id="ch13-advanced-security-agent-security-useful-urls">Useful URLs</h2></section><section class="print-page" id="ch13-advanced-security-using-vault" heading-number="18.5"><h1 id="ch13-advanced-security-using-vault-storing-secrets">Storing secrets</h1></section><section class="print-page" id="ch13-advanced-security-partitioning-database" heading-number="18.6"><h1 id="ch13-advanced-security-partitioning-database-partitioning-a-zabbix-mariadb-mysql-database-with-perl">Partitioning a Zabbix MariaDB (MySQL) database with Perl</h1>
<p>As your Zabbix environment grows, you'll eventually notice that the built-in housekeeper
struggles to keep up. This happens because the Zabbix housekeeper works by scanning
the database for each history or trend entry that exceeds its configured retention
period and deletes them row by row. While this works for smaller setups, as the
database grows your housekeeper process will reach a limit as to what it can delete
in time.</p>
<p>You can usually see this issue happening when the housekeeper process runs at 100%
continuously and the database keeps growing larger. This indicated that the cleanup
can't keep pace with incoming data.</p>
<p>PostgreSQL users can use the native TimescaleDB plugin in Zabbix, which handles
historical data retention more efficiently. <code>MariaDB</code> (or MySQL) doesn't have a
similar built-in option.</p>
<p>This is where <code>MariaDB</code> partitioning comes in.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>It's recommended to do partitioning right after setting up your Zabbix database.
This process is a lot easier on a clean database, than it is on a database
that is already is use.</p>
</details>
<h2 id="ch13-advanced-security-partitioning-database-preparing-the-database">Preparing the database</h2>
<p>To begin implementing <code>MariaDB</code> partitioning, you'll need access with super privileges
to your Zabbix database server. Before starting however, if you are going to partition
an existing zabbix database make sure to create a backup of your database. We can
do this in various ways and with various tools, but the built-in <code>mariadb-dump</code> tool
will work perfectly fine.</p>
<p><a href="https://mariadb.com/kb/en/mariadb-dump/">https://mariadb.com/kb/en/mariadb-dump/</a></p>
<p><a href="https://mariadb.com/kb/en/mariadb-import/">https://mariadb.com/kb/en/mariadb-import/</a></p>
<p><code>Make sure to export your database backup to a different server (or disk at least).</code></p>
<p>Keep in mind, data corruption can happen when performing large scale changes on
your DB and as such also with partitioning.</p>
<p>To prevent MariaDB running out of space, also make sure to have a generous amount
of free space on your system. Running partitioning when you have no free space left
can lead to a corrupted database data. Check your free space with:</p>
<div class="admonition info">
<p class="admonition-title">Check disk space availability</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch13-advanced-security-partitioning-database-__codelineno-0-1"></a>df -h
</span></code></pre></div>
</div>
<h2 id="ch13-advanced-security-partitioning-database-preparing-the-partitioning">Preparing the partitioning</h2>
<p>For existing Zabbix databases, partitioning can be a very time-consuming process.
It all depends on the size of the database and the resources available to MariaDB-Server.</p>
<p>This is why I always run partitioning in a <code>tmux</code> session. If <code>tmux</code> hasn't been
installed onto your database server yet, do that now.</p>
<div class="admonition info">
<p class="admonition-title">Check disk space availability</p>
<p>Red Hat-based
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch13-advanced-security-partitioning-database-__codelineno-1-1"></a>dnf install tmux
</span></code></pre></div>
Debian-based
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch13-advanced-security-partitioning-database-__codelineno-2-1"></a>apt install tmux
</span></code></pre></div></p>
</div>
<p>Now we can issue the tmux command to open a new tmux session:</p>
<div class="admonition info">
<p class="admonition-title">Open tmux session</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch13-advanced-security-partitioning-database-__codelineno-3-1"></a>tmux
</span></code></pre></div>
</div>
<p>This opens up an terminal session that will remain active even if our SSH session
times out.</p>
<p>Now, let's open up a notepad and prepare our partitions. We‚Äôll be partitioning
the following tables:</p>
<table>
<thead>
<tr>
<th>Table name</th>
<th>Purpose</th>
<th>Data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>history</td>
<td>Stores numeric floating point values</td>
<td></td>
</tr>
<tr>
<td>history_uint</td>
<td>Stores numeric unsigned values</td>
<td></td>
</tr>
<tr>
<td>history_str</td>
<td>Stores text values up to 255 characters</td>
<td></td>
</tr>
<tr>
<td>history_text</td>
<td>Stores text values values up to 64kB</td>
<td></td>
</tr>
<tr>
<td>history_log</td>
<td>Stores text values up to 64kB with additional log related properties like timestamp</td>
<td></td>
</tr>
<tr>
<td>history_bin</td>
<td>Stores binary image data</td>
<td></td>
</tr>
<tr>
<td>trends</td>
<td>Stores the min/avg/max/count trends of numeric floating point data</td>
<td></td>
</tr>
<tr>
<td>trends_uint</td>
<td>Stores the min/avg/max/count trends of numeric unsigned data</td>
<td></td>
</tr>
</tbody>
</table>
<p>We first will have first have to determine how long we want to store the information
per table. MariaDB partitioning will take over the history and trend storage periods
as usually configured in the Zabbix frontend. We will configure these retention
periods later in the perl script.</p>
<p>Let's say I want to store my history tables for <code>31 days</code> and my trend data for
<code>15 months</code>. This allows me to troubleshoot in depth for a month and also audit
my data for little over a year.</p>
<p>Now this is where I open up a notepad and prepare my partitioning commands. Our
history tables will be partitioned by day and our trends tables will be
partitioned by month.</p>
<p>So, let‚Äôs start with our history_uint table:</p>
<div class="admonition info">
<p class="admonition-title">Prepare history partitioning (assuming today is May 10th 2025)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch13-advanced-security-partitioning-database-__codelineno-4-1"></a>ALTER TABLE history_uint PARTITION BY RANGE ( clock)
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch13-advanced-security-partitioning-database-__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch13-advanced-security-partitioning-database-__codelineno-4-3"></a>(PARTITION p2025_03_26 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-03-27 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch13-advanced-security-partitioning-database-__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ch13-advanced-security-partitioning-database-__codelineno-4-5"></a>PARTITION p2025_03_27 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-03-28 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ch13-advanced-security-partitioning-database-__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ch13-advanced-security-partitioning-database-__codelineno-4-7"></a>PARTITION p2025_03_28 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-03-29 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ch13-advanced-security-partitioning-database-__codelineno-4-8"></a>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ch13-advanced-security-partitioning-database-__codelineno-4-9"></a>PARTITION p2025_03_29 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-03-30 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#ch13-advanced-security-partitioning-database-__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#ch13-advanced-security-partitioning-database-__codelineno-4-11"></a>PARTITION p2025_03_30 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#ch13-advanced-security-partitioning-database-__codelineno-4-12"></a>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#ch13-advanced-security-partitioning-database-__codelineno-4-13"></a>PARTITION p2025_04_01 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-02 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#ch13-advanced-security-partitioning-database-__codelineno-4-14"></a>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#ch13-advanced-security-partitioning-database-__codelineno-4-15"></a>PARTITION p2025_04_02 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-03 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#ch13-advanced-security-partitioning-database-__codelineno-4-16"></a>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#ch13-advanced-security-partitioning-database-__codelineno-4-17"></a>PARTITION p2025_04_03 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-04 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#ch13-advanced-security-partitioning-database-__codelineno-4-18"></a>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#ch13-advanced-security-partitioning-database-__codelineno-4-19"></a>PARTITION p2025_04_04 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-05 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#ch13-advanced-security-partitioning-database-__codelineno-4-20"></a>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#ch13-advanced-security-partitioning-database-__codelineno-4-21"></a>PARTITION p2025_04_05 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-06 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#ch13-advanced-security-partitioning-database-__codelineno-4-22"></a>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#ch13-advanced-security-partitioning-database-__codelineno-4-23"></a>PARTITION p2025_04_06 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-07 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#ch13-advanced-security-partitioning-database-__codelineno-4-24"></a>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#ch13-advanced-security-partitioning-database-__codelineno-4-25"></a>PARTITION p2025_04_07 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-08 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#ch13-advanced-security-partitioning-database-__codelineno-4-26"></a>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#ch13-advanced-security-partitioning-database-__codelineno-4-27"></a>PARTITION p2025_04_08 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-09 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#ch13-advanced-security-partitioning-database-__codelineno-4-28"></a>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#ch13-advanced-security-partitioning-database-__codelineno-4-29"></a>PARTITION p2025_04_09 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-10 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#ch13-advanced-security-partitioning-database-__codelineno-4-30"></a>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#ch13-advanced-security-partitioning-database-__codelineno-4-31"></a>PARTITION p2025_04_10 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-11 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#ch13-advanced-security-partitioning-database-__codelineno-4-32"></a>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#ch13-advanced-security-partitioning-database-__codelineno-4-33"></a>PARTITION p2025_04_11 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-12 00:00:00&quot;)) ENGINE = InnoDB);
</span></code></pre></div>
</div>
<p>As you can see, I only created <code>16</code> partitions here. I could have created <code>31</code>,
which would have been better perhaps. <code>MariaDB</code> will now add all my older than 2025-03-26
data in that single partition. No problem, but it will take longer for my disk space to
free up this bigger partitioning, after which is will only keep 1 day worth of data
from that point.</p>
<p>I also created a partition in the future, just to have it. The script will handle
creating new partitions later for us.</p>
<ul>
<li>Creating less than 31 partitions: End up with 1 big partition until it is deleted</li>
<li>Creating exactly 31 partitions: End up with the ideal set-up immediately, but more
  to create.</li>
</ul>
<p>Now, create this <code>ALTER TABLE</code> commands with the partitions for all history tables.
We then do the same for the trends tables:</p>
<div class="admonition info">
<p class="admonition-title">Prepare trends partitioning (assuming today is May 10th 2025)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch13-advanced-security-partitioning-database-__codelineno-5-1"></a>ALTER TABLE trends_uint PARTITION BY RANGE ( clock)
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ch13-advanced-security-partitioning-database-__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ch13-advanced-security-partitioning-database-__codelineno-5-3"></a>(PARTITION p2024_12 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-01-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ch13-advanced-security-partitioning-database-__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ch13-advanced-security-partitioning-database-__codelineno-5-5"></a>PARTITION p2025_01 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-02-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#ch13-advanced-security-partitioning-database-__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#ch13-advanced-security-partitioning-database-__codelineno-5-7"></a>PARTITION p2025_02 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-03-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#ch13-advanced-security-partitioning-database-__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#ch13-advanced-security-partitioning-database-__codelineno-5-9"></a>PARTITION p2025_03 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#ch13-advanced-security-partitioning-database-__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#ch13-advanced-security-partitioning-database-__codelineno-5-11"></a>PARTITION p2025_04 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-05-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#ch13-advanced-security-partitioning-database-__codelineno-5-12"></a>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#ch13-advanced-security-partitioning-database-__codelineno-5-13"></a>PARTITION p2025_05 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-06-01 00:00:00&quot;)) ENGINE = InnoDB);
</span></code></pre></div>
</div>
<p>As you can see, here we are partitioning by month instead of by day. Once again,
I can create all partitions for 15 months, or less. That's up to us to decide.
Prepared this command for all trends tables.</p>
<p>Then it is time to login to MariaDB and start the partitioning. Please do not forget
to use the <code>tmux</code> command as we mentioned earlier.</p>
<div class="admonition info">
<p class="admonition-title">Login to MariaDB</p>
<p><code>mariadb -u root -p</code></p>
</div>
<p>Execute the history and trends partitioning commands you prepared in your notepad
one by one and make sure to wait for each to finish. As mentioned with large database,
be patient. With a clean Zabbix database, this process should be near instant.</p>
<h2 id="ch13-advanced-security-partitioning-database-setting-up-the-perl-script">Setting up the Perl script</h2>
<p>With the partitioning done, we still need to maintain the partitioned setup. MariaDB
will not create new and delete old partitions for us automatically, we need to
use a <code>perl</code> script for this. Years ago, an honorable Zabbix community member wrote
a <code>perl</code> script to maintain the partitioning and the people at <code>Opensource ICT Solutions</code>
have been maintaining it. You can find it on their GitHub repository:</p>
<p><a href="https://github.com/OpensourceICTSolutions/zabbix-mysql-partitioning-perl">https://github.com/OpensourceICTSolutions/zabbix-mysql-partitioning-perl</a></p>
<p>Download the script from their GitHub and save it on your Zabbix database server(s)
in the following folder:</p>
<div class="admonition info">
<p class="admonition-title">Script folder (create the folder if it doesn't exist)</p>
<p><code>/usr/lib/zabbix/</code></p>
</div>
<p>Then make the script executable, so we can create a cronjob later to execute it.</p>
<div class="admonition info">
<p class="admonition-title">Make the script executable</p>
<p><code>chmod 750 /usr/lib/zabbix/mysql_zbx_part.pl</code></p>
</div>
<p>Now, let's make sure all the settings in the script are set-up correctly. Edit the
script with your favourite editor (yes, nano is also an option).</p>
<div class="admonition info">
<p class="admonition-title">Edit the script</p>
<p><code>vim /usr/lib/zabbix/mysql_zbx_part.pl</code></p>
</div>
<p>There are a few lines here we need to edit to make sure the script works. Let's start
with our MariaDB login details.</p>
<div class="admonition info">
<p class="admonition-title">Add login details to the script</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch13-advanced-security-partitioning-database-__codelineno-6-1"></a>my $dsn = &#39;DBI:mysql:&#39;.$db_schema.&#39;:mysql_socket=/var/lib/mysql/mysql.sock&#39;;
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ch13-advanced-security-partitioning-database-__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ch13-advanced-security-partitioning-database-__codelineno-6-3"></a>my $db_user_name = &#39;zabbix&#39;;
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ch13-advanced-security-partitioning-database-__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ch13-advanced-security-partitioning-database-__codelineno-6-5"></a>my $db_password = &#39;password&#39;;
</span></code></pre></div>
</div>
<p>Make sure to modify the credentials and socket path to reflect your own Zabbix database
setup. The MariaDB username and password can, for instance, match those defined in
your Zabbix server configuration file. You can also create a different user for
this if preferred.</p>
<p>Also, keep in mind that the MariaDB socket file can vary depending on your distribution.
If the default path (/var/lib/mysql/mysql.sock) doesn't apply, update it accordingly.
For example, on Ubuntu systems, the socket is often located at /var/run/mysqld/mysql.sock.</p>
<p>Next up, we should edit the settings related to how long we want our data to be stored.
We define that in the following block.</p>
<div class="admonition info">
<p class="admonition-title">Add login details to the script</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch13-advanced-security-partitioning-database-__codelineno-7-1"></a>my $tables = {  &#39;history&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch13-advanced-security-partitioning-database-__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch13-advanced-security-partitioning-database-__codelineno-7-3"></a>                &#39;history_log&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#ch13-advanced-security-partitioning-database-__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#ch13-advanced-security-partitioning-database-__codelineno-7-5"></a>                &#39;history_str&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#ch13-advanced-security-partitioning-database-__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#ch13-advanced-security-partitioning-database-__codelineno-7-7"></a>                &#39;history_text&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#ch13-advanced-security-partitioning-database-__codelineno-7-8"></a>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#ch13-advanced-security-partitioning-database-__codelineno-7-9"></a>                &#39;history_uint&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#ch13-advanced-security-partitioning-database-__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#ch13-advanced-security-partitioning-database-__codelineno-7-11"></a>                &#39;history_bin&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#ch13-advanced-security-partitioning-database-__codelineno-7-12"></a>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#ch13-advanced-security-partitioning-database-__codelineno-7-13"></a>                &#39;trends&#39; =&gt; { &#39;period&#39; =&gt; &#39;month&#39;, &#39;keep_history&#39; =&gt; &#39;15&#39;},
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#ch13-advanced-security-partitioning-database-__codelineno-7-14"></a>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#ch13-advanced-security-partitioning-database-__codelineno-7-15"></a>                &#39;trends_uint&#39; =&gt; { &#39;period&#39; =&gt; &#39;month&#39;, &#39;keep_history&#39; =&gt; &#39;15&#39;},
</span></code></pre></div>
</div>
<p>Keep in mind that <code>history</code> is defined by day here and <code>trends</code> are defined by month.</p>
<p>We also need to change the timezone to match the timezone configured on our Zabbix
database server. As this was written in the the Netherlands, I will use <code>Europe/Amsterdam</code>.</p>
<div class="admonition info">
<p class="admonition-title">Add correct timezone</p>
<p><code>my $curr_tz = 'Europe/Amsterdam';</code></p>
</div>
<p>Then the last important step is to make sure that we comment or uncomment some lines
in the script. The script works for both <code>MariaDB</code> and <code>MySQL</code>, as well as for older
versions. It is however not smart enough to detect what to use automatically, but
feel free to open up that pull request!</p>
<p>The script is already out of the box configured for <code>MariaDB</code>, so we don't need
to do anything.</p>
<p>For the <code>MySQL 8.x</code> users comment the following <code>MariaDB</code> lines.</p>
<div class="admonition info">
<p class="admonition-title">Comment MariaDB</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch13-advanced-security-partitioning-database-__codelineno-8-1"></a># MySQL 5.6 + MariaDB
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ch13-advanced-security-partitioning-database-__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ch13-advanced-security-partitioning-database-__codelineno-8-3"></a>    #my $sth = $dbh-&gt;prepare(qq{SELECT plugin_status FROM information_schema.plugins
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#ch13-advanced-security-partitioning-database-__codelineno-8-4"></a>    WHERE plugin_name = &#39;partition&#39;});
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#ch13-advanced-security-partitioning-database-__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#ch13-advanced-security-partitioning-database-__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#ch13-advanced-security-partitioning-database-__codelineno-8-7"></a>    #$sth-&gt;execute();
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#ch13-advanced-security-partitioning-database-__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#ch13-advanced-security-partitioning-database-__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#ch13-advanced-security-partitioning-database-__codelineno-8-10"></a>    #my $row = $sth-&gt;fetchrow_array();
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#ch13-advanced-security-partitioning-database-__codelineno-8-11"></a>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#ch13-advanced-security-partitioning-database-__codelineno-8-12"></a>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#ch13-advanced-security-partitioning-database-__codelineno-8-13"></a>    #$sth-&gt;finish();
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#ch13-advanced-security-partitioning-database-__codelineno-8-14"></a>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#ch13-advanced-security-partitioning-database-__codelineno-8-15"></a>    #    return 1 if $row eq &#39;ACTIVE&#39;;
</span></code></pre></div>
</div>
<p>And uncomment the <code>MySQL 8.x</code> lines.</p>
<div class="admonition info">
<p class="admonition-title">Uncomment MySQL 8.x</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch13-advanced-security-partitioning-database-__codelineno-9-1"></a># MySQL 8.x (NOT MariaDB!)
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ch13-advanced-security-partitioning-database-__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#ch13-advanced-security-partitioning-database-__codelineno-9-3"></a>    my $sth = $dbh-&gt;prepare(qq{select version();});
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#ch13-advanced-security-partitioning-database-__codelineno-9-4"></a>    $sth-&gt;execute();
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#ch13-advanced-security-partitioning-database-__codelineno-9-5"></a>    my $row = $sth-&gt;fetchrow_array();
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#ch13-advanced-security-partitioning-database-__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#ch13-advanced-security-partitioning-database-__codelineno-9-7"></a>    $sth-&gt;finish();
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#ch13-advanced-security-partitioning-database-__codelineno-9-8"></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#ch13-advanced-security-partitioning-database-__codelineno-9-9"></a>           return 1 if $row &gt;= 8;
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#ch13-advanced-security-partitioning-database-__codelineno-9-10"></a>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#ch13-advanced-security-partitioning-database-__codelineno-9-11"></a>    # End of MySQL 8.x
</span></code></pre></div>
</div>
<p>Keep in mind, ONLY do this if you are using <code>MySQL 8.x</code> and later. If you are on
<code>MySQL 5.6</code> or <code>MariaDB</code> do NOT change these lines.</p>
<p>For Zabbix 5.4 and OLDER versions also make sure to uncomment the indicated lines.
But do not do this for Zabbix 6.0 and higher though.</p>
<div class="admonition info">
<p class="admonition-title">Uncomment for Zabbix 5.4 and older only</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch13-advanced-security-partitioning-database-__codelineno-10-1"></a># Uncomment the following line for Zabbix 5.4 and earlier
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ch13-advanced-security-partitioning-database-__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ch13-advanced-security-partitioning-database-__codelineno-10-3"></a>    # $dbh-&gt;do(&quot;DELETE FROM auditlog_details WHERE NOT EXISTS (SELECT NULL FROM
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ch13-advanced-security-partitioning-database-__codelineno-10-4"></a>    auditlog WHERE auditlog.auditid = auditlog_details.auditid)&quot;);
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#ch13-advanced-security-partitioning-database-__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#ch13-advanced-security-partitioning-database-__codelineno-10-6"></a>    }
</span></code></pre></div>
</div>
<p>For Zabbix 6.4 and OLDER versions also make sure to comment the following line.
Do not do this for Zabbix 7.0 and higher though:</p>
<div class="admonition info">
<p class="admonition-title">Uncomment for Zabbix 6.4 and older only</p>
<p><code>'history_bin' =&gt; { 'period' =&gt; 'day', 'keep_history' =&gt; '60'},</code></p>
</div>
<p>We also need to install some Perl dependencies to make sure we can execute the script.</p>
<div class="admonition info">
<p class="admonition-title">Install dependencies</p>
<p>Red Hat-Based
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch13-advanced-security-partitioning-database-__codelineno-11-1"></a>dnf install perl-DateTime perl-Sys-Syslog
</span></code></pre></div>
Debian-based
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch13-advanced-security-partitioning-database-__codelineno-12-1"></a>apt-get install libdatetime-perl liblogger-syslog-perl
</span></code></pre></div></p>
</div>
<p>If perl-DateTime isn't available on your Red Hat 7.x installation make sure to install
the powertools repo.</p>
<div class="admonition info">
<p class="admonition-title">Install correct repository</p>
<p>Red Hat 7 based
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch13-advanced-security-partitioning-database-__codelineno-13-1"></a>yum config-manager --set-enabled powertools
</span></code></pre></div></p>
<p>Red Hat 9 based
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch13-advanced-security-partitioning-database-__codelineno-14-1"></a>dnf config-manager --enable crb
</span></code></pre></div></p>
<p>Genuine Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch13-advanced-security-partitioning-database-__codelineno-15-1"></a>subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms
</span></code></pre></div></p>
<p>Oracle Linux
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch13-advanced-security-partitioning-database-__codelineno-16-1"></a>dnf config-manager --set-enabled ol8_codeready_builder
</span></code></pre></div></p>
</div>
<p>Then the last step is to add a cronjob to execute the script everyday.</p>
<div class="admonition info">
<p class="admonition-title">Open crontab</p>
<p><code>crontab -e</code></p>
</div>
<p>Add the following line to create the cronjob.</p>
<div class="admonition info">
<p class="admonition-title">Create cronjob</p>
<p><code>55 22 * * * /usr/lib/zabbix/mysql_zbx_part.pl &gt;/dev/null 2&gt;&amp;1</code></p>
</div>
<p>Execute the script manually to test.</p>
<div class="admonition info">
<p class="admonition-title">Manual script execution for testing</p>
<p><code>perl /usr/lib/zabbix/mysql_zbx_part.pl</code></p>
</div>
<p>Then we can check and see if it worked.</p>
<div class="admonition info">
<p class="admonition-title">Check the script log</p>
<p><code>journalctl -t mysql_zbx_part</code></p>
</div>
<p>This will give you back a list of created and deleted partitions if you've done
everything right. Make sure to check this command again tomorrow, to make sure
the cronjob is working as expected.</p></section><section class="print-page" id="ch13-advanced-security-partitioning-postgresql-database" heading-number="18.7"><h1 id="ch13-advanced-security-partitioning-postgresql-database-partitioning-postgresql-with-timescaledb">Partitioning PostgreSQL with TimescaleDB</h1>
<p>If you're familiar with partitioning a Zabbix database using MySQL or any of the
other forks like MariaDB, you're likely aware of the complexity involved, which
often requires Perl scripts and manual database operations. Fortunately, PostgreSQL
offers a much simpler and more streamlined approach. With the TimescaleDB extension,
partitioning is fully automated. This extension is not only powerful and efficient,
it is also the only method officially supported by Zabbix for database partitioning.
TimescaleDB takes care of the underlying logic, freeing you from custom scripts
and manual tweaks. For this reason, PostgreSQL could be the preferred and most convenient
option for managing large scale Zabbix environments.</p>
<h2 id="ch13-advanced-security-partitioning-postgresql-database-installing-timescaledb">Installing TimescaleDB</h2>
<p>First, make sure to download TimescaleDB from the correct source: <a href="https://docs.timescale.com/self-hosted/latest/install/">https://docs.timescale.com/self-hosted/latest/install/</a>.
Avoid using the version available in the standard PostgreSQL package repository,
as it is outdated and not suitable for Zabbix.</p>
<p>TimescaleDB comes in two editions: one released under the Apache license and the
other as the Community edition. For Zabbix, the Community edition is the recommended
choice. It includes all advanced features such as native compression, which are
essential for efficient long term data storage and performance in larger environments.</p>
<details class="info" open="open">
<summary>Info</summary>
<p>To use TimescaleDB with Zabbix, make sure PostgreSQL is installed from the official
PostgreSQL community repositories, as described in our setup guide. <strong>Do not</strong>
use the PostgreSQL version provided by Red Hat or its derivatives. The TimescaleDB
extension is not compatible with that version, and attempting to use it will
lead to failure in the configuration.</p>
</details>
<details class="note" open="open">
<summary>Note</summary>
<p>Always check in the Zabbix documentation before you start what version of
PostgreSQL is supported and what version of the TimescaleDB is supported that
way you don't install any unsupported version that could run you into issues.
<a href="https://docs.timescale.com/self-hosted/latest/install/installation-linux/#supported-platforms">https://docs.timescale.com/self-hosted/latest/install/installation-linux/#supported-platforms</a></p>
</details>
<h3 id="ch13-advanced-security-partitioning-postgresql-database-add-the-timescaledb-repository">Add the TimescaleDB repository</h3>
<div class="admonition info">
<p class="admonition-title">adding the repository</p>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-1"></a>sudo tee /etc/yum.repos.d/timescale_timescaledb.repo &lt;&lt;EOL
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-2"></a>[timescale_timescaledb]
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-3"></a>name=timescale_timescaledb
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-4"></a>baseurl=https://packagecloud.io/timescale/timescaledb/el/$(rpm -E %{rhel})/\$basearch
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-5"></a>repo_gpgcheck=1
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-6"></a>gpgcheck=0
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-7"></a>enabled=1
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-8"></a>gpgkey=https://packagecloud.io/timescale/timescaledb/gpgkey
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-9"></a>sslverify=1
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-10"></a>sslcacert=/etc/pki/tls/certs/ca-bundle.crt
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-11"></a>metadata_expire=300
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-0-12"></a>EOL
</span></code></pre></div>
Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-1-1"></a>echo &quot;deb https://packagecloud.io/timescale/timescaledb/ubuntu/ $(lsb_release -c -s) main&quot; | sudo tee /etc/apt/sources.list.d/timescaledb.list
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-2-1"></a>wget --quiet -O - https://packagecloud.io/timescale/timescaledb/gpgkey |
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-2-2"></a> sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/timescaledb.gpg
</span></code></pre></div></p>
</div>
<div class="admonition info">
<p class="admonition-title">Update your local repository list</p>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-3-1"></a>sudo dnf update -y
</span></code></pre></div>
Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-4-1"></a>sudo apt update -y
</span></code></pre></div></p>
</div>
<h3 id="ch13-advanced-security-partitioning-postgresql-database-install-timescaledb">Install TimescaleDB</h3>
<div class="admonition info">
<p class="admonition-title">Install TimescaleDB</p>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-5-1"></a>sudo yum install timescaledb-2-postgresql-17 postgresql17
</span></code></pre></div>
Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-6-1"></a>sudo apt install timescaledb-2-postgresql-17 postgresql-client-17
</span></code></pre></div></p>
</div>
<details class="note" open="open">
<summary>Note</summary>
<p>Of course, you need to match the TimescaleDB version to the version of PostgreSQL
you installed. For example, if you are using PostgreSQL 14, you must install
the corresponding TimescaleDB packages for version 14. The installation would
look like this:
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-7-1"></a>dnf install timescaledb-2-postgresql-14 postgresql-client-14
</span></code></pre></div>
Using mismatched versions can lead to compatibility issues, so always make
sure the TimescaleDB packages align with your PostgreSQL version.</p>
</details>
<details class="warning" open="open">
<summary>Warning</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-8-1"></a>Be sure to install the version of TimescaleDB that is supported by Zabbix
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-8-2"></a>also when you upgrade your OS verify that the new database version and
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-8-3"></a>timescaledb are supported by Zabbix. It&#39;s probably best to exclude them from
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-8-4"></a>automatic updates.
</span></code></pre></div>
</details>
<div class="admonition info">
<p class="admonition-title">Check for specific versions</p>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-9-1"></a>dnf list timescaledb-2-postgresql-17 --showduplicates
</span></code></pre></div>
Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-10-1"></a>apt-cache policy timescaledb-2-postgresql-17
</span></code></pre></div></p>
</div>
<div class="admonition info">
<p class="admonition-title">installing a specific version and lock the version</p>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-11-1"></a>sudo dnf install timescaledb-2-postgresql-17-2.19.3
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-11-2"></a>sudo dnf versionlock add timescaledb-2-postgresql-17
</span></code></pre></div>
Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-12-1"></a>sudo apt install timescaledb-2-postgresql-17=2.19.3~ubuntu24.04 timescaledb-2-loader-postgresql-17=2.19.3~ubuntu24.04
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-12-2"></a>sudo apt-mark hold timescaledb-2-postgresql-17
</span></code></pre></div></p>
</div>
<h3 id="ch13-advanced-security-partitioning-postgresql-database-configure-timescaledb">Configure TimescaleDB</h3>
<p>The next step is to load the TimescaleDB extension into your PostgreSQL database
and tune the configuration. There are two ways to do this: the automated way and
the manual way.</p>
<p>TimescaleDB provides a tuning script that analyses your system and applies recommended
settings to optimize performance. On Red Hat based systems, you can run:</p>
<div class="admonition info">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-13-1"></a>sudo<span class="w"> </span>timescaledb-tune<span class="w"> </span>--pg-config<span class="o">=</span>/usr/pgsql/17/bin/pg_config
</span></code></pre></div>
</div>
<p>For Ubuntu and Debian based systems, simply run:</p>
<div class="admonition info">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-14-1"></a>sudo<span class="w"> </span>timescaledb<span class="w"> </span>tune
</span></code></pre></div>
</div>
<p>This script will suggest configuration changes and can update your postgresql
configuration file automatically. If you prefer to tune the settings manually,
which is often recommended for experienced users, you will need to edit your postgresql
configuration file yourself.</p>
<p>At a minimum, make sure to add the following line at the end of the file:</p>
<div class="admonition info">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-15-1"></a><span class="nv">shared_preload_libraries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;timescaledb&#39;</span>
</span></code></pre></div>
</div>
<div class="admonition info">
<p class="admonition-title">Let's load the library</p>
<p>Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-16-1"></a>echo &quot;shared_preload_libraries = &#39;timescaledb&#39;&quot; | sudo tee -a /var/lib/pgsql/17/data/postgresql.conf
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-17-1"></a>systemctl restart postgresql-17
</span></code></pre></div>
Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-18-1"></a>echo &quot;shared_preload_libraries = &#39;timescaledb&#39;&quot; | sudo tee -a /etc/postgresql/17/main/postgresql.conf
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-19-1"></a>sudo systemctl restart postgresql
</span></code></pre></div></p>
</div>
<h3 id="ch13-advanced-security-partitioning-postgresql-database-configure-zabbix-for-timescaledb">Configure Zabbix for timescaledb</h3>
<p>Next, we connect to the Zabbix database as the user <code>zabbixsrv</code>, or whichever database
user you have configured earlier, and create the TimescaleDB extension. However,
before doing this, it is strongly recommended to stop the Zabbix server. This will
prevent the application from interfering with the database during the process, which
could otherwise cause locks or unexpected behavior.</p>
<div class="admonition info">
<p class="admonition-title">Stop Zabbix server</p>
<p>Red Hat and Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-20-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>zabbix-server
</span></code></pre></div></p>
</div>
<div class="admonition info">
<p class="admonition-title">Create timescaledb extension</p>
<p>Red Hat and Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-21-1"></a>psql<span class="w"> </span>-Uzabbix-srv<span class="w"> </span>zabbix<span class="w"> </span>-W
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-22-1"></a>psql (17.5)
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-22-2"></a>Type &quot;help&quot; for help.
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-22-4"></a>zabbix=&gt; CREATE EXTENSION IF NOT EXISTS timescaledb CASCADE;
</span></code></pre></div></p>
</div>
<p>Make sure the extension is installed by running <code>\dx</code>.</p>
<div class="admonition info">
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-23-1"></a>zabbix=&gt; \dx
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-23-2"></a>                                            List of installed extensions
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-23-3"></a>Name     | Version |   Schema   |                                      Description
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-23-4"></a>-------------+---------+------------+---------------------------------------------------------------------------------------
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-23-5"></a> plpgsql     | 1.0     | pg_catalog | PL/pgSQL procedural language
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-23-6"></a> timescaledb | 2.19.3  | public     | Enables scalable inserts and complex queries for time-series data (Community Edition)
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-23-7"></a>(2 rows)
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-23-8"></a>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-23-9"></a>zabbix=&gt;
</span></code></pre></div>
</div>
<h3 id="ch13-advanced-security-partitioning-postgresql-database-patch-zabbix-database">Patch Zabbix database</h3>
<p>While still connected to the Zabbix database, you can now apply the TimescaleDB
patch. This patch will migrate your existing history, trends, and audit log tables
to the TimescaleDB format. Depending on the amount of existing data, this process
may take some time.</p>
<p>Run the following command inside the database session:</p>
<div class="admonition info">
<div class="language-sql highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-24-1"></a><span class="n">zabbix</span><span class="o">=&gt;</span><span class="w"> </span><span class="err">\</span><span class="n">i</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">zabbix</span><span class="o">/</span><span class="k">sql</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="n">timescaledb</span><span class="o">/</span><span class="k">schema</span><span class="p">.</span><span class="k">sql</span>
</span></code></pre></div>
</div>
<p>The <code>schema.sql</code> script adjusts several important housekeeping parameters:</p>
<ul>
<li>Override item history period</li>
<li>Override item trend period</li>
</ul>
<p>To use partitioned housekeeping for history and trends, both of these options must
be enabled. However, it is also possible to enable them individually, depending
on your requirements.</p>
<p>In addition, the script sets two TimescaleDB specific parameters:</p>
<ul>
<li>Enable compression</li>
<li>Compress records older than 7 days</li>
</ul>
<p>These settings help reduce the size of historical data and improve long term performance.
Let's start our zabbix server again before we continue</p>
<div class="admonition info">
<p class="admonition-title">start Zabbix server</p>
<p>RedHat and Ubuntu
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-25-1"></a>sudo systemctl start zabbix-server
</span></code></pre></div></p>
</div>
<p>Let's have a look at them go in our menu to <strong>Administration</strong> -&gt; <strong>Housekeeping</strong></p>
<p><img alt="TimescaleDB settings" src="../ch13-advanced-security/timescaledb/ch13-timescaledb.png" /></p>
<p><em>13.1 housekeeper
settings</em></p>
<details class="warning" open="open">
<summary>Warning</summary>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-26-1"></a>When running the `schema.sql` script on TimescaleDB version 2.9.0 or higher,
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-26-2"></a>you may see warning messages indicating that certain best practices are not
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-26-3"></a>being followed. These warnings can be safely ignored. They do not affect the
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-26-4"></a>outcome of the configuration process.
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-26-5"></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-26-6"></a>As long as everything is set up correctly, the script will complete without
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-26-7"></a>issue. You should see the following confirmation at the end:
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-27-1"></a><span class="n">psql</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">zabbix</span><span class="o">/</span><span class="k">sql</span><span class="w"> </span><span class="n">scripts</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="n">timescaledb</span><span class="o">/</span><span class="k">schema</span><span class="p">.</span><span class="k">sql</span><span class="p">:</span><span class="mi">112</span><span class="p">:</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-27-2"></a><span class="n">NOTICE</span><span class="p">:</span><span class="w">  </span><span class="n">TimescaleDB</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">configured</span><span class="w"> </span><span class="n">successfully</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-28-1"></a>This confirms that the TimescaleDB extension and related Zabbix settings have
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#ch13-advanced-security-partitioning-postgresql-database-__codelineno-28-2"></a>been applied correctly.
</span></code></pre></div></p>
</details>
<h2 id="ch13-advanced-security-partitioning-postgresql-database-conclusion">Conclusion</h2>
<p>Using TimescaleDB with PostgreSQL is the only officially supported method for database
partitioning in Zabbix. It replaces complex manual setups with automated, efficient
handling of historical and trend data. Features like native compression and time
based partitioning significantly reduce storage usage and improve query performance.</p>
<p>By installing PostgreSQL from the correct repository, tuning it properly, and applying
the TimescaleDB schema patch, you ensure that Zabbix can scale reliably with minimal
maintenance overhead. This setup not only optimizes performance but also prepares
your environment for long term growth and data retention.</p>
<h2 id="ch13-advanced-security-partitioning-postgresql-database-questions">Questions</h2>
<ul>
<li>What are the key advantages of using TimescaleDB compared to partitioning with
  MySQL or MariaDB?</li>
<li>What might go wrong if you install PostgreSQL from the default Red Hat repositories
  when planning to use TimescaleDB?</li>
<li>How does enabling compression in TimescaleDB benefit your Zabbix installation?</li>
</ul>
<h2 id="ch13-advanced-security-partitioning-postgresql-database-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://docs.timescale.com/self-hosted/latest/configuration/">https://docs.timescale.com/self-hosted/latest/configuration/</a></li>
<li><a href="https://www.zabbix.com/documentation/7.2/en/manual/appendix/install/timescaledb?hl=TimescaleDB">https://www.zabbix.com/documentation/7.2/en/manual/appendix/install/timescaledb?hl=TimescaleDB</a></li>
</ul></section></section>
                    <section class='print-page md-section' id='section-19' heading-number='19'>
                        <h1>Chapter 14 : Maintenance<a class='headerlink' href='#section-19' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch14-zabbix-maintenance-chapter" heading-number="19.1"><h1 id="ch14-zabbix-maintenance-chapter-zabbix-maintenance">Zabbix maintenance</h1>
<p>Maintaining a stable and efficient Zabbix environment requires more than just
monitoring external systems, it also involves taking care of Zabbix itself. This
chapter explores the key aspects of Zabbix maintenance, including setting up regular
backups to protect your data, using Zabbix's internal health checks to monitor
its own performance, and applying upgrades to stay current with new features and
security fixes. We'll also cover Zabbix's built-in maintenance mode, which allows
you to schedule downtime for hosts and services without triggering unnecessary
alerts. Together, these practices help ensure your monitoring system remains
reliable, resilient, and ready to scale.</p></section><section class="print-page" id="ch14-zabbix-maintenance-maintenance" heading-number="19.2"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="maintenance">Maintenance</h1>
<h2 id="ch14-zabbix-maintenance-maintenance-the-purpose-of-maintenance-periods">The Purpose of Maintenance Periods</h2>
<p>A <strong>Maintenance Period</strong> in Zabbix is a defined time window for planned work
(e.g., software updates, configuration changes). Its primary goal is to <strong>suppress
problem notifications (alerts)</strong> for the affected hosts or applications to prevent
alert fatigue.</p>
<p>During maintenance, Zabbix still monitors systems, but alert actions (emails,
tickets, etc.) are typically paused.</p>
<hr />
<h2 id="ch14-zabbix-maintenance-maintenance-key-maintenance-configuration-options">Key Maintenance Configuration Options</h2>
<h3 id="ch14-zabbix-maintenance-maintenance-1-maintenance-type">1. Maintenance Type</h3>
<p>The Maintenance section is located in the main menu under <code>Data collection</code>
‚Üí <code>Maintenance</code>. To create a new maintenance window, click Create maintenance.
When doing so, Zabbix presents two available maintenance types, allowing you to
choose the one that best fits your needs.</p>
<p>This defines how Zabbix handles data during the maintenance window:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Trigger Processing</th>
<th style="text-align: left;">Data Collection</th>
<th style="text-align: left;">Best Used For</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>With data collection</strong></td>
<td style="text-align: left;">Data is collected as usual, but <strong>problem notifications are suppressed</strong> (via a default Action condition).</td>
<td style="text-align: left;"><strong>Processed</strong></td>
<td style="text-align: left;"><strong>Collected</strong></td>
<td style="text-align: left;">Routine updates where data continuity is important.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>No data collection</strong></td>
<td style="text-align: left;">Data collection is completely paused for the items on the maintained host(s).</td>
<td style="text-align: left;"><strong>Not Processed</strong></td>
<td style="text-align: left;"><strong>Ignored/Not Collected</strong></td>
<td style="text-align: left;">Major hardware upgrades or OS reloads where the host is completely unavailable.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using <code>no data collection</code>, host and proxies will still sent data to the
Zabbix server. However the server will not process the data and store it into
the database.</p>
</div>
<h3 id="ch14-zabbix-maintenance-maintenance-2-time-window-definition-active-since-active-till">2. Time Window Definition (<code>Active Since</code> / <code>Active Till</code>)</h3>
<p>The Start and End dates determine the overall duration of the maintenance rule.
Specific maintenance execution times are configured on the Periods tab. Each
defined period must fall within the maintenance window‚Äôs overall lifespan.</p>
<h3 id="ch14-zabbix-maintenance-maintenance-3-maintenance-periods-the-schedule">3. Maintenance Periods (The Schedule)</h3>
<p>This tab defines the precise scheduling:</p>
<ul>
<li><strong>One Time Only:</strong> A single, non-recurring window.</li>
<li><strong>Daily:</strong> A recurring schedule every <em>N</em> days.</li>
<li><strong>Weekly:</strong> A recurring schedule on specific days of the week.</li>
<li><strong>Monthly:</strong> The most flexible, allowing selection by <strong>Day of Month</strong> or
  <strong>Day of Week</strong> within a month (e.g., the last Sunday).</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Active Since/Till will not put the server in maintenance. It is the
maintenance period that will show that the server is in maintenance or not
in the frontend.</p>
</div>
<p><img alt="maintenance/../ch14-zabbix-maintenance/maintenance/ch14.01-maintenance.png" src="../ch14-zabbix-maintenance/maintenance/ch14.01-maintenance.png" /></p>
<h3 id="ch14-zabbix-maintenance-maintenance-4-scope-hosts-and-host-groups">4. Scope (Hosts and Host Groups)</h3>
<p>You define the scope by selecting the specific <strong>Hosts</strong> and/or <strong>Host Groups</strong>
that the rule applies to.</p>
<h3 id="ch14-zabbix-maintenance-maintenance-5-problem-tag-filtering-advanced-suppression">5. Problem Tag Filtering (Advanced Suppression)</h3>
<p>This allows you to suppress <strong>only specific problems</strong> during maintenance by
matching <strong>Problem Tags</strong> (e.g., <code>service:database</code>), which is useful if you
need to be alerted to hardware failures during software maintenance.</p>
<h3 id="ch14-zabbix-maintenance-maintenance-6-maintenance-visibility">6. Maintenance visibility</h3>
<p>When a server is placed into maintenance mode, this state is clearly indicated
in the Zabbix frontend, making it easy to distinguish whether a host is currently
under maintenance or not.</p>
<p>During maintenance, an orange wrench <img alt="maintenance/../ch14-zabbix-maintenance/maintenance/ch14.04-maintenance-wrench.png" src="../ch14-zabbix-maintenance/maintenance/ch14.04-maintenance-wrench.png" />
icon is displayed next to the host name in the following views:</p>
<ul>
<li><strong>Dashboards</strong></li>
<li><strong>Monitoring ‚Üí Problems</strong></li>
<li><strong>Inventory ‚Üí Hosts ‚Üí Host inventory details</strong></li>
<li><strong>Data collection ‚Üí Hosts</strong></li>
</ul>
<p>In addition, hosts in maintenance are highlighted with an orange background on
<strong>Monitoring ‚Üí Maps</strong>.</p>
<p>By default, problems associated with hosts in maintenance are <em>suppressed</em> and
therefore not shown in the frontend. However, Zabbix can be configured to display
these suppressed problems. This behavior can be enabled by selecting the
<strong>Show suppressed problems</strong> option in the following locations:</p>
<ul>
<li><strong>Dashboards</strong> ‚Äì in the configuration of the <em>Problem hosts</em>, <em>Problems</em>,
  <em>Problems by severity</em>, and <em>Trigger overview</em> widgets</li>
<li><strong>Monitoring ‚Üí Problems</strong> ‚Äì in the filter settings</li>
<li><strong>Monitoring ‚Üí Maps</strong> ‚Äì in the map configuration</li>
<li><strong>Global notifications</strong> ‚Äì in the user profile configuration</li>
</ul>
<p>When suppressed problems are configured to be shown, a dedicated status icon is
displayed next to the problem. Hovering the mouse pointer over this icon reveals
additional details about the suppression state.</p>
<p><img alt="maintenance/../ch14-zabbix-maintenance/maintenance/ch14.05-maintenance-icon.png" src="../ch14-zabbix-maintenance/maintenance/ch14.05-maintenance-icon.png" /></p>
<hr />
<h2 id="ch14-zabbix-maintenance-maintenance-time-zones-and-maintenance-schedule-logic">Time Zones and Maintenance Schedule Logic</h2>
<p>Understanding how time zones work in Zabbix is essential for scheduling reliable
maintenance tasks. Zabbix handles time zones differently depending on whether
a maintenance window is one-time or recurring.</p>
<p>For one time maintenance, the start and end times are interpreted in the frontend
user's local time zone. The same time zone configured for the logged-in user.
In contrast, recurring maintenance is evaluated based on the Zabbix server's time
zone, ensuring that the recurrence pattern remains consistent, even if users in
different regions view it.</p>
<p>This distinction is important to remember: a maintenance period that appears
correct in your local time might execute at a different time if the server is in
another time zone.</p>
<h3 id="ch14-zabbix-maintenance-maintenance-time-zone-rules-for-maintenance-periods">Time Zone Rules for Maintenance Periods</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">Period Type</th>
<th style="text-align: left;">Time Zone Used for Execution</th>
<th style="text-align: left;">Displayed Time Zone</th>
<th style="text-align: left;">Implication</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>One Time Only</strong></td>
<td style="text-align: left;"><strong>User's Browser Time Zone</strong></td>
<td style="text-align: left;"><strong>User's Browser Time Zone</strong></td>
<td style="text-align: left;">The absolute UTC time is stored based on the user's view.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Daily, Weekly, Monthly</strong></td>
<td style="text-align: left;"><strong>Zabbix Server Time Zone</strong></td>
<td style="text-align: left;"><strong>User's Browser Time Zone</strong></td>
<td style="text-align: left;">The recurring logic (e.g., "start at 02:00") is executed based on the time zone configured on the <strong>Zabbix Server operating system</strong>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>Active since</code> / <code>Active till</code></strong></td>
<td style="text-align: left;"><strong>User's Browser Time Zone</strong></td>
<td style="text-align: left;"><strong>User's Browser Time Zone</strong></td>
<td style="text-align: left;">These bounding dates are based on the time zone of the user who configured them.</td>
</tr>
</tbody>
</table>
<details class="info" open="open">
<summary>Info</summary>
<p><strong>It's Good Practice:</strong> to use a common time zone (e.g., <strong>UTC</strong>) across the
Zabbix Server, the database, and the PHP frontend configuration for predictable
results, especially with recurring periods and DST changes. Another way is
to add a clock widget to the dashboard with the <code>Zabbix server</code> time.</p>
</details>
<hr />
<h2 id="ch14-zabbix-maintenance-maintenance-backend-process-and-configuration">Backend Process and Configuration</h2>
<h3 id="ch14-zabbix-maintenance-maintenance-the-timer-process-the-engine-of-maintenance">The Timer Process: The Engine of Maintenance</h3>
<p>The process responsible for calculating and initiating maintenance periods is the
<strong>Zabbix Timer process</strong> (controlled by <code>StartTimers</code>).</p>
<ol>
<li><strong>Recalculation Interval (The Check):</strong> The Timer process checks whether a host's
   status must change to/from maintenance at <strong>0 seconds of every minute</strong>.
   * This means the maintenance window will start and stop with a <strong>maximum latency
     of 60 seconds</strong> after the scheduled time.</li>
<li><strong>Configuration Cache:</strong> Maintenance definitions are stored in the database
   and loaded into the Zabbix Server's <strong>Configuration Cache</strong>. The Timer
   uses this cache to determine host status.</li>
</ol>
<details class="info" open="open">
<summary>Info</summary>
<p>Only the first timer process handles host maintenance updates. Problem
 suppression updates are shared between all the timers.</p>
</details>
<h3 id="ch14-zabbix-maintenance-maintenance-key-zabbix-server-configuration-zabbix_serverconf">Key Zabbix Server Configuration (<code>zabbix_server.conf</code>)</h3>
<p>The overall efficiency of maintenance logic depends on these parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Zabbix 8.0 Default Value</th>
<th style="text-align: left;">Purpose in Relation to Maintenance</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong><code>CacheUpdateFrequency</code></strong></td>
<td style="text-align: left;"><strong>10</strong></td>
<td style="text-align: left;">Defines how often (in seconds) the Zabbix Server updates its configuration cache from the database. A change to a maintenance period will take effect within <strong>10 seconds</strong>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>StartTimers</code></strong></td>
<td style="text-align: left;"><code>1</code></td>
<td style="text-align: left;">The number of <strong>Timer processes</strong> to start. These are the processes that execute the maintenance calculation.</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>CacheSize</code></strong></td>
<td style="text-align: left;"><code>8M</code></td>
<td style="text-align: left;">The size of the configuration cache. Insufficient size can impact the Timer's ability to quickly process status changes in large environments.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ch14-zabbix-maintenance-maintenance-example-monthly-recurring-maintenance-setup">Example: Monthly Recurring Maintenance Setup</h2>
<p><strong>Scenario:</strong> Routine updates on all <strong>Database Servers</strong> on the <strong>last Sunday of
every month</strong> at midnight for <strong>2 hours</strong>. Only suppress problems related to the
<strong>Database Service</strong>.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field/Tab</th>
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;"><code>Monthly DB Patching - Last Sunday</code></td>
<td style="text-align: left;">Descriptive name.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Maintenance type</strong></td>
<td style="text-align: left;"><strong>With data collection</strong></td>
<td style="text-align: left;">Continue data collection.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Periods Tab</strong></td>
<td style="text-align: left;"><strong>Period type:</strong> <code>Monthly</code></td>
<td style="text-align: left;">Selects the schedule type.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Periods Tab</strong></td>
<td style="text-align: left;"><strong>Day of week:</strong> <code>Sunday</code> / <strong>Week of month:</strong> <code>Last</code></td>
<td style="text-align: left;">Defines the precise day.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Periods Tab</strong></td>
<td style="text-align: left;"><strong>Start time:</strong> <code>00:00</code> / <strong>Duration:</strong> <code>2 hours</code></td>
<td style="text-align: left;">Defines the 00:00 to 02:00 window.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Hosts &amp; Groups Tab</strong></td>
<td style="text-align: left;"><strong>Host Group:</strong> <code>Database Servers</code></td>
<td style="text-align: left;">Defines the scope.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Tags Tab</strong></td>
<td style="text-align: left;"><strong>Tag evaluation:</strong> <code>AND</code></td>
<td style="text-align: left;">Ensures both conditions (maintenance and tag) are met for suppression.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Tags Tab</strong></td>
<td style="text-align: left;"><strong>Tag:</strong> <code>service</code> <strong>Operator:</strong> <code>=</code> <strong>Value:</strong> <code>database</code></td>
<td style="text-align: left;"><strong>Crucial:</strong> Only problems with the tag <code>service:database</code> are suppressed.</td>
</tr>
</tbody>
</table>
<p><img alt="maintenance/../ch14-zabbix-maintenance/maintenance/ch14.02-maintenance-config.png" src="../ch14-zabbix-maintenance/maintenance/ch14.02-maintenance-config.png" /></p>
<h3 id="ch14-zabbix-maintenance-maintenance-execution-summary">Execution Summary</h3>
<ol>
<li>At 00:00 (Server Time Zone), the <strong>Timer</strong> changes the host status to "Maintenance."</li>
<li>Data collection continues.</li>
<li>Any problem event is filtered by the Action: If the host is in maintenance AND
   the problem has the tag <code>service:database</code>, the alert is <strong>suppressed</strong>.</li>
<li>If a hardware problem (e.g., no matching tag) occurs, the alert <strong>will still
   be sent</strong>, as only the database service issues are suppressed.</li>
<li>At 02:00, the Timer ends the maintenance, and all alerting resumes.</li>
</ol>
<hr />
<h2 id="ch14-zabbix-maintenance-maintenance-api-integration-for-maintenance-management">API Integration for Maintenance Management</h2>
<p>For professional Zabbix monitoring setups that require dynamic scheduling, integration
with change management workflows, or complex multi-system orchestration, the
<strong>Zabbix API</strong> is the primary tool for managing maintenance periods.</p>
<p>The key method used for maintenance management is <strong><code>maintenance.create</code></strong> (and
corresponding <code>.get</code>, <code>.update</code>, and <code>.delete</code> methods).</p>
<h3 id="ch14-zabbix-maintenance-maintenance-why-use-the-api-for-maintenance">Why Use the API for Maintenance?</h3>
<ul>
<li><strong>ITSM Integration:</strong> Allows automated creation of maintenance windows when
  a Change Request (CR) is approved in an external system (e.g., ServiceNow, Jira),
  ensuring alerts are suppressed only during authorized work.</li>
<li><strong>Automation:</strong> Facilitates the management of maintenance templates using
  infrastructure-as-code tools (like Ansible or Terraform).</li>
<li><strong>Dynamic Scheduling:</strong> Enables the creation of immediate, short-term maintenance
  windows directly from operational scripts.</li>
</ul>
<h3 id="ch14-zabbix-maintenance-maintenance-key-parameters-for-maintenancecreate">Key Parameters for <code>maintenance.create</code></h3>
<p>When calling the <code>maintenance.create</code> method, you send a JSON-RPC request containing
several crucial parameters that mirror the frontend configuration:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">API Parameter</th>
<th style="text-align: left;">Frontend Equivalent</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong><code>name</code></strong></td>
<td style="text-align: left;">Name</td>
<td style="text-align: left;">The name of the maintenance period.</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>active_since</code></strong></td>
<td style="text-align: left;">Active Since</td>
<td style="text-align: left;"><strong>Unix timestamp</strong> (seconds) when the maintenance rule becomes active.</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>active_till</code></strong></td>
<td style="text-align: left;">Active Till</td>
<td style="text-align: left;"><strong>Unix timestamp</strong> (seconds) when the maintenance rule is deactivated.</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>maintenance_type</code></strong></td>
<td style="text-align: left;">Maintenance Type</td>
<td style="text-align: left;"><strong><code>0</code></strong> for "With data collection" (default), <strong><code>1</code></strong> for "No data collection".</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>hostids</code></strong></td>
<td style="text-align: left;">Hosts</td>
<td style="text-align: left;">An array of <strong>Host IDs</strong> (<code>hostid</code>) to be put into maintenance.</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>groupids</code></strong></td>
<td style="text-align: left;">Host Groups</td>
<td style="text-align: left;">An array of <strong>Host Group IDs</strong> (<code>groupid</code>) to be put into maintenance.</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>timeperiods</code></strong></td>
<td style="text-align: left;">Periods Tab</td>
<td style="text-align: left;">An array defining the precise recurring or one-time schedule.</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>tags</code></strong></td>
<td style="text-align: left;">Tags Tab</td>
<td style="text-align: left;">An array defining the problem tags for filtering (optional).</td>
</tr>
</tbody>
</table>
<h3 id="ch14-zabbix-maintenance-maintenance-the-timeperiods-parameter-schedule-definition">The <code>timeperiods</code> Parameter (Schedule Definition)</h3>
<p>The <strong><code>timeperiods</code></strong> array defines the exact schedule. Key elements include:</p>
<ol>
<li><strong><code>timeperiod_type</code></strong>: The type of schedule (<code>0</code> for one-time, <code>4</code> for monthly,
   etc.).</li>
<li><strong><code>start_time</code></strong>: The time of day the maintenance starts (in seconds from midnight,
   <strong>based on Zabbix Server Time Zone</strong>).</li>
<li><strong><code>period</code></strong>: The duration of the maintenance window in seconds.</li>
<li><strong><code>dayofweek</code> / <code>dayofmonth</code></strong>: Used for recurring schedules.</li>
</ol>
<hr />
<h2 id="ch14-zabbix-maintenance-maintenance-practical-example-creating-maintenance-via-the-api">Practical Example: Creating Maintenance via the API</h2>
<p>This <code>curl</code> command demonstrates how to programmatically create the "Last Sunday
of the Month" maintenance window, which runs at midnight for 2 hours, and applies
to host group ID <code>4</code>.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>You must replace <code>&lt;ZABBIX_SERVER_IP_OR_DNS&gt;</code> with your server's address and
<code>"YOUR API TOKEN"</code> with an active token from a successful <code>user.login</code> API
call. The <strong>Host Group ID</strong> (e.g., <code>"4"</code>) must be known beforehand. This id
can be found in the url when going to the host group` in the Zabbix menu.</p>
</details>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-1"></a>curl<span class="w"> </span>-i<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json-rpc&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Authorization: Bearer &lt;YOUR API TOKEN&gt;&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-4"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-5"></a><span class="s1">    &quot;jsonrpc&quot;: &quot;2.0&quot;,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-6"></a><span class="s1">    &quot;method&quot;: &quot;maintenance.create&quot;,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-7"></a><span class="s1">    &quot;params&quot;: {</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-8"></a><span class="s1">      &quot;name&quot;: &quot;Monthly DB Patching via API&quot;,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-9"></a><span class="s1">      &quot;active_since&quot;: 1748822400,</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-10"></a><span class="s1">      &quot;active_till&quot;: 1780444800,</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-11"></a><span class="s1">      &quot;maintenance_type&quot;: 0,</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-12"></a><span class="s1">      &quot;groups&quot;: [</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-13"></a><span class="s1">        { &quot;groupid&quot;: &quot;4&quot; }</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-14"></a><span class="s1">      ],</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-15"></a><span class="s1">      &quot;timeperiods&quot;: [</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-16"></a><span class="s1">        {</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-17"></a><span class="s1">          &quot;timeperiod_type&quot;: 4,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-18"></a><span class="s1">          &quot;start_time&quot;: 0,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-19"></a><span class="s1">          &quot;period&quot;: 7200,</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-20"></a><span class="s1">          &quot;dayofweek&quot;: 64,</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-21"></a><span class="s1">          &quot;every&quot;: 5,</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-22"></a><span class="s1">          &quot;month&quot;: 4095</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-23"></a><span class="s1">        }</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-24"></a><span class="s1">      ]</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-25"></a><span class="s1">    },</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-26"></a><span class="s1">    &quot;id&quot;: 1</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-27"></a><span class="s1">  }&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#ch14-zabbix-maintenance-maintenance-__codelineno-0-28"></a><span class="w">  </span>http://&lt;ZABBIX_SERVER_IP_OR_DNS&gt;/api_jsonrpc.php
</span></code></pre></div>
<hr />
<h3 id="ch14-zabbix-maintenance-maintenance-understanding-the-time-period-parameters">Understanding the Time Period Parameters</h3>
<p>Let's go over what we just did here to have a better understanding.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch14-zabbix-maintenance-maintenance-__codelineno-1-1"></a><span class="nt">&quot;timeperiod_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ch14-zabbix-maintenance-maintenance-__codelineno-1-2"></a><span class="nt">&quot;start_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ch14-zabbix-maintenance-maintenance-__codelineno-1-3"></a><span class="nt">&quot;period&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7200</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ch14-zabbix-maintenance-maintenance-__codelineno-1-4"></a><span class="nt">&quot;dayofweek&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ch14-zabbix-maintenance-maintenance-__codelineno-1-5"></a><span class="nt">&quot;every&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ch14-zabbix-maintenance-maintenance-__codelineno-1-6"></a><span class="nt">&quot;month&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4095</span>
</span></code></pre></div>
<hr />
<h3 id="ch14-zabbix-maintenance-maintenance-timeperiod_type-4-monthly-period"><code>timeperiod_type: 4</code> ‚Äî Monthly Period</h3>
<p>This defines the <strong>type of recurrence</strong> for the maintenance period.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">0</td>
<td style="text-align: left;">One-time</td>
</tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: left;">Weekly</td>
</tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: left;">Daily</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4</strong></td>
<td style="text-align: left;"><strong>Monthly</strong></td>
</tr>
</tbody>
</table>
<p>Setting it to <code>4</code> means the maintenance repeats <strong>every month</strong>.</p>
<hr />
<h3 id="ch14-zabbix-maintenance-maintenance-start_time-0-start-of-the-day-000000"><code>start_time: 0</code> ‚Äî Start of the Day (00:00:00)</h3>
<p>The number of <strong>seconds past midnight</strong> when maintenance begins.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">0</td>
<td style="text-align: left;">00:00 (midnight)</td>
</tr>
<tr>
<td style="text-align: left;">3600</td>
<td style="text-align: left;">01:00</td>
</tr>
<tr>
<td style="text-align: left;">9000</td>
<td style="text-align: left;">02:30</td>
</tr>
</tbody>
</table>
<p>Here, it starts at <strong>midnight</strong>.</p>
<hr />
<h3 id="ch14-zabbix-maintenance-maintenance-period-7200-duration"><code>period: 7200</code> ‚Äî Duration</h3>
<p>Defines how long the maintenance lasts, in <strong>seconds</strong>.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch14-zabbix-maintenance-maintenance-__codelineno-2-1"></a>7200 seconds = 2 hours
</span></code></pre></div>
<p>So this window runs from <strong>00:00 to 02:00</strong>.</p>
<hr />
<h3 id="ch14-zabbix-maintenance-maintenance-dayofweek-64-sunday"><code>dayofweek: 64</code> ‚Äî Sunday</h3>
<p>Zabbix uses a <strong>bitmask</strong> for days of the week:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Day</th>
<th style="text-align: left;">Bit Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Monday</td>
<td style="text-align: left;">1</td>
</tr>
<tr>
<td style="text-align: left;">Tuesday</td>
<td style="text-align: left;">2</td>
</tr>
<tr>
<td style="text-align: left;">Wednesday</td>
<td style="text-align: left;">4</td>
</tr>
<tr>
<td style="text-align: left;">Thursday</td>
<td style="text-align: left;">8</td>
</tr>
<tr>
<td style="text-align: left;">Friday</td>
<td style="text-align: left;">16</td>
</tr>
<tr>
<td style="text-align: left;">Saturday</td>
<td style="text-align: left;">32</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Sunday</strong></td>
<td style="text-align: left;"><strong>64</strong></td>
</tr>
</tbody>
</table>
<p><code>64</code> means the maintenance occurs on <strong>Sunday</strong>.
You can combine days ‚Äî for example, Monday + Wednesday = <code>1 + 4 = 5</code>.</p>
<hr />
<h3 id="ch14-zabbix-maintenance-maintenance-every-5-last-week-of-the-month"><code>every: 5</code> ‚Äî Last Week of the Month</h3>
<p>For monthly schedules, this field defines <strong>which week of the month</strong> to use:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;">First week</td>
</tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: left;">Second week</td>
</tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: left;">Third week</td>
</tr>
<tr>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Fourth week</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5</strong></td>
<td style="text-align: left;"><strong>Last week</strong></td>
</tr>
</tbody>
</table>
<p><code>5</code> means the <strong>last occurrence</strong> of the selected weekday. In this case, the
  <strong>last Sunday of the month</strong>.</p>
<hr />
<h3 id="ch14-zabbix-maintenance-maintenance-month-4095-all-months"><code>month: 4095</code> ‚Äî All Months</h3>
<p>Months also use a <strong>bitmask</strong>:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Month</th>
<th style="text-align: left;">Bit Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">January</td>
<td style="text-align: left;">1</td>
</tr>
<tr>
<td style="text-align: left;">February</td>
<td style="text-align: left;">2</td>
</tr>
<tr>
<td style="text-align: left;">March</td>
<td style="text-align: left;">4</td>
</tr>
<tr>
<td style="text-align: left;">April</td>
<td style="text-align: left;">8</td>
</tr>
<tr>
<td style="text-align: left;">May</td>
<td style="text-align: left;">16</td>
</tr>
<tr>
<td style="text-align: left;">June</td>
<td style="text-align: left;">32</td>
</tr>
<tr>
<td style="text-align: left;">July</td>
<td style="text-align: left;">64</td>
</tr>
<tr>
<td style="text-align: left;">August</td>
<td style="text-align: left;">128</td>
</tr>
<tr>
<td style="text-align: left;">September</td>
<td style="text-align: left;">256</td>
</tr>
<tr>
<td style="text-align: left;">October</td>
<td style="text-align: left;">512</td>
</tr>
<tr>
<td style="text-align: left;">November</td>
<td style="text-align: left;">1024</td>
</tr>
<tr>
<td style="text-align: left;">December</td>
<td style="text-align: left;">2048</td>
</tr>
</tbody>
</table>
<p>To include all months, add them up:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch14-zabbix-maintenance-maintenance-__codelineno-3-1"></a>1 + 2 + 4 + 8 + 16 + 32 + 64 + 128 + 256 + 512 + 1024 + 2048 = 4095
</span></code></pre></div>
<p>So <code>4095</code> means <strong>every month</strong>.</p>
<p>Ok, let's verify what we just did. Go to <code>Data collection</code> ‚Üí <code>Maintenance</code>. If
all went well you should now see a new maintenance that was created by our
script.</p>
<p>A working easy to use maintenance script can be found here : <a href="https://github.com/penmasters/trikke76-fork/tree/master/maintenance">https://github.com/penmasters/trikke76-fork/tree/master/maintenance</a></p>
<p><img alt="maintenance/../ch14-zabbix-maintenance/maintenance/ch14.03-maintenance-api.png" src="../ch14-zabbix-maintenance/maintenance/ch14.03-maintenance-api.png" /></p>
<hr />
<h2 id="ch14-zabbix-maintenance-maintenance-conclusion">Conclusion</h2>
<p>Mastering Zabbix maintenance periods is crucial for operational maturity. By
correctly applying precise scheduling, leveraging problem tag filtering, and
integrating maintenance workflows via the Zabbix API, you ensure that alerts
are accurately suppressed only during planned work. This practice is vital for
maintaining the credibility of your monitoring data and preventing alert fatigue
among your operations team, transforming Zabbix from a passive alarm system into
a strategic tool for change management.</p>
<h2 id="ch14-zabbix-maintenance-maintenance-questions">Questions</h2>
<ul>
<li>What is the primary operational effect on triggers/alerts when a host enters
  a defined maintenance period?</li>
<li>Briefly explain the difference between "One time only" and "Daily" scheduling
  for maintenance periods. When would you use one over the other?</li>
<li>Does Zabbix continue to collect data from an item during a maintenance period?
  Why is this important?</li>
<li>Your Zabbix server is set to UTC, but the server you are maintaining is in EST.
  When defining a "No Data Collection" maintenance window from 2:00 AM to 4:00 AM,
  which time zone should you select for the schedule and why?</li>
</ul>
<h2 id="ch14-zabbix-maintenance-maintenance-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/maintenance">https://www.zabbix.com/documentation/current/en/manual/maintenance</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/api/reference/maintenance/create">https://www.zabbix.com/documentation/current/en/manual/api/reference/maintenance/create</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/api/reference/maintenance/object#time-period">https://www.zabbix.com/documentation/current/en/manual/api/reference/maintenance/object#time-period</a></li>
</ul></section><section class="print-page" id="ch14-zabbix-maintenance-internal-health" heading-number="19.3"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="zabbix-internal-health-check">Zabbix internal health check</h1>
<h2 id="ch14-zabbix-maintenance-internal-health-1-introduction"><strong>1. Introduction</strong></h2>
<p>While Zabbix is known for monitoring infrastructure, it can also monitor itself.
Through <em>internal checks</em>, Zabbix continuously measures its own operational state
from poller load and queue length to cache usage and data throughput.</p>
<p>Monitoring these internal metrics allows administrators to detect overload
conditions, database bottlenecks, and sizing issues early, ensuring the monitoring
system remains reliable and performant.</p>
<hr />
<h2 id="ch14-zabbix-maintenance-internal-health-2-the-zabbix-internal-host"><strong>2. The Zabbix Internal Host</strong></h2>
<p>Each Zabbix installation automatically creates a <strong>virtual internal host</strong>:</p>
<ul>
<li><strong>Zabbix server</strong> ‚Äì represents the server process itself</li>
<li><strong>Zabbix proxy</strong> ‚Äì represents each proxy instance</li>
</ul>
<p>These hosts are not linked to any physical device or network interface.
They exist entirely within the Zabbix backend and collect self monitoring data
through <em>internal items</em> with keys beginning with <code>zabbix[...]</code>.</p>
<p>Examples:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch14-zabbix-maintenance-internal-health-__codelineno-0-1"></a>zabbix[process,poller,avg,busy]
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch14-zabbix-maintenance-internal-health-__codelineno-0-2"></a>zabbix[queue,all]
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch14-zabbix-maintenance-internal-health-__codelineno-0-3"></a>zabbix[wcache,values,free]
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch14-zabbix-maintenance-internal-health-__codelineno-0-4"></a>zabbix[items]
</span></code></pre></div>
<p>These items require no agent or SNMP interface, they are gathered internally
by Zabbix.</p>
<hr />
<h2 id="ch14-zabbix-maintenance-internal-health-3-categories-of-internal-metrics"><strong>3. Categories of Internal Metrics</strong></h2>
<h3 id="ch14-zabbix-maintenance-internal-health-31-process-performance"><strong>3.1 Process Performance</strong></h3>
<p>Zabbix Server is a multi-process application. It relies on a dedicated set of
specialized processes such as the pollers for active data collection, trappers
for passive incoming data, and alerters for sending notifications to perform its
core duties efficiently and concurrently.</p>
<p>Each type of internal process reports its load via internal checks, indicating
the percentage of time it spends working versus waiting. Consistently high
utilization (approaching 100%) is a critical performance indicator, suggesting
that the configured number of processes (Start<Process>) is insufficient to handle
the current monitoring load.</p>
<p>If a process like the poller remains overloaded, it directly causes item collection
delays, pushing new check requests into the queue. If the alerter is overloaded,
users won't receive timely notifications about problems. Monitoring these metrics
is thus the primary way to ensure data collection and alerting remain timely.</p>
<table>
<thead>
<tr>
<th>Example Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>zabbix[process,poller,avg,busy]</code></td>
<td>Average poller utilization</td>
</tr>
<tr>
<td><code>zabbix[process,trapper,avg,busy]</code></td>
<td>Trapper process load</td>
</tr>
<tr>
<td><code>zabbix[process,alerter,avg,busy]</code></td>
<td>Notification sender load</td>
</tr>
<tr>
<td><code>zabbix[process,preprocessor,avg,busy]</code></td>
<td>Preprocessing queue usage</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If process utilization exceeds 75‚Äì80% for a sustained period, increase the
corresponding Start<Process> parameter (e.g., StartPollers, StartAlerters)
in zabbix_server.conf. A common bottleneck is the Housekeeper process, which
cleans up historical data; if it is consistently busy, database performance
will suffer significantly.</p>
</div>
<hr />
<h3 id="ch14-zabbix-maintenance-internal-health-32-queue-metrics"><strong>3.2 Queue Metrics</strong></h3>
<p>The Zabbix internal queue is the most immediate indicator of the health of the
entire monitoring pipeline. Every item check, regardless of how it's collected,
first enters this queue before being processed, pre-processed, and eventually
written to the database.</p>
<p>Monitoring the queue helps to determine whether Zabbix is keeping pace with
the influx of data. If the server is functioning correctly, the total queue
length <code>zabbix[queue,5m]</code> should remain low and stable.</p>
<p>Zabbix categorizes queued items by their delay, providing buckets for items
waiting for more than 1 minute, 5 minutes, 10 minutes (as seen
in the internal metric <code>zabbix[queue,&lt;from&gt;,&lt;to&gt;]</code> and the <code>Queue overview</code> page).
The presence of items in these high delay queues is an immediate sign of trouble,
as it means the monitoring system is collecting stale data.</p>
<table>
<thead>
<tr>
<th>Example Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>zabbix[queue,0,1s]</code></td>
<td>The count of items waiting for processing for less than</td>
</tr>
<tr>
<td></td>
<td>1 second. This represents the normal, immediate flow of the system.</td>
</tr>
<tr>
<td><code>zabbix[queue,10m]</code></td>
<td>The count of items delayed by at least 10 minutes</td>
</tr>
<tr>
<td></td>
<td>(the default to is infinity). This is the primary indicator of a severe backlog or performance bottleneck.</td>
</tr>
</tbody>
</table>
<p>If the queue grows consistently, it signals that Zabbix is falling behind. The
root cause is usually one of three things: either the data collection processes
(pollers, etc.) are undersized, the database cannot accept data quickly enough
(database write bottleneck), or the network connection between Zabbix and the
database is saturated. A rapidly growing queue should trigger an immediate
investigation.</p>
<hr />
<h3 id="ch14-zabbix-maintenance-internal-health-33-cache-and-database-performance"><strong>3.3 Cache and Database Performance</strong></h3>
<p>Zabbix relies on multiple in memory caches to operate efficiently. The primary
goal of these caches is to minimize the load on the backend database by storing
frequently accessed data, such as host inventory, item configurations, and recent
history values. If Zabbix processes need data that isn't in memory, they must
perform expensive, synchronous database queries, severely impacting the overall
throughput.</p>
<p>The most critical cache is the Configuration Cache. This cache holds the entire
monitoring setup (hosts, items, triggers, etc.). Its size is governed by the
primary CacheSize parameter in the zabbix_server.conf file. Crucially, Zabbix
does not expose a direct internal item to monitor the free space or utilization
of the Configuration Cache. Its health is inferred from general server performance
issues and related log file warnings.</p>
<p>Other essential caches, such as the History Cache and the Trend Cache, do report
their status. These provide direct visibility into memory pressure caused by data
volume processing.</p>
<table>
<thead>
<tr>
<th>Example Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>zabbix[wcache,values]</code></td>
<td>History values currently stored in write cache</td>
</tr>
<tr>
<td><code>zabbix[wcache,values,free]</code></td>
<td>Free space in the write cache</td>
</tr>
<tr>
<td><code>zabbix[rcache,buffer,free]</code></td>
<td>Free read-cache buffer</td>
</tr>
<tr>
<td><code>zabbix[values_processed]</code></td>
<td>Values processed per second</td>
</tr>
</tbody>
</table>
<p>If the free space in the History Cache (wcache,values,free) approaches zero, or
if the queue starts growing, the Zabbix server is under memory pressure. The
critical step is to increase the relevant CacheSize parameters. Specifically,
issues with the Configuration Cache are resolved by increasing the main <code>CacheSize</code>
parameter, while data processing bottlenecks are resolved by increasing parameters
like HistoryCacheSize and TrendCacheSize.</p>
<hr />
<h3 id="ch14-zabbix-maintenance-internal-health-34-general-statistics"><strong>3.4 General Statistics</strong></h3>
<p>Zabbix's internal host also provides overall system information, including:</p>
<ul>
<li>Total number of hosts, items, and triggers</li>
<li>Number of unsupported items</li>
<li>Average values processed per second</li>
<li>Event processing rate</li>
</ul>
<p>These metrics are invaluable for capacity planning and performance validation.</p>
<hr />
<h2 id="ch14-zabbix-maintenance-internal-health-4-viewing-internal-metrics"><strong>4. Viewing Internal Metrics</strong></h2>
<p>To effectively diagnose performance issues, administrators need direct access to
the collected internal data. Zabbix provides several primary ways to inspect these
internal checks, each serving a slightly different purpose:</p>
<ul>
<li>
<p>Monitoring ‚Üí Latest data ‚Üí Host: Zabbix server</p>
<ul>
<li>This is the quickest way to view the live, current values of every internal
  item associated with the Zabbix server. It's ideal for immediate troubleshooting,
  checking recent busy percentages, or confirming the current size of the item
  queue. You can apply filters here to focus on specific item groups (like
  "Queue" or "Cache") without navigating configuration screens.</li>
</ul>
</li>
<li>
<p>Configuration ‚Üí Hosts ‚Üí Zabbix server ‚Üí Items</p>
<ul>
<li>This view allows you to inspect the item configuration itself. You can verify
  the exact syntax of the internal key (e.g., zabbix[queue,10m]), check the
  collection interval, and see the full history of the item over long time periods,
  which is essential for diagnosing recurring or historical issues.</li>
</ul>
</li>
<li>
<p>Or through the official Zabbix health templates (explained below)</p>
<ul>
<li>While the two methods above provide raw data, the builtin templates offer
  the data pre organized into graphs and dashboards. This is the standard,
  visual method for monitoring health, as it allows for immediate, high level
  visualization of performance trends (e.g., "Poller utilization over the last
  24 hours") and triggers pre configured alerts. This is generally the method
  used for proactive monitoring.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="ch14-zabbix-maintenance-internal-health-5-built-in-health-templates"><strong>5. Built-in Health Templates</strong></h2>
<p>The Template App Zabbix Server is the cornerstone of Zabbix self monitoring. It
is a pre-configured solution specifically designed to monitor the operational health
of the Zabbix server process itself. It automatically links to the internal "Zabbix
server" host upon installation, providing immediate visibility into the platform's
performance without any manual item creation.</p>
<p>This template is comprehensive and provides actionable insights by collecting
metrics across several critical areas:</p>
<ul>
<li><strong>Process Utilization:</strong> Tracks the busy percentage of critical multi process
  components like pollers, trappers, alerters, and history writers. High
  utilization here is the first sign of resource bottlenecks.</li>
<li>
<p><strong>Queue Health:</strong> Monitors the delay windows (using item keys like
  zabbix[queue,1m]) to instantly identify whether Zabbix is falling behind in
  data processing.</p>
</li>
<li>
<p><strong>Cache Usage:</strong> Provides metrics on free space for essential in-memory stores
  like the History and Trend caches, helping to identify memory pressure .</p>
</li>
<li>
<p><strong>Data Throughput:</strong> Includes checks related to the rate of processed values
  (NVPS), which is essential for capacity planning and performance validation.</p>
</li>
</ul>
<p>Crucially, the template provides ready to use graphs, powerful triggers, and dashboard
widgets to visualize Zabbix's performance over time. If the template is not automatically
linked or needs to be restored, it can typically be imported from GIT:</p>
<p>`https://github.com/zabbix/zabbix/tree/master/templates/</p>
<p>The ultimate goal of this template is to ensure that the monitoring system never
fails silently.</p>
<h3 id="ch14-zabbix-maintenance-internal-health-51-template-zabbix-server-health"><strong>5.1 Template Zabbix server health</strong></h3>
<p>This template monitors all internal server metrics, including:</p>
<ul>
<li>Process utilization (pollers, trappers, alerters, etc.)</li>
<li>Queue length</li>
<li>Cache usage</li>
<li>Values processed per second</li>
</ul>
<p>It provides ready to use graphs, triggers, and dashboards to visualize Zabbix's
performance.
It is automatically linked to the <em>Zabbix server</em> host after installation.
If missing, it can be imported from:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch14-zabbix-maintenance-internal-health-__codelineno-1-1"></a>https://github.com/zabbix/zabbix/tree/master/templates/app/zabbix_server
</span></code></pre></div>
<hr />
<h3 id="ch14-zabbix-maintenance-internal-health-52-template-app-zabbix-proxy"><strong>5.2 Template App Zabbix Proxy</strong></h3>
<p>This template monitors the internal state of a <strong>Zabbix proxy</strong>.
It includes metrics for:</p>
<ul>
<li>Proxy pollers and data senders</li>
<li>Proxy queue and cache utilization</li>
<li>Items and hosts processed by the proxy</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since Zabbix <strong>7.0</strong>, proxies are automatically monitored for <em>availability</em>
(online/offline) out of the box.  However, these basic checks do <strong>not</strong>
include internal performance statistics. To collect proxy internal metrics,
you still need to:
1. Install a <strong>Zabbix agent</strong> on each proxy host.
2. Configure that agent to be <strong>monitored by the proxy itself</strong> (not by the server).</p>
</div>
<p>Only then can the <em>Template App Zabbix Proxy</em> correctly collect proxy performance
data.</p>
<hr />
<h3 id="ch14-zabbix-maintenance-internal-health-53-template-remote-zabbix-serverproxy-health"><strong>5.3 Template Remote Zabbix server/proxy health</strong></h3>
<p>The <strong>Remote Zabbix server health</strong> and <strong>Remote Zabbix proxy health</strong> templates
allow internal metrics to be collected by <em>another</em> Zabbix instance or a third
party system.</p>
<p>These templates are not related to active agents.
Instead, they expose internal statistics via the Zabbix protocol, enabling <strong>remote
supervision</strong> in distributed or multi-tenant environments.</p>
<p>Typical use cases:</p>
<ul>
<li>A service provider monitoring client Zabbix instances remotely</li>
<li>A centralized monitoring system aggregating health data from multiple independent
  Zabbix installations</li>
<li>Integration with an umbrella monitoring solution where Zabbix is not the main
  system</li>
</ul>
<hr />
<h2 id="ch14-zabbix-maintenance-internal-health-6-dashboards-and-visualization"><strong>6. Dashboards and Visualization</strong></h2>
<p>Starting from Zabbix 6.0, the <strong>Zabbix Server Health</strong> dashboard provides a
preconfigured visual overview of:</p>
<ul>
<li>Poller busy %</li>
<li>Queue size</li>
<li>Cache usage</li>
<li>Values processed per second</li>
<li>Event processing rate</li>
</ul>
<p>You can clone or extend this dashboard to track both server and proxy performance
side by side.</p>
<hr />
<h2 id="ch14-zabbix-maintenance-internal-health-7-tuning-based-on-internal-metrics"><strong>7. Tuning Based on Internal Metrics</strong></h2>
<table>
<thead>
<tr>
<th>Problem</th>
<th>Indicator</th>
<th>Recommended Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pollers &gt;80% busy</td>
<td><code>zabbix[process,poller,avg,busy]</code></td>
<td>Increase <code>StartPollers</code></td>
</tr>
<tr>
<td>Long queue</td>
<td><code>zabbix[queue,10m]</code></td>
<td>Add more pollers, tune DB</td>
</tr>
<tr>
<td>Cache nearly full</td>
<td><code>zabbix[wcache,values,free]</code></td>
<td>Increase cache parameters</td>
</tr>
<tr>
<td>Unsupported items</td>
<td><code>zabbix[items_unsupported]</code></td>
<td>Fix item keys or credentials</td>
</tr>
<tr>
<td>Proxy delay</td>
<td>Proxy internal metrics</td>
<td>Tune <code>ProxyOfflineBuffer</code> or increase sender count</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ch14-zabbix-maintenance-internal-health-8-alerting-on-internal-health"><strong>8. Alerting on Internal Health</strong></h2>
<p>Triggers can automatically warn about performance degradation.</p>
<p><strong>Example:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch14-zabbix-maintenance-internal-health-__codelineno-2-1"></a>Problem:<span class="w"> </span>avg<span class="o">(</span>/Zabbix<span class="w"> </span>server/zabbix<span class="o">[</span>process,poller,avg,busy<span class="o">]</span>,10m<span class="o">)</span>&gt;<span class="o">{</span><span class="nv">$ZABBIX</span>.SERVER.UTIL.MAX:<span class="s2">&quot;poller&quot;</span><span class="o">}</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ch14-zabbix-maintenance-internal-health-__codelineno-2-2"></a>Recovery:<span class="w"> </span>avg<span class="o">(</span>/Zabbix<span class="w"> </span>server/zabbix<span class="o">[</span>process,poller,avg,busy<span class="o">]</span>,10m<span class="o">)</span>&lt;<span class="o">{</span><span class="nv">$ZABBIX</span>.SERVER.UTIL.MIN:<span class="s2">&quot;poller&quot;</span><span class="o">}</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ch14-zabbix-maintenance-internal-health-__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ch14-zabbix-maintenance-internal-health-__codelineno-2-4"></a>Where:
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ch14-zabbix-maintenance-internal-health-__codelineno-2-5"></a>-<span class="w"> </span><span class="o">{</span><span class="nv">$ZABBIX</span>.SERVER.UTIL.MIN<span class="o">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">65</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ch14-zabbix-maintenance-internal-health-__codelineno-2-6"></a>-<span class="w"> </span><span class="o">{</span><span class="nv">$ZABBIX</span>.SERVER.UTIL.MAX<span class="o">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">75</span>
</span></code></pre></div>
<p>This will raise an event if the pollers are overloaded.
Similar triggers can be created for queues, caches, or proxy synchronization delays.</p>
<hr />
<h2 id="ch14-zabbix-maintenance-internal-health-conclusion">Conclusion</h2>
<p>Zabbix's internal health checks provide full insight into how the monitoring platform
itself performs. Combined with the built-in health templates and dashboards, these
metrics help administrators:</p>
<ul>
<li>Detect overload and capacity issues</li>
<li>Verify proxy performance</li>
<li>Tune process and cache parameters</li>
<li>Integrate Zabbix self-monitoring into broader enterprise systems</li>
</ul>
<p>By keeping the Zabbix server and proxies healthy, you ensure the reliability of
every other monitored component.</p>
<hr />
<h2 id="ch14-zabbix-maintenance-internal-health-questions">Questions</h2>
<ol>
<li>What is the purpose of the ‚ÄúZabbix server‚Äù internal host?</li>
<li>Why does Zabbix 7.0+ no longer require a special setup to detect proxy availability?</li>
<li>Why must a Zabbix proxy‚Äôs agent be monitored by the proxy itself?</li>
<li>What are the key differences between ‚ÄúTemplate App Zabbix Proxy‚Äù and ‚ÄúTemplate App Zabbix Remote‚Äù?</li>
<li>Which internal metric indicates poller utilization?</li>
<li>What can cause the item queue to grow over time?</li>
<li>How can triggers help you detect Zabbix server performance problems automatically?</li>
<li>In what scenario would you use the ‚ÄúRemote Zabbix Server Health‚Äù template?</li>
</ol>
<hr />
<h2 id="ch14-zabbix-maintenance-internal-health-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/internal">https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/internal</a></li>
</ul></section><section class="print-page" id="ch14-zabbix-maintenance-taking-backups" heading-number="19.4"><nav class='md-tags'><span class='md-tag'>advanced</span></nav><h1 id="backup-strategies">Backup strategies</h1>
<p>A logical backup is a copy of the contents of the database, usually performed as a 
dump of the contents to a single file, where as a physical backup is a copy of the
files the database consists of. A physical backup can be either consistent or
non-consistent, also called "hot". A consistent backup can be restored as is, but
a non-consistent backup has to be recovered using archived log files. Taking a 
consistent backup usually has performance implications, as all writes to the 
datafiles must be postponed for the duration of the backup. 
A logical backup can only restore data to the point in time where the dump has
been taken, while a physical backup can be recovered to any point in time using 
the archived logs. For this reason, a physical backup is a more secure and and
mature method of protecting the database when compared to a logical backup.
However, since Zabbix does not handle financial transactions, but only observations, 
alerts and similar, it is usually not a big deal, if the backups are done with
dumps instead of physical backups.
Zabbix relies heavily on the underlying database not only for the collected items
(metrics), but also for storing the Zabbix configuration we create in the Zabbix
frontend. This database should either be a MariaDB, PostgreSQL or MySQL database
in Zabbix 8.0 as those are the official production supported database types.</p>
<p>Since our history, trends and configuration data is all stored in this central
database, taking a meaningful backup of our Zabbix environment is fairly simple.
All we have to do is pick a backup method we like for our chosen database and then
use that to backup the database. Giving you a backup you can easily restore 99%
of your Zabbix environment with.</p>
<p>Easily forgotten, there are also some important configuration files and you might
even have some scripts hanging around on your filesystem that you need to backup.
The configuration files could be restored manually with not too much effort, but
those scripts could especially take a long time to restore. As such it is always
important to also backup these additional files. We will explore both the database
and file backups in this topic within the book.</p>
<p>Various options exist for creating a database backup.
Dumping the database content to a flat file is the easiest and simplest method.
Physical backups requires more effort, usually installing a backup agent and
configuring the backup software as well as configuring the database to run with 
archiving of the database logs, and continous deletion of the archived logs.
With regular backups of the database and the archived logs, a restore is possible 
to the latest committed transaction in most databases.</p>
<p>For dumping the contents of the database, various tools exists:</p>
<ul>
<li><strong><code>mariadb-dump utility</code>:</strong> This is a built-in tool shipped with MariaDB, allowing you
  to create reliable .sql file dumps of the MariaDB database. It creates a file with
  SQL statements, allowing us to restore our database.</li>
<li><strong><code>mysqldump utility</code>:</strong> This tool allows us to do the same as mariadb-dump, but is
  the official MySQL variant. Keep in mind that MariaDB and MySQL are going in
  different directions with their codebase, so it is recommended to use the right
  tool for your database.</li>
<li><strong><code>pg_dump utility</code>:</strong> PostgreSQL also has a built-in tool to allow us to create .sql
  file dumps of our PostgreSQL database. This creates a very similar .sql file with
  SQL statements, allowing us to restore our database fully.</li>
<li><strong><code>(Virtual) Machine disk snapshots</code>:</strong> There are various utilities on the market to
  create (incremental) snapshots of a database server. Some examples are snapshots
  built into Azure/Amazon AWS, Proxmox PBS server, Veeam, Rubrik and more.
  Beware, that VM disk snapshots cannot be considered safe backups of a database, as
  there is a significant chance of the data not being consistent.</li>
</ul>
<h2 id="ch14-zabbix-maintenance-taking-backups-mariadb">MariaDB</h2>
<p>Creating database dumps on MariaDB using the official <code>mariadb-dump</code> utility is
fairly simple. When we have the mariadb-client installed we should already have the 
<code>mariadb-dump</code> utility installed as well. Double-check on your Zabbix database server 
CLI with the command below.</p>
<div class="admonition info">
<p class="admonition-title">Check if mariadb-dump is installed</p>
<p>Linux
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-0-1"></a>mariadb-dump<span class="w"> </span>--version
</span></code></pre></div></p>
</div>
<p>If your get no result, try to install the MariaDB client.</p>
<div class="admonition info">
<p class="admonition-title">Install MariaDB client</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-1-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>mariadb
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-2-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>mariadb-client
</span></code></pre></div></p>
</div>
<h3 id="ch14-zabbix-maintenance-taking-backups-creating-a-logical-database-backup">Creating a Logical Database Backup</h3>
<p>If the <code>mariadb-dump</code> tool is installed, a basic dump of a Zabbix database can be 
created with a single command. The options used below are specifically chosen to 
balance consistency, performance, and compatibility during restore operations.</p>
<div class="admonition info">
<p class="admonition-title">Create a Zabbix MariaDB database backup</p>
<p>Linux
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-3-1"></a>mysqldump<span class="w"> </span>zabbix<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-3-2"></a>--add-drop-table<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-3-3"></a>--add-locks<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-3-4"></a>--extended-insert<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-3-5"></a>--single-transaction<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-3-6"></a>--quick
</span></code></pre></div></p>
</div>
<p>The <code>--single-transaction</code> option ensures a consistent snapshot for transactional
tables without locking them for extended periods, which is especially important
for active Zabbix systems. The <code>--quick</code> option reduces memory usage during the dump
process, making the dump of the database more predictable under load.</p>
<p>This will login using MariaDB Unix socket authentication and create a database
dump in your current working directory. It is also possible to pass your <code>username</code>
and <code>password</code> directly, if password-based authentication is required,</p>
<div class="admonition info">
<p class="admonition-title">Create a Zabbix MariaDB database dump with username and password</p>
<p>Linux
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-4-1"></a>mysqldump<span class="w"> </span>zabbix<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-4-2"></a>--add-drop-table<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-4-3"></a>--add-locks<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-4-4"></a>--extended-insert<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-4-5"></a>--single-transaction<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-4-6"></a>--quick<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-4-7"></a>-u&lt;USER&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-4-8"></a>-p&lt;PASSWORD&gt;<span class="w"> </span>
</span></code></pre></div></p>
</div>
<p>Keep in mind that passing plain text passwords on the CLI might not be secure.</p>
<p>One more issue with creating the database dump like this, it takes up a lot of space 
on your disk. There is one more improvement to recommend here to make sure the 
backup is created as efficiently as possible. We can compress the dump before
storing it to disk. To do this, we can install a compression tool like <code>lz4</code>.</p>
<div class="admonition info">
<p class="admonition-title">Install lz4 compression tool</p>
<p>Red Hat
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-5-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>lz4
</span></code></pre></div></p>
<p>Ubuntu
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-6-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>lz4
</span></code></pre></div></p>
</div>
<p>Using lz4, we can now compress our database dump by using a quick pipe in our
<code>mariadb-dump</code> command.</p>
<div class="admonition info">
<p class="admonition-title">Create a Zabbix MariaDB database dump with compression</p>
<p>Linux
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-7-1"></a>mysqldump<span class="w"> </span>zabbix<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-7-2"></a>--add-drop-table<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-7-3"></a>--add-locks<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-7-4"></a>--extended-insert<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-7-5"></a>--single-transaction<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-7-6"></a>--quick<span class="w"> </span><span class="p">|</span><span class="w"> </span>lz4<span class="w"> </span>&gt;<span class="w"> </span>zabbix.sql.lz4
</span></code></pre></div></p>
</div>
<p>This dump will include all tables of our <code>zabbix</code> database and compress it with lz4 
to store it as <code>zabbix.sql.lz4</code>. Keep in mind, it is always recommended to store the 
database dump somewhere away from our database server. There are several options to 
make this work in a safe manner.</p>
<ul>
<li>Attach a separate dump disk to store the dumps on (still within the same
  server however)</li>
<li>Store to separate disk and then transfer to remote storage (more secure)</li>
<li>Directly pipe the lz4 compressed data to a tool like <code>rsync</code> to send it over
  SSH to a remote storage location (takes up the least amount of duplicated
  resources)</li>
</ul>
<h3 id="ch14-zabbix-maintenance-taking-backups-limitations-of-logical-dumps">Limitations of Logical dumps</h3>
<p>While logical backups are simple and reliable, they do not scale indefinitely.
On large Zabbix installations with high data retention, dump times and restore
times can become significant. Logical backups also do not support point-in-time
recovery, meaning restores can only be performed to the moment the backup completed.</p>
<p>For this reason, logical dumps are best suited for:</p>
<ul>
<li>Small to medium-sized Zabbix installations</li>
<li>Environments with modest recovery time objectives</li>
<li>Systems without strict availability requirements</li>
</ul>
<p>Larger environments may benefit from physical or snapshot-based backup solutions,
provided database consistency is guaranteed.</p>
<h2 id="ch14-zabbix-maintenance-taking-backups-postgresql">PostgreSQL</h2>
<p>When Zabbix uses PostgreSQL as its backend database, the database becomes the most
critical component of the entire monitoring system. All configuration, state, history,
and trends are stored there, and without a usable database dump/backup, recovery of a
failed Zabbix server is effectively impossible.</p>
<p>Unlike file-based backups, PostgreSQL requires database-aware backup methods. Simply
copying the data directory while the database is running will almost certainly
result in a corrupted and unusable backup. For this reason, PostgreSQL provides
its own backup mechanisms, and choosing the correct one depends largely on the size
of the Zabbix environment and the acceptable recovery time.</p>
<h3 id="ch14-zabbix-maintenance-taking-backups-logical-dumps-with-pg_dump">Logical dumps with pg_dump</h3>
<p>The simplest way to dump a PostgreSQL database is by using pg_dump. This tool
performs a logical dump, meaning it exports the contents of the database as SQL
statements or a structured archive format.</p>
<p>For small Zabbix installations or non-production environments, pg_dump can be sufficient.
It is easy to use, requires no special PostgreSQL configuration, and produces dumps that 
are portable across systems and PostgreSQL minor versions.</p>
<p>A typical dump of a Zabbix database using pg_dump looks like this:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-8-1"></a>sudo<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>pg_dump<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-8-2"></a><span class="w">  </span>--format<span class="o">=</span>custom<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-8-3"></a><span class="w">  </span>--file<span class="o">=</span>/backup/zabbix.dump<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-8-4"></a><span class="w">  </span>zabbix
</span></code></pre></div>
<p>Restoring such a dump is equally straightforward:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-9-1"></a>sudo<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>pg_restore<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-9-2"></a><span class="w">  </span>--clean<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-9-3"></a><span class="w">  </span>--dbname<span class="o">=</span>zabbix<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-9-4"></a><span class="w">  </span>zabbix.dump
</span></code></pre></div>
<p>While convenient, dumps have important limitations in a Zabbix context. On systems 
with large history or trend tables, dumps can take a long time to complete and may 
put noticeable load on the database server. Logical dumps also do not support 
point-in-time recovery, meaning it is impossible to restore the database to a 
specific moment before a failure.</p>
<p>For these reasons, pg_dump should be viewed as an entry-level solution rather than
a long-term strategy for production Zabbix systems.</p>
<h3 id="ch14-zabbix-maintenance-taking-backups-physical-backups-and-wal-archiving">Physical Backups and WAL Archiving</h3>
<p>For medium and large Zabbix installations, physical backups are generally more
appropriate. A physical backup captures the PostgreSQL data files directly, together
with the write-ahead log (WAL) files required to replay changes. This approach
allows for significantly faster restores and enables point-in-time recovery (PITR).</p>
<p>Physical backups are usually created using pg_basebackup, while WAL files are
archived continuously in the background. From PostgreSQL‚Äôs perspective, this
is the same mechanism used for replication, which makes it both reliable and well
tested.</p>
<p>Once WAL archiving is enabled in PostgreSQL, a base backup of the Zabbix database
cluster can be taken without stopping the database. In the event of a failure,
PostgreSQL can be restored to a precise moment in time by replaying WAL files
up to the desired point.</p>
<p>This approach scales much better than logical backups and is well suited for
Zabbix installations that generate a large volume of monitoring data. However,
it requires more careful planning and disciplined retention management, as both
base backups and WAL files must be preserved consistently.</p>
<h3 id="ch14-zabbix-maintenance-taking-backups-pgbackrest-and-pgbarman-the-preferred-production-solution">PgBackRest and PgBarman: The Preferred Production Solution</h3>
<p>For production Zabbix environments, especially those with large databases or high
availability requirements, dedicated PostgreSQL backup frameworks are strongly
recommended. Among these, PgBackRest and PgBarman are the two most widely adopted
and battle-tested solutions.</p>
<p>Both tools are designed specifically for physical PostgreSQL backups with continuous
WAL archiving, providing features that go far beyond what is possible with manual base
backups. They support point-in-time recovery, enforce retention policies, and ensure
backup integrity through automated verification steps.</p>
<p>PgBackRest is often favored in environments where performance and flexibility are
key concerns. It supports full, differential, and incremental backups, efficient
compression, and parallel processing, which makes it particularly suitable for Zabbix
databases with high write rates. PgBackRest integrates well with modern PostgreSQL
high-availability setups and is commonly used in combination with cluster managers
and load balancers.</p>
<p>PgBarman, on the other hand, follows a more centralized backup model. It is typically
deployed on a dedicated backup server that manages backups for one or more PostgreSQL
instances. This approach can be attractive in environments where backup operations
must be isolated from database servers or managed by a separate operations team.
PgBarman also provides reliable WAL management and point-in-time recovery, making
it a solid choice for enterprise Zabbix installations.</p>
<p>From a Zabbix perspective, both tools solve the same fundamental problem: they allow
the PostgreSQL database to be backed up consistently while Zabbix continues to
ingest monitoring data. The choice between PgBackRest and PgBarman is usually
driven by operational preferences, existing PostgreSQL standards, and infrastructure
design rather than functional limitations.</p>
<p>Regardless of which tool is chosen, the key requirement remains the same: backups
must be automated, retained according to policy, and restored successfully during
regular testing. Either PgBackRest or PgBarman meets these requirements and should
be considered the baseline for serious, production-grade Zabbix deployments.</p>
<h3 id="ch14-zabbix-maintenance-taking-backups-backup-size-and-zabbix-data-characteristics">Backup Size and Zabbix Data Characteristics</h3>
<p>Zabbix databases grow continuously by design. History and trend tables receive
constant inserts, and without proper housekeeping, backups can quickly become very
large. This is not a backup problem but a data lifecycle issue.</p>
<p>Before designing a PostgreSQL backup strategy for Zabbix, it is important to ensure
that database retention settings are aligned with business needs. Keeping excessive
history in the database not only increases backup size but also slows down backup
and restore operations, directly affecting recovery time objectives.</p>
<p>One way to better control database growth is the use of TimescaleDB, which is supported
by Zabbix for handling historical data. By storing history and trends in hypertables,
TimescaleDB allows for more efficient data management and automated data retention
policies. This can significantly reduce the volume of data that must be retained
and, by extension, the size of database backups.</p>
<p>Another approach, typically reserved for advanced or highly specialized environments,
is to exclude history and trend tables from certain backups. In such designs, configuration
data is backed up separately from monitoring data, with the understanding that
historical metrics can be discarded or rebuilt if necessary. This reduces backup
size and restore time but comes at the cost of losing historical visibility after
a recovery.</p>
<p>A well-tuned Zabbix database, whether using native PostgreSQL tables or TimescaleDB,
combined with physical backups and WAL archiving, results in manageable backup
sizes and predictable recovery times.</p>
<h2 id="ch14-zabbix-maintenance-taking-backups-storage-and-off-host-backups">Storage and Off-Host Backups</h2>
<p>Regardless of the backup method used, storing backups exclusively on the database
server itself is insufficient. Hardware failures, filesystem corruption, or
security incidents can render both the database and its backups unusable.</p>
<p>Common approaches include:</p>
<ul>
<li>Writing backups to a dedicated backup disk</li>
<li>Transferring backups to remote storage after creation</li>
<li>Streaming compressed backups directly to a remote system over SSH</li>
</ul>
<p>The exact method is less important than ensuring that backups are stored independently
of the database server and can be accessed during a full system failure.</p>
<h3 id="ch14-zabbix-maintenance-taking-backups-hot-standby-database">Hot standby database</h3>
<p>While it is important to take a backup/dump of the database at regular intervals, 
it can be a timeconsuming task restoring this backup. For this reason, it can make
sense to maintain a standby database, which is constantly synced with the changes
that occurs in the active database, thus having a restored and recovered copy of
the database running and ready to take over, should a disaster occur on the active 
database.</p>
<h2 id="ch14-zabbix-maintenance-taking-backups-other-important-config-files">Other important (config) files</h2>
<p>Often overlooked, since we focus so much on the database, are the Zabbix configuration files and possibly custom scripts. For a full restore of your Zabbix environment, these files can not be missed as they are vital to getting Zabbix back online in case of an issue. Of course, configuration files are easy to rebuild with a bit of time. However, it is best practice to also include these to make sure a speedy restoration can happen.</p>
<p>Let's create a quick working folder to place our backups in.</p>
<div class="admonition info">
<p class="admonition-title">Create a Zabbix backup folder</p>
<p>Linux
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-10-1"></a>mkdir<span class="w"> </span>/opt/zabbix-backup/
</span></code></pre></div></p>
</div>
<p>When Zabbix is installed from packages, it will always store the configuration files in a single location. That location <code>/etc/zabbix/</code> should contain most of our important files already. We can take a manual backup with the following command.</p>
<div class="admonition info">
<p class="admonition-title">Create a Zabbix configuration files backup</p>
<p>Linux
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-11-1"></a>cp<span class="w"> </span>-R<span class="w"> </span>/etc/zabbix/*<span class="w"> </span>/opt/zabbix-backup/
</span></code></pre></div></p>
</div>
<p>You can run this command on all of your Zabbix server, Frontend, Database and Proxy hosts. This should cover the most important configuration files already, but there is another folder that could contain very important files.</p>
<div class="admonition info">
<p class="admonition-title">Create other Zabbix files backup</p>
<p>Linux
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-12-1"></a>cp<span class="w"> </span>-R<span class="w"> </span>/usr/share/zabbix/<span class="w"> </span>/opt/zabbix-backup/
</span></code></pre></div></p>
</div>
<p>The /usr/share/zabbix/ folder contains important PHP files and Zabbix binaries. A similar folder we should backup is the <code>/usr/lib/zabbix</code> folder, which contains our custom <code>alertscripts</code> and <code>externalscripts</code>.</p>
<div class="admonition info">
<p class="admonition-title">Create other Zabbix files backup</p>
<p>Linux
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-13-1"></a>cp<span class="w"> </span>-R<span class="w"> </span>/usr/lib/zabbix/<span class="w"> </span>/opt/zabbix-backup/
</span></code></pre></div></p>
</div>
<p>Lastly, it is also recommended to create a backup of your webserver configuration. Depending on if you have <code>httpd</code>, <code>apache2</code> or <code>nginx</code> we will need to create the backup slightly differently. </p>
<div class="admonition info">
<p class="admonition-title">Install MariaDB client</p>
<p>Red Hat HTTPD
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-14-1"></a>cp<span class="w"> </span>-R<span class="w"> </span>/etc/httpd/<span class="w"> </span>/opt/zabbix-backup/
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-14-2"></a>cp<span class="w"> </span>-R<span class="w"> </span>/var/www/<span class="w"> </span>/opt/zabbix-backup/
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-14-3"></a>cp<span class="w"> </span>/etc/httpd/conf.d/zabbix.conf<span class="w">  </span>/opt/zabbix-backup/<span class="w">    </span><span class="sb">```</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-14-5"></a>Ubuntu<span class="w"> </span>Apache2
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-14-6"></a><span class="sb">```</span>bash
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-14-7"></a>cp<span class="w"> </span>-R<span class="w"> </span>/etc/apache2/<span class="w"> </span>/opt/zabbix-backup/
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-14-8"></a>cp<span class="w"> </span>-R<span class="w"> </span>/var/www/<span class="w"> </span>/opt/zabbix-backup/
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-14-9"></a>cp<span class="w"> </span>/etc/httpd/conf.d/zabbix.conf<span class="w">  </span>/opt/zabbix-backup/
</span></code></pre></div></p>
<p>NGINX
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ch14-zabbix-maintenance-taking-backups-__codelineno-15-1"></a>cp<span class="w"> </span>-R<span class="w"> </span>/etc/nginx/<span class="w"> </span>/opt/zabbix-backup/
</span></code></pre></div></p>
</div>
<p>That should cover all the important files here, but they are only written to a separate folder on the same Linux server now. To create a truly resilient backup, we should write these files somewhere else. There are various solutions here as well.</p>
<ul>
<li>Write the files to <code>/opt/zabbix-backup/</code> and copy the folder to a remote location daily</li>
<li>Grab the files from the filesystem and store them in a Git repository (bonus: You get a nice diff)</li>
<li>The simple method, ...</li>
</ul>
<h2 id="ch14-zabbix-maintenance-taking-backups-conclusion">Conclusion</h2>
<p>Backing up the Zabbix database is a fundamental part of any maintenance strategy,
regardless of whether PostgreSQL or MySQL/MariaDB is used as the backend. While
the specific tools and mechanisms differ between database engines, the underlying
principles remain the same: backups must be consistent, automated, and aligned with
the size and criticality of the environment.</p>
<p>For PostgreSQL-based Zabbix installations, logical backups are suitable only for
small or non-critical systems. Larger environments benefit from physical backups
with WAL archiving, with dedicated tools such as PgBackRest or PgBarman providing
the reliability, performance, and recovery options required in production. Database
growth must be managed deliberately, whether through retention tuning, the use of
TimescaleDB, or, in advanced cases, separating configuration data from historical
data in backup design.</p>
<p>For MySQL and MariaDB backends, equivalent considerations apply. Logical dumps may
be sufficient for small systems, but physical or hot backup solutions are preferred
as data volume and availability requirements increase. Regardless of the database engine,
uncontrolled data growth directly affects backup size and recovery time and must be
addressed as part of the overall strategy.</p>
<p>Finally, a backup that has never been restored successfully cannot be considered
reliable. Regular restore testing is essential to verify backup integrity, confirm
recovery procedures, and establish realistic recovery time expectations. Only
backups that have been tested end-to-end should be trusted to protect a Zabbix
installation in production.</p>
<h2 id="ch14-zabbix-maintenance-taking-backups-questions">Questions</h2>
<ul>
<li>Why is backing up the Zabbix database sufficient to restore most of a Zabbix environment?</li>
<li>What role do WAL files play in PostgreSQL point-in-time recovery?</li>
<li>What risks exist if backups are never tested by performing a restore?</li>
<li>Why is database growth considered a data lifecycle issue rather than a backup issue?</li>
</ul>
<h2 id="ch14-zabbix-maintenance-taking-backups-useful-urls">Useful URLs</h2>
<ul>
<li>https://www.postgresql.org/docs/current/backup.html</li>
<li>https://pgbarman.org/</li>
<li>https://pgbackrest.org/</li>
<li>https://mariadb.com/docs/server/clients-and-utilities/backup-restore-and-import-clients/mariadb-dump</li>
<li>https://www.percona.com/mysql/software/percona-xtrabackup</li>
</ul></section><section class="print-page" id="ch14-zabbix-maintenance-upgrades" heading-number="19.5"><nav class='md-tags'><span class='md-tag'>advanced</span><span class='md-tag'>expert</span></nav><h1 id="zabbix-upgrades">Zabbix Upgrades</h1>
<p>Upgrading Zabbix is one of those activities every administrator knows must happen
eventually, and yet hopes to postpone just a little longer. Not because it is
particularly complex, but because it touches the one system everyone depends on
when things go wrong.</p>
<p>A monitoring system that is unavailable during an incident is not just inconvenient
it is actively harmful. This is why upgrades deserve planning, context, and restraint.</p>
<p>This chapter is not a checklist. It is a guide to understanding what actually happens
when you upgrade Zabbix, what can go wrong, and how to make sure it does not.</p>
<p><em>‚ÄúGood upgrades are quiet. Bad ones become stories.‚Äù</em></p>
<h3 id="ch14-zabbix-maintenance-upgrades-how-zabbix-really-upgrades">How Zabbix Really Upgrades</h3>
<p>Zabbix does not upgrade like some other open-source software.</p>
<p>At its core, Zabbix uses a versioned database schema. Every structural change ever
made to the database since 2.0 is recorded as a patch. When the Zabbix server
starts, it compares the current database version with the one it expects and applies
all missing patches automatically.</p>
<p>This means that a database created with Zabbix 2.0 can be upgraded directly to
Zabbix 8.0. No intermediate versions are required. No manual schema juggling is
needed.</p>
<p>This capability is powerful, and often misunderstood.</p>
<p>What matters is not the starting version of Zabbix, but whether the surrounding
system, the operating system, database engine, PHP, and optional extensions can support
the target version.</p>
<h3 id="ch14-zabbix-maintenance-upgrades-major-and-minor-upgrades-two-very-different-beasts">Major and Minor Upgrades: Two Very Different Beasts</h3>
<p>Not all upgrades deserve the same level of concern.</p>
<p>A minor upgrade for example from 8.0.1 to 8.0.8 focuses on stability. These releases
fix bugs, close security issues, and improve performance. They are usually quick,
safe, and should be applied regularly. Treating them as major events often leads
to them being postponed, which quietly increases risk over time.</p>
<p>A major upgrade, on the other hand, changes behavior. It may introduce new features,
remove deprecated ones, and almost always involves database schema changes. While
Zabbix can apply these changes automatically, the impact depends heavily on the
size of your database and the age of your installation.</p>
<p><em>‚ÄúSkipping minor upgrades is how small problems grow up unsupervised.‚Äù</em></p>
<details class="info" open="open">
<summary>Info</summary>
<p>Zabbix follows a regular release cycle for minor updates, which are generally
published on a monthly basis.</p>
</details>
<p>This book focuses on Zabbix 8.0 as the target version. Older releases matter only
in how they shape the path toward it.</p>
<h3 id="ch14-zabbix-maintenance-upgrades-the-stack-beneath-the-server">The Stack Beneath the Server</h3>
<p>Zabbix is not an island. It rests on a stack of software that evolves independently
and sometimes forces upgrades on its own schedule.</p>
<p>Operating systems reach end of life. Database engines deprecate versions. PHP moves
forward whether the frontend is ready or not. TimescaleDB introduces performance
gains and constraints in equal measure.</p>
<p>Many Zabbix upgrades are triggered not by Zabbix itself, but by one of these layers.</p>
<p>This is where many upgrades go wrong: everything changes at once.</p>
<p><strong><em>‚ÄúIf the OS, database, PHP, and Zabbix all change in the same night, you did not
perform an upgrade. You rolled the dice.‚Äù</em></strong></p>
<h4 id="ch14-zabbix-maintenance-upgrades-a-short-story-about-an-upgrade-gone-wrong">A Short Story About an Upgrade Gone Wrong</h4>
<p><strong>Consider a real-world example:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ch14-zabbix-maintenance-upgrades-__codelineno-0-1"></a>An administrator decides to upgrade an aging monitoring server. The OS is out of
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ch14-zabbix-maintenance-upgrades-__codelineno-0-2"></a>support, so it gets upgraded. The new OS ships with a newer PostgreSQL version,
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ch14-zabbix-maintenance-upgrades-__codelineno-0-3"></a>so that changes too. PHP is updated automatically as part of the process. Since
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ch14-zabbix-maintenance-upgrades-__codelineno-0-4"></a>Zabbix needs an upgrade anyway, that is done last.
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ch14-zabbix-maintenance-upgrades-__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ch14-zabbix-maintenance-upgrades-__codelineno-0-6"></a>The server starts. The database upgrade begins. Disk usage spikes. PostgreSQL
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ch14-zabbix-maintenance-upgrades-__codelineno-0-7"></a>runs out of space halfway through rebuilding indexes. The Zabbix server refuses
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ch14-zabbix-maintenance-upgrades-__codelineno-0-8"></a>to start. The frontend is broken because PHP extensions changed. Monitoring is
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ch14-zabbix-maintenance-upgrades-__codelineno-0-9"></a>down, and restoring the backup takes hours.
</span></code></pre></div>
<p>Nothing <strong>‚Äúunexpected‚Äù</strong> happened. Everything that went wrong was predictable.</p>
<p>The mistake was not technical. It was concurrent change without isolation.</p>
<h3 id="ch14-zabbix-maintenance-upgrades-why-migrations-are-often-safer-than-upgrades">Why Migrations Are Often Safer Than Upgrades</h3>
<p>For this reason, many experienced administrators prefer migration based upgrades,
especially when major versions or operating systems are involved.</p>
<p>Instead of upgrading an existing system in place, a new system is built alongside
it. The target operating system, database engine, PHP version, and Zabbix release
are installed cleanly. Only once the new environment is stable does the data move.</p>
<p>This approach has advantages that are hard to overstate. It allows testing without
pressure, rollback without panic, and validation without guessing.</p>
<p>It also forces clarity.</p>
<h3 id="ch14-zabbix-maintenance-upgrades-what-actually-makes-a-zabbix-system">What Actually Makes a Zabbix System</h3>
<p>Despite appearances, a Zabbix system consists of remarkably few moving parts.</p>
<p><strong>The database holds almost everything:</strong> configuration, history, trends, users,
permissions. Migrating the database brings the environment with it. When restored
into a new system and started with a newer Zabbix server, the schema is upgraded
automatically.</p>
<p>Configuration files matter too, but far less than many expect. Server and proxy
configuration files, alert scripts, external checks, and certificates should be
migrated deliberately, not copied blindly. Paths change. Defaults improve. Old
workarounds often become unnecessary. As an example Zabbix now support
preprocessing with JSONPath and JavaScript. This alone can reduce tons of
scripts we used before.</p>
<p>What does not deserve to follow you are old logs, temporary files, and forgotten
overrides. Migration is not just movement, it is an opportunity to let go.</p>
<p><strong><em>‚ÄúIf you copy every problem forward, you did not migrate. You embalmed.‚Äù</em></strong></p>
<h3 id="ch14-zabbix-maintenance-upgrades-time-scale-and-reality">Time, Scale, and Reality</h3>
<p>Upgrade duration has little to do with version numbers and everything to do with
data volume.</p>
<p>A small installation with a modest database may complete a major upgrade in minutes.
A large environment with years of retained history and TimescaleDB hypertables
may take hours if not days. During that time, disk I/O will spike, tables may be
locked, and patience will be tested.</p>
<p>This is normal.</p>
<p>What turns long upgrades into outages is not duration, but surprise.</p>
<p>A well planned upgrade announces its timeline in advance. A poorly planned one
discovers it in production.</p>
<h4 id="ch14-zabbix-maintenance-upgrades-a-crucial-detour-primary-keys-and-database-health">A Crucial Detour: Primary Keys and Database Health</h4>
<p>At some point in every long running Zabbix installation, performance questions
arise. Queries get slower. Housekeeping takes longer. Vacuuming or optimization
jobs begin to dominate maintenance windows. Very often, the root cause is not
hardware, scale, or even Zabbix itself.</p>
<p>It is missing or late added primary keys.</p>
<p>Historically, early Zabbix versions did not enforce primary keys on all large tables.
This was not negligence it reflected the realities of database engines and workloads at the
time. As Zabbix evolved, so did its expectations of the database beneath it.</p>
<p>Modern Zabbix versions rely heavily on primary keys to ensure:</p>
<ul>
<li>Efficient housekeeping</li>
<li>Predictable query plans</li>
<li>Safe parallel operations</li>
<li>TimescaleDB compatibility</li>
</ul>
<p>Adding them late is possible, but it is not free.</p>
<p><strong><em>‚ÄúA database without primary keys works‚Ä¶ until it really, really doesn't.‚Äù</em></strong></p>
<h4 id="ch14-zabbix-maintenance-upgrades-why-primary-keys-matter-more-during-upgrades">Why Primary Keys Matter More During Upgrades</h4>
<p>Database upgrades and migrations are moments of maximum leverage. Tables are already
being rewritten, indexes rebuilt, and metadata refreshed. This makes them the ideal
time to correct structural debt.</p>
<p>Adding primary keys to large Zabbix tables on a live production system can be
disruptive. Doing so during an upgrade or migration often costs little more than
patience.</p>
<p>This is why Zabbix documents primary key enforcement so explicitly: it is not a
theoretical best practice, it is a practical necessity for modern workloads.</p>
<p>If your database still lacks required primary keys, an upgrade is not just an
opportunity to add them, it is the safest time you will ever get.</p>
<h4 id="ch14-zabbix-maintenance-upgrades-database-engines-are-not-neutral-observers">Database Engines Are Not Neutral Observers</h4>
<p>database does not exist in a vacuum. It may feel self contained once it is running,
but it is quietly shaped by the operating system beneath it, sometimes in ways that
only become visible years later.</p>
<p>One of the most striking examples of this is the C standard library.</p>
<p>Database engines rely on the system‚Äôs C library for fundamental operations such as
string comparison, sorting, and collation. When that library changes, the rules of
order can change with it. What was considered correctly sorted yesterday may no
longer be considered correct tomorrow.</p>
<p>This is not hypothetical.</p>
<p>During major Linux distribution upgrades such as the transition from CentOS 6 to 7,
or across certain Ubuntu releases the underlying C library changed its collation
behavior. Databases that were perfectly healthy before the upgrade suddenly contained
indexes that no longer matched the new sorting rules.</p>
<p>Nothing was ‚Äúbroken‚Äù. Queries still worked. Data was still there. But indexes were
now built on assumptions that no longer held true.</p>
<p>The only correct response in such situations is a rebuild.</p>
<p>That is why database upgrades that coincide with operating system changes often
benefit from index rebuilds, table rewrites, or full reindexing operations. Not
because the database engine failed, but because the environment it depends on has
evolved.</p>
<p><strong><em>‚ÄúA database upgraded without reindexing is carrying yesterday‚Äôs sorting rules
into today's system.‚Äù</em></strong></p>
<p><strong>Ignoring this can lead to subtle and difficult-to-diagnose issues:</strong> degraded
performance, unexpected query plans, or in rare cases, incorrect index usage.
These problems do not announce themselves loudly. They simply erode confidence
over time.</p>
<p>Reindexing after a major OS or database upgrade is not superstition. It is an
acknowledgement that databases inherit behavior from the systems they run on and
that those systems do change.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>Historically, major upgrades of CentOS, Ubuntu, and SUSE Linux Enterprise have 
all introduced updates to core system libraries, including the C standard library.
In some cases, these updates altered collation and sorting behavior in ways that
directly affected database indexes.</p>
</details>
<h4 id="ch14-zabbix-maintenance-upgrades-postgresql-upgrade-and-migration-strategies">PostgreSQL: Upgrade and Migration Strategies</h4>
<p>PostgreSQL offers administrators an unusual degree of flexibility when it comes to
upgrades. That flexibility is a strength but only if it is understood.</p>
<p>For smaller Zabbix installations, the most straightforward approach is often a
logical dump and restore. A new PostgreSQL version is installed, data is exported
from the old system, and restored into the new one. This method is slow, sometimes
painfully so, but it has one decisive advantage: every table, index, and object is
rebuilt from scratch using the new database engine and the current system libraries.</p>
<p>It is difficult to carry historical baggage through a dump and restore, which is
precisely why it remains such a reliable option.</p>
<p>Larger environments tend to follow a different path. When databases grow to hundreds
of gigabytes or more, full logical restores become impractical. In these cases,
PostgreSQL‚Äôs native upgrade tooling is often used to perform an in-place upgrade.</p>
<p>This is where installing multiple PostgreSQL versions side by side becomes important.</p>
<p>Tools such as pg_upgrade rely on having both the old and the new PostgreSQL binaries
available at the same time. By explicitly controlling which binaries operate on a
given data directory, administrators can perform a fast upgrade while preserving
the existing data layout. When executed correctly, this approach dramatically reduces
downtime compared to logical migrations.</p>
<p>Some teams take this one step further by carefully structuring filesystem layouts
or using symbolic links to ensure that data directories remain stable while binaries
change around them. This is not casual administration, it requires discipline, documentation,
and rehearsals but it allows upgrades to be repeatable and predictable even at scale.</p>
<p><strong><em>‚ÄúFast upgrades are never accidental. They are designed long before they are needed.‚Äù</em></strong></p>
<p>Regardless of the chosen method, PostgreSQL upgrades benefit enormously from a few
consistent practices.</p>
<p>Testing the upgrade process on a restored copy of the database removes uncertainty.
Performing explicit reindexing after major operating system or engine upgrades ensures
that indexes reflect the behavior of the new environment. Verifying extensions
particularly TimescaleDB before starting Zabbix prevents avoidable startup failures.</p>
<p>PostgreSQL provides the tools to upgrade safely. The challenge lies not in choosing
the fastest method, but in choosing the one that matches the size, risk tolerance,
and operational maturity of your environment.</p>
<h4 id="ch14-zabbix-maintenance-upgrades-mariadb-and-mysql-different-tools-same-principles">MariaDB and MySQL: Different Tools, Same Principles</h4>
<p>MariaDB and MySQL follow a different philosophy, but the fundamentals remain unchanged.</p>
<p>Major engine upgrades should be treated as database migrations, not package updates.
Replication can be used to great advantage here: upgrading a replica first, validating
behavior, and only then promoting it.</p>
<p>This approach reduces downtime and provides a clean rollback path.</p>
<p>Primary key enforcement, index health, and collation consistency deserve special
care in these environments. What works adequately on smaller systems can degrade
sharply at scale.</p>
<h4 id="ch14-zabbix-maintenance-upgrades-replication-as-an-upgrade-tool">Replication as an Upgrade Tool</h4>
<p>Replication is often discussed only in the context of high availability, but its
value goes far beyond failover. Used correctly, replication is one of the most
powerful tools available for safe upgrades.</p>
<p>Whether using PostgreSQL replication or MariaDB replicas, maintaining a secondary
system allows administrators to observe the effects of an upgrade without putting
production at risk. Schema changes can be applied and evaluated, performance
characteristics measured, and perhaps most importantly the true duration of the
upgrade can be understood before it matters.</p>
<p>Only once the replica behaves exactly as expected does the primary system change.</p>
<p>This transforms upgrades from leaps of faith into rehearsed procedures.</p>
<p><strong><em>‚ÄúIf you have a replica and didn't test the upgrade on it first, you skipped
the best gift you were given.‚Äù</em></strong></p>
<h5 id="ch14-zabbix-maintenance-upgrades-logical-replication-and-near-zero-downtime">Logical Replication and Near-Zero Downtime</h5>
<p><strong>PostgreSQL adds another powerful option:</strong> logical replication.</p>
<p>Unlike physical replication, logical replication works at the level of database
changes rather than raw data files. This makes it possible to replicate data between:</p>
<ul>
<li>Different PostgreSQL major versions</li>
<li>Different database layouts</li>
<li>Even different operating systems</li>
</ul>
<p>In upgrade scenarios, this opens the door to near zero downtime migrations.</p>
<p>A new system can be built with the target PostgreSQL version, operating system,
and Zabbix release. Data is streamed continuously from the old system into the
new one while production remains fully active. When the time comes to switch over,
downtime is reduced to the moment required to stop writes, let replication catch
up, and redirect the application.</p>
<p>This approach requires more planning and careful validation, but it fundamentally
changes what ‚Äúupgrade downtime‚Äù means especially for large installations where
traditional upgrades would take hours.</p>
<p>MariaDB offers similar concepts through replication and online schema changes,
though the mechanisms differ. The underlying idea remains the same: decouple
data movement from service interruption.</p>
<p><strong><em>‚ÄúThe fastest upgrade is the one that finishes before users notice it
started.‚Äù</em></strong></p>
<h5 id="ch14-zabbix-maintenance-upgrades-when-replication-is-the-right-choice">When Replication Is the Right Choice</h5>
<p>Replication-based upgrades shine when:</p>
<ul>
<li>Databases are large</li>
<li>Downtime windows are small</li>
<li>OS or major database versions are changing</li>
<li>A clean separation between old and new systems is desired</li>
</ul>
<p>They also impose discipline. Replication setups must be monitored, understood,
and tested long before an upgrade is planned. This is not a last minute solution
but when available, it is one of the safest ones.</p>
<h5 id="ch14-zabbix-maintenance-upgrades-bringing-it-back-to-zabbix">Bringing It Back to Zabbix</h5>
<p>For Zabbix, replication based upgrades are particularly attractive. Configuration
data changes slowly. History and trends are append-only. This makes the data model
well suited to replication strategies.</p>
<p>Used correctly, replication allows Zabbix upgrades to feel less like maintenance
windows and more like controlled transitions.</p>
<p><em>And that, ultimately, is the goal !</em></p>
<h3 id="ch14-zabbix-maintenance-upgrades-the-frontend-as-an-early-warning">The Frontend as an Early Warning</h3>
<p><strong>One often overlooked lesson:</strong> the Zabbix frontend is your canary.</p>
<p>After OS or PHP changes, the frontend is usually the first thing to break. When
it does, it is a signal not an inconvenience. It tells you something in the
environment is no longer aligned.</p>
<p>If the frontend is unhealthy, do not proceed with the server upgrade. Fix the
stack first. Zabbix itself is rarely the problem.</p>
<h3 id="ch14-zabbix-maintenance-upgrades-choosing-the-right-approach">Choosing the Right Approach</h3>
<p>There is no universal rule that says every upgrade must be done in place, nor
that every system requires migration. The decision depends on scale, risk tolerance,
and what else is changing at the same time.</p>
<p>Minor upgrades should be routine. Major upgrades should be deliberate. Operating
system changes should be treated with respect. Database and TimescaleDB upgrades
should never be rushed.</p>
<p>Above all, changes should be isolated whenever possible.</p>
<h2 id="ch14-zabbix-maintenance-upgrades-conclusion">Conclusion</h2>
<p>Zabbix upgrades have a reputation they do not deserve. The software itself is
capable, conservative, and predictable. When upgrades fail, it is almost always
because too many things changed at once, or because preparation was mistaken for
pessimism.</p>
<p><strong><em>‚ÄúMost upgrade failures are not technical. They are scheduling decisions.‚Äù</em></strong></p>
<p>Treat upgrades as part of system lifecycle management, not emergency surgery. Plan
them, rehearse them, and let them be boring.</p>
<p>Because when your monitoring system needs attention, it is already too late to
learn how it works.</p>
<h2 id="ch14-zabbix-maintenance-upgrades-questions">Questions</h2>
<ul>
<li>What is the fundamental difference between a major and a minor Zabbix upgrade,
  and why does it matter when planning downtime?</li>
<li>Why does Zabbix not require incremental upgrades between major versions, and
  what role does the database play in this process?</li>
<li>Which components of the stack should be considered before upgrading Zabbix itself,
  and why can upgrading them all at once be risky?</li>
<li>What problems can arise when upgrading an operating system without rebuilding
  database indexes?</li>
</ul>
<h2 id="ch14-zabbix-maintenance-upgrades-useful-urls">Useful URLs</h2>
<ul>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/installation/upgrade">https://www.zabbix.com/documentation/current/en/manual/installation/upgrade</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/appendix/install/db_primary_keys">https://www.zabbix.com/documentation/current/en/manual/appendix/install/db_primary_keys</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/appendix/install/db_scripts">https://www.zabbix.com/documentation/current/en/manual/appendix/install/db_scripts</a></li>
<li></li>
</ul></section></section>
                    <section class='print-page md-section' id='section-20' heading-number='20'>
                        <h1>Chapter 15 : Real world examples<a class='headerlink' href='#section-20' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="ch15-zabbix-real-world-examples-chapter" heading-number="20.1"><h1 id="ch15-zabbix-real-world-examples-chapter-zabbix-real-world-examples">Zabbix real world examples</h1>
<p>In this book we have learned a lot about our Zabbix environment, but most of it is building the foundation to start doing it on your own. From time to time you will encounter an implementation in a Zabbix environment that uses out of the box thinking or is just so simple you can't believe you never thought of it.</p>
<p>This chapter aims to provide you a collection of interesting things people have built and things you absolutely have to know exist. </p></section><section class="print-page" id="ch15-zabbix-real-world-examples-disk-health-windows" heading-number="20.2"><nav class='md-tags'><span class='md-tag'>beginner</span></nav><h1 id="disk-health-monitoring-on-windows-with-smartmontools">Disk Health Monitoring on Windows with Smartmontools</h1>
<p>This guide explains how to enable monitoring of the disk ‚Äúhealth‚Äù (temperature,
errors, wear level, alerts) on Windows computers using Zabbix + Smartmontools.</p>
<h2 id="ch15-zabbix-real-world-examples-disk-health-windows-install-zabbix-agent-2-required">Install Zabbix Agent 2 (required)</h2>
<p>To use Smartmontools with Zabbix, you must install Zabbix Agent 2. The standard
Zabbix Agent does not support this functionality</p>
<p><a href="https://cdn.zabbix.com/zabbix/binaries/stable/8.0/latest/">https://cdn.zabbix.com/zabbix/binaries/stable/8.0/latest/</a></p>
<p>During installation:</p>
<ul>
<li>Enter the Raspberry Pi IP address (your Zabbix Proxy) in both fields that request
  the server IP.</li>
<li>Complete the installation normally.</li>
</ul>
<p><img alt="smarttools/ch15_01_agent_config.jpg" src="../ch15-zabbix-real-world-examples/smarttools/ch15_01_agent_config.jpg" />
<em>15.1_agent_config</em></p>
<h2 id="ch15-zabbix-real-world-examples-disk-health-windows-set-the-agent-service-to-automatic-start">Set the Agent service to automatic start</h2>
<p>In Windows:</p>
<ul>
<li>Open Services</li>
<li>Find Zabbix Agent 2</li>
<li>Right-click ‚Üí Properties</li>
<li>Set Startup type to Automatic</li>
<li>Click Start if the service is not already running This ensures</li>
</ul>
<p>monitoring continues after PC restarts</p>
<p><img alt="smarttools/ch15_02_services.jpg" src="../ch15-zabbix-real-world-examples/smarttools/ch15_02_services.jpg" />
<em>15.2 Configure Services</em></p>
<h2 id="ch15-zabbix-real-world-examples-disk-health-windows-test-smartmontools">Test Smartmontools</h2>
<p>Download the smartmontools latest version. Ex: smartmontools-7.5.win32-setup.exe</p>
<p><a href="https://github.com/smartmontools/smartmontools/releases/">https://github.com/smartmontools/smartmontools/releases/</a></p>
<p>After installing Smartmontools, open Command Prompt (CMD) and run:</p>
<p><code>smartctl.exe -a /dev/sdX (where sdX is the name of your diskdrive)</code></p>
<p>If everything is correct, it will display detailed information about your SSD/HDD
such as temperature, usage hours, alerts, and more.</p>
<p><img alt="smarttools/ch15_03_smartmontool.jpg" src="../ch15-zabbix-real-world-examples/smarttools/ch15_03_smartmontool.jpg" />
<em>15.3 Smartmontools</em></p>
<h2 id="ch15-zabbix-real-world-examples-disk-health-windows-configure-the-smart-plugin-in-zabbix-agent-2">Configure the Smart plugin in Zabbix Agent 2</h2>
<p>Locate the plugin configuration folder:</p>
<ul>
<li>C:\Program Files\Zabbix Agent 2\zabbix_agent2.d\plugins.d</li>
<li>Open the file smart.conf using Notepad as Administrator, then add the following line:<ul>
<li>Plugins.Smart.Path=C:\PROGRA~1\smartmontools\bin\smartctl.exe Save and close the file.</li>
</ul>
</li>
</ul>
<p><img alt="smarttools/ch15_04_plugins.jpg" src="../ch15-zabbix-real-world-examples/smarttools/ch15_04_plugins.jpg" />
<em>15.4 Plugins</em></p>
<p><img alt="smarttools/ch15_05_plugins.jpg" src="../ch15-zabbix-real-world-examples/smarttools/ch15_05_plugins.jpg" />
<em>15.5 plugin config</em></p>
<h2 id="ch15-zabbix-real-world-examples-disk-health-windows-test-communication-between-zabbix-agent-2-and-smartmontools">Test communication between Zabbix Agent 2 and Smartmontools</h2>
<p>Inside the Zabbix Agent 2 installation folder, run: zabbix_agent2.exe -t smart.disk.get
If successful, it will return the disk information that will be sent to Zabbix.</p>
<p><img alt="smarttools/ch15_06_communication.jpg" src="../ch15-zabbix-real-world-examples/smarttools/ch15_06_communication.jpg" />
<em>15.6 communication check</em></p>
<h2 id="ch15-zabbix-real-world-examples-disk-health-windows-configure-it-in-the-zabbix-web-interface">Configure it in the Zabbix Web Interface</h2>
<p>In Zabbix do the following steps:</p>
<ul>
<li>Open the Host you want to monitor (Data collection -&gt; Hosts)</li>
<li>Go to Templates</li>
<li>Add the following template:</li>
</ul>
<p><img alt="smarttools/ch15_07_host-add.jpg" src="../ch15-zabbix-real-world-examples/smarttools/ch15_07_host-add.jpg" />
<em>15.7 Host add</em></p>
<p>Wait 1‚Äì5 minutes for Zabbix to automatically detect the disk sensors and metrics.
If it does not detect anything:</p>
<ul>
<li>Restart the Zabbix Agent 2 service in Windows</li>
<li>Execute the discovery rule<ul>
<li>Wait a few more minutes</li>
</ul>
</li>
</ul>
<p>After collecting all the data, Zabbix will display all relevant disk health data, such as:</p>
<ul>
<li>Temperature</li>
<li>SMART errors</li>
<li>Wear level</li>
<li>Critical alerts</li>
<li>Read/Write status</li>
<li>Estimated disk lifespan</li>
</ul>
<p>Let's have a look at our latest data page. Monitoring -&gt; Latest data.</p>
<p><img alt="smarttools/ch15_08_latestdata.jpg" src="../ch15-zabbix-real-world-examples/smarttools/ch15_08_latestdata.jpg" /></p>
<p><em>15.8 latest data</em></p></section></section></div><style>.print-site-enumerate-headings #index > h1:before { content: '1 ' }

                .print-site-enumerate-headings #index h2:before { content: '1.' counter(counter-index-2) ' ' }
                .print-site-enumerate-headings #index h2 {  counter-reset: counter-index-3  counter-index-4  counter-index-5  counter-index-6 ;  counter-increment: counter-index-2 }
            
                .print-site-enumerate-headings #index h3:before { content: '1.' counter(counter-index-2) '.' counter(counter-index-3) ' ' }
                .print-site-enumerate-headings #index h3 {  counter-reset: counter-index-4  counter-index-5  counter-index-6 ;  counter-increment: counter-index-3 }
            
                .print-site-enumerate-headings #index h4:before { content: '1.' counter(counter-index-2) '.' counter(counter-index-3) '.' counter(counter-index-4) ' ' }
                .print-site-enumerate-headings #index h4 {  counter-reset: counter-index-5  counter-index-6 ;  counter-increment: counter-index-4 }
            
                .print-site-enumerate-headings #index h5:before { content: '1.' counter(counter-index-2) '.' counter(counter-index-3) '.' counter(counter-index-4) '.' counter(counter-index-5) ' ' }
                .print-site-enumerate-headings #index h5 {  counter-reset: counter-index-6 ;  counter-increment: counter-index-5 }
            
                .print-site-enumerate-headings #index h6:before { content: '1.' counter(counter-index-2) '.' counter(counter-index-3) '.' counter(counter-index-4) '.' counter(counter-index-5) '.' counter(counter-index-6) ' ' }
                .print-site-enumerate-headings #index h6 {  counter-increment: counter-index-6 }
            
.print-site-enumerate-headings #guidelines > h1:before { content: '2 ' }

                .print-site-enumerate-headings #guidelines h2:before { content: '2.' counter(counter-guidelines-2) ' ' }
                .print-site-enumerate-headings #guidelines h2 {  counter-reset: counter-guidelines-3  counter-guidelines-4  counter-guidelines-5  counter-guidelines-6 ;  counter-increment: counter-guidelines-2 }
            
                .print-site-enumerate-headings #guidelines h3:before { content: '2.' counter(counter-guidelines-2) '.' counter(counter-guidelines-3) ' ' }
                .print-site-enumerate-headings #guidelines h3 {  counter-reset: counter-guidelines-4  counter-guidelines-5  counter-guidelines-6 ;  counter-increment: counter-guidelines-3 }
            
                .print-site-enumerate-headings #guidelines h4:before { content: '2.' counter(counter-guidelines-2) '.' counter(counter-guidelines-3) '.' counter(counter-guidelines-4) ' ' }
                .print-site-enumerate-headings #guidelines h4 {  counter-reset: counter-guidelines-5  counter-guidelines-6 ;  counter-increment: counter-guidelines-4 }
            
                .print-site-enumerate-headings #guidelines h5:before { content: '2.' counter(counter-guidelines-2) '.' counter(counter-guidelines-3) '.' counter(counter-guidelines-4) '.' counter(counter-guidelines-5) ' ' }
                .print-site-enumerate-headings #guidelines h5 {  counter-reset: counter-guidelines-6 ;  counter-increment: counter-guidelines-5 }
            
                .print-site-enumerate-headings #guidelines h6:before { content: '2.' counter(counter-guidelines-2) '.' counter(counter-guidelines-3) '.' counter(counter-guidelines-4) '.' counter(counter-guidelines-5) '.' counter(counter-guidelines-6) ' ' }
                .print-site-enumerate-headings #guidelines h6 {  counter-increment: counter-guidelines-6 }
            
.print-site-enumerate-headings #tags > h1:before { content: '3 ' }

                .print-site-enumerate-headings #tags h2:before { content: '3.' counter(counter-tags-2) ' ' }
                .print-site-enumerate-headings #tags h2 {  counter-reset: counter-tags-3  counter-tags-4  counter-tags-5  counter-tags-6 ;  counter-increment: counter-tags-2 }
            
                .print-site-enumerate-headings #tags h3:before { content: '3.' counter(counter-tags-2) '.' counter(counter-tags-3) ' ' }
                .print-site-enumerate-headings #tags h3 {  counter-reset: counter-tags-4  counter-tags-5  counter-tags-6 ;  counter-increment: counter-tags-3 }
            
                .print-site-enumerate-headings #tags h4:before { content: '3.' counter(counter-tags-2) '.' counter(counter-tags-3) '.' counter(counter-tags-4) ' ' }
                .print-site-enumerate-headings #tags h4 {  counter-reset: counter-tags-5  counter-tags-6 ;  counter-increment: counter-tags-4 }
            
                .print-site-enumerate-headings #tags h5:before { content: '3.' counter(counter-tags-2) '.' counter(counter-tags-3) '.' counter(counter-tags-4) '.' counter(counter-tags-5) ' ' }
                .print-site-enumerate-headings #tags h5 {  counter-reset: counter-tags-6 ;  counter-increment: counter-tags-5 }
            
                .print-site-enumerate-headings #tags h6:before { content: '3.' counter(counter-tags-2) '.' counter(counter-tags-3) '.' counter(counter-tags-4) '.' counter(counter-tags-5) '.' counter(counter-tags-6) ' ' }
                .print-site-enumerate-headings #tags h6 {  counter-increment: counter-tags-6 }
            
.print-site-enumerate-headings #supporters-contributors > h1:before { content: '4 ' }

                .print-site-enumerate-headings #supporters-contributors h2:before { content: '4.' counter(counter-supporters-contributors-2) ' ' }
                .print-site-enumerate-headings #supporters-contributors h2 {  counter-reset: counter-supporters-contributors-3  counter-supporters-contributors-4  counter-supporters-contributors-5  counter-supporters-contributors-6 ;  counter-increment: counter-supporters-contributors-2 }
            
                .print-site-enumerate-headings #supporters-contributors h3:before { content: '4.' counter(counter-supporters-contributors-2) '.' counter(counter-supporters-contributors-3) ' ' }
                .print-site-enumerate-headings #supporters-contributors h3 {  counter-reset: counter-supporters-contributors-4  counter-supporters-contributors-5  counter-supporters-contributors-6 ;  counter-increment: counter-supporters-contributors-3 }
            
                .print-site-enumerate-headings #supporters-contributors h4:before { content: '4.' counter(counter-supporters-contributors-2) '.' counter(counter-supporters-contributors-3) '.' counter(counter-supporters-contributors-4) ' ' }
                .print-site-enumerate-headings #supporters-contributors h4 {  counter-reset: counter-supporters-contributors-5  counter-supporters-contributors-6 ;  counter-increment: counter-supporters-contributors-4 }
            
                .print-site-enumerate-headings #supporters-contributors h5:before { content: '4.' counter(counter-supporters-contributors-2) '.' counter(counter-supporters-contributors-3) '.' counter(counter-supporters-contributors-4) '.' counter(counter-supporters-contributors-5) ' ' }
                .print-site-enumerate-headings #supporters-contributors h5 {  counter-reset: counter-supporters-contributors-6 ;  counter-increment: counter-supporters-contributors-5 }
            
                .print-site-enumerate-headings #supporters-contributors h6:before { content: '4.' counter(counter-supporters-contributors-2) '.' counter(counter-supporters-contributors-3) '.' counter(counter-supporters-contributors-4) '.' counter(counter-supporters-contributors-5) '.' counter(counter-supporters-contributors-6) ' ' }
                .print-site-enumerate-headings #supporters-contributors h6 {  counter-increment: counter-supporters-contributors-6 }
            
.print-site-enumerate-headings #section-5 > h1:before { content: '5 ' }
.print-site-enumerate-headings #ch00-getting-started-initial-steps > h1:before { content: '5.1 ' }

                .print-site-enumerate-headings #ch00-getting-started-initial-steps h2:before { content: '5.1.' counter(counter-ch00-getting-started-initial-steps-2) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-initial-steps h2 {  counter-reset: counter-ch00-getting-started-initial-steps-3  counter-ch00-getting-started-initial-steps-4  counter-ch00-getting-started-initial-steps-5 ;  counter-increment: counter-ch00-getting-started-initial-steps-2 }
            
                .print-site-enumerate-headings #ch00-getting-started-initial-steps h3:before { content: '5.1.' counter(counter-ch00-getting-started-initial-steps-2) '.' counter(counter-ch00-getting-started-initial-steps-3) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-initial-steps h3 {  counter-reset: counter-ch00-getting-started-initial-steps-4  counter-ch00-getting-started-initial-steps-5 ;  counter-increment: counter-ch00-getting-started-initial-steps-3 }
            
                .print-site-enumerate-headings #ch00-getting-started-initial-steps h4:before { content: '5.1.' counter(counter-ch00-getting-started-initial-steps-2) '.' counter(counter-ch00-getting-started-initial-steps-3) '.' counter(counter-ch00-getting-started-initial-steps-4) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-initial-steps h4 {  counter-reset: counter-ch00-getting-started-initial-steps-5 ;  counter-increment: counter-ch00-getting-started-initial-steps-4 }
            
                .print-site-enumerate-headings #ch00-getting-started-initial-steps h5:before { content: '5.1.' counter(counter-ch00-getting-started-initial-steps-2) '.' counter(counter-ch00-getting-started-initial-steps-3) '.' counter(counter-ch00-getting-started-initial-steps-4) '.' counter(counter-ch00-getting-started-initial-steps-5) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-initial-steps h5 {  counter-increment: counter-ch00-getting-started-initial-steps-5 }
            
.print-site-enumerate-headings #ch00-getting-started-requirements > h1:before { content: '5.2 ' }

                .print-site-enumerate-headings #ch00-getting-started-requirements h2:before { content: '5.2.' counter(counter-ch00-getting-started-requirements-2) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-requirements h2 {  counter-reset: counter-ch00-getting-started-requirements-3  counter-ch00-getting-started-requirements-4  counter-ch00-getting-started-requirements-5 ;  counter-increment: counter-ch00-getting-started-requirements-2 }
            
                .print-site-enumerate-headings #ch00-getting-started-requirements h3:before { content: '5.2.' counter(counter-ch00-getting-started-requirements-2) '.' counter(counter-ch00-getting-started-requirements-3) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-requirements h3 {  counter-reset: counter-ch00-getting-started-requirements-4  counter-ch00-getting-started-requirements-5 ;  counter-increment: counter-ch00-getting-started-requirements-3 }
            
                .print-site-enumerate-headings #ch00-getting-started-requirements h4:before { content: '5.2.' counter(counter-ch00-getting-started-requirements-2) '.' counter(counter-ch00-getting-started-requirements-3) '.' counter(counter-ch00-getting-started-requirements-4) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-requirements h4 {  counter-reset: counter-ch00-getting-started-requirements-5 ;  counter-increment: counter-ch00-getting-started-requirements-4 }
            
                .print-site-enumerate-headings #ch00-getting-started-requirements h5:before { content: '5.2.' counter(counter-ch00-getting-started-requirements-2) '.' counter(counter-ch00-getting-started-requirements-3) '.' counter(counter-ch00-getting-started-requirements-4) '.' counter(counter-ch00-getting-started-requirements-5) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-requirements h5 {  counter-increment: counter-ch00-getting-started-requirements-5 }
            
.print-site-enumerate-headings #ch00-getting-started-preparation > h1:before { content: '5.3 ' }

                .print-site-enumerate-headings #ch00-getting-started-preparation h2:before { content: '5.3.' counter(counter-ch00-getting-started-preparation-2) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-preparation h2 {  counter-reset: counter-ch00-getting-started-preparation-3  counter-ch00-getting-started-preparation-4  counter-ch00-getting-started-preparation-5 ;  counter-increment: counter-ch00-getting-started-preparation-2 }
            
                .print-site-enumerate-headings #ch00-getting-started-preparation h3:before { content: '5.3.' counter(counter-ch00-getting-started-preparation-2) '.' counter(counter-ch00-getting-started-preparation-3) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-preparation h3 {  counter-reset: counter-ch00-getting-started-preparation-4  counter-ch00-getting-started-preparation-5 ;  counter-increment: counter-ch00-getting-started-preparation-3 }
            
                .print-site-enumerate-headings #ch00-getting-started-preparation h4:before { content: '5.3.' counter(counter-ch00-getting-started-preparation-2) '.' counter(counter-ch00-getting-started-preparation-3) '.' counter(counter-ch00-getting-started-preparation-4) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-preparation h4 {  counter-reset: counter-ch00-getting-started-preparation-5 ;  counter-increment: counter-ch00-getting-started-preparation-4 }
            
                .print-site-enumerate-headings #ch00-getting-started-preparation h5:before { content: '5.3.' counter(counter-ch00-getting-started-preparation-2) '.' counter(counter-ch00-getting-started-preparation-3) '.' counter(counter-ch00-getting-started-preparation-4) '.' counter(counter-ch00-getting-started-preparation-5) ' ' }
                .print-site-enumerate-headings #ch00-getting-started-preparation h5 {  counter-increment: counter-ch00-getting-started-preparation-5 }
            
.print-site-enumerate-headings #section-6 > h1:before { content: '6 ' }
.print-site-enumerate-headings #ch01-zabbix-components-chapter > h1:before { content: '6.1 ' }

                .print-site-enumerate-headings #ch01-zabbix-components-chapter h2:before { content: '6.1.' counter(counter-ch01-zabbix-components-chapter-2) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-chapter h2 {  counter-reset: counter-ch01-zabbix-components-chapter-3  counter-ch01-zabbix-components-chapter-4  counter-ch01-zabbix-components-chapter-5 ;  counter-increment: counter-ch01-zabbix-components-chapter-2 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-chapter h3:before { content: '6.1.' counter(counter-ch01-zabbix-components-chapter-2) '.' counter(counter-ch01-zabbix-components-chapter-3) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-chapter h3 {  counter-reset: counter-ch01-zabbix-components-chapter-4  counter-ch01-zabbix-components-chapter-5 ;  counter-increment: counter-ch01-zabbix-components-chapter-3 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-chapter h4:before { content: '6.1.' counter(counter-ch01-zabbix-components-chapter-2) '.' counter(counter-ch01-zabbix-components-chapter-3) '.' counter(counter-ch01-zabbix-components-chapter-4) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-chapter h4 {  counter-reset: counter-ch01-zabbix-components-chapter-5 ;  counter-increment: counter-ch01-zabbix-components-chapter-4 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-chapter h5:before { content: '6.1.' counter(counter-ch01-zabbix-components-chapter-2) '.' counter(counter-ch01-zabbix-components-chapter-3) '.' counter(counter-ch01-zabbix-components-chapter-4) '.' counter(counter-ch01-zabbix-components-chapter-5) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-chapter h5 {  counter-increment: counter-ch01-zabbix-components-chapter-5 }
            
.print-site-enumerate-headings #ch01-zabbix-components-architecture > h1:before { content: '6.2 ' }

                .print-site-enumerate-headings #ch01-zabbix-components-architecture h2:before { content: '6.2.' counter(counter-ch01-zabbix-components-architecture-2) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-architecture h2 {  counter-reset: counter-ch01-zabbix-components-architecture-3  counter-ch01-zabbix-components-architecture-4  counter-ch01-zabbix-components-architecture-5 ;  counter-increment: counter-ch01-zabbix-components-architecture-2 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-architecture h3:before { content: '6.2.' counter(counter-ch01-zabbix-components-architecture-2) '.' counter(counter-ch01-zabbix-components-architecture-3) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-architecture h3 {  counter-reset: counter-ch01-zabbix-components-architecture-4  counter-ch01-zabbix-components-architecture-5 ;  counter-increment: counter-ch01-zabbix-components-architecture-3 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-architecture h4:before { content: '6.2.' counter(counter-ch01-zabbix-components-architecture-2) '.' counter(counter-ch01-zabbix-components-architecture-3) '.' counter(counter-ch01-zabbix-components-architecture-4) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-architecture h4 {  counter-reset: counter-ch01-zabbix-components-architecture-5 ;  counter-increment: counter-ch01-zabbix-components-architecture-4 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-architecture h5:before { content: '6.2.' counter(counter-ch01-zabbix-components-architecture-2) '.' counter(counter-ch01-zabbix-components-architecture-3) '.' counter(counter-ch01-zabbix-components-architecture-4) '.' counter(counter-ch01-zabbix-components-architecture-5) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-architecture h5 {  counter-increment: counter-ch01-zabbix-components-architecture-5 }
            
.print-site-enumerate-headings #section-6-3 > h1:before { content: '6.3 ' }
.print-site-enumerate-headings #ch01-zabbix-components-database > h1:before { content: '6.3.1 ' }

                .print-site-enumerate-headings #ch01-zabbix-components-database h2:before { content: '6.3.1.' counter(counter-ch01-zabbix-components-database-2) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-database h2 {  counter-reset: counter-ch01-zabbix-components-database-3  counter-ch01-zabbix-components-database-4 ;  counter-increment: counter-ch01-zabbix-components-database-2 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-database h3:before { content: '6.3.1.' counter(counter-ch01-zabbix-components-database-2) '.' counter(counter-ch01-zabbix-components-database-3) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-database h3 {  counter-reset: counter-ch01-zabbix-components-database-4 ;  counter-increment: counter-ch01-zabbix-components-database-3 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-database h4:before { content: '6.3.1.' counter(counter-ch01-zabbix-components-database-2) '.' counter(counter-ch01-zabbix-components-database-3) '.' counter(counter-ch01-zabbix-components-database-4) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-database h4 {  counter-increment: counter-ch01-zabbix-components-database-4 }
            
.print-site-enumerate-headings #ch01-zabbix-components-mariadb > h1:before { content: '6.3.2 ' }

                .print-site-enumerate-headings #ch01-zabbix-components-mariadb h2:before { content: '6.3.2.' counter(counter-ch01-zabbix-components-mariadb-2) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-mariadb h2 {  counter-reset: counter-ch01-zabbix-components-mariadb-3  counter-ch01-zabbix-components-mariadb-4 ;  counter-increment: counter-ch01-zabbix-components-mariadb-2 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-mariadb h3:before { content: '6.3.2.' counter(counter-ch01-zabbix-components-mariadb-2) '.' counter(counter-ch01-zabbix-components-mariadb-3) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-mariadb h3 {  counter-reset: counter-ch01-zabbix-components-mariadb-4 ;  counter-increment: counter-ch01-zabbix-components-mariadb-3 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-mariadb h4:before { content: '6.3.2.' counter(counter-ch01-zabbix-components-mariadb-2) '.' counter(counter-ch01-zabbix-components-mariadb-3) '.' counter(counter-ch01-zabbix-components-mariadb-4) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-mariadb h4 {  counter-increment: counter-ch01-zabbix-components-mariadb-4 }
            
.print-site-enumerate-headings #ch01-zabbix-components-postgresql > h1:before { content: '6.3.3 ' }

                .print-site-enumerate-headings #ch01-zabbix-components-postgresql h2:before { content: '6.3.3.' counter(counter-ch01-zabbix-components-postgresql-2) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-postgresql h2 {  counter-reset: counter-ch01-zabbix-components-postgresql-3  counter-ch01-zabbix-components-postgresql-4 ;  counter-increment: counter-ch01-zabbix-components-postgresql-2 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-postgresql h3:before { content: '6.3.3.' counter(counter-ch01-zabbix-components-postgresql-2) '.' counter(counter-ch01-zabbix-components-postgresql-3) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-postgresql h3 {  counter-reset: counter-ch01-zabbix-components-postgresql-4 ;  counter-increment: counter-ch01-zabbix-components-postgresql-3 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-postgresql h4:before { content: '6.3.3.' counter(counter-ch01-zabbix-components-postgresql-2) '.' counter(counter-ch01-zabbix-components-postgresql-3) '.' counter(counter-ch01-zabbix-components-postgresql-4) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-postgresql h4 {  counter-increment: counter-ch01-zabbix-components-postgresql-4 }
            
.print-site-enumerate-headings #ch01-zabbix-components-zabbix-server > h1:before { content: '6.4 ' }

                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-server h2:before { content: '6.4.' counter(counter-ch01-zabbix-components-zabbix-server-2) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-server h2 {  counter-reset: counter-ch01-zabbix-components-zabbix-server-3  counter-ch01-zabbix-components-zabbix-server-4  counter-ch01-zabbix-components-zabbix-server-5 ;  counter-increment: counter-ch01-zabbix-components-zabbix-server-2 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-server h3:before { content: '6.4.' counter(counter-ch01-zabbix-components-zabbix-server-2) '.' counter(counter-ch01-zabbix-components-zabbix-server-3) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-server h3 {  counter-reset: counter-ch01-zabbix-components-zabbix-server-4  counter-ch01-zabbix-components-zabbix-server-5 ;  counter-increment: counter-ch01-zabbix-components-zabbix-server-3 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-server h4:before { content: '6.4.' counter(counter-ch01-zabbix-components-zabbix-server-2) '.' counter(counter-ch01-zabbix-components-zabbix-server-3) '.' counter(counter-ch01-zabbix-components-zabbix-server-4) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-server h4 {  counter-reset: counter-ch01-zabbix-components-zabbix-server-5 ;  counter-increment: counter-ch01-zabbix-components-zabbix-server-4 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-server h5:before { content: '6.4.' counter(counter-ch01-zabbix-components-zabbix-server-2) '.' counter(counter-ch01-zabbix-components-zabbix-server-3) '.' counter(counter-ch01-zabbix-components-zabbix-server-4) '.' counter(counter-ch01-zabbix-components-zabbix-server-5) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-server h5 {  counter-increment: counter-ch01-zabbix-components-zabbix-server-5 }
            
.print-site-enumerate-headings #ch01-zabbix-components-zabbix-frontend > h1:before { content: '6.5 ' }

                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-frontend h2:before { content: '6.5.' counter(counter-ch01-zabbix-components-zabbix-frontend-2) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-frontend h2 {  counter-reset: counter-ch01-zabbix-components-zabbix-frontend-3  counter-ch01-zabbix-components-zabbix-frontend-4  counter-ch01-zabbix-components-zabbix-frontend-5 ;  counter-increment: counter-ch01-zabbix-components-zabbix-frontend-2 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-frontend h3:before { content: '6.5.' counter(counter-ch01-zabbix-components-zabbix-frontend-2) '.' counter(counter-ch01-zabbix-components-zabbix-frontend-3) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-frontend h3 {  counter-reset: counter-ch01-zabbix-components-zabbix-frontend-4  counter-ch01-zabbix-components-zabbix-frontend-5 ;  counter-increment: counter-ch01-zabbix-components-zabbix-frontend-3 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-frontend h4:before { content: '6.5.' counter(counter-ch01-zabbix-components-zabbix-frontend-2) '.' counter(counter-ch01-zabbix-components-zabbix-frontend-3) '.' counter(counter-ch01-zabbix-components-zabbix-frontend-4) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-frontend h4 {  counter-reset: counter-ch01-zabbix-components-zabbix-frontend-5 ;  counter-increment: counter-ch01-zabbix-components-zabbix-frontend-4 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-frontend h5:before { content: '6.5.' counter(counter-ch01-zabbix-components-zabbix-frontend-2) '.' counter(counter-ch01-zabbix-components-zabbix-frontend-3) '.' counter(counter-ch01-zabbix-components-zabbix-frontend-4) '.' counter(counter-ch01-zabbix-components-zabbix-frontend-5) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-zabbix-frontend h5 {  counter-increment: counter-ch01-zabbix-components-zabbix-frontend-5 }
            
.print-site-enumerate-headings #ch01-zabbix-components-ha-setup > h1:before { content: '6.6 ' }

                .print-site-enumerate-headings #ch01-zabbix-components-ha-setup h2:before { content: '6.6.' counter(counter-ch01-zabbix-components-ha-setup-2) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-ha-setup h2 {  counter-reset: counter-ch01-zabbix-components-ha-setup-3  counter-ch01-zabbix-components-ha-setup-4  counter-ch01-zabbix-components-ha-setup-5 ;  counter-increment: counter-ch01-zabbix-components-ha-setup-2 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-ha-setup h3:before { content: '6.6.' counter(counter-ch01-zabbix-components-ha-setup-2) '.' counter(counter-ch01-zabbix-components-ha-setup-3) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-ha-setup h3 {  counter-reset: counter-ch01-zabbix-components-ha-setup-4  counter-ch01-zabbix-components-ha-setup-5 ;  counter-increment: counter-ch01-zabbix-components-ha-setup-3 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-ha-setup h4:before { content: '6.6.' counter(counter-ch01-zabbix-components-ha-setup-2) '.' counter(counter-ch01-zabbix-components-ha-setup-3) '.' counter(counter-ch01-zabbix-components-ha-setup-4) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-ha-setup h4 {  counter-reset: counter-ch01-zabbix-components-ha-setup-5 ;  counter-increment: counter-ch01-zabbix-components-ha-setup-4 }
            
                .print-site-enumerate-headings #ch01-zabbix-components-ha-setup h5:before { content: '6.6.' counter(counter-ch01-zabbix-components-ha-setup-2) '.' counter(counter-ch01-zabbix-components-ha-setup-3) '.' counter(counter-ch01-zabbix-components-ha-setup-4) '.' counter(counter-ch01-zabbix-components-ha-setup-5) ' ' }
                .print-site-enumerate-headings #ch01-zabbix-components-ha-setup h5 {  counter-increment: counter-ch01-zabbix-components-ha-setup-5 }
            
.print-site-enumerate-headings #section-7 > h1:before { content: '7 ' }
.print-site-enumerate-headings #ch02-zabbix-installation-chapter > h1:before { content: '7.1 ' }

                .print-site-enumerate-headings #ch02-zabbix-installation-chapter h2:before { content: '7.1.' counter(counter-ch02-zabbix-installation-chapter-2) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-chapter h2 {  counter-reset: counter-ch02-zabbix-installation-chapter-3  counter-ch02-zabbix-installation-chapter-4  counter-ch02-zabbix-installation-chapter-5 ;  counter-increment: counter-ch02-zabbix-installation-chapter-2 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-chapter h3:before { content: '7.1.' counter(counter-ch02-zabbix-installation-chapter-2) '.' counter(counter-ch02-zabbix-installation-chapter-3) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-chapter h3 {  counter-reset: counter-ch02-zabbix-installation-chapter-4  counter-ch02-zabbix-installation-chapter-5 ;  counter-increment: counter-ch02-zabbix-installation-chapter-3 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-chapter h4:before { content: '7.1.' counter(counter-ch02-zabbix-installation-chapter-2) '.' counter(counter-ch02-zabbix-installation-chapter-3) '.' counter(counter-ch02-zabbix-installation-chapter-4) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-chapter h4 {  counter-reset: counter-ch02-zabbix-installation-chapter-5 ;  counter-increment: counter-ch02-zabbix-installation-chapter-4 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-chapter h5:before { content: '7.1.' counter(counter-ch02-zabbix-installation-chapter-2) '.' counter(counter-ch02-zabbix-installation-chapter-3) '.' counter(counter-ch02-zabbix-installation-chapter-4) '.' counter(counter-ch02-zabbix-installation-chapter-5) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-chapter h5 {  counter-increment: counter-ch02-zabbix-installation-chapter-5 }
            
.print-site-enumerate-headings #ch02-zabbix-installation-frontend > h1:before { content: '7.2 ' }

                .print-site-enumerate-headings #ch02-zabbix-installation-frontend h2:before { content: '7.2.' counter(counter-ch02-zabbix-installation-frontend-2) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-frontend h2 {  counter-reset: counter-ch02-zabbix-installation-frontend-3  counter-ch02-zabbix-installation-frontend-4  counter-ch02-zabbix-installation-frontend-5 ;  counter-increment: counter-ch02-zabbix-installation-frontend-2 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-frontend h3:before { content: '7.2.' counter(counter-ch02-zabbix-installation-frontend-2) '.' counter(counter-ch02-zabbix-installation-frontend-3) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-frontend h3 {  counter-reset: counter-ch02-zabbix-installation-frontend-4  counter-ch02-zabbix-installation-frontend-5 ;  counter-increment: counter-ch02-zabbix-installation-frontend-3 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-frontend h4:before { content: '7.2.' counter(counter-ch02-zabbix-installation-frontend-2) '.' counter(counter-ch02-zabbix-installation-frontend-3) '.' counter(counter-ch02-zabbix-installation-frontend-4) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-frontend h4 {  counter-reset: counter-ch02-zabbix-installation-frontend-5 ;  counter-increment: counter-ch02-zabbix-installation-frontend-4 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-frontend h5:before { content: '7.2.' counter(counter-ch02-zabbix-installation-frontend-2) '.' counter(counter-ch02-zabbix-installation-frontend-3) '.' counter(counter-ch02-zabbix-installation-frontend-4) '.' counter(counter-ch02-zabbix-installation-frontend-5) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-frontend h5 {  counter-increment: counter-ch02-zabbix-installation-frontend-5 }
            
.print-site-enumerate-headings #ch02-zabbix-installation-host-groups > h1:before { content: '7.3 ' }

                .print-site-enumerate-headings #ch02-zabbix-installation-host-groups h2:before { content: '7.3.' counter(counter-ch02-zabbix-installation-host-groups-2) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-host-groups h2 {  counter-reset: counter-ch02-zabbix-installation-host-groups-3  counter-ch02-zabbix-installation-host-groups-4  counter-ch02-zabbix-installation-host-groups-5 ;  counter-increment: counter-ch02-zabbix-installation-host-groups-2 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-host-groups h3:before { content: '7.3.' counter(counter-ch02-zabbix-installation-host-groups-2) '.' counter(counter-ch02-zabbix-installation-host-groups-3) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-host-groups h3 {  counter-reset: counter-ch02-zabbix-installation-host-groups-4  counter-ch02-zabbix-installation-host-groups-5 ;  counter-increment: counter-ch02-zabbix-installation-host-groups-3 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-host-groups h4:before { content: '7.3.' counter(counter-ch02-zabbix-installation-host-groups-2) '.' counter(counter-ch02-zabbix-installation-host-groups-3) '.' counter(counter-ch02-zabbix-installation-host-groups-4) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-host-groups h4 {  counter-reset: counter-ch02-zabbix-installation-host-groups-5 ;  counter-increment: counter-ch02-zabbix-installation-host-groups-4 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-host-groups h5:before { content: '7.3.' counter(counter-ch02-zabbix-installation-host-groups-2) '.' counter(counter-ch02-zabbix-installation-host-groups-3) '.' counter(counter-ch02-zabbix-installation-host-groups-4) '.' counter(counter-ch02-zabbix-installation-host-groups-5) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-host-groups h5 {  counter-increment: counter-ch02-zabbix-installation-host-groups-5 }
            
.print-site-enumerate-headings #ch02-zabbix-installation-user-groups > h1:before { content: '7.4 ' }

                .print-site-enumerate-headings #ch02-zabbix-installation-user-groups h2:before { content: '7.4.' counter(counter-ch02-zabbix-installation-user-groups-2) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-user-groups h2 {  counter-reset: counter-ch02-zabbix-installation-user-groups-3  counter-ch02-zabbix-installation-user-groups-4  counter-ch02-zabbix-installation-user-groups-5 ;  counter-increment: counter-ch02-zabbix-installation-user-groups-2 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-user-groups h3:before { content: '7.4.' counter(counter-ch02-zabbix-installation-user-groups-2) '.' counter(counter-ch02-zabbix-installation-user-groups-3) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-user-groups h3 {  counter-reset: counter-ch02-zabbix-installation-user-groups-4  counter-ch02-zabbix-installation-user-groups-5 ;  counter-increment: counter-ch02-zabbix-installation-user-groups-3 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-user-groups h4:before { content: '7.4.' counter(counter-ch02-zabbix-installation-user-groups-2) '.' counter(counter-ch02-zabbix-installation-user-groups-3) '.' counter(counter-ch02-zabbix-installation-user-groups-4) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-user-groups h4 {  counter-reset: counter-ch02-zabbix-installation-user-groups-5 ;  counter-increment: counter-ch02-zabbix-installation-user-groups-4 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-user-groups h5:before { content: '7.4.' counter(counter-ch02-zabbix-installation-user-groups-2) '.' counter(counter-ch02-zabbix-installation-user-groups-3) '.' counter(counter-ch02-zabbix-installation-user-groups-4) '.' counter(counter-ch02-zabbix-installation-user-groups-5) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-user-groups h5 {  counter-increment: counter-ch02-zabbix-installation-user-groups-5 }
            
.print-site-enumerate-headings #ch02-zabbix-installation-user-roles > h1:before { content: '7.5 ' }

                .print-site-enumerate-headings #ch02-zabbix-installation-user-roles h2:before { content: '7.5.' counter(counter-ch02-zabbix-installation-user-roles-2) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-user-roles h2 {  counter-reset: counter-ch02-zabbix-installation-user-roles-3  counter-ch02-zabbix-installation-user-roles-4  counter-ch02-zabbix-installation-user-roles-5 ;  counter-increment: counter-ch02-zabbix-installation-user-roles-2 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-user-roles h3:before { content: '7.5.' counter(counter-ch02-zabbix-installation-user-roles-2) '.' counter(counter-ch02-zabbix-installation-user-roles-3) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-user-roles h3 {  counter-reset: counter-ch02-zabbix-installation-user-roles-4  counter-ch02-zabbix-installation-user-roles-5 ;  counter-increment: counter-ch02-zabbix-installation-user-roles-3 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-user-roles h4:before { content: '7.5.' counter(counter-ch02-zabbix-installation-user-roles-2) '.' counter(counter-ch02-zabbix-installation-user-roles-3) '.' counter(counter-ch02-zabbix-installation-user-roles-4) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-user-roles h4 {  counter-reset: counter-ch02-zabbix-installation-user-roles-5 ;  counter-increment: counter-ch02-zabbix-installation-user-roles-4 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-user-roles h5:before { content: '7.5.' counter(counter-ch02-zabbix-installation-user-roles-2) '.' counter(counter-ch02-zabbix-installation-user-roles-3) '.' counter(counter-ch02-zabbix-installation-user-roles-4) '.' counter(counter-ch02-zabbix-installation-user-roles-5) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-user-roles h5 {  counter-increment: counter-ch02-zabbix-installation-user-roles-5 }
            
.print-site-enumerate-headings #section-7-6 > h1:before { content: '7.6 ' }
.print-site-enumerate-headings #ch02-zabbix-installation-http > h1:before { content: '7.6.1 ' }

                .print-site-enumerate-headings #ch02-zabbix-installation-http h2:before { content: '7.6.1.' counter(counter-ch02-zabbix-installation-http-2) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-http h2 {  counter-reset: counter-ch02-zabbix-installation-http-3  counter-ch02-zabbix-installation-http-4 ;  counter-increment: counter-ch02-zabbix-installation-http-2 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-http h3:before { content: '7.6.1.' counter(counter-ch02-zabbix-installation-http-2) '.' counter(counter-ch02-zabbix-installation-http-3) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-http h3 {  counter-reset: counter-ch02-zabbix-installation-http-4 ;  counter-increment: counter-ch02-zabbix-installation-http-3 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-http h4:before { content: '7.6.1.' counter(counter-ch02-zabbix-installation-http-2) '.' counter(counter-ch02-zabbix-installation-http-3) '.' counter(counter-ch02-zabbix-installation-http-4) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-http h4 {  counter-increment: counter-ch02-zabbix-installation-http-4 }
            
.print-site-enumerate-headings #ch02-zabbix-installation-ldap-ad > h1:before { content: '7.6.2 ' }

                .print-site-enumerate-headings #ch02-zabbix-installation-ldap-ad h2:before { content: '7.6.2.' counter(counter-ch02-zabbix-installation-ldap-ad-2) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-ldap-ad h2 {  counter-reset: counter-ch02-zabbix-installation-ldap-ad-3  counter-ch02-zabbix-installation-ldap-ad-4 ;  counter-increment: counter-ch02-zabbix-installation-ldap-ad-2 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-ldap-ad h3:before { content: '7.6.2.' counter(counter-ch02-zabbix-installation-ldap-ad-2) '.' counter(counter-ch02-zabbix-installation-ldap-ad-3) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-ldap-ad h3 {  counter-reset: counter-ch02-zabbix-installation-ldap-ad-4 ;  counter-increment: counter-ch02-zabbix-installation-ldap-ad-3 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-ldap-ad h4:before { content: '7.6.2.' counter(counter-ch02-zabbix-installation-ldap-ad-2) '.' counter(counter-ch02-zabbix-installation-ldap-ad-3) '.' counter(counter-ch02-zabbix-installation-ldap-ad-4) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-ldap-ad h4 {  counter-increment: counter-ch02-zabbix-installation-ldap-ad-4 }
            
.print-site-enumerate-headings #ch02-zabbix-installation-saml > h1:before { content: '7.6.3 ' }

                .print-site-enumerate-headings #ch02-zabbix-installation-saml h2:before { content: '7.6.3.' counter(counter-ch02-zabbix-installation-saml-2) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-saml h2 {  counter-reset: counter-ch02-zabbix-installation-saml-3  counter-ch02-zabbix-installation-saml-4 ;  counter-increment: counter-ch02-zabbix-installation-saml-2 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-saml h3:before { content: '7.6.3.' counter(counter-ch02-zabbix-installation-saml-2) '.' counter(counter-ch02-zabbix-installation-saml-3) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-saml h3 {  counter-reset: counter-ch02-zabbix-installation-saml-4 ;  counter-increment: counter-ch02-zabbix-installation-saml-3 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-saml h4:before { content: '7.6.3.' counter(counter-ch02-zabbix-installation-saml-2) '.' counter(counter-ch02-zabbix-installation-saml-3) '.' counter(counter-ch02-zabbix-installation-saml-4) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-saml h4 {  counter-increment: counter-ch02-zabbix-installation-saml-4 }
            
.print-site-enumerate-headings #ch02-zabbix-installation-mfa > h1:before { content: '7.6.4 ' }

                .print-site-enumerate-headings #ch02-zabbix-installation-mfa h2:before { content: '7.6.4.' counter(counter-ch02-zabbix-installation-mfa-2) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-mfa h2 {  counter-reset: counter-ch02-zabbix-installation-mfa-3  counter-ch02-zabbix-installation-mfa-4 ;  counter-increment: counter-ch02-zabbix-installation-mfa-2 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-mfa h3:before { content: '7.6.4.' counter(counter-ch02-zabbix-installation-mfa-2) '.' counter(counter-ch02-zabbix-installation-mfa-3) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-mfa h3 {  counter-reset: counter-ch02-zabbix-installation-mfa-4 ;  counter-increment: counter-ch02-zabbix-installation-mfa-3 }
            
                .print-site-enumerate-headings #ch02-zabbix-installation-mfa h4:before { content: '7.6.4.' counter(counter-ch02-zabbix-installation-mfa-2) '.' counter(counter-ch02-zabbix-installation-mfa-3) '.' counter(counter-ch02-zabbix-installation-mfa-4) ' ' }
                .print-site-enumerate-headings #ch02-zabbix-installation-mfa h4 {  counter-increment: counter-ch02-zabbix-installation-mfa-4 }
            
.print-site-enumerate-headings #section-8 > h1:before { content: '8 ' }
.print-site-enumerate-headings #ch03-zabbix-proxies-chapter > h1:before { content: '8.1 ' }

                .print-site-enumerate-headings #ch03-zabbix-proxies-chapter h2:before { content: '8.1.' counter(counter-ch03-zabbix-proxies-chapter-2) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-chapter h2 {  counter-reset: counter-ch03-zabbix-proxies-chapter-3  counter-ch03-zabbix-proxies-chapter-4  counter-ch03-zabbix-proxies-chapter-5 ;  counter-increment: counter-ch03-zabbix-proxies-chapter-2 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-chapter h3:before { content: '8.1.' counter(counter-ch03-zabbix-proxies-chapter-2) '.' counter(counter-ch03-zabbix-proxies-chapter-3) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-chapter h3 {  counter-reset: counter-ch03-zabbix-proxies-chapter-4  counter-ch03-zabbix-proxies-chapter-5 ;  counter-increment: counter-ch03-zabbix-proxies-chapter-3 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-chapter h4:before { content: '8.1.' counter(counter-ch03-zabbix-proxies-chapter-2) '.' counter(counter-ch03-zabbix-proxies-chapter-3) '.' counter(counter-ch03-zabbix-proxies-chapter-4) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-chapter h4 {  counter-reset: counter-ch03-zabbix-proxies-chapter-5 ;  counter-increment: counter-ch03-zabbix-proxies-chapter-4 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-chapter h5:before { content: '8.1.' counter(counter-ch03-zabbix-proxies-chapter-2) '.' counter(counter-ch03-zabbix-proxies-chapter-3) '.' counter(counter-ch03-zabbix-proxies-chapter-4) '.' counter(counter-ch03-zabbix-proxies-chapter-5) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-chapter h5 {  counter-increment: counter-ch03-zabbix-proxies-chapter-5 }
            
.print-site-enumerate-headings #ch03-zabbix-proxies-proxy-basics > h1:before { content: '8.2 ' }

                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-basics h2:before { content: '8.2.' counter(counter-ch03-zabbix-proxies-proxy-basics-2) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-basics h2 {  counter-reset: counter-ch03-zabbix-proxies-proxy-basics-3  counter-ch03-zabbix-proxies-proxy-basics-4  counter-ch03-zabbix-proxies-proxy-basics-5 ;  counter-increment: counter-ch03-zabbix-proxies-proxy-basics-2 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-basics h3:before { content: '8.2.' counter(counter-ch03-zabbix-proxies-proxy-basics-2) '.' counter(counter-ch03-zabbix-proxies-proxy-basics-3) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-basics h3 {  counter-reset: counter-ch03-zabbix-proxies-proxy-basics-4  counter-ch03-zabbix-proxies-proxy-basics-5 ;  counter-increment: counter-ch03-zabbix-proxies-proxy-basics-3 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-basics h4:before { content: '8.2.' counter(counter-ch03-zabbix-proxies-proxy-basics-2) '.' counter(counter-ch03-zabbix-proxies-proxy-basics-3) '.' counter(counter-ch03-zabbix-proxies-proxy-basics-4) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-basics h4 {  counter-reset: counter-ch03-zabbix-proxies-proxy-basics-5 ;  counter-increment: counter-ch03-zabbix-proxies-proxy-basics-4 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-basics h5:before { content: '8.2.' counter(counter-ch03-zabbix-proxies-proxy-basics-2) '.' counter(counter-ch03-zabbix-proxies-proxy-basics-3) '.' counter(counter-ch03-zabbix-proxies-proxy-basics-4) '.' counter(counter-ch03-zabbix-proxies-proxy-basics-5) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-basics h5 {  counter-increment: counter-ch03-zabbix-proxies-proxy-basics-5 }
            
.print-site-enumerate-headings #ch03-zabbix-proxies-active-passive-proxies > h1:before { content: '8.3 ' }

                .print-site-enumerate-headings #ch03-zabbix-proxies-active-passive-proxies h2:before { content: '8.3.' counter(counter-ch03-zabbix-proxies-active-passive-proxies-2) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-active-passive-proxies h2 {  counter-reset: counter-ch03-zabbix-proxies-active-passive-proxies-3  counter-ch03-zabbix-proxies-active-passive-proxies-4  counter-ch03-zabbix-proxies-active-passive-proxies-5 ;  counter-increment: counter-ch03-zabbix-proxies-active-passive-proxies-2 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-active-passive-proxies h3:before { content: '8.3.' counter(counter-ch03-zabbix-proxies-active-passive-proxies-2) '.' counter(counter-ch03-zabbix-proxies-active-passive-proxies-3) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-active-passive-proxies h3 {  counter-reset: counter-ch03-zabbix-proxies-active-passive-proxies-4  counter-ch03-zabbix-proxies-active-passive-proxies-5 ;  counter-increment: counter-ch03-zabbix-proxies-active-passive-proxies-3 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-active-passive-proxies h4:before { content: '8.3.' counter(counter-ch03-zabbix-proxies-active-passive-proxies-2) '.' counter(counter-ch03-zabbix-proxies-active-passive-proxies-3) '.' counter(counter-ch03-zabbix-proxies-active-passive-proxies-4) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-active-passive-proxies h4 {  counter-reset: counter-ch03-zabbix-proxies-active-passive-proxies-5 ;  counter-increment: counter-ch03-zabbix-proxies-active-passive-proxies-4 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-active-passive-proxies h5:before { content: '8.3.' counter(counter-ch03-zabbix-proxies-active-passive-proxies-2) '.' counter(counter-ch03-zabbix-proxies-active-passive-proxies-3) '.' counter(counter-ch03-zabbix-proxies-active-passive-proxies-4) '.' counter(counter-ch03-zabbix-proxies-active-passive-proxies-5) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-active-passive-proxies h5 {  counter-increment: counter-ch03-zabbix-proxies-active-passive-proxies-5 }
            
.print-site-enumerate-headings #ch03-zabbix-proxies-proxies-as-container > h1:before { content: '8.4 ' }

                .print-site-enumerate-headings #ch03-zabbix-proxies-proxies-as-container h2:before { content: '8.4.' counter(counter-ch03-zabbix-proxies-proxies-as-container-2) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxies-as-container h2 {  counter-reset: counter-ch03-zabbix-proxies-proxies-as-container-3  counter-ch03-zabbix-proxies-proxies-as-container-4  counter-ch03-zabbix-proxies-proxies-as-container-5 ;  counter-increment: counter-ch03-zabbix-proxies-proxies-as-container-2 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxies-as-container h3:before { content: '8.4.' counter(counter-ch03-zabbix-proxies-proxies-as-container-2) '.' counter(counter-ch03-zabbix-proxies-proxies-as-container-3) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxies-as-container h3 {  counter-reset: counter-ch03-zabbix-proxies-proxies-as-container-4  counter-ch03-zabbix-proxies-proxies-as-container-5 ;  counter-increment: counter-ch03-zabbix-proxies-proxies-as-container-3 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxies-as-container h4:before { content: '8.4.' counter(counter-ch03-zabbix-proxies-proxies-as-container-2) '.' counter(counter-ch03-zabbix-proxies-proxies-as-container-3) '.' counter(counter-ch03-zabbix-proxies-proxies-as-container-4) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxies-as-container h4 {  counter-reset: counter-ch03-zabbix-proxies-proxies-as-container-5 ;  counter-increment: counter-ch03-zabbix-proxies-proxies-as-container-4 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxies-as-container h5:before { content: '8.4.' counter(counter-ch03-zabbix-proxies-proxies-as-container-2) '.' counter(counter-ch03-zabbix-proxies-proxies-as-container-3) '.' counter(counter-ch03-zabbix-proxies-proxies-as-container-4) '.' counter(counter-ch03-zabbix-proxies-proxies-as-container-5) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxies-as-container h5 {  counter-increment: counter-ch03-zabbix-proxies-proxies-as-container-5 }
            
.print-site-enumerate-headings #ch03-zabbix-proxies-proxy-groups > h1:before { content: '8.5 ' }

                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-groups h2:before { content: '8.5.' counter(counter-ch03-zabbix-proxies-proxy-groups-2) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-groups h2 {  counter-reset: counter-ch03-zabbix-proxies-proxy-groups-3  counter-ch03-zabbix-proxies-proxy-groups-4  counter-ch03-zabbix-proxies-proxy-groups-5 ;  counter-increment: counter-ch03-zabbix-proxies-proxy-groups-2 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-groups h3:before { content: '8.5.' counter(counter-ch03-zabbix-proxies-proxy-groups-2) '.' counter(counter-ch03-zabbix-proxies-proxy-groups-3) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-groups h3 {  counter-reset: counter-ch03-zabbix-proxies-proxy-groups-4  counter-ch03-zabbix-proxies-proxy-groups-5 ;  counter-increment: counter-ch03-zabbix-proxies-proxy-groups-3 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-groups h4:before { content: '8.5.' counter(counter-ch03-zabbix-proxies-proxy-groups-2) '.' counter(counter-ch03-zabbix-proxies-proxy-groups-3) '.' counter(counter-ch03-zabbix-proxies-proxy-groups-4) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-groups h4 {  counter-reset: counter-ch03-zabbix-proxies-proxy-groups-5 ;  counter-increment: counter-ch03-zabbix-proxies-proxy-groups-4 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-groups h5:before { content: '8.5.' counter(counter-ch03-zabbix-proxies-proxy-groups-2) '.' counter(counter-ch03-zabbix-proxies-proxy-groups-3) '.' counter(counter-ch03-zabbix-proxies-proxy-groups-4) '.' counter(counter-ch03-zabbix-proxies-proxy-groups-5) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-proxy-groups h5 {  counter-increment: counter-ch03-zabbix-proxies-proxy-groups-5 }
            
.print-site-enumerate-headings #ch03-zabbix-proxies-web-services > h1:before { content: '8.6 ' }

                .print-site-enumerate-headings #ch03-zabbix-proxies-web-services h2:before { content: '8.6.' counter(counter-ch03-zabbix-proxies-web-services-2) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-web-services h2 {  counter-reset: counter-ch03-zabbix-proxies-web-services-3  counter-ch03-zabbix-proxies-web-services-4  counter-ch03-zabbix-proxies-web-services-5 ;  counter-increment: counter-ch03-zabbix-proxies-web-services-2 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-web-services h3:before { content: '8.6.' counter(counter-ch03-zabbix-proxies-web-services-2) '.' counter(counter-ch03-zabbix-proxies-web-services-3) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-web-services h3 {  counter-reset: counter-ch03-zabbix-proxies-web-services-4  counter-ch03-zabbix-proxies-web-services-5 ;  counter-increment: counter-ch03-zabbix-proxies-web-services-3 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-web-services h4:before { content: '8.6.' counter(counter-ch03-zabbix-proxies-web-services-2) '.' counter(counter-ch03-zabbix-proxies-web-services-3) '.' counter(counter-ch03-zabbix-proxies-web-services-4) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-web-services h4 {  counter-reset: counter-ch03-zabbix-proxies-web-services-5 ;  counter-increment: counter-ch03-zabbix-proxies-web-services-4 }
            
                .print-site-enumerate-headings #ch03-zabbix-proxies-web-services h5:before { content: '8.6.' counter(counter-ch03-zabbix-proxies-web-services-2) '.' counter(counter-ch03-zabbix-proxies-web-services-3) '.' counter(counter-ch03-zabbix-proxies-web-services-4) '.' counter(counter-ch03-zabbix-proxies-web-services-5) ' ' }
                .print-site-enumerate-headings #ch03-zabbix-proxies-web-services h5 {  counter-increment: counter-ch03-zabbix-proxies-web-services-5 }
            
.print-site-enumerate-headings #section-9 > h1:before { content: '9 ' }
.print-site-enumerate-headings #ch04-zabbix-collecting-data-chapter > h1:before { content: '9.1 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-chapter h2:before { content: '9.1.' counter(counter-ch04-zabbix-collecting-data-chapter-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-chapter h2 {  counter-reset: counter-ch04-zabbix-collecting-data-chapter-3  counter-ch04-zabbix-collecting-data-chapter-4  counter-ch04-zabbix-collecting-data-chapter-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-chapter-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-chapter h3:before { content: '9.1.' counter(counter-ch04-zabbix-collecting-data-chapter-2) '.' counter(counter-ch04-zabbix-collecting-data-chapter-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-chapter h3 {  counter-reset: counter-ch04-zabbix-collecting-data-chapter-4  counter-ch04-zabbix-collecting-data-chapter-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-chapter-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-chapter h4:before { content: '9.1.' counter(counter-ch04-zabbix-collecting-data-chapter-2) '.' counter(counter-ch04-zabbix-collecting-data-chapter-3) '.' counter(counter-ch04-zabbix-collecting-data-chapter-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-chapter h4 {  counter-reset: counter-ch04-zabbix-collecting-data-chapter-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-chapter-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-chapter h5:before { content: '9.1.' counter(counter-ch04-zabbix-collecting-data-chapter-2) '.' counter(counter-ch04-zabbix-collecting-data-chapter-3) '.' counter(counter-ch04-zabbix-collecting-data-chapter-4) '.' counter(counter-ch04-zabbix-collecting-data-chapter-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-chapter h5 {  counter-increment: counter-ch04-zabbix-collecting-data-chapter-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-dataflow > h1:before { content: '9.2 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dataflow h2:before { content: '9.2.' counter(counter-ch04-zabbix-collecting-data-dataflow-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dataflow h2 {  counter-reset: counter-ch04-zabbix-collecting-data-dataflow-3  counter-ch04-zabbix-collecting-data-dataflow-4  counter-ch04-zabbix-collecting-data-dataflow-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-dataflow-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dataflow h3:before { content: '9.2.' counter(counter-ch04-zabbix-collecting-data-dataflow-2) '.' counter(counter-ch04-zabbix-collecting-data-dataflow-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dataflow h3 {  counter-reset: counter-ch04-zabbix-collecting-data-dataflow-4  counter-ch04-zabbix-collecting-data-dataflow-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-dataflow-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dataflow h4:before { content: '9.2.' counter(counter-ch04-zabbix-collecting-data-dataflow-2) '.' counter(counter-ch04-zabbix-collecting-data-dataflow-3) '.' counter(counter-ch04-zabbix-collecting-data-dataflow-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dataflow h4 {  counter-reset: counter-ch04-zabbix-collecting-data-dataflow-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-dataflow-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dataflow h5:before { content: '9.2.' counter(counter-ch04-zabbix-collecting-data-dataflow-2) '.' counter(counter-ch04-zabbix-collecting-data-dataflow-3) '.' counter(counter-ch04-zabbix-collecting-data-dataflow-4) '.' counter(counter-ch04-zabbix-collecting-data-dataflow-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dataflow h5 {  counter-increment: counter-ch04-zabbix-collecting-data-dataflow-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-hosts > h1:before { content: '9.3 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-hosts h2:before { content: '9.3.' counter(counter-ch04-zabbix-collecting-data-hosts-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-hosts h2 {  counter-reset: counter-ch04-zabbix-collecting-data-hosts-3  counter-ch04-zabbix-collecting-data-hosts-4  counter-ch04-zabbix-collecting-data-hosts-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-hosts-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-hosts h3:before { content: '9.3.' counter(counter-ch04-zabbix-collecting-data-hosts-2) '.' counter(counter-ch04-zabbix-collecting-data-hosts-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-hosts h3 {  counter-reset: counter-ch04-zabbix-collecting-data-hosts-4  counter-ch04-zabbix-collecting-data-hosts-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-hosts-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-hosts h4:before { content: '9.3.' counter(counter-ch04-zabbix-collecting-data-hosts-2) '.' counter(counter-ch04-zabbix-collecting-data-hosts-3) '.' counter(counter-ch04-zabbix-collecting-data-hosts-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-hosts h4 {  counter-reset: counter-ch04-zabbix-collecting-data-hosts-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-hosts-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-hosts h5:before { content: '9.3.' counter(counter-ch04-zabbix-collecting-data-hosts-2) '.' counter(counter-ch04-zabbix-collecting-data-hosts-3) '.' counter(counter-ch04-zabbix-collecting-data-hosts-4) '.' counter(counter-ch04-zabbix-collecting-data-hosts-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-hosts h5 {  counter-increment: counter-ch04-zabbix-collecting-data-hosts-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-simple-checks > h1:before { content: '9.4 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-simple-checks h2:before { content: '9.4.' counter(counter-ch04-zabbix-collecting-data-simple-checks-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-simple-checks h2 {  counter-reset: counter-ch04-zabbix-collecting-data-simple-checks-3  counter-ch04-zabbix-collecting-data-simple-checks-4  counter-ch04-zabbix-collecting-data-simple-checks-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-simple-checks-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-simple-checks h3:before { content: '9.4.' counter(counter-ch04-zabbix-collecting-data-simple-checks-2) '.' counter(counter-ch04-zabbix-collecting-data-simple-checks-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-simple-checks h3 {  counter-reset: counter-ch04-zabbix-collecting-data-simple-checks-4  counter-ch04-zabbix-collecting-data-simple-checks-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-simple-checks-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-simple-checks h4:before { content: '9.4.' counter(counter-ch04-zabbix-collecting-data-simple-checks-2) '.' counter(counter-ch04-zabbix-collecting-data-simple-checks-3) '.' counter(counter-ch04-zabbix-collecting-data-simple-checks-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-simple-checks h4 {  counter-reset: counter-ch04-zabbix-collecting-data-simple-checks-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-simple-checks-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-simple-checks h5:before { content: '9.4.' counter(counter-ch04-zabbix-collecting-data-simple-checks-2) '.' counter(counter-ch04-zabbix-collecting-data-simple-checks-3) '.' counter(counter-ch04-zabbix-collecting-data-simple-checks-4) '.' counter(counter-ch04-zabbix-collecting-data-simple-checks-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-simple-checks h5 {  counter-increment: counter-ch04-zabbix-collecting-data-simple-checks-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-host-interfaces > h1:before { content: '9.5 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-host-interfaces h2:before { content: '9.5.' counter(counter-ch04-zabbix-collecting-data-host-interfaces-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-host-interfaces h2 {  counter-reset: counter-ch04-zabbix-collecting-data-host-interfaces-3  counter-ch04-zabbix-collecting-data-host-interfaces-4  counter-ch04-zabbix-collecting-data-host-interfaces-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-host-interfaces-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-host-interfaces h3:before { content: '9.5.' counter(counter-ch04-zabbix-collecting-data-host-interfaces-2) '.' counter(counter-ch04-zabbix-collecting-data-host-interfaces-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-host-interfaces h3 {  counter-reset: counter-ch04-zabbix-collecting-data-host-interfaces-4  counter-ch04-zabbix-collecting-data-host-interfaces-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-host-interfaces-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-host-interfaces h4:before { content: '9.5.' counter(counter-ch04-zabbix-collecting-data-host-interfaces-2) '.' counter(counter-ch04-zabbix-collecting-data-host-interfaces-3) '.' counter(counter-ch04-zabbix-collecting-data-host-interfaces-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-host-interfaces h4 {  counter-reset: counter-ch04-zabbix-collecting-data-host-interfaces-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-host-interfaces-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-host-interfaces h5:before { content: '9.5.' counter(counter-ch04-zabbix-collecting-data-host-interfaces-2) '.' counter(counter-ch04-zabbix-collecting-data-host-interfaces-3) '.' counter(counter-ch04-zabbix-collecting-data-host-interfaces-4) '.' counter(counter-ch04-zabbix-collecting-data-host-interfaces-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-host-interfaces h5 {  counter-increment: counter-ch04-zabbix-collecting-data-host-interfaces-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-passive > h1:before { content: '9.6 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-passive h2:before { content: '9.6.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-passive-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-passive h2 {  counter-reset: counter-ch04-zabbix-collecting-data-zabbix-agent-passive-3  counter-ch04-zabbix-collecting-data-zabbix-agent-passive-4  counter-ch04-zabbix-collecting-data-zabbix-agent-passive-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-agent-passive-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-passive h3:before { content: '9.6.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-passive-2) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-passive-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-passive h3 {  counter-reset: counter-ch04-zabbix-collecting-data-zabbix-agent-passive-4  counter-ch04-zabbix-collecting-data-zabbix-agent-passive-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-agent-passive-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-passive h4:before { content: '9.6.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-passive-2) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-passive-3) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-passive-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-passive h4 {  counter-reset: counter-ch04-zabbix-collecting-data-zabbix-agent-passive-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-agent-passive-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-passive h5:before { content: '9.6.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-passive-2) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-passive-3) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-passive-4) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-passive-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-passive h5 {  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-agent-passive-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-active > h1:before { content: '9.7 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-active h2:before { content: '9.7.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-active-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-active h2 {  counter-reset: counter-ch04-zabbix-collecting-data-zabbix-agent-active-3  counter-ch04-zabbix-collecting-data-zabbix-agent-active-4  counter-ch04-zabbix-collecting-data-zabbix-agent-active-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-agent-active-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-active h3:before { content: '9.7.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-active-2) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-active-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-active h3 {  counter-reset: counter-ch04-zabbix-collecting-data-zabbix-agent-active-4  counter-ch04-zabbix-collecting-data-zabbix-agent-active-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-agent-active-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-active h4:before { content: '9.7.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-active-2) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-active-3) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-active-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-active h4 {  counter-reset: counter-ch04-zabbix-collecting-data-zabbix-agent-active-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-agent-active-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-active h5:before { content: '9.7.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-active-2) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-active-3) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-active-4) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-agent-active-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-agent-active h5 {  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-agent-active-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-polling > h1:before { content: '9.8 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-polling h2:before { content: '9.8.' counter(counter-ch04-zabbix-collecting-data-snmp-polling-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-polling h2 {  counter-reset: counter-ch04-zabbix-collecting-data-snmp-polling-3  counter-ch04-zabbix-collecting-data-snmp-polling-4  counter-ch04-zabbix-collecting-data-snmp-polling-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-snmp-polling-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-polling h3:before { content: '9.8.' counter(counter-ch04-zabbix-collecting-data-snmp-polling-2) '.' counter(counter-ch04-zabbix-collecting-data-snmp-polling-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-polling h3 {  counter-reset: counter-ch04-zabbix-collecting-data-snmp-polling-4  counter-ch04-zabbix-collecting-data-snmp-polling-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-snmp-polling-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-polling h4:before { content: '9.8.' counter(counter-ch04-zabbix-collecting-data-snmp-polling-2) '.' counter(counter-ch04-zabbix-collecting-data-snmp-polling-3) '.' counter(counter-ch04-zabbix-collecting-data-snmp-polling-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-polling h4 {  counter-reset: counter-ch04-zabbix-collecting-data-snmp-polling-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-snmp-polling-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-polling h5:before { content: '9.8.' counter(counter-ch04-zabbix-collecting-data-snmp-polling-2) '.' counter(counter-ch04-zabbix-collecting-data-snmp-polling-3) '.' counter(counter-ch04-zabbix-collecting-data-snmp-polling-4) '.' counter(counter-ch04-zabbix-collecting-data-snmp-polling-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-polling h5 {  counter-increment: counter-ch04-zabbix-collecting-data-snmp-polling-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-trapping > h1:before { content: '9.9 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-trapping h2:before { content: '9.9.' counter(counter-ch04-zabbix-collecting-data-snmp-trapping-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-trapping h2 {  counter-reset: counter-ch04-zabbix-collecting-data-snmp-trapping-3  counter-ch04-zabbix-collecting-data-snmp-trapping-4  counter-ch04-zabbix-collecting-data-snmp-trapping-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-snmp-trapping-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-trapping h3:before { content: '9.9.' counter(counter-ch04-zabbix-collecting-data-snmp-trapping-2) '.' counter(counter-ch04-zabbix-collecting-data-snmp-trapping-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-trapping h3 {  counter-reset: counter-ch04-zabbix-collecting-data-snmp-trapping-4  counter-ch04-zabbix-collecting-data-snmp-trapping-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-snmp-trapping-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-trapping h4:before { content: '9.9.' counter(counter-ch04-zabbix-collecting-data-snmp-trapping-2) '.' counter(counter-ch04-zabbix-collecting-data-snmp-trapping-3) '.' counter(counter-ch04-zabbix-collecting-data-snmp-trapping-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-trapping h4 {  counter-reset: counter-ch04-zabbix-collecting-data-snmp-trapping-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-snmp-trapping-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-trapping h5:before { content: '9.9.' counter(counter-ch04-zabbix-collecting-data-snmp-trapping-2) '.' counter(counter-ch04-zabbix-collecting-data-snmp-trapping-3) '.' counter(counter-ch04-zabbix-collecting-data-snmp-trapping-4) '.' counter(counter-ch04-zabbix-collecting-data-snmp-trapping-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-snmp-trapping h5 {  counter-increment: counter-ch04-zabbix-collecting-data-snmp-trapping-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-http > h1:before { content: '9.10 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-http h2:before { content: '9.10.' counter(counter-ch04-zabbix-collecting-data-http-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-http h2 {  counter-reset: counter-ch04-zabbix-collecting-data-http-3  counter-ch04-zabbix-collecting-data-http-4  counter-ch04-zabbix-collecting-data-http-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-http-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-http h3:before { content: '9.10.' counter(counter-ch04-zabbix-collecting-data-http-2) '.' counter(counter-ch04-zabbix-collecting-data-http-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-http h3 {  counter-reset: counter-ch04-zabbix-collecting-data-http-4  counter-ch04-zabbix-collecting-data-http-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-http-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-http h4:before { content: '9.10.' counter(counter-ch04-zabbix-collecting-data-http-2) '.' counter(counter-ch04-zabbix-collecting-data-http-3) '.' counter(counter-ch04-zabbix-collecting-data-http-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-http h4 {  counter-reset: counter-ch04-zabbix-collecting-data-http-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-http-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-http h5:before { content: '9.10.' counter(counter-ch04-zabbix-collecting-data-http-2) '.' counter(counter-ch04-zabbix-collecting-data-http-3) '.' counter(counter-ch04-zabbix-collecting-data-http-4) '.' counter(counter-ch04-zabbix-collecting-data-http-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-http h5 {  counter-increment: counter-ch04-zabbix-collecting-data-http-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-preprocessing > h1:before { content: '9.11 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-preprocessing h2:before { content: '9.11.' counter(counter-ch04-zabbix-collecting-data-preprocessing-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-preprocessing h2 {  counter-reset: counter-ch04-zabbix-collecting-data-preprocessing-3  counter-ch04-zabbix-collecting-data-preprocessing-4  counter-ch04-zabbix-collecting-data-preprocessing-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-preprocessing-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-preprocessing h3:before { content: '9.11.' counter(counter-ch04-zabbix-collecting-data-preprocessing-2) '.' counter(counter-ch04-zabbix-collecting-data-preprocessing-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-preprocessing h3 {  counter-reset: counter-ch04-zabbix-collecting-data-preprocessing-4  counter-ch04-zabbix-collecting-data-preprocessing-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-preprocessing-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-preprocessing h4:before { content: '9.11.' counter(counter-ch04-zabbix-collecting-data-preprocessing-2) '.' counter(counter-ch04-zabbix-collecting-data-preprocessing-3) '.' counter(counter-ch04-zabbix-collecting-data-preprocessing-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-preprocessing h4 {  counter-reset: counter-ch04-zabbix-collecting-data-preprocessing-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-preprocessing-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-preprocessing h5:before { content: '9.11.' counter(counter-ch04-zabbix-collecting-data-preprocessing-2) '.' counter(counter-ch04-zabbix-collecting-data-preprocessing-3) '.' counter(counter-ch04-zabbix-collecting-data-preprocessing-4) '.' counter(counter-ch04-zabbix-collecting-data-preprocessing-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-preprocessing h5 {  counter-increment: counter-ch04-zabbix-collecting-data-preprocessing-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-dependent > h1:before { content: '9.12 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dependent h2:before { content: '9.12.' counter(counter-ch04-zabbix-collecting-data-dependent-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dependent h2 {  counter-reset: counter-ch04-zabbix-collecting-data-dependent-3  counter-ch04-zabbix-collecting-data-dependent-4  counter-ch04-zabbix-collecting-data-dependent-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-dependent-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dependent h3:before { content: '9.12.' counter(counter-ch04-zabbix-collecting-data-dependent-2) '.' counter(counter-ch04-zabbix-collecting-data-dependent-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dependent h3 {  counter-reset: counter-ch04-zabbix-collecting-data-dependent-4  counter-ch04-zabbix-collecting-data-dependent-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-dependent-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dependent h4:before { content: '9.12.' counter(counter-ch04-zabbix-collecting-data-dependent-2) '.' counter(counter-ch04-zabbix-collecting-data-dependent-3) '.' counter(counter-ch04-zabbix-collecting-data-dependent-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dependent h4 {  counter-reset: counter-ch04-zabbix-collecting-data-dependent-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-dependent-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dependent h5:before { content: '9.12.' counter(counter-ch04-zabbix-collecting-data-dependent-2) '.' counter(counter-ch04-zabbix-collecting-data-dependent-3) '.' counter(counter-ch04-zabbix-collecting-data-dependent-4) '.' counter(counter-ch04-zabbix-collecting-data-dependent-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-dependent h5 {  counter-increment: counter-ch04-zabbix-collecting-data-dependent-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-ssh-telnet > h1:before { content: '9.13 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ssh-telnet h2:before { content: '9.13.' counter(counter-ch04-zabbix-collecting-data-ssh-telnet-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ssh-telnet h2 {  counter-reset: counter-ch04-zabbix-collecting-data-ssh-telnet-3  counter-ch04-zabbix-collecting-data-ssh-telnet-4  counter-ch04-zabbix-collecting-data-ssh-telnet-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-ssh-telnet-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ssh-telnet h3:before { content: '9.13.' counter(counter-ch04-zabbix-collecting-data-ssh-telnet-2) '.' counter(counter-ch04-zabbix-collecting-data-ssh-telnet-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ssh-telnet h3 {  counter-reset: counter-ch04-zabbix-collecting-data-ssh-telnet-4  counter-ch04-zabbix-collecting-data-ssh-telnet-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-ssh-telnet-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ssh-telnet h4:before { content: '9.13.' counter(counter-ch04-zabbix-collecting-data-ssh-telnet-2) '.' counter(counter-ch04-zabbix-collecting-data-ssh-telnet-3) '.' counter(counter-ch04-zabbix-collecting-data-ssh-telnet-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ssh-telnet h4 {  counter-reset: counter-ch04-zabbix-collecting-data-ssh-telnet-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-ssh-telnet-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ssh-telnet h5:before { content: '9.13.' counter(counter-ch04-zabbix-collecting-data-ssh-telnet-2) '.' counter(counter-ch04-zabbix-collecting-data-ssh-telnet-3) '.' counter(counter-ch04-zabbix-collecting-data-ssh-telnet-4) '.' counter(counter-ch04-zabbix-collecting-data-ssh-telnet-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ssh-telnet h5 {  counter-increment: counter-ch04-zabbix-collecting-data-ssh-telnet-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-script > h1:before { content: '9.14 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-script h2:before { content: '9.14.' counter(counter-ch04-zabbix-collecting-data-script-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-script h2 {  counter-reset: counter-ch04-zabbix-collecting-data-script-3  counter-ch04-zabbix-collecting-data-script-4  counter-ch04-zabbix-collecting-data-script-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-script-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-script h3:before { content: '9.14.' counter(counter-ch04-zabbix-collecting-data-script-2) '.' counter(counter-ch04-zabbix-collecting-data-script-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-script h3 {  counter-reset: counter-ch04-zabbix-collecting-data-script-4  counter-ch04-zabbix-collecting-data-script-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-script-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-script h4:before { content: '9.14.' counter(counter-ch04-zabbix-collecting-data-script-2) '.' counter(counter-ch04-zabbix-collecting-data-script-3) '.' counter(counter-ch04-zabbix-collecting-data-script-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-script h4 {  counter-reset: counter-ch04-zabbix-collecting-data-script-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-script-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-script h5:before { content: '9.14.' counter(counter-ch04-zabbix-collecting-data-script-2) '.' counter(counter-ch04-zabbix-collecting-data-script-3) '.' counter(counter-ch04-zabbix-collecting-data-script-4) '.' counter(counter-ch04-zabbix-collecting-data-script-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-script h5 {  counter-increment: counter-ch04-zabbix-collecting-data-script-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-jmx > h1:before { content: '9.15 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-jmx h2:before { content: '9.15.' counter(counter-ch04-zabbix-collecting-data-jmx-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-jmx h2 {  counter-reset: counter-ch04-zabbix-collecting-data-jmx-3  counter-ch04-zabbix-collecting-data-jmx-4  counter-ch04-zabbix-collecting-data-jmx-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-jmx-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-jmx h3:before { content: '9.15.' counter(counter-ch04-zabbix-collecting-data-jmx-2) '.' counter(counter-ch04-zabbix-collecting-data-jmx-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-jmx h3 {  counter-reset: counter-ch04-zabbix-collecting-data-jmx-4  counter-ch04-zabbix-collecting-data-jmx-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-jmx-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-jmx h4:before { content: '9.15.' counter(counter-ch04-zabbix-collecting-data-jmx-2) '.' counter(counter-ch04-zabbix-collecting-data-jmx-3) '.' counter(counter-ch04-zabbix-collecting-data-jmx-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-jmx h4 {  counter-reset: counter-ch04-zabbix-collecting-data-jmx-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-jmx-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-jmx h5:before { content: '9.15.' counter(counter-ch04-zabbix-collecting-data-jmx-2) '.' counter(counter-ch04-zabbix-collecting-data-jmx-3) '.' counter(counter-ch04-zabbix-collecting-data-jmx-4) '.' counter(counter-ch04-zabbix-collecting-data-jmx-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-jmx h5 {  counter-increment: counter-ch04-zabbix-collecting-data-jmx-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-ipmi > h1:before { content: '9.16 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ipmi h2:before { content: '9.16.' counter(counter-ch04-zabbix-collecting-data-ipmi-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ipmi h2 {  counter-reset: counter-ch04-zabbix-collecting-data-ipmi-3  counter-ch04-zabbix-collecting-data-ipmi-4  counter-ch04-zabbix-collecting-data-ipmi-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-ipmi-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ipmi h3:before { content: '9.16.' counter(counter-ch04-zabbix-collecting-data-ipmi-2) '.' counter(counter-ch04-zabbix-collecting-data-ipmi-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ipmi h3 {  counter-reset: counter-ch04-zabbix-collecting-data-ipmi-4  counter-ch04-zabbix-collecting-data-ipmi-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-ipmi-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ipmi h4:before { content: '9.16.' counter(counter-ch04-zabbix-collecting-data-ipmi-2) '.' counter(counter-ch04-zabbix-collecting-data-ipmi-3) '.' counter(counter-ch04-zabbix-collecting-data-ipmi-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ipmi h4 {  counter-reset: counter-ch04-zabbix-collecting-data-ipmi-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-ipmi-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ipmi h5:before { content: '9.16.' counter(counter-ch04-zabbix-collecting-data-ipmi-2) '.' counter(counter-ch04-zabbix-collecting-data-ipmi-3) '.' counter(counter-ch04-zabbix-collecting-data-ipmi-4) '.' counter(counter-ch04-zabbix-collecting-data-ipmi-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-ipmi h5 {  counter-increment: counter-ch04-zabbix-collecting-data-ipmi-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-database-odbc > h1:before { content: '9.17 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-odbc h2:before { content: '9.17.' counter(counter-ch04-zabbix-collecting-data-database-odbc-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-odbc h2 {  counter-reset: counter-ch04-zabbix-collecting-data-database-odbc-3  counter-ch04-zabbix-collecting-data-database-odbc-4  counter-ch04-zabbix-collecting-data-database-odbc-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-database-odbc-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-odbc h3:before { content: '9.17.' counter(counter-ch04-zabbix-collecting-data-database-odbc-2) '.' counter(counter-ch04-zabbix-collecting-data-database-odbc-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-odbc h3 {  counter-reset: counter-ch04-zabbix-collecting-data-database-odbc-4  counter-ch04-zabbix-collecting-data-database-odbc-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-database-odbc-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-odbc h4:before { content: '9.17.' counter(counter-ch04-zabbix-collecting-data-database-odbc-2) '.' counter(counter-ch04-zabbix-collecting-data-database-odbc-3) '.' counter(counter-ch04-zabbix-collecting-data-database-odbc-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-odbc h4 {  counter-reset: counter-ch04-zabbix-collecting-data-database-odbc-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-database-odbc-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-odbc h5:before { content: '9.17.' counter(counter-ch04-zabbix-collecting-data-database-odbc-2) '.' counter(counter-ch04-zabbix-collecting-data-database-odbc-3) '.' counter(counter-ch04-zabbix-collecting-data-database-odbc-4) '.' counter(counter-ch04-zabbix-collecting-data-database-odbc-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-odbc h5 {  counter-increment: counter-ch04-zabbix-collecting-data-database-odbc-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-database-agent > h1:before { content: '9.18 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-agent h2:before { content: '9.18.' counter(counter-ch04-zabbix-collecting-data-database-agent-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-agent h2 {  counter-reset: counter-ch04-zabbix-collecting-data-database-agent-3  counter-ch04-zabbix-collecting-data-database-agent-4  counter-ch04-zabbix-collecting-data-database-agent-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-database-agent-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-agent h3:before { content: '9.18.' counter(counter-ch04-zabbix-collecting-data-database-agent-2) '.' counter(counter-ch04-zabbix-collecting-data-database-agent-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-agent h3 {  counter-reset: counter-ch04-zabbix-collecting-data-database-agent-4  counter-ch04-zabbix-collecting-data-database-agent-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-database-agent-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-agent h4:before { content: '9.18.' counter(counter-ch04-zabbix-collecting-data-database-agent-2) '.' counter(counter-ch04-zabbix-collecting-data-database-agent-3) '.' counter(counter-ch04-zabbix-collecting-data-database-agent-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-agent h4 {  counter-reset: counter-ch04-zabbix-collecting-data-database-agent-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-database-agent-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-agent h5:before { content: '9.18.' counter(counter-ch04-zabbix-collecting-data-database-agent-2) '.' counter(counter-ch04-zabbix-collecting-data-database-agent-3) '.' counter(counter-ch04-zabbix-collecting-data-database-agent-4) '.' counter(counter-ch04-zabbix-collecting-data-database-agent-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-database-agent h5 {  counter-increment: counter-ch04-zabbix-collecting-data-database-agent-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-trapper > h1:before { content: '9.19 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-trapper h2:before { content: '9.19.' counter(counter-ch04-zabbix-collecting-data-zabbix-trapper-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-trapper h2 {  counter-reset: counter-ch04-zabbix-collecting-data-zabbix-trapper-3  counter-ch04-zabbix-collecting-data-zabbix-trapper-4  counter-ch04-zabbix-collecting-data-zabbix-trapper-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-trapper-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-trapper h3:before { content: '9.19.' counter(counter-ch04-zabbix-collecting-data-zabbix-trapper-2) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-trapper-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-trapper h3 {  counter-reset: counter-ch04-zabbix-collecting-data-zabbix-trapper-4  counter-ch04-zabbix-collecting-data-zabbix-trapper-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-trapper-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-trapper h4:before { content: '9.19.' counter(counter-ch04-zabbix-collecting-data-zabbix-trapper-2) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-trapper-3) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-trapper-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-trapper h4 {  counter-reset: counter-ch04-zabbix-collecting-data-zabbix-trapper-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-trapper-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-trapper h5:before { content: '9.19.' counter(counter-ch04-zabbix-collecting-data-zabbix-trapper-2) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-trapper-3) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-trapper-4) '.' counter(counter-ch04-zabbix-collecting-data-zabbix-trapper-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-zabbix-trapper h5 {  counter-increment: counter-ch04-zabbix-collecting-data-zabbix-trapper-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-external-checks > h1:before { content: '9.20 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-external-checks h2:before { content: '9.20.' counter(counter-ch04-zabbix-collecting-data-external-checks-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-external-checks h2 {  counter-reset: counter-ch04-zabbix-collecting-data-external-checks-3  counter-ch04-zabbix-collecting-data-external-checks-4  counter-ch04-zabbix-collecting-data-external-checks-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-external-checks-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-external-checks h3:before { content: '9.20.' counter(counter-ch04-zabbix-collecting-data-external-checks-2) '.' counter(counter-ch04-zabbix-collecting-data-external-checks-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-external-checks h3 {  counter-reset: counter-ch04-zabbix-collecting-data-external-checks-4  counter-ch04-zabbix-collecting-data-external-checks-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-external-checks-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-external-checks h4:before { content: '9.20.' counter(counter-ch04-zabbix-collecting-data-external-checks-2) '.' counter(counter-ch04-zabbix-collecting-data-external-checks-3) '.' counter(counter-ch04-zabbix-collecting-data-external-checks-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-external-checks h4 {  counter-reset: counter-ch04-zabbix-collecting-data-external-checks-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-external-checks-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-external-checks h5:before { content: '9.20.' counter(counter-ch04-zabbix-collecting-data-external-checks-2) '.' counter(counter-ch04-zabbix-collecting-data-external-checks-3) '.' counter(counter-ch04-zabbix-collecting-data-external-checks-4) '.' counter(counter-ch04-zabbix-collecting-data-external-checks-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-external-checks h5 {  counter-increment: counter-ch04-zabbix-collecting-data-external-checks-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-browser > h1:before { content: '9.21 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-browser h2:before { content: '9.21.' counter(counter-ch04-zabbix-collecting-data-browser-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-browser h2 {  counter-reset: counter-ch04-zabbix-collecting-data-browser-3  counter-ch04-zabbix-collecting-data-browser-4  counter-ch04-zabbix-collecting-data-browser-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-browser-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-browser h3:before { content: '9.21.' counter(counter-ch04-zabbix-collecting-data-browser-2) '.' counter(counter-ch04-zabbix-collecting-data-browser-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-browser h3 {  counter-reset: counter-ch04-zabbix-collecting-data-browser-4  counter-ch04-zabbix-collecting-data-browser-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-browser-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-browser h4:before { content: '9.21.' counter(counter-ch04-zabbix-collecting-data-browser-2) '.' counter(counter-ch04-zabbix-collecting-data-browser-3) '.' counter(counter-ch04-zabbix-collecting-data-browser-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-browser h4 {  counter-reset: counter-ch04-zabbix-collecting-data-browser-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-browser-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-browser h5:before { content: '9.21.' counter(counter-ch04-zabbix-collecting-data-browser-2) '.' counter(counter-ch04-zabbix-collecting-data-browser-3) '.' counter(counter-ch04-zabbix-collecting-data-browser-4) '.' counter(counter-ch04-zabbix-collecting-data-browser-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-browser h5 {  counter-increment: counter-ch04-zabbix-collecting-data-browser-5 }
            
.print-site-enumerate-headings #ch04-zabbix-collecting-data-calculated > h1:before { content: '9.22 ' }

                .print-site-enumerate-headings #ch04-zabbix-collecting-data-calculated h2:before { content: '9.22.' counter(counter-ch04-zabbix-collecting-data-calculated-2) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-calculated h2 {  counter-reset: counter-ch04-zabbix-collecting-data-calculated-3  counter-ch04-zabbix-collecting-data-calculated-4  counter-ch04-zabbix-collecting-data-calculated-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-calculated-2 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-calculated h3:before { content: '9.22.' counter(counter-ch04-zabbix-collecting-data-calculated-2) '.' counter(counter-ch04-zabbix-collecting-data-calculated-3) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-calculated h3 {  counter-reset: counter-ch04-zabbix-collecting-data-calculated-4  counter-ch04-zabbix-collecting-data-calculated-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-calculated-3 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-calculated h4:before { content: '9.22.' counter(counter-ch04-zabbix-collecting-data-calculated-2) '.' counter(counter-ch04-zabbix-collecting-data-calculated-3) '.' counter(counter-ch04-zabbix-collecting-data-calculated-4) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-calculated h4 {  counter-reset: counter-ch04-zabbix-collecting-data-calculated-5 ;  counter-increment: counter-ch04-zabbix-collecting-data-calculated-4 }
            
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-calculated h5:before { content: '9.22.' counter(counter-ch04-zabbix-collecting-data-calculated-2) '.' counter(counter-ch04-zabbix-collecting-data-calculated-3) '.' counter(counter-ch04-zabbix-collecting-data-calculated-4) '.' counter(counter-ch04-zabbix-collecting-data-calculated-5) ' ' }
                .print-site-enumerate-headings #ch04-zabbix-collecting-data-calculated h5 {  counter-increment: counter-ch04-zabbix-collecting-data-calculated-5 }
            
.print-site-enumerate-headings #section-10 > h1:before { content: '10 ' }
.print-site-enumerate-headings #ch05-zabbix-triggers-chapter > h1:before { content: '10.1 ' }

                .print-site-enumerate-headings #ch05-zabbix-triggers-chapter h2:before { content: '10.1.' counter(counter-ch05-zabbix-triggers-chapter-2) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-chapter h2 {  counter-reset: counter-ch05-zabbix-triggers-chapter-3  counter-ch05-zabbix-triggers-chapter-4  counter-ch05-zabbix-triggers-chapter-5 ;  counter-increment: counter-ch05-zabbix-triggers-chapter-2 }
            
                .print-site-enumerate-headings #ch05-zabbix-triggers-chapter h3:before { content: '10.1.' counter(counter-ch05-zabbix-triggers-chapter-2) '.' counter(counter-ch05-zabbix-triggers-chapter-3) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-chapter h3 {  counter-reset: counter-ch05-zabbix-triggers-chapter-4  counter-ch05-zabbix-triggers-chapter-5 ;  counter-increment: counter-ch05-zabbix-triggers-chapter-3 }
            
                .print-site-enumerate-headings #ch05-zabbix-triggers-chapter h4:before { content: '10.1.' counter(counter-ch05-zabbix-triggers-chapter-2) '.' counter(counter-ch05-zabbix-triggers-chapter-3) '.' counter(counter-ch05-zabbix-triggers-chapter-4) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-chapter h4 {  counter-reset: counter-ch05-zabbix-triggers-chapter-5 ;  counter-increment: counter-ch05-zabbix-triggers-chapter-4 }
            
                .print-site-enumerate-headings #ch05-zabbix-triggers-chapter h5:before { content: '10.1.' counter(counter-ch05-zabbix-triggers-chapter-2) '.' counter(counter-ch05-zabbix-triggers-chapter-3) '.' counter(counter-ch05-zabbix-triggers-chapter-4) '.' counter(counter-ch05-zabbix-triggers-chapter-5) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-chapter h5 {  counter-increment: counter-ch05-zabbix-triggers-chapter-5 }
            
.print-site-enumerate-headings #ch05-zabbix-triggers-triggers > h1:before { content: '10.2 ' }

                .print-site-enumerate-headings #ch05-zabbix-triggers-triggers h2:before { content: '10.2.' counter(counter-ch05-zabbix-triggers-triggers-2) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-triggers h2 {  counter-reset: counter-ch05-zabbix-triggers-triggers-3  counter-ch05-zabbix-triggers-triggers-4  counter-ch05-zabbix-triggers-triggers-5 ;  counter-increment: counter-ch05-zabbix-triggers-triggers-2 }
            
                .print-site-enumerate-headings #ch05-zabbix-triggers-triggers h3:before { content: '10.2.' counter(counter-ch05-zabbix-triggers-triggers-2) '.' counter(counter-ch05-zabbix-triggers-triggers-3) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-triggers h3 {  counter-reset: counter-ch05-zabbix-triggers-triggers-4  counter-ch05-zabbix-triggers-triggers-5 ;  counter-increment: counter-ch05-zabbix-triggers-triggers-3 }
            
                .print-site-enumerate-headings #ch05-zabbix-triggers-triggers h4:before { content: '10.2.' counter(counter-ch05-zabbix-triggers-triggers-2) '.' counter(counter-ch05-zabbix-triggers-triggers-3) '.' counter(counter-ch05-zabbix-triggers-triggers-4) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-triggers h4 {  counter-reset: counter-ch05-zabbix-triggers-triggers-5 ;  counter-increment: counter-ch05-zabbix-triggers-triggers-4 }
            
                .print-site-enumerate-headings #ch05-zabbix-triggers-triggers h5:before { content: '10.2.' counter(counter-ch05-zabbix-triggers-triggers-2) '.' counter(counter-ch05-zabbix-triggers-triggers-3) '.' counter(counter-ch05-zabbix-triggers-triggers-4) '.' counter(counter-ch05-zabbix-triggers-triggers-5) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-triggers h5 {  counter-increment: counter-ch05-zabbix-triggers-triggers-5 }
            
.print-site-enumerate-headings #ch05-zabbix-triggers-advanced-triggers > h1:before { content: '10.3 ' }

                .print-site-enumerate-headings #ch05-zabbix-triggers-advanced-triggers h2:before { content: '10.3.' counter(counter-ch05-zabbix-triggers-advanced-triggers-2) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-advanced-triggers h2 {  counter-reset: counter-ch05-zabbix-triggers-advanced-triggers-3  counter-ch05-zabbix-triggers-advanced-triggers-4  counter-ch05-zabbix-triggers-advanced-triggers-5 ;  counter-increment: counter-ch05-zabbix-triggers-advanced-triggers-2 }
            
                .print-site-enumerate-headings #ch05-zabbix-triggers-advanced-triggers h3:before { content: '10.3.' counter(counter-ch05-zabbix-triggers-advanced-triggers-2) '.' counter(counter-ch05-zabbix-triggers-advanced-triggers-3) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-advanced-triggers h3 {  counter-reset: counter-ch05-zabbix-triggers-advanced-triggers-4  counter-ch05-zabbix-triggers-advanced-triggers-5 ;  counter-increment: counter-ch05-zabbix-triggers-advanced-triggers-3 }
            
                .print-site-enumerate-headings #ch05-zabbix-triggers-advanced-triggers h4:before { content: '10.3.' counter(counter-ch05-zabbix-triggers-advanced-triggers-2) '.' counter(counter-ch05-zabbix-triggers-advanced-triggers-3) '.' counter(counter-ch05-zabbix-triggers-advanced-triggers-4) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-advanced-triggers h4 {  counter-reset: counter-ch05-zabbix-triggers-advanced-triggers-5 ;  counter-increment: counter-ch05-zabbix-triggers-advanced-triggers-4 }
            
                .print-site-enumerate-headings #ch05-zabbix-triggers-advanced-triggers h5:before { content: '10.3.' counter(counter-ch05-zabbix-triggers-advanced-triggers-2) '.' counter(counter-ch05-zabbix-triggers-advanced-triggers-3) '.' counter(counter-ch05-zabbix-triggers-advanced-triggers-4) '.' counter(counter-ch05-zabbix-triggers-advanced-triggers-5) ' ' }
                .print-site-enumerate-headings #ch05-zabbix-triggers-advanced-triggers h5 {  counter-increment: counter-ch05-zabbix-triggers-advanced-triggers-5 }
            
.print-site-enumerate-headings #section-11 > h1:before { content: '11 ' }
.print-site-enumerate-headings #ch06-zabbix-templates-chapter > h1:before { content: '11.1 ' }

                .print-site-enumerate-headings #ch06-zabbix-templates-chapter h2:before { content: '11.1.' counter(counter-ch06-zabbix-templates-chapter-2) ' ' }
                .print-site-enumerate-headings #ch06-zabbix-templates-chapter h2 {  counter-reset: counter-ch06-zabbix-templates-chapter-3  counter-ch06-zabbix-templates-chapter-4  counter-ch06-zabbix-templates-chapter-5 ;  counter-increment: counter-ch06-zabbix-templates-chapter-2 }
            
                .print-site-enumerate-headings #ch06-zabbix-templates-chapter h3:before { content: '11.1.' counter(counter-ch06-zabbix-templates-chapter-2) '.' counter(counter-ch06-zabbix-templates-chapter-3) ' ' }
                .print-site-enumerate-headings #ch06-zabbix-templates-chapter h3 {  counter-reset: counter-ch06-zabbix-templates-chapter-4  counter-ch06-zabbix-templates-chapter-5 ;  counter-increment: counter-ch06-zabbix-templates-chapter-3 }
            
                .print-site-enumerate-headings #ch06-zabbix-templates-chapter h4:before { content: '11.1.' counter(counter-ch06-zabbix-templates-chapter-2) '.' counter(counter-ch06-zabbix-templates-chapter-3) '.' counter(counter-ch06-zabbix-templates-chapter-4) ' ' }
                .print-site-enumerate-headings #ch06-zabbix-templates-chapter h4 {  counter-reset: counter-ch06-zabbix-templates-chapter-5 ;  counter-increment: counter-ch06-zabbix-templates-chapter-4 }
            
                .print-site-enumerate-headings #ch06-zabbix-templates-chapter h5:before { content: '11.1.' counter(counter-ch06-zabbix-templates-chapter-2) '.' counter(counter-ch06-zabbix-templates-chapter-3) '.' counter(counter-ch06-zabbix-templates-chapter-4) '.' counter(counter-ch06-zabbix-templates-chapter-5) ' ' }
                .print-site-enumerate-headings #ch06-zabbix-templates-chapter h5 {  counter-increment: counter-ch06-zabbix-templates-chapter-5 }
            
.print-site-enumerate-headings #ch06-zabbix-templates-templates > h1:before { content: '11.2 ' }

                .print-site-enumerate-headings #ch06-zabbix-templates-templates h2:before { content: '11.2.' counter(counter-ch06-zabbix-templates-templates-2) ' ' }
                .print-site-enumerate-headings #ch06-zabbix-templates-templates h2 {  counter-reset: counter-ch06-zabbix-templates-templates-3  counter-ch06-zabbix-templates-templates-4  counter-ch06-zabbix-templates-templates-5 ;  counter-increment: counter-ch06-zabbix-templates-templates-2 }
            
                .print-site-enumerate-headings #ch06-zabbix-templates-templates h3:before { content: '11.2.' counter(counter-ch06-zabbix-templates-templates-2) '.' counter(counter-ch06-zabbix-templates-templates-3) ' ' }
                .print-site-enumerate-headings #ch06-zabbix-templates-templates h3 {  counter-reset: counter-ch06-zabbix-templates-templates-4  counter-ch06-zabbix-templates-templates-5 ;  counter-increment: counter-ch06-zabbix-templates-templates-3 }
            
                .print-site-enumerate-headings #ch06-zabbix-templates-templates h4:before { content: '11.2.' counter(counter-ch06-zabbix-templates-templates-2) '.' counter(counter-ch06-zabbix-templates-templates-3) '.' counter(counter-ch06-zabbix-templates-templates-4) ' ' }
                .print-site-enumerate-headings #ch06-zabbix-templates-templates h4 {  counter-reset: counter-ch06-zabbix-templates-templates-5 ;  counter-increment: counter-ch06-zabbix-templates-templates-4 }
            
                .print-site-enumerate-headings #ch06-zabbix-templates-templates h5:before { content: '11.2.' counter(counter-ch06-zabbix-templates-templates-2) '.' counter(counter-ch06-zabbix-templates-templates-3) '.' counter(counter-ch06-zabbix-templates-templates-4) '.' counter(counter-ch06-zabbix-templates-templates-5) ' ' }
                .print-site-enumerate-headings #ch06-zabbix-templates-templates h5 {  counter-increment: counter-ch06-zabbix-templates-templates-5 }
            
.print-site-enumerate-headings #section-12 > h1:before { content: '12 ' }
.print-site-enumerate-headings #ch07-zabbix-alerts-chapter > h1:before { content: '12.1 ' }

                .print-site-enumerate-headings #ch07-zabbix-alerts-chapter h2:before { content: '12.1.' counter(counter-ch07-zabbix-alerts-chapter-2) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-chapter h2 {  counter-reset: counter-ch07-zabbix-alerts-chapter-3  counter-ch07-zabbix-alerts-chapter-4  counter-ch07-zabbix-alerts-chapter-5 ;  counter-increment: counter-ch07-zabbix-alerts-chapter-2 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-chapter h3:before { content: '12.1.' counter(counter-ch07-zabbix-alerts-chapter-2) '.' counter(counter-ch07-zabbix-alerts-chapter-3) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-chapter h3 {  counter-reset: counter-ch07-zabbix-alerts-chapter-4  counter-ch07-zabbix-alerts-chapter-5 ;  counter-increment: counter-ch07-zabbix-alerts-chapter-3 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-chapter h4:before { content: '12.1.' counter(counter-ch07-zabbix-alerts-chapter-2) '.' counter(counter-ch07-zabbix-alerts-chapter-3) '.' counter(counter-ch07-zabbix-alerts-chapter-4) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-chapter h4 {  counter-reset: counter-ch07-zabbix-alerts-chapter-5 ;  counter-increment: counter-ch07-zabbix-alerts-chapter-4 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-chapter h5:before { content: '12.1.' counter(counter-ch07-zabbix-alerts-chapter-2) '.' counter(counter-ch07-zabbix-alerts-chapter-3) '.' counter(counter-ch07-zabbix-alerts-chapter-4) '.' counter(counter-ch07-zabbix-alerts-chapter-5) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-chapter h5 {  counter-increment: counter-ch07-zabbix-alerts-chapter-5 }
            
.print-site-enumerate-headings #ch07-zabbix-alerts-media-types > h1:before { content: '12.2 ' }

                .print-site-enumerate-headings #ch07-zabbix-alerts-media-types h2:before { content: '12.2.' counter(counter-ch07-zabbix-alerts-media-types-2) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-media-types h2 {  counter-reset: counter-ch07-zabbix-alerts-media-types-3  counter-ch07-zabbix-alerts-media-types-4  counter-ch07-zabbix-alerts-media-types-5 ;  counter-increment: counter-ch07-zabbix-alerts-media-types-2 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-media-types h3:before { content: '12.2.' counter(counter-ch07-zabbix-alerts-media-types-2) '.' counter(counter-ch07-zabbix-alerts-media-types-3) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-media-types h3 {  counter-reset: counter-ch07-zabbix-alerts-media-types-4  counter-ch07-zabbix-alerts-media-types-5 ;  counter-increment: counter-ch07-zabbix-alerts-media-types-3 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-media-types h4:before { content: '12.2.' counter(counter-ch07-zabbix-alerts-media-types-2) '.' counter(counter-ch07-zabbix-alerts-media-types-3) '.' counter(counter-ch07-zabbix-alerts-media-types-4) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-media-types h4 {  counter-reset: counter-ch07-zabbix-alerts-media-types-5 ;  counter-increment: counter-ch07-zabbix-alerts-media-types-4 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-media-types h5:before { content: '12.2.' counter(counter-ch07-zabbix-alerts-media-types-2) '.' counter(counter-ch07-zabbix-alerts-media-types-3) '.' counter(counter-ch07-zabbix-alerts-media-types-4) '.' counter(counter-ch07-zabbix-alerts-media-types-5) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-media-types h5 {  counter-increment: counter-ch07-zabbix-alerts-media-types-5 }
            
.print-site-enumerate-headings #ch07-zabbix-alerts-scripts > h1:before { content: '12.3 ' }

                .print-site-enumerate-headings #ch07-zabbix-alerts-scripts h2:before { content: '12.3.' counter(counter-ch07-zabbix-alerts-scripts-2) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-scripts h2 {  counter-reset: counter-ch07-zabbix-alerts-scripts-3  counter-ch07-zabbix-alerts-scripts-4  counter-ch07-zabbix-alerts-scripts-5 ;  counter-increment: counter-ch07-zabbix-alerts-scripts-2 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-scripts h3:before { content: '12.3.' counter(counter-ch07-zabbix-alerts-scripts-2) '.' counter(counter-ch07-zabbix-alerts-scripts-3) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-scripts h3 {  counter-reset: counter-ch07-zabbix-alerts-scripts-4  counter-ch07-zabbix-alerts-scripts-5 ;  counter-increment: counter-ch07-zabbix-alerts-scripts-3 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-scripts h4:before { content: '12.3.' counter(counter-ch07-zabbix-alerts-scripts-2) '.' counter(counter-ch07-zabbix-alerts-scripts-3) '.' counter(counter-ch07-zabbix-alerts-scripts-4) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-scripts h4 {  counter-reset: counter-ch07-zabbix-alerts-scripts-5 ;  counter-increment: counter-ch07-zabbix-alerts-scripts-4 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-scripts h5:before { content: '12.3.' counter(counter-ch07-zabbix-alerts-scripts-2) '.' counter(counter-ch07-zabbix-alerts-scripts-3) '.' counter(counter-ch07-zabbix-alerts-scripts-4) '.' counter(counter-ch07-zabbix-alerts-scripts-5) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-scripts h5 {  counter-increment: counter-ch07-zabbix-alerts-scripts-5 }
            
.print-site-enumerate-headings #ch07-zabbix-alerts-actions > h1:before { content: '12.4 ' }

                .print-site-enumerate-headings #ch07-zabbix-alerts-actions h2:before { content: '12.4.' counter(counter-ch07-zabbix-alerts-actions-2) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-actions h2 {  counter-reset: counter-ch07-zabbix-alerts-actions-3  counter-ch07-zabbix-alerts-actions-4  counter-ch07-zabbix-alerts-actions-5 ;  counter-increment: counter-ch07-zabbix-alerts-actions-2 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-actions h3:before { content: '12.4.' counter(counter-ch07-zabbix-alerts-actions-2) '.' counter(counter-ch07-zabbix-alerts-actions-3) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-actions h3 {  counter-reset: counter-ch07-zabbix-alerts-actions-4  counter-ch07-zabbix-alerts-actions-5 ;  counter-increment: counter-ch07-zabbix-alerts-actions-3 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-actions h4:before { content: '12.4.' counter(counter-ch07-zabbix-alerts-actions-2) '.' counter(counter-ch07-zabbix-alerts-actions-3) '.' counter(counter-ch07-zabbix-alerts-actions-4) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-actions h4 {  counter-reset: counter-ch07-zabbix-alerts-actions-5 ;  counter-increment: counter-ch07-zabbix-alerts-actions-4 }
            
                .print-site-enumerate-headings #ch07-zabbix-alerts-actions h5:before { content: '12.4.' counter(counter-ch07-zabbix-alerts-actions-2) '.' counter(counter-ch07-zabbix-alerts-actions-3) '.' counter(counter-ch07-zabbix-alerts-actions-4) '.' counter(counter-ch07-zabbix-alerts-actions-5) ' ' }
                .print-site-enumerate-headings #ch07-zabbix-alerts-actions h5 {  counter-increment: counter-ch07-zabbix-alerts-actions-5 }
            
.print-site-enumerate-headings #section-13 > h1:before { content: '13 ' }
.print-site-enumerate-headings #ch08-zabbix-lld-chapter > h1:before { content: '13.1 ' }

                .print-site-enumerate-headings #ch08-zabbix-lld-chapter h2:before { content: '13.1.' counter(counter-ch08-zabbix-lld-chapter-2) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-chapter h2 {  counter-reset: counter-ch08-zabbix-lld-chapter-3  counter-ch08-zabbix-lld-chapter-4  counter-ch08-zabbix-lld-chapter-5 ;  counter-increment: counter-ch08-zabbix-lld-chapter-2 }
            
                .print-site-enumerate-headings #ch08-zabbix-lld-chapter h3:before { content: '13.1.' counter(counter-ch08-zabbix-lld-chapter-2) '.' counter(counter-ch08-zabbix-lld-chapter-3) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-chapter h3 {  counter-reset: counter-ch08-zabbix-lld-chapter-4  counter-ch08-zabbix-lld-chapter-5 ;  counter-increment: counter-ch08-zabbix-lld-chapter-3 }
            
                .print-site-enumerate-headings #ch08-zabbix-lld-chapter h4:before { content: '13.1.' counter(counter-ch08-zabbix-lld-chapter-2) '.' counter(counter-ch08-zabbix-lld-chapter-3) '.' counter(counter-ch08-zabbix-lld-chapter-4) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-chapter h4 {  counter-reset: counter-ch08-zabbix-lld-chapter-5 ;  counter-increment: counter-ch08-zabbix-lld-chapter-4 }
            
                .print-site-enumerate-headings #ch08-zabbix-lld-chapter h5:before { content: '13.1.' counter(counter-ch08-zabbix-lld-chapter-2) '.' counter(counter-ch08-zabbix-lld-chapter-3) '.' counter(counter-ch08-zabbix-lld-chapter-4) '.' counter(counter-ch08-zabbix-lld-chapter-5) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-chapter h5 {  counter-increment: counter-ch08-zabbix-lld-chapter-5 }
            
.print-site-enumerate-headings #ch08-zabbix-lld-custom > h1:before { content: '13.2 ' }

                .print-site-enumerate-headings #ch08-zabbix-lld-custom h2:before { content: '13.2.' counter(counter-ch08-zabbix-lld-custom-2) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-custom h2 {  counter-reset: counter-ch08-zabbix-lld-custom-3  counter-ch08-zabbix-lld-custom-4  counter-ch08-zabbix-lld-custom-5 ;  counter-increment: counter-ch08-zabbix-lld-custom-2 }
            
                .print-site-enumerate-headings #ch08-zabbix-lld-custom h3:before { content: '13.2.' counter(counter-ch08-zabbix-lld-custom-2) '.' counter(counter-ch08-zabbix-lld-custom-3) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-custom h3 {  counter-reset: counter-ch08-zabbix-lld-custom-4  counter-ch08-zabbix-lld-custom-5 ;  counter-increment: counter-ch08-zabbix-lld-custom-3 }
            
                .print-site-enumerate-headings #ch08-zabbix-lld-custom h4:before { content: '13.2.' counter(counter-ch08-zabbix-lld-custom-2) '.' counter(counter-ch08-zabbix-lld-custom-3) '.' counter(counter-ch08-zabbix-lld-custom-4) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-custom h4 {  counter-reset: counter-ch08-zabbix-lld-custom-5 ;  counter-increment: counter-ch08-zabbix-lld-custom-4 }
            
                .print-site-enumerate-headings #ch08-zabbix-lld-custom h5:before { content: '13.2.' counter(counter-ch08-zabbix-lld-custom-2) '.' counter(counter-ch08-zabbix-lld-custom-3) '.' counter(counter-ch08-zabbix-lld-custom-4) '.' counter(counter-ch08-zabbix-lld-custom-5) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-custom h5 {  counter-increment: counter-ch08-zabbix-lld-custom-5 }
            
.print-site-enumerate-headings #ch08-zabbix-lld-lld-with-dependent-items > h1:before { content: '13.3 ' }

                .print-site-enumerate-headings #ch08-zabbix-lld-lld-with-dependent-items h2:before { content: '13.3.' counter(counter-ch08-zabbix-lld-lld-with-dependent-items-2) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-lld-with-dependent-items h2 {  counter-reset: counter-ch08-zabbix-lld-lld-with-dependent-items-3  counter-ch08-zabbix-lld-lld-with-dependent-items-4  counter-ch08-zabbix-lld-lld-with-dependent-items-5 ;  counter-increment: counter-ch08-zabbix-lld-lld-with-dependent-items-2 }
            
                .print-site-enumerate-headings #ch08-zabbix-lld-lld-with-dependent-items h3:before { content: '13.3.' counter(counter-ch08-zabbix-lld-lld-with-dependent-items-2) '.' counter(counter-ch08-zabbix-lld-lld-with-dependent-items-3) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-lld-with-dependent-items h3 {  counter-reset: counter-ch08-zabbix-lld-lld-with-dependent-items-4  counter-ch08-zabbix-lld-lld-with-dependent-items-5 ;  counter-increment: counter-ch08-zabbix-lld-lld-with-dependent-items-3 }
            
                .print-site-enumerate-headings #ch08-zabbix-lld-lld-with-dependent-items h4:before { content: '13.3.' counter(counter-ch08-zabbix-lld-lld-with-dependent-items-2) '.' counter(counter-ch08-zabbix-lld-lld-with-dependent-items-3) '.' counter(counter-ch08-zabbix-lld-lld-with-dependent-items-4) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-lld-with-dependent-items h4 {  counter-reset: counter-ch08-zabbix-lld-lld-with-dependent-items-5 ;  counter-increment: counter-ch08-zabbix-lld-lld-with-dependent-items-4 }
            
                .print-site-enumerate-headings #ch08-zabbix-lld-lld-with-dependent-items h5:before { content: '13.3.' counter(counter-ch08-zabbix-lld-lld-with-dependent-items-2) '.' counter(counter-ch08-zabbix-lld-lld-with-dependent-items-3) '.' counter(counter-ch08-zabbix-lld-lld-with-dependent-items-4) '.' counter(counter-ch08-zabbix-lld-lld-with-dependent-items-5) ' ' }
                .print-site-enumerate-headings #ch08-zabbix-lld-lld-with-dependent-items h5 {  counter-increment: counter-ch08-zabbix-lld-lld-with-dependent-items-5 }
            
.print-site-enumerate-headings #section-14 > h1:before { content: '14 ' }
.print-site-enumerate-headings #ch09-zabbix-extending-chapter > h1:before { content: '14.1 ' }

                .print-site-enumerate-headings #ch09-zabbix-extending-chapter h2:before { content: '14.1.' counter(counter-ch09-zabbix-extending-chapter-2) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-chapter h2 {  counter-reset: counter-ch09-zabbix-extending-chapter-3  counter-ch09-zabbix-extending-chapter-4  counter-ch09-zabbix-extending-chapter-5 ;  counter-increment: counter-ch09-zabbix-extending-chapter-2 }
            
                .print-site-enumerate-headings #ch09-zabbix-extending-chapter h3:before { content: '14.1.' counter(counter-ch09-zabbix-extending-chapter-2) '.' counter(counter-ch09-zabbix-extending-chapter-3) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-chapter h3 {  counter-reset: counter-ch09-zabbix-extending-chapter-4  counter-ch09-zabbix-extending-chapter-5 ;  counter-increment: counter-ch09-zabbix-extending-chapter-3 }
            
                .print-site-enumerate-headings #ch09-zabbix-extending-chapter h4:before { content: '14.1.' counter(counter-ch09-zabbix-extending-chapter-2) '.' counter(counter-ch09-zabbix-extending-chapter-3) '.' counter(counter-ch09-zabbix-extending-chapter-4) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-chapter h4 {  counter-reset: counter-ch09-zabbix-extending-chapter-5 ;  counter-increment: counter-ch09-zabbix-extending-chapter-4 }
            
                .print-site-enumerate-headings #ch09-zabbix-extending-chapter h5:before { content: '14.1.' counter(counter-ch09-zabbix-extending-chapter-2) '.' counter(counter-ch09-zabbix-extending-chapter-3) '.' counter(counter-ch09-zabbix-extending-chapter-4) '.' counter(counter-ch09-zabbix-extending-chapter-5) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-chapter h5 {  counter-increment: counter-ch09-zabbix-extending-chapter-5 }
            
.print-site-enumerate-headings #ch09-zabbix-extending-frontend-scripts > h1:before { content: '14.2 ' }

                .print-site-enumerate-headings #ch09-zabbix-extending-frontend-scripts h2:before { content: '14.2.' counter(counter-ch09-zabbix-extending-frontend-scripts-2) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-frontend-scripts h2 {  counter-reset: counter-ch09-zabbix-extending-frontend-scripts-3  counter-ch09-zabbix-extending-frontend-scripts-4  counter-ch09-zabbix-extending-frontend-scripts-5 ;  counter-increment: counter-ch09-zabbix-extending-frontend-scripts-2 }
            
                .print-site-enumerate-headings #ch09-zabbix-extending-frontend-scripts h3:before { content: '14.2.' counter(counter-ch09-zabbix-extending-frontend-scripts-2) '.' counter(counter-ch09-zabbix-extending-frontend-scripts-3) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-frontend-scripts h3 {  counter-reset: counter-ch09-zabbix-extending-frontend-scripts-4  counter-ch09-zabbix-extending-frontend-scripts-5 ;  counter-increment: counter-ch09-zabbix-extending-frontend-scripts-3 }
            
                .print-site-enumerate-headings #ch09-zabbix-extending-frontend-scripts h4:before { content: '14.2.' counter(counter-ch09-zabbix-extending-frontend-scripts-2) '.' counter(counter-ch09-zabbix-extending-frontend-scripts-3) '.' counter(counter-ch09-zabbix-extending-frontend-scripts-4) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-frontend-scripts h4 {  counter-reset: counter-ch09-zabbix-extending-frontend-scripts-5 ;  counter-increment: counter-ch09-zabbix-extending-frontend-scripts-4 }
            
                .print-site-enumerate-headings #ch09-zabbix-extending-frontend-scripts h5:before { content: '14.2.' counter(counter-ch09-zabbix-extending-frontend-scripts-2) '.' counter(counter-ch09-zabbix-extending-frontend-scripts-3) '.' counter(counter-ch09-zabbix-extending-frontend-scripts-4) '.' counter(counter-ch09-zabbix-extending-frontend-scripts-5) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-frontend-scripts h5 {  counter-increment: counter-ch09-zabbix-extending-frontend-scripts-5 }
            
.print-site-enumerate-headings #ch09-zabbix-extending-user-parameters > h1:before { content: '14.3 ' }

                .print-site-enumerate-headings #ch09-zabbix-extending-user-parameters h2:before { content: '14.3.' counter(counter-ch09-zabbix-extending-user-parameters-2) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-user-parameters h2 {  counter-reset: counter-ch09-zabbix-extending-user-parameters-3  counter-ch09-zabbix-extending-user-parameters-4  counter-ch09-zabbix-extending-user-parameters-5 ;  counter-increment: counter-ch09-zabbix-extending-user-parameters-2 }
            
                .print-site-enumerate-headings #ch09-zabbix-extending-user-parameters h3:before { content: '14.3.' counter(counter-ch09-zabbix-extending-user-parameters-2) '.' counter(counter-ch09-zabbix-extending-user-parameters-3) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-user-parameters h3 {  counter-reset: counter-ch09-zabbix-extending-user-parameters-4  counter-ch09-zabbix-extending-user-parameters-5 ;  counter-increment: counter-ch09-zabbix-extending-user-parameters-3 }
            
                .print-site-enumerate-headings #ch09-zabbix-extending-user-parameters h4:before { content: '14.3.' counter(counter-ch09-zabbix-extending-user-parameters-2) '.' counter(counter-ch09-zabbix-extending-user-parameters-3) '.' counter(counter-ch09-zabbix-extending-user-parameters-4) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-user-parameters h4 {  counter-reset: counter-ch09-zabbix-extending-user-parameters-5 ;  counter-increment: counter-ch09-zabbix-extending-user-parameters-4 }
            
                .print-site-enumerate-headings #ch09-zabbix-extending-user-parameters h5:before { content: '14.3.' counter(counter-ch09-zabbix-extending-user-parameters-2) '.' counter(counter-ch09-zabbix-extending-user-parameters-3) '.' counter(counter-ch09-zabbix-extending-user-parameters-4) '.' counter(counter-ch09-zabbix-extending-user-parameters-5) ' ' }
                .print-site-enumerate-headings #ch09-zabbix-extending-user-parameters h5 {  counter-increment: counter-ch09-zabbix-extending-user-parameters-5 }
            
.print-site-enumerate-headings #section-15 > h1:before { content: '15 ' }
.print-site-enumerate-headings #ch10-zabbix-discovery-network-host-discovery > h1:before { content: '15.1 ' }

                .print-site-enumerate-headings #ch10-zabbix-discovery-network-host-discovery h2:before { content: '15.1.' counter(counter-ch10-zabbix-discovery-network-host-discovery-2) ' ' }
                .print-site-enumerate-headings #ch10-zabbix-discovery-network-host-discovery h2 {  counter-reset: counter-ch10-zabbix-discovery-network-host-discovery-3  counter-ch10-zabbix-discovery-network-host-discovery-4  counter-ch10-zabbix-discovery-network-host-discovery-5 ;  counter-increment: counter-ch10-zabbix-discovery-network-host-discovery-2 }
            
                .print-site-enumerate-headings #ch10-zabbix-discovery-network-host-discovery h3:before { content: '15.1.' counter(counter-ch10-zabbix-discovery-network-host-discovery-2) '.' counter(counter-ch10-zabbix-discovery-network-host-discovery-3) ' ' }
                .print-site-enumerate-headings #ch10-zabbix-discovery-network-host-discovery h3 {  counter-reset: counter-ch10-zabbix-discovery-network-host-discovery-4  counter-ch10-zabbix-discovery-network-host-discovery-5 ;  counter-increment: counter-ch10-zabbix-discovery-network-host-discovery-3 }
            
                .print-site-enumerate-headings #ch10-zabbix-discovery-network-host-discovery h4:before { content: '15.1.' counter(counter-ch10-zabbix-discovery-network-host-discovery-2) '.' counter(counter-ch10-zabbix-discovery-network-host-discovery-3) '.' counter(counter-ch10-zabbix-discovery-network-host-discovery-4) ' ' }
                .print-site-enumerate-headings #ch10-zabbix-discovery-network-host-discovery h4 {  counter-reset: counter-ch10-zabbix-discovery-network-host-discovery-5 ;  counter-increment: counter-ch10-zabbix-discovery-network-host-discovery-4 }
            
                .print-site-enumerate-headings #ch10-zabbix-discovery-network-host-discovery h5:before { content: '15.1.' counter(counter-ch10-zabbix-discovery-network-host-discovery-2) '.' counter(counter-ch10-zabbix-discovery-network-host-discovery-3) '.' counter(counter-ch10-zabbix-discovery-network-host-discovery-4) '.' counter(counter-ch10-zabbix-discovery-network-host-discovery-5) ' ' }
                .print-site-enumerate-headings #ch10-zabbix-discovery-network-host-discovery h5 {  counter-increment: counter-ch10-zabbix-discovery-network-host-discovery-5 }
            
.print-site-enumerate-headings #ch10-zabbix-discovery-active-agent-autoregistration > h1:before { content: '15.2 ' }

                .print-site-enumerate-headings #ch10-zabbix-discovery-active-agent-autoregistration h2:before { content: '15.2.' counter(counter-ch10-zabbix-discovery-active-agent-autoregistration-2) ' ' }
                .print-site-enumerate-headings #ch10-zabbix-discovery-active-agent-autoregistration h2 {  counter-reset: counter-ch10-zabbix-discovery-active-agent-autoregistration-3  counter-ch10-zabbix-discovery-active-agent-autoregistration-4  counter-ch10-zabbix-discovery-active-agent-autoregistration-5 ;  counter-increment: counter-ch10-zabbix-discovery-active-agent-autoregistration-2 }
            
                .print-site-enumerate-headings #ch10-zabbix-discovery-active-agent-autoregistration h3:before { content: '15.2.' counter(counter-ch10-zabbix-discovery-active-agent-autoregistration-2) '.' counter(counter-ch10-zabbix-discovery-active-agent-autoregistration-3) ' ' }
                .print-site-enumerate-headings #ch10-zabbix-discovery-active-agent-autoregistration h3 {  counter-reset: counter-ch10-zabbix-discovery-active-agent-autoregistration-4  counter-ch10-zabbix-discovery-active-agent-autoregistration-5 ;  counter-increment: counter-ch10-zabbix-discovery-active-agent-autoregistration-3 }
            
                .print-site-enumerate-headings #ch10-zabbix-discovery-active-agent-autoregistration h4:before { content: '15.2.' counter(counter-ch10-zabbix-discovery-active-agent-autoregistration-2) '.' counter(counter-ch10-zabbix-discovery-active-agent-autoregistration-3) '.' counter(counter-ch10-zabbix-discovery-active-agent-autoregistration-4) ' ' }
                .print-site-enumerate-headings #ch10-zabbix-discovery-active-agent-autoregistration h4 {  counter-reset: counter-ch10-zabbix-discovery-active-agent-autoregistration-5 ;  counter-increment: counter-ch10-zabbix-discovery-active-agent-autoregistration-4 }
            
                .print-site-enumerate-headings #ch10-zabbix-discovery-active-agent-autoregistration h5:before { content: '15.2.' counter(counter-ch10-zabbix-discovery-active-agent-autoregistration-2) '.' counter(counter-ch10-zabbix-discovery-active-agent-autoregistration-3) '.' counter(counter-ch10-zabbix-discovery-active-agent-autoregistration-4) '.' counter(counter-ch10-zabbix-discovery-active-agent-autoregistration-5) ' ' }
                .print-site-enumerate-headings #ch10-zabbix-discovery-active-agent-autoregistration h5 {  counter-increment: counter-ch10-zabbix-discovery-active-agent-autoregistration-5 }
            
.print-site-enumerate-headings #section-16 > h1:before { content: '16 ' }
.print-site-enumerate-headings #ch11-zabbix-visualisation-graphs > h1:before { content: '16.1 ' }

                .print-site-enumerate-headings #ch11-zabbix-visualisation-graphs h2:before { content: '16.1.' counter(counter-ch11-zabbix-visualisation-graphs-2) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-graphs h2 {  counter-reset: counter-ch11-zabbix-visualisation-graphs-3  counter-ch11-zabbix-visualisation-graphs-4  counter-ch11-zabbix-visualisation-graphs-5 ;  counter-increment: counter-ch11-zabbix-visualisation-graphs-2 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-graphs h3:before { content: '16.1.' counter(counter-ch11-zabbix-visualisation-graphs-2) '.' counter(counter-ch11-zabbix-visualisation-graphs-3) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-graphs h3 {  counter-reset: counter-ch11-zabbix-visualisation-graphs-4  counter-ch11-zabbix-visualisation-graphs-5 ;  counter-increment: counter-ch11-zabbix-visualisation-graphs-3 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-graphs h4:before { content: '16.1.' counter(counter-ch11-zabbix-visualisation-graphs-2) '.' counter(counter-ch11-zabbix-visualisation-graphs-3) '.' counter(counter-ch11-zabbix-visualisation-graphs-4) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-graphs h4 {  counter-reset: counter-ch11-zabbix-visualisation-graphs-5 ;  counter-increment: counter-ch11-zabbix-visualisation-graphs-4 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-graphs h5:before { content: '16.1.' counter(counter-ch11-zabbix-visualisation-graphs-2) '.' counter(counter-ch11-zabbix-visualisation-graphs-3) '.' counter(counter-ch11-zabbix-visualisation-graphs-4) '.' counter(counter-ch11-zabbix-visualisation-graphs-5) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-graphs h5 {  counter-increment: counter-ch11-zabbix-visualisation-graphs-5 }
            
.print-site-enumerate-headings #ch11-zabbix-visualisation-dashboards > h1:before { content: '16.2 ' }

                .print-site-enumerate-headings #ch11-zabbix-visualisation-dashboards h2:before { content: '16.2.' counter(counter-ch11-zabbix-visualisation-dashboards-2) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-dashboards h2 {  counter-reset: counter-ch11-zabbix-visualisation-dashboards-3  counter-ch11-zabbix-visualisation-dashboards-4  counter-ch11-zabbix-visualisation-dashboards-5 ;  counter-increment: counter-ch11-zabbix-visualisation-dashboards-2 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-dashboards h3:before { content: '16.2.' counter(counter-ch11-zabbix-visualisation-dashboards-2) '.' counter(counter-ch11-zabbix-visualisation-dashboards-3) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-dashboards h3 {  counter-reset: counter-ch11-zabbix-visualisation-dashboards-4  counter-ch11-zabbix-visualisation-dashboards-5 ;  counter-increment: counter-ch11-zabbix-visualisation-dashboards-3 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-dashboards h4:before { content: '16.2.' counter(counter-ch11-zabbix-visualisation-dashboards-2) '.' counter(counter-ch11-zabbix-visualisation-dashboards-3) '.' counter(counter-ch11-zabbix-visualisation-dashboards-4) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-dashboards h4 {  counter-reset: counter-ch11-zabbix-visualisation-dashboards-5 ;  counter-increment: counter-ch11-zabbix-visualisation-dashboards-4 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-dashboards h5:before { content: '16.2.' counter(counter-ch11-zabbix-visualisation-dashboards-2) '.' counter(counter-ch11-zabbix-visualisation-dashboards-3) '.' counter(counter-ch11-zabbix-visualisation-dashboards-4) '.' counter(counter-ch11-zabbix-visualisation-dashboards-5) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-dashboards h5 {  counter-increment: counter-ch11-zabbix-visualisation-dashboards-5 }
            
.print-site-enumerate-headings #ch11-zabbix-visualisation-maps > h1:before { content: '16.3 ' }

                .print-site-enumerate-headings #ch11-zabbix-visualisation-maps h2:before { content: '16.3.' counter(counter-ch11-zabbix-visualisation-maps-2) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-maps h2 {  counter-reset: counter-ch11-zabbix-visualisation-maps-3  counter-ch11-zabbix-visualisation-maps-4  counter-ch11-zabbix-visualisation-maps-5 ;  counter-increment: counter-ch11-zabbix-visualisation-maps-2 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-maps h3:before { content: '16.3.' counter(counter-ch11-zabbix-visualisation-maps-2) '.' counter(counter-ch11-zabbix-visualisation-maps-3) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-maps h3 {  counter-reset: counter-ch11-zabbix-visualisation-maps-4  counter-ch11-zabbix-visualisation-maps-5 ;  counter-increment: counter-ch11-zabbix-visualisation-maps-3 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-maps h4:before { content: '16.3.' counter(counter-ch11-zabbix-visualisation-maps-2) '.' counter(counter-ch11-zabbix-visualisation-maps-3) '.' counter(counter-ch11-zabbix-visualisation-maps-4) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-maps h4 {  counter-reset: counter-ch11-zabbix-visualisation-maps-5 ;  counter-increment: counter-ch11-zabbix-visualisation-maps-4 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-maps h5:before { content: '16.3.' counter(counter-ch11-zabbix-visualisation-maps-2) '.' counter(counter-ch11-zabbix-visualisation-maps-3) '.' counter(counter-ch11-zabbix-visualisation-maps-4) '.' counter(counter-ch11-zabbix-visualisation-maps-5) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-maps h5 {  counter-increment: counter-ch11-zabbix-visualisation-maps-5 }
            
.print-site-enumerate-headings #ch11-zabbix-visualisation-built-in-reports > h1:before { content: '16.4 ' }

                .print-site-enumerate-headings #ch11-zabbix-visualisation-built-in-reports h2:before { content: '16.4.' counter(counter-ch11-zabbix-visualisation-built-in-reports-2) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-built-in-reports h2 {  counter-reset: counter-ch11-zabbix-visualisation-built-in-reports-3  counter-ch11-zabbix-visualisation-built-in-reports-4  counter-ch11-zabbix-visualisation-built-in-reports-5 ;  counter-increment: counter-ch11-zabbix-visualisation-built-in-reports-2 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-built-in-reports h3:before { content: '16.4.' counter(counter-ch11-zabbix-visualisation-built-in-reports-2) '.' counter(counter-ch11-zabbix-visualisation-built-in-reports-3) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-built-in-reports h3 {  counter-reset: counter-ch11-zabbix-visualisation-built-in-reports-4  counter-ch11-zabbix-visualisation-built-in-reports-5 ;  counter-increment: counter-ch11-zabbix-visualisation-built-in-reports-3 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-built-in-reports h4:before { content: '16.4.' counter(counter-ch11-zabbix-visualisation-built-in-reports-2) '.' counter(counter-ch11-zabbix-visualisation-built-in-reports-3) '.' counter(counter-ch11-zabbix-visualisation-built-in-reports-4) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-built-in-reports h4 {  counter-reset: counter-ch11-zabbix-visualisation-built-in-reports-5 ;  counter-increment: counter-ch11-zabbix-visualisation-built-in-reports-4 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-built-in-reports h5:before { content: '16.4.' counter(counter-ch11-zabbix-visualisation-built-in-reports-2) '.' counter(counter-ch11-zabbix-visualisation-built-in-reports-3) '.' counter(counter-ch11-zabbix-visualisation-built-in-reports-4) '.' counter(counter-ch11-zabbix-visualisation-built-in-reports-5) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-built-in-reports h5 {  counter-increment: counter-ch11-zabbix-visualisation-built-in-reports-5 }
            
.print-site-enumerate-headings #ch11-zabbix-visualisation-automated-pdf-reports > h1:before { content: '16.5 ' }

                .print-site-enumerate-headings #ch11-zabbix-visualisation-automated-pdf-reports h2:before { content: '16.5.' counter(counter-ch11-zabbix-visualisation-automated-pdf-reports-2) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-automated-pdf-reports h2 {  counter-reset: counter-ch11-zabbix-visualisation-automated-pdf-reports-3  counter-ch11-zabbix-visualisation-automated-pdf-reports-4  counter-ch11-zabbix-visualisation-automated-pdf-reports-5 ;  counter-increment: counter-ch11-zabbix-visualisation-automated-pdf-reports-2 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-automated-pdf-reports h3:before { content: '16.5.' counter(counter-ch11-zabbix-visualisation-automated-pdf-reports-2) '.' counter(counter-ch11-zabbix-visualisation-automated-pdf-reports-3) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-automated-pdf-reports h3 {  counter-reset: counter-ch11-zabbix-visualisation-automated-pdf-reports-4  counter-ch11-zabbix-visualisation-automated-pdf-reports-5 ;  counter-increment: counter-ch11-zabbix-visualisation-automated-pdf-reports-3 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-automated-pdf-reports h4:before { content: '16.5.' counter(counter-ch11-zabbix-visualisation-automated-pdf-reports-2) '.' counter(counter-ch11-zabbix-visualisation-automated-pdf-reports-3) '.' counter(counter-ch11-zabbix-visualisation-automated-pdf-reports-4) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-automated-pdf-reports h4 {  counter-reset: counter-ch11-zabbix-visualisation-automated-pdf-reports-5 ;  counter-increment: counter-ch11-zabbix-visualisation-automated-pdf-reports-4 }
            
                .print-site-enumerate-headings #ch11-zabbix-visualisation-automated-pdf-reports h5:before { content: '16.5.' counter(counter-ch11-zabbix-visualisation-automated-pdf-reports-2) '.' counter(counter-ch11-zabbix-visualisation-automated-pdf-reports-3) '.' counter(counter-ch11-zabbix-visualisation-automated-pdf-reports-4) '.' counter(counter-ch11-zabbix-visualisation-automated-pdf-reports-5) ' ' }
                .print-site-enumerate-headings #ch11-zabbix-visualisation-automated-pdf-reports h5 {  counter-increment: counter-ch11-zabbix-visualisation-automated-pdf-reports-5 }
            
.print-site-enumerate-headings #section-17 > h1:before { content: '17 ' }
.print-site-enumerate-headings #ch12-zabbix-api-chapter > h1:before { content: '17.1 ' }

                .print-site-enumerate-headings #ch12-zabbix-api-chapter h2:before { content: '17.1.' counter(counter-ch12-zabbix-api-chapter-2) ' ' }
                .print-site-enumerate-headings #ch12-zabbix-api-chapter h2 {  counter-reset: counter-ch12-zabbix-api-chapter-3  counter-ch12-zabbix-api-chapter-4  counter-ch12-zabbix-api-chapter-5 ;  counter-increment: counter-ch12-zabbix-api-chapter-2 }
            
                .print-site-enumerate-headings #ch12-zabbix-api-chapter h3:before { content: '17.1.' counter(counter-ch12-zabbix-api-chapter-2) '.' counter(counter-ch12-zabbix-api-chapter-3) ' ' }
                .print-site-enumerate-headings #ch12-zabbix-api-chapter h3 {  counter-reset: counter-ch12-zabbix-api-chapter-4  counter-ch12-zabbix-api-chapter-5 ;  counter-increment: counter-ch12-zabbix-api-chapter-3 }
            
                .print-site-enumerate-headings #ch12-zabbix-api-chapter h4:before { content: '17.1.' counter(counter-ch12-zabbix-api-chapter-2) '.' counter(counter-ch12-zabbix-api-chapter-3) '.' counter(counter-ch12-zabbix-api-chapter-4) ' ' }
                .print-site-enumerate-headings #ch12-zabbix-api-chapter h4 {  counter-reset: counter-ch12-zabbix-api-chapter-5 ;  counter-increment: counter-ch12-zabbix-api-chapter-4 }
            
                .print-site-enumerate-headings #ch12-zabbix-api-chapter h5:before { content: '17.1.' counter(counter-ch12-zabbix-api-chapter-2) '.' counter(counter-ch12-zabbix-api-chapter-3) '.' counter(counter-ch12-zabbix-api-chapter-4) '.' counter(counter-ch12-zabbix-api-chapter-5) ' ' }
                .print-site-enumerate-headings #ch12-zabbix-api-chapter h5 {  counter-increment: counter-ch12-zabbix-api-chapter-5 }
            
.print-site-enumerate-headings #ch12-zabbix-api-self-engaging > h1:before { content: '17.2 ' }

                .print-site-enumerate-headings #ch12-zabbix-api-self-engaging h2:before { content: '17.2.' counter(counter-ch12-zabbix-api-self-engaging-2) ' ' }
                .print-site-enumerate-headings #ch12-zabbix-api-self-engaging h2 {  counter-reset: counter-ch12-zabbix-api-self-engaging-3  counter-ch12-zabbix-api-self-engaging-4  counter-ch12-zabbix-api-self-engaging-5 ;  counter-increment: counter-ch12-zabbix-api-self-engaging-2 }
            
                .print-site-enumerate-headings #ch12-zabbix-api-self-engaging h3:before { content: '17.2.' counter(counter-ch12-zabbix-api-self-engaging-2) '.' counter(counter-ch12-zabbix-api-self-engaging-3) ' ' }
                .print-site-enumerate-headings #ch12-zabbix-api-self-engaging h3 {  counter-reset: counter-ch12-zabbix-api-self-engaging-4  counter-ch12-zabbix-api-self-engaging-5 ;  counter-increment: counter-ch12-zabbix-api-self-engaging-3 }
            
                .print-site-enumerate-headings #ch12-zabbix-api-self-engaging h4:before { content: '17.2.' counter(counter-ch12-zabbix-api-self-engaging-2) '.' counter(counter-ch12-zabbix-api-self-engaging-3) '.' counter(counter-ch12-zabbix-api-self-engaging-4) ' ' }
                .print-site-enumerate-headings #ch12-zabbix-api-self-engaging h4 {  counter-reset: counter-ch12-zabbix-api-self-engaging-5 ;  counter-increment: counter-ch12-zabbix-api-self-engaging-4 }
            
                .print-site-enumerate-headings #ch12-zabbix-api-self-engaging h5:before { content: '17.2.' counter(counter-ch12-zabbix-api-self-engaging-2) '.' counter(counter-ch12-zabbix-api-self-engaging-3) '.' counter(counter-ch12-zabbix-api-self-engaging-4) '.' counter(counter-ch12-zabbix-api-self-engaging-5) ' ' }
                .print-site-enumerate-headings #ch12-zabbix-api-self-engaging h5 {  counter-increment: counter-ch12-zabbix-api-self-engaging-5 }
            
.print-site-enumerate-headings #section-18 > h1:before { content: '18 ' }
.print-site-enumerate-headings #ch13-advanced-security-chapter > h1:before { content: '18.1 ' }

                .print-site-enumerate-headings #ch13-advanced-security-chapter h2:before { content: '18.1.' counter(counter-ch13-advanced-security-chapter-2) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-chapter h2 {  counter-reset: counter-ch13-advanced-security-chapter-3  counter-ch13-advanced-security-chapter-4  counter-ch13-advanced-security-chapter-5 ;  counter-increment: counter-ch13-advanced-security-chapter-2 }
            
                .print-site-enumerate-headings #ch13-advanced-security-chapter h3:before { content: '18.1.' counter(counter-ch13-advanced-security-chapter-2) '.' counter(counter-ch13-advanced-security-chapter-3) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-chapter h3 {  counter-reset: counter-ch13-advanced-security-chapter-4  counter-ch13-advanced-security-chapter-5 ;  counter-increment: counter-ch13-advanced-security-chapter-3 }
            
                .print-site-enumerate-headings #ch13-advanced-security-chapter h4:before { content: '18.1.' counter(counter-ch13-advanced-security-chapter-2) '.' counter(counter-ch13-advanced-security-chapter-3) '.' counter(counter-ch13-advanced-security-chapter-4) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-chapter h4 {  counter-reset: counter-ch13-advanced-security-chapter-5 ;  counter-increment: counter-ch13-advanced-security-chapter-4 }
            
                .print-site-enumerate-headings #ch13-advanced-security-chapter h5:before { content: '18.1.' counter(counter-ch13-advanced-security-chapter-2) '.' counter(counter-ch13-advanced-security-chapter-3) '.' counter(counter-ch13-advanced-security-chapter-4) '.' counter(counter-ch13-advanced-security-chapter-5) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-chapter h5 {  counter-increment: counter-ch13-advanced-security-chapter-5 }
            
.print-site-enumerate-headings #ch13-advanced-security-selinux-zabbix > h1:before { content: '18.2 ' }

                .print-site-enumerate-headings #ch13-advanced-security-selinux-zabbix h2:before { content: '18.2.' counter(counter-ch13-advanced-security-selinux-zabbix-2) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-selinux-zabbix h2 {  counter-reset: counter-ch13-advanced-security-selinux-zabbix-3  counter-ch13-advanced-security-selinux-zabbix-4  counter-ch13-advanced-security-selinux-zabbix-5 ;  counter-increment: counter-ch13-advanced-security-selinux-zabbix-2 }
            
                .print-site-enumerate-headings #ch13-advanced-security-selinux-zabbix h3:before { content: '18.2.' counter(counter-ch13-advanced-security-selinux-zabbix-2) '.' counter(counter-ch13-advanced-security-selinux-zabbix-3) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-selinux-zabbix h3 {  counter-reset: counter-ch13-advanced-security-selinux-zabbix-4  counter-ch13-advanced-security-selinux-zabbix-5 ;  counter-increment: counter-ch13-advanced-security-selinux-zabbix-3 }
            
                .print-site-enumerate-headings #ch13-advanced-security-selinux-zabbix h4:before { content: '18.2.' counter(counter-ch13-advanced-security-selinux-zabbix-2) '.' counter(counter-ch13-advanced-security-selinux-zabbix-3) '.' counter(counter-ch13-advanced-security-selinux-zabbix-4) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-selinux-zabbix h4 {  counter-reset: counter-ch13-advanced-security-selinux-zabbix-5 ;  counter-increment: counter-ch13-advanced-security-selinux-zabbix-4 }
            
                .print-site-enumerate-headings #ch13-advanced-security-selinux-zabbix h5:before { content: '18.2.' counter(counter-ch13-advanced-security-selinux-zabbix-2) '.' counter(counter-ch13-advanced-security-selinux-zabbix-3) '.' counter(counter-ch13-advanced-security-selinux-zabbix-4) '.' counter(counter-ch13-advanced-security-selinux-zabbix-5) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-selinux-zabbix h5 {  counter-increment: counter-ch13-advanced-security-selinux-zabbix-5 }
            
.print-site-enumerate-headings #ch13-advanced-security-securing-frontend > h1:before { content: '18.3 ' }

                .print-site-enumerate-headings #ch13-advanced-security-securing-frontend h2:before { content: '18.3.' counter(counter-ch13-advanced-security-securing-frontend-2) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-securing-frontend h2 {  counter-reset: counter-ch13-advanced-security-securing-frontend-3  counter-ch13-advanced-security-securing-frontend-4  counter-ch13-advanced-security-securing-frontend-5 ;  counter-increment: counter-ch13-advanced-security-securing-frontend-2 }
            
                .print-site-enumerate-headings #ch13-advanced-security-securing-frontend h3:before { content: '18.3.' counter(counter-ch13-advanced-security-securing-frontend-2) '.' counter(counter-ch13-advanced-security-securing-frontend-3) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-securing-frontend h3 {  counter-reset: counter-ch13-advanced-security-securing-frontend-4  counter-ch13-advanced-security-securing-frontend-5 ;  counter-increment: counter-ch13-advanced-security-securing-frontend-3 }
            
                .print-site-enumerate-headings #ch13-advanced-security-securing-frontend h4:before { content: '18.3.' counter(counter-ch13-advanced-security-securing-frontend-2) '.' counter(counter-ch13-advanced-security-securing-frontend-3) '.' counter(counter-ch13-advanced-security-securing-frontend-4) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-securing-frontend h4 {  counter-reset: counter-ch13-advanced-security-securing-frontend-5 ;  counter-increment: counter-ch13-advanced-security-securing-frontend-4 }
            
                .print-site-enumerate-headings #ch13-advanced-security-securing-frontend h5:before { content: '18.3.' counter(counter-ch13-advanced-security-securing-frontend-2) '.' counter(counter-ch13-advanced-security-securing-frontend-3) '.' counter(counter-ch13-advanced-security-securing-frontend-4) '.' counter(counter-ch13-advanced-security-securing-frontend-5) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-securing-frontend h5 {  counter-increment: counter-ch13-advanced-security-securing-frontend-5 }
            
.print-site-enumerate-headings #ch13-advanced-security-agent-security > h1:before { content: '18.4 ' }

                .print-site-enumerate-headings #ch13-advanced-security-agent-security h2:before { content: '18.4.' counter(counter-ch13-advanced-security-agent-security-2) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-agent-security h2 {  counter-reset: counter-ch13-advanced-security-agent-security-3  counter-ch13-advanced-security-agent-security-4  counter-ch13-advanced-security-agent-security-5 ;  counter-increment: counter-ch13-advanced-security-agent-security-2 }
            
                .print-site-enumerate-headings #ch13-advanced-security-agent-security h3:before { content: '18.4.' counter(counter-ch13-advanced-security-agent-security-2) '.' counter(counter-ch13-advanced-security-agent-security-3) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-agent-security h3 {  counter-reset: counter-ch13-advanced-security-agent-security-4  counter-ch13-advanced-security-agent-security-5 ;  counter-increment: counter-ch13-advanced-security-agent-security-3 }
            
                .print-site-enumerate-headings #ch13-advanced-security-agent-security h4:before { content: '18.4.' counter(counter-ch13-advanced-security-agent-security-2) '.' counter(counter-ch13-advanced-security-agent-security-3) '.' counter(counter-ch13-advanced-security-agent-security-4) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-agent-security h4 {  counter-reset: counter-ch13-advanced-security-agent-security-5 ;  counter-increment: counter-ch13-advanced-security-agent-security-4 }
            
                .print-site-enumerate-headings #ch13-advanced-security-agent-security h5:before { content: '18.4.' counter(counter-ch13-advanced-security-agent-security-2) '.' counter(counter-ch13-advanced-security-agent-security-3) '.' counter(counter-ch13-advanced-security-agent-security-4) '.' counter(counter-ch13-advanced-security-agent-security-5) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-agent-security h5 {  counter-increment: counter-ch13-advanced-security-agent-security-5 }
            
.print-site-enumerate-headings #ch13-advanced-security-using-vault > h1:before { content: '18.5 ' }

                .print-site-enumerate-headings #ch13-advanced-security-using-vault h2:before { content: '18.5.' counter(counter-ch13-advanced-security-using-vault-2) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-using-vault h2 {  counter-reset: counter-ch13-advanced-security-using-vault-3  counter-ch13-advanced-security-using-vault-4  counter-ch13-advanced-security-using-vault-5 ;  counter-increment: counter-ch13-advanced-security-using-vault-2 }
            
                .print-site-enumerate-headings #ch13-advanced-security-using-vault h3:before { content: '18.5.' counter(counter-ch13-advanced-security-using-vault-2) '.' counter(counter-ch13-advanced-security-using-vault-3) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-using-vault h3 {  counter-reset: counter-ch13-advanced-security-using-vault-4  counter-ch13-advanced-security-using-vault-5 ;  counter-increment: counter-ch13-advanced-security-using-vault-3 }
            
                .print-site-enumerate-headings #ch13-advanced-security-using-vault h4:before { content: '18.5.' counter(counter-ch13-advanced-security-using-vault-2) '.' counter(counter-ch13-advanced-security-using-vault-3) '.' counter(counter-ch13-advanced-security-using-vault-4) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-using-vault h4 {  counter-reset: counter-ch13-advanced-security-using-vault-5 ;  counter-increment: counter-ch13-advanced-security-using-vault-4 }
            
                .print-site-enumerate-headings #ch13-advanced-security-using-vault h5:before { content: '18.5.' counter(counter-ch13-advanced-security-using-vault-2) '.' counter(counter-ch13-advanced-security-using-vault-3) '.' counter(counter-ch13-advanced-security-using-vault-4) '.' counter(counter-ch13-advanced-security-using-vault-5) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-using-vault h5 {  counter-increment: counter-ch13-advanced-security-using-vault-5 }
            
.print-site-enumerate-headings #ch13-advanced-security-partitioning-database > h1:before { content: '18.6 ' }

                .print-site-enumerate-headings #ch13-advanced-security-partitioning-database h2:before { content: '18.6.' counter(counter-ch13-advanced-security-partitioning-database-2) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-database h2 {  counter-reset: counter-ch13-advanced-security-partitioning-database-3  counter-ch13-advanced-security-partitioning-database-4  counter-ch13-advanced-security-partitioning-database-5 ;  counter-increment: counter-ch13-advanced-security-partitioning-database-2 }
            
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-database h3:before { content: '18.6.' counter(counter-ch13-advanced-security-partitioning-database-2) '.' counter(counter-ch13-advanced-security-partitioning-database-3) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-database h3 {  counter-reset: counter-ch13-advanced-security-partitioning-database-4  counter-ch13-advanced-security-partitioning-database-5 ;  counter-increment: counter-ch13-advanced-security-partitioning-database-3 }
            
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-database h4:before { content: '18.6.' counter(counter-ch13-advanced-security-partitioning-database-2) '.' counter(counter-ch13-advanced-security-partitioning-database-3) '.' counter(counter-ch13-advanced-security-partitioning-database-4) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-database h4 {  counter-reset: counter-ch13-advanced-security-partitioning-database-5 ;  counter-increment: counter-ch13-advanced-security-partitioning-database-4 }
            
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-database h5:before { content: '18.6.' counter(counter-ch13-advanced-security-partitioning-database-2) '.' counter(counter-ch13-advanced-security-partitioning-database-3) '.' counter(counter-ch13-advanced-security-partitioning-database-4) '.' counter(counter-ch13-advanced-security-partitioning-database-5) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-database h5 {  counter-increment: counter-ch13-advanced-security-partitioning-database-5 }
            
.print-site-enumerate-headings #ch13-advanced-security-partitioning-postgresql-database > h1:before { content: '18.7 ' }

                .print-site-enumerate-headings #ch13-advanced-security-partitioning-postgresql-database h2:before { content: '18.7.' counter(counter-ch13-advanced-security-partitioning-postgresql-database-2) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-postgresql-database h2 {  counter-reset: counter-ch13-advanced-security-partitioning-postgresql-database-3  counter-ch13-advanced-security-partitioning-postgresql-database-4  counter-ch13-advanced-security-partitioning-postgresql-database-5 ;  counter-increment: counter-ch13-advanced-security-partitioning-postgresql-database-2 }
            
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-postgresql-database h3:before { content: '18.7.' counter(counter-ch13-advanced-security-partitioning-postgresql-database-2) '.' counter(counter-ch13-advanced-security-partitioning-postgresql-database-3) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-postgresql-database h3 {  counter-reset: counter-ch13-advanced-security-partitioning-postgresql-database-4  counter-ch13-advanced-security-partitioning-postgresql-database-5 ;  counter-increment: counter-ch13-advanced-security-partitioning-postgresql-database-3 }
            
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-postgresql-database h4:before { content: '18.7.' counter(counter-ch13-advanced-security-partitioning-postgresql-database-2) '.' counter(counter-ch13-advanced-security-partitioning-postgresql-database-3) '.' counter(counter-ch13-advanced-security-partitioning-postgresql-database-4) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-postgresql-database h4 {  counter-reset: counter-ch13-advanced-security-partitioning-postgresql-database-5 ;  counter-increment: counter-ch13-advanced-security-partitioning-postgresql-database-4 }
            
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-postgresql-database h5:before { content: '18.7.' counter(counter-ch13-advanced-security-partitioning-postgresql-database-2) '.' counter(counter-ch13-advanced-security-partitioning-postgresql-database-3) '.' counter(counter-ch13-advanced-security-partitioning-postgresql-database-4) '.' counter(counter-ch13-advanced-security-partitioning-postgresql-database-5) ' ' }
                .print-site-enumerate-headings #ch13-advanced-security-partitioning-postgresql-database h5 {  counter-increment: counter-ch13-advanced-security-partitioning-postgresql-database-5 }
            
.print-site-enumerate-headings #section-19 > h1:before { content: '19 ' }
.print-site-enumerate-headings #ch14-zabbix-maintenance-chapter > h1:before { content: '19.1 ' }

                .print-site-enumerate-headings #ch14-zabbix-maintenance-chapter h2:before { content: '19.1.' counter(counter-ch14-zabbix-maintenance-chapter-2) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-chapter h2 {  counter-reset: counter-ch14-zabbix-maintenance-chapter-3  counter-ch14-zabbix-maintenance-chapter-4  counter-ch14-zabbix-maintenance-chapter-5 ;  counter-increment: counter-ch14-zabbix-maintenance-chapter-2 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-chapter h3:before { content: '19.1.' counter(counter-ch14-zabbix-maintenance-chapter-2) '.' counter(counter-ch14-zabbix-maintenance-chapter-3) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-chapter h3 {  counter-reset: counter-ch14-zabbix-maintenance-chapter-4  counter-ch14-zabbix-maintenance-chapter-5 ;  counter-increment: counter-ch14-zabbix-maintenance-chapter-3 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-chapter h4:before { content: '19.1.' counter(counter-ch14-zabbix-maintenance-chapter-2) '.' counter(counter-ch14-zabbix-maintenance-chapter-3) '.' counter(counter-ch14-zabbix-maintenance-chapter-4) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-chapter h4 {  counter-reset: counter-ch14-zabbix-maintenance-chapter-5 ;  counter-increment: counter-ch14-zabbix-maintenance-chapter-4 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-chapter h5:before { content: '19.1.' counter(counter-ch14-zabbix-maintenance-chapter-2) '.' counter(counter-ch14-zabbix-maintenance-chapter-3) '.' counter(counter-ch14-zabbix-maintenance-chapter-4) '.' counter(counter-ch14-zabbix-maintenance-chapter-5) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-chapter h5 {  counter-increment: counter-ch14-zabbix-maintenance-chapter-5 }
            
.print-site-enumerate-headings #ch14-zabbix-maintenance-maintenance > h1:before { content: '19.2 ' }

                .print-site-enumerate-headings #ch14-zabbix-maintenance-maintenance h2:before { content: '19.2.' counter(counter-ch14-zabbix-maintenance-maintenance-2) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-maintenance h2 {  counter-reset: counter-ch14-zabbix-maintenance-maintenance-3  counter-ch14-zabbix-maintenance-maintenance-4  counter-ch14-zabbix-maintenance-maintenance-5 ;  counter-increment: counter-ch14-zabbix-maintenance-maintenance-2 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-maintenance h3:before { content: '19.2.' counter(counter-ch14-zabbix-maintenance-maintenance-2) '.' counter(counter-ch14-zabbix-maintenance-maintenance-3) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-maintenance h3 {  counter-reset: counter-ch14-zabbix-maintenance-maintenance-4  counter-ch14-zabbix-maintenance-maintenance-5 ;  counter-increment: counter-ch14-zabbix-maintenance-maintenance-3 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-maintenance h4:before { content: '19.2.' counter(counter-ch14-zabbix-maintenance-maintenance-2) '.' counter(counter-ch14-zabbix-maintenance-maintenance-3) '.' counter(counter-ch14-zabbix-maintenance-maintenance-4) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-maintenance h4 {  counter-reset: counter-ch14-zabbix-maintenance-maintenance-5 ;  counter-increment: counter-ch14-zabbix-maintenance-maintenance-4 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-maintenance h5:before { content: '19.2.' counter(counter-ch14-zabbix-maintenance-maintenance-2) '.' counter(counter-ch14-zabbix-maintenance-maintenance-3) '.' counter(counter-ch14-zabbix-maintenance-maintenance-4) '.' counter(counter-ch14-zabbix-maintenance-maintenance-5) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-maintenance h5 {  counter-increment: counter-ch14-zabbix-maintenance-maintenance-5 }
            
.print-site-enumerate-headings #ch14-zabbix-maintenance-internal-health > h1:before { content: '19.3 ' }

                .print-site-enumerate-headings #ch14-zabbix-maintenance-internal-health h2:before { content: '19.3.' counter(counter-ch14-zabbix-maintenance-internal-health-2) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-internal-health h2 {  counter-reset: counter-ch14-zabbix-maintenance-internal-health-3  counter-ch14-zabbix-maintenance-internal-health-4  counter-ch14-zabbix-maintenance-internal-health-5 ;  counter-increment: counter-ch14-zabbix-maintenance-internal-health-2 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-internal-health h3:before { content: '19.3.' counter(counter-ch14-zabbix-maintenance-internal-health-2) '.' counter(counter-ch14-zabbix-maintenance-internal-health-3) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-internal-health h3 {  counter-reset: counter-ch14-zabbix-maintenance-internal-health-4  counter-ch14-zabbix-maintenance-internal-health-5 ;  counter-increment: counter-ch14-zabbix-maintenance-internal-health-3 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-internal-health h4:before { content: '19.3.' counter(counter-ch14-zabbix-maintenance-internal-health-2) '.' counter(counter-ch14-zabbix-maintenance-internal-health-3) '.' counter(counter-ch14-zabbix-maintenance-internal-health-4) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-internal-health h4 {  counter-reset: counter-ch14-zabbix-maintenance-internal-health-5 ;  counter-increment: counter-ch14-zabbix-maintenance-internal-health-4 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-internal-health h5:before { content: '19.3.' counter(counter-ch14-zabbix-maintenance-internal-health-2) '.' counter(counter-ch14-zabbix-maintenance-internal-health-3) '.' counter(counter-ch14-zabbix-maintenance-internal-health-4) '.' counter(counter-ch14-zabbix-maintenance-internal-health-5) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-internal-health h5 {  counter-increment: counter-ch14-zabbix-maintenance-internal-health-5 }
            
.print-site-enumerate-headings #ch14-zabbix-maintenance-taking-backups > h1:before { content: '19.4 ' }

                .print-site-enumerate-headings #ch14-zabbix-maintenance-taking-backups h2:before { content: '19.4.' counter(counter-ch14-zabbix-maintenance-taking-backups-2) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-taking-backups h2 {  counter-reset: counter-ch14-zabbix-maintenance-taking-backups-3  counter-ch14-zabbix-maintenance-taking-backups-4  counter-ch14-zabbix-maintenance-taking-backups-5 ;  counter-increment: counter-ch14-zabbix-maintenance-taking-backups-2 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-taking-backups h3:before { content: '19.4.' counter(counter-ch14-zabbix-maintenance-taking-backups-2) '.' counter(counter-ch14-zabbix-maintenance-taking-backups-3) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-taking-backups h3 {  counter-reset: counter-ch14-zabbix-maintenance-taking-backups-4  counter-ch14-zabbix-maintenance-taking-backups-5 ;  counter-increment: counter-ch14-zabbix-maintenance-taking-backups-3 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-taking-backups h4:before { content: '19.4.' counter(counter-ch14-zabbix-maintenance-taking-backups-2) '.' counter(counter-ch14-zabbix-maintenance-taking-backups-3) '.' counter(counter-ch14-zabbix-maintenance-taking-backups-4) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-taking-backups h4 {  counter-reset: counter-ch14-zabbix-maintenance-taking-backups-5 ;  counter-increment: counter-ch14-zabbix-maintenance-taking-backups-4 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-taking-backups h5:before { content: '19.4.' counter(counter-ch14-zabbix-maintenance-taking-backups-2) '.' counter(counter-ch14-zabbix-maintenance-taking-backups-3) '.' counter(counter-ch14-zabbix-maintenance-taking-backups-4) '.' counter(counter-ch14-zabbix-maintenance-taking-backups-5) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-taking-backups h5 {  counter-increment: counter-ch14-zabbix-maintenance-taking-backups-5 }
            
.print-site-enumerate-headings #ch14-zabbix-maintenance-upgrades > h1:before { content: '19.5 ' }

                .print-site-enumerate-headings #ch14-zabbix-maintenance-upgrades h2:before { content: '19.5.' counter(counter-ch14-zabbix-maintenance-upgrades-2) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-upgrades h2 {  counter-reset: counter-ch14-zabbix-maintenance-upgrades-3  counter-ch14-zabbix-maintenance-upgrades-4  counter-ch14-zabbix-maintenance-upgrades-5 ;  counter-increment: counter-ch14-zabbix-maintenance-upgrades-2 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-upgrades h3:before { content: '19.5.' counter(counter-ch14-zabbix-maintenance-upgrades-2) '.' counter(counter-ch14-zabbix-maintenance-upgrades-3) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-upgrades h3 {  counter-reset: counter-ch14-zabbix-maintenance-upgrades-4  counter-ch14-zabbix-maintenance-upgrades-5 ;  counter-increment: counter-ch14-zabbix-maintenance-upgrades-3 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-upgrades h4:before { content: '19.5.' counter(counter-ch14-zabbix-maintenance-upgrades-2) '.' counter(counter-ch14-zabbix-maintenance-upgrades-3) '.' counter(counter-ch14-zabbix-maintenance-upgrades-4) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-upgrades h4 {  counter-reset: counter-ch14-zabbix-maintenance-upgrades-5 ;  counter-increment: counter-ch14-zabbix-maintenance-upgrades-4 }
            
                .print-site-enumerate-headings #ch14-zabbix-maintenance-upgrades h5:before { content: '19.5.' counter(counter-ch14-zabbix-maintenance-upgrades-2) '.' counter(counter-ch14-zabbix-maintenance-upgrades-3) '.' counter(counter-ch14-zabbix-maintenance-upgrades-4) '.' counter(counter-ch14-zabbix-maintenance-upgrades-5) ' ' }
                .print-site-enumerate-headings #ch14-zabbix-maintenance-upgrades h5 {  counter-increment: counter-ch14-zabbix-maintenance-upgrades-5 }
            
.print-site-enumerate-headings #section-20 > h1:before { content: '20 ' }
.print-site-enumerate-headings #ch15-zabbix-real-world-examples-chapter > h1:before { content: '20.1 ' }

                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-chapter h2:before { content: '20.1.' counter(counter-ch15-zabbix-real-world-examples-chapter-2) ' ' }
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-chapter h2 {  counter-reset: counter-ch15-zabbix-real-world-examples-chapter-3  counter-ch15-zabbix-real-world-examples-chapter-4  counter-ch15-zabbix-real-world-examples-chapter-5 ;  counter-increment: counter-ch15-zabbix-real-world-examples-chapter-2 }
            
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-chapter h3:before { content: '20.1.' counter(counter-ch15-zabbix-real-world-examples-chapter-2) '.' counter(counter-ch15-zabbix-real-world-examples-chapter-3) ' ' }
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-chapter h3 {  counter-reset: counter-ch15-zabbix-real-world-examples-chapter-4  counter-ch15-zabbix-real-world-examples-chapter-5 ;  counter-increment: counter-ch15-zabbix-real-world-examples-chapter-3 }
            
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-chapter h4:before { content: '20.1.' counter(counter-ch15-zabbix-real-world-examples-chapter-2) '.' counter(counter-ch15-zabbix-real-world-examples-chapter-3) '.' counter(counter-ch15-zabbix-real-world-examples-chapter-4) ' ' }
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-chapter h4 {  counter-reset: counter-ch15-zabbix-real-world-examples-chapter-5 ;  counter-increment: counter-ch15-zabbix-real-world-examples-chapter-4 }
            
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-chapter h5:before { content: '20.1.' counter(counter-ch15-zabbix-real-world-examples-chapter-2) '.' counter(counter-ch15-zabbix-real-world-examples-chapter-3) '.' counter(counter-ch15-zabbix-real-world-examples-chapter-4) '.' counter(counter-ch15-zabbix-real-world-examples-chapter-5) ' ' }
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-chapter h5 {  counter-increment: counter-ch15-zabbix-real-world-examples-chapter-5 }
            
.print-site-enumerate-headings #ch15-zabbix-real-world-examples-disk-health-windows > h1:before { content: '20.2 ' }

                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-disk-health-windows h2:before { content: '20.2.' counter(counter-ch15-zabbix-real-world-examples-disk-health-windows-2) ' ' }
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-disk-health-windows h2 {  counter-reset: counter-ch15-zabbix-real-world-examples-disk-health-windows-3  counter-ch15-zabbix-real-world-examples-disk-health-windows-4  counter-ch15-zabbix-real-world-examples-disk-health-windows-5 ;  counter-increment: counter-ch15-zabbix-real-world-examples-disk-health-windows-2 }
            
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-disk-health-windows h3:before { content: '20.2.' counter(counter-ch15-zabbix-real-world-examples-disk-health-windows-2) '.' counter(counter-ch15-zabbix-real-world-examples-disk-health-windows-3) ' ' }
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-disk-health-windows h3 {  counter-reset: counter-ch15-zabbix-real-world-examples-disk-health-windows-4  counter-ch15-zabbix-real-world-examples-disk-health-windows-5 ;  counter-increment: counter-ch15-zabbix-real-world-examples-disk-health-windows-3 }
            
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-disk-health-windows h4:before { content: '20.2.' counter(counter-ch15-zabbix-real-world-examples-disk-health-windows-2) '.' counter(counter-ch15-zabbix-real-world-examples-disk-health-windows-3) '.' counter(counter-ch15-zabbix-real-world-examples-disk-health-windows-4) ' ' }
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-disk-health-windows h4 {  counter-reset: counter-ch15-zabbix-real-world-examples-disk-health-windows-5 ;  counter-increment: counter-ch15-zabbix-real-world-examples-disk-health-windows-4 }
            
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-disk-health-windows h5:before { content: '20.2.' counter(counter-ch15-zabbix-real-world-examples-disk-health-windows-2) '.' counter(counter-ch15-zabbix-real-world-examples-disk-health-windows-3) '.' counter(counter-ch15-zabbix-real-world-examples-disk-health-windows-4) '.' counter(counter-ch15-zabbix-real-world-examples-disk-health-windows-5) ' ' }
                .print-site-enumerate-headings #ch15-zabbix-real-world-examples-disk-health-windows h5 {  counter-increment: counter-ch15-zabbix-real-world-examples-disk-health-windows-5 }
            </style>












                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Stichting The Monitoring Penmasters
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "/", "features": ["content.tags", "navigation.expand", "navigation.prune", "navigation.path", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.action.view", "content.tags"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": {"index": "tags.md"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../javascripts/tags-data-attr.js?v=514f4d1ef40cb7c1bed03bcbf9a447d4f11fa141"></script>
      
    
    
        
            
            
        
		
		
    

  </body>
</html>