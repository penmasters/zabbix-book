# Системные требования

# Требования
Zabbix предъявляет особые требования к аппаратному и программному обеспечению, 
которые должны быть выполнены, и эти требования могут меняться со временем. 
Они также зависят от размера вашей установки и выбранного вами стека программного 
обеспечения.
Прежде чем приобретать оборудование или устанавливать версию базы данных, 
необходимо ознакомиться с документацией Zabbix, чтобы узнать самые последние 
требования к версии, которую вы планируете установить.
Вы можете найти последние требования [https://www.zabbix.com/documentation/current/en/manual/installation/requirements](https://www.zabbix.com/documentation/current/en/manual/installation/requirements).
Убедитесь, что выбрали правильную версию Zabbix из списка.

Для небольших или тестовых установок Zabbix может комфортно работать на системе 
с 2 процессорами и 8 ГБ оперативной памяти. Однако размер вашей установки, 
количество отслеживаемых элементов, создаваемых триггеров и длительность хранения 
данных будут влиять на требования к ресурсам.
В современных виртуализированных средах я советую начинать с малого и наращивать 
масштаб по мере необходимости.

Вы можете установить все компоненты (сервер Zabbix, базу данных, веб-сервер) 
на одной машине или распределить их по нескольким серверам.
Для простоты обратите внимание на детали сервера:

| Компонент       | IP-адрес   |
| :-------------- | :--------- |
| Zabbix-сервер   |            |
| Сервер баз данных |            |
| Web-сервер      |            |

???+ tip
    Zabbix package names often use dashes (`-`) in their names, such as `zabbix-get`
    or `zabbix-sender`, but the binaries themselves may use underscores (`_`),
    like `zabbix_sender` or `zabbix_server`. This naming discrepancy can sometimes
    be confusing, particularly if you are using packages from non-official Zabbix
    repositories.
    Always check if a binary uses a dash or an underscore when troubleshooting.

---

## Базовая конфигурация ОС

Операционные системы, так много вариантов, каждый со своими преимуществами и 
лояльной базой пользователей.
Хотя Zabbix может быть установлен на широкий спектр платформ, документировать 
процесс для каждой доступной ОС было бы непрактично. Чтобы сделать эту книгу 
целенаправленной и эффективной, мы решили рассказать только о наиболее 
распространенных вариантах: Ubuntu и дистрибутивы на базе Red Hat.

Поскольку не у всех есть доступ к подписке на Red Hat Enterprise Linux (RHEL), 
даже если учетная запись разработчика предоставляет ограниченный доступ, 
мы выбрали Rocky Linux в качестве легкодоступной альтернативы. 
В этой книге мы будем использовать Rocky Linux 9.x и Ubuntu LTS 24.04.x.
- <https://rockylinux.org/>
- <https://ubuntu.com/>

### Брандмауэр

Перед установкой Zabbix необходимо правильно подготовить операционную систему.
В первую очередь необходимо убедиться, что брандмауэр установлен и настроен.

Чтобы установить и включить брандмауэр, выполните следующую команду:

```bash
RedHat
# dnf install firewalld
# systemctl enable firewalld --now

Ubuntu
# sudo apt install ufw -y
# sudo ufw enable
```

После установки вы можете настроить необходимые порты.
Для Zabbix нам нужно разрешить доступ к порту `10051/tcp`, 
на котором Zabbix trapper прослушивает входящие данные. 
Используйте следующую команду, чтобы открыть этот порт в брандмауэре:

```bash
RedHat
# firewall-cmd --add-service=zabbix-server --permanent

Ubuntu
# sudo ufw allow 10051/tcp
```

Если служба не распознана, можно вручную указать порт:

```bash
# firewall-cmd --add-port=10051/tcp --permanent
```

/// note | firewalld
«Firewalld является заменой iptables в системах на базе RHEL и 
позволяет изменениям вступать в силу немедленно, без необходимости 
перезапускать службу.
Если в вашем дистрибутиве не используется [Firewalld](https://www.firewalld.org), 
обратитесь к документации по вашей ОС, чтобы узнать, как настроить брандмауэр».
В Ubuntu используется UFW, который является всего лишь фронтендом для iptables.
///

---

### Сервер времени

Еще один важный шаг - настройка сервера времени и синхронизация сервера 
Zabbix с помощью NTP-клиента.
Точная синхронизация времени жизненно важна для Zabbix, как для сервера, 
так и для устройств, за которыми он следит.
Если на одном из узлов установлен неправильный часовой пояс, это может 
привести к путанице, например, при расследовании проблемы в Zabbix, 
которая, как оказалось, произошла на несколько часов раньше, чем на самом деле.

Чтобы установить и включить chrony, наш NTP-клиент, выполните следующую команду:

```bash
RedHat
# dnf install chrony
# systemctl enable chronyd --now

Ubuntu
# sudo apt install chrony -y
```

После установки вы можете убедиться, что Chrony включен и работает, проверив его статус:

```bash
RedHat
# systemctl status chronyd
```

/// note | dnf
«dnf» - это менеджер пакетов, используемый в системах на базе Red Hat. 
Если вы используете другой дистрибутив, замените `dnf` на соответствующий менеджер 
пакетов, например `zyper`, `apt`, или `yum`. Chrony - это современная замена `ntpd`, 
обеспечивающая более быструю и более точную синхронизацию времени.
Если ваша ОС не поддерживает [Chrony](https://chrony-project.org/), подумайте об использовании `ntpd` вместо него».
///

После установки Chrony необходимо убедиться, что установлен правильный часовой пояс. 
Вы можете посмотреть текущую конфигурацию времени с помощью команды `timedatectl`:

```bash
# timedatectl
               Local time: Thu 2023-11-16 15:09:14 UTC
           Universal time: Thu 2023-11-16 15:09:14 UTC
                 RTC time: Thu 2023-11-16 15:09:15
                Time zone: UTC (UTC, +0000)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
```

Убедитесь, что служба Chrony активна (при необходимости обратитесь к предыдущим шагам).
Чтобы установить правильный часовой пояс, сначала можно узнать все доступные часовые пояса 
с помощью следующей команды:

```bash
# timedatectl list-timezones
```

Появится список часовых поясов, из которого можно выбрать ближайший к вашему местоположению:

```bash
Africa/Abidjan
Africa/Accra
...
Pacific/Tongatapu
Pacific/Wake
Pacific/Wallis
UTC
```

Определив часовой пояс, настройте его с помощью следующей команды:

```bash
# timedatectl set-timezone Asia/Yekaterinburg
```

Чтобы убедиться, что часовой пояс настроен правильно, используйте команду `timedatectl` снова:

```bash
# timedatectl
               Local time: Вт 2025-02-25 16:55:01 +05
           Universal time: Вт 2025-02-25 11:55:01 UTC
                 RTC time: Вт 2025-02-25 11:55:01
                Time zone: Asia/Yekaterinburg (+05, +0500)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
```

???+ note
    Некоторые администраторы предпочитают устанавливать все серверы в часовом 
    поясе UTC, чтобы обеспечить синхронизацию журналов сервера в глобальных 
    развертываниях.
    Zabbix поддерживает пользовательские настройки часового пояса, что 
    позволяет серверу оставаться в UTC, в то время как отдельные пользователи 
    могут настроить часовой пояс через интерфейс при необходимости.
    
---

### Проверка синхронизации Chrony

Чтобы убедиться, что Chrony синхронизируется с правильными серверами времени, 
вы можете выполнить следующую команду:

```bash
# chronyc
```

Вывод должен выглядеть следующим образом:

```bash
chrony version 4.2
Copyright (C) 1997-2003, 2007, 2009-2021 Richard P. Curnow and others
chrony comes with ABSOLUTELY NO WARRANTY.  This is free software, and
you are welcome to redistribute it under certain conditions.  See the
GNU General Public License version 2 for details.

chronyc>
```

Войдя в приглашение Chrony, введите следующее, чтобы проверить источники:

```bash
chronyc> sources
```

Пример вывода:

```bash
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^- 51-15-20-83.rev.poneytel>     2   9   377   354   +429us[ +429us] +/-  342ms
^- 5.255.99.180                  2  10   377   620  +7424us[+7424us] +/-   37ms
^- hachi.paina.net               2  10   377   412   +445us[ +445us] +/-   39ms
^* leontp1.office.panq.nl        1  10   377   904  +6806ns[ +171us] +/- 2336us
```

В этом примере используемые серверы NTP расположены за пределами вашего региона.
Рекомендуется переключиться на серверы времени в вашей стране или, если это 
возможно, на выделенный сервер времени компании. Вы можете найти локальные 
NTP-серверы [здесь](https://www.ntppool.org/).
---

### Обновление серверов времени

Чтобы обновить серверы времени, измените файл `/etc/chrony.conf` в системах на 
базе RedHat, если вы используете Ubuntu, отредактируйте `/etc/chrony/chrony.conf`. 
Замените существующий NTP-сервер на более близкий к вашему местоположению.

Пример текущей конфигурации:
```bash
# Use public servers from the pool.ntp.org project.
# Please consider joining the pool (http://www.pool.ntp.org/join.html).
pool 2.centos.pool.ntp.org iburst
```

Измените нужные пулы на локальный сервер времени:

```bash
# Use public servers from the pool.ntp.org project.
# Please consider joining the pool (http://www.pool.ntp.org/join.html).
pool ru.pool.ntp.org iburst
```

После внесения этих изменений перезапустите службу Chrony, чтобы применить новую конфигурацию:

```bash
# systemctl restart chronyd
```

### Проверка обновленных серверов времени

Проверьте источники времени еще раз, чтобы убедиться, что используются новые локальные серверы:

```bash
chronyc> sources
```

Пример ожидаемого вывода с локальными серверами:

```bash
MS Name/IP address         Stratum Poll Reach LastRx Last sample               
===============================================================================
^- ntp1.vniiftri.ru              1   6    17    16   -584us[ -584us] +/-   22ms
^* vigil.intelfx.name            2   6    17    18   +899us[ +317us] +/-   22ms
^+ 185.211.244.47                2   6    17    18    -67us[ -649us] +/-   28ms
^+ 217.170.87.229                2   6    17    19  -2335us[-2917us] +/-   52ms
```

Это подтверждает, что система теперь использует серверы местного времени.
