
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A free, community driven online resource to master Zabbix: built to give back, sustain the community, and help you become truly empowered with monitoring.">
      
      
        <meta name="author" content="The Monitoring Penmasters">
      
      
        <link rel="canonical" href="https://thezabbixbook.com/ch13-advanced-security/partitioning-database/">
      
      
        <link rel="prev" href="../using-vault/">
      
      
        <link rel="next" href="../partitioning-postgresql-database/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Partitioning MariaDB - Zabbix Book</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.af67bdb9.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Nunito"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css?v=8e9f1ef305a011bd82d366c3ef82d26bf85e8ea7">
    
      <link rel="stylesheet" href="../../stylesheets/linewrap.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
    
    
    

    <meta property="og:title" content="Partitioning MariaDB">
    <meta property="og:description" content="A free, community driven online resource to master Zabbix: built to give back, sustain the community, and help you become truly empowered with monitoring.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thezabbixbook.com/ch13-advanced-security/partitioning-database/">
    <meta property="og:image" content="https://www.thezabbixbook.com/assets/social-card.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Partitioning MariaDB">
    <meta name="twitter:description" content="A free, community driven online resource to master Zabbix: built to give back, sustain the community, and help you become truly empowered with monitoring.">
    <meta name="twitter:image" content="https://www.thezabbixbook.com/assets/social-card.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="627">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#partitioning-a-zabbix-mariadb-mysql-database-with-perl" class="md-skip">
          Pular para conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
    
    
    
    
    <script>
        const gGMC_SELECT_VERSION = "Selecione a versão";
        const gGMC_TRANSLATE_CTA = "Support us and translate!";
        const gGMC_PAGE_LOCALE = "en";
        const gGMC_FILE_LOCALE = "en";
        const gGMC_TRANSLATE_SVG = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.5 12c0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2 0 .37-.03.73-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10C6.47 2 2 6.5 2 12s4.5 10 10 10c.59 0 1.16-.06 1.72-.16A5.9 5.9 0 0 1 13 19c0-.29.03-.57.07-.85-.32.63-.67 1.24-1.07 1.81-.83-1.2-1.5-2.53-1.91-3.96h3.72a5.95 5.95 0 0 1 2.59-2.4c.06-.53.1-1.06.1-1.6M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2zm.82 2H8c.35 1.25.8 2.45 1.4 3.56A8 8 0 0 1 5.08 16M8 8H5.08A7.92 7.92 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m6.34 6H9.66c-.1-.66-.16-1.32-.16-2s.06-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2m.25-9.56c1.84.63 3.37 1.9 4.33 3.56h-2.95a15.7 15.7 0 0 0-1.38-3.56M23 18v2h-3v3h-2v-3h-3v-2h3v-3h2v3z"/></svg>';
    </script>
    
    

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabeçalho">
    <a href="../.." title="Zabbix Book" class="md-header__button md-logo" aria-label="Zabbix Book" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Zabbix Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Partitioning MariaDB
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Selecione o idioma">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../fr/ch13-advanced-security/partitioning-database/" hreflang="fr" class="md-select__link">
              Français
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../nl/ch13-advanced-security/partitioning-database/" hreflang="nl" class="md-select__link">
              Nederlands
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../pt_BR/ch13-advanced-security/partitioning-database/" hreflang="pt_BR" class="md-select__link">
              Brazillian Portugese
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../ru/ch13-advanced-security/partitioning-database/" hreflang="ru" class="md-select__link">
              Russian
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Pesquisar">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Compartilhar" aria-label="Compartilhar" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Limpar" aria-label="Limpar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando busca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/penmasters/zabbix-book" title="Ir para repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    penmasters
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegação" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Zabbix Book" class="md-nav__button md-logo" aria-label="Zabbix Book" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Zabbix Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/penmasters/zabbix-book" title="Ir para repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    penmasters
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guidelines
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Book Tags
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Supporters-Contributors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Supporters and contributors
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch00-getting-started/initial-steps/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch01-zabbix-components/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 01 : Zabbix components
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch02-zabbix-installation/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 02 : Installation
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch03-zabbix-proxies/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 03 : Proxies and Webcomponents
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch04-zabbix-collecting-data/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 04 : Collecting data 
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch05-zabbix-triggers/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 05 : Triggers
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch06-zabbix-templates/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 06 : Templates
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch07-zabbix-alerts/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 07 : Alerting
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch08-zabbix-lld/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 08 : LLD
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch09-zabbix-extending/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 09 : Extending Zabbix
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch10-zabbix-discovery/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 10 : Discovery
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch11-zabbix-visualisation/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 11 : Visualisation
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch12-zabbix-api/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 12 : Zabbix API
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" checked>
        
          
          <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 13 : Advanced set up and security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            Chapter 13 : Advanced set up and security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced set-up and security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../selinux-zabbix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SELinux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../securing-frontend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Securing the frontend
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Securing the agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../using-vault/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storing secrets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Partitioning MariaDB
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Partitioning MariaDB
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparing-the-database" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing the database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-the-partitioning" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing the partitioning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-the-perl-script" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up the Perl script
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../partitioning-postgresql-database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Partitioning PostgreSQL with TimescaleDB
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch14-zabbix-maintenance/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 14 : Maintenance
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch15-zabbix-real-world-examples/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 15 : Real world examples
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../print_page/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Print Site
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparing-the-database" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing the database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-the-partitioning" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing the partitioning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-the-perl-script" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up the Perl script
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                


    <a href="../../print_page/" title="Print Site" class="md-content__button md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 3H6v4h12m1 5a1 1 0 0 1-1-1 1 1 0 0 1 1-1 1 1 0 0 1 1 1 1 1 0 0 1-1 1m-3 7H8v-5h8m3-6H5a3 3 0 0 0-3 3v6h4v4h12v-4h4v-6a3 3 0 0 0-3-3"/></svg>
    </a>



                   

  
  
    
      
    
    <a href="https://github.com/penmasters/zabbix-book/raw/main/docs/ch13-advanced-security/partitioning-database.md" title="Exibir fonte desta página" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="partitioning-a-zabbix-mariadb-mysql-database-with-perl">Partitioning a Zabbix MariaDB (MySQL) database with Perl</h1>
<p>As your Zabbix environment grows, you'll eventually notice that the built-in housekeeper
struggles to keep up. This happens because the Zabbix housekeeper works by scanning
the database for each history or trend entry that exceeds its configured retention
period and deletes them row by row. While this works for smaller setups, as the
database grows your housekeeper process will reach a limit as to what it can delete
in time.</p>
<p>You can usually see this issue happening when the housekeeper process runs at 100%
continuously and the database keeps growing larger. This indicated that the cleanup
can't keep pace with incoming data.</p>
<p>PostgreSQL users can use the native TimescaleDB plugin in Zabbix, which handles
historical data retention more efficiently. <code>MariaDB</code> (or MySQL) doesn't have a
similar built-in option.</p>
<p>This is where <code>MariaDB</code> partitioning comes in.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>It's recommended to do partitioning right after setting up your Zabbix database.
This process is a lot easier on a clean database, than it is on a database
that is already is use.</p>
</details>
<h2 id="preparing-the-database">Preparing the database</h2>
<p>To begin implementing <code>MariaDB</code> partitioning, you'll need access with super privileges
to your Zabbix database server. Before starting however, if you are going to partition
an existing zabbix database make sure to create a backup of your database. We can
do this in various ways and with various tools, but the built-in <code>mariadb-dump</code> tool
will work perfectly fine.</p>
<p><a href="https://mariadb.com/kb/en/mariadb-dump/">https://mariadb.com/kb/en/mariadb-dump/</a></p>
<p><a href="https://mariadb.com/kb/en/mariadb-import/">https://mariadb.com/kb/en/mariadb-import/</a></p>
<p><code>Make sure to export your database backup to a different server (or disk at least).</code></p>
<p>Keep in mind, data corruption can happen when performing large scale changes on
your DB and as such also with partitioning.</p>
<p>To prevent MariaDB running out of space, also make sure to have a generous amount
of free space on your system. Running partitioning when you have no free space left
can lead to a corrupted database data. Check your free space with:</p>
<div class="admonition info">
<p class="admonition-title">Check disk space availability</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>df -h
</span></code></pre></div>
</div>
<h2 id="preparing-the-partitioning">Preparing the partitioning</h2>
<p>For existing Zabbix databases, partitioning can be a very time-consuming process.
It all depends on the size of the database and the resources available to MariaDB-Server.</p>
<p>This is why I always run partitioning in a <code>tmux</code> session. If <code>tmux</code> hasn't been
installed onto your database server yet, do that now.</p>
<div class="admonition info">
<p class="admonition-title">Check disk space availability</p>
<p>Red Hat-based
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>dnf install tmux
</span></code></pre></div>
Debian-based
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>apt install tmux
</span></code></pre></div></p>
</div>
<p>Now we can issue the tmux command to open a new tmux session:</p>
<div class="admonition info">
<p class="admonition-title">Open tmux session</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>tmux
</span></code></pre></div>
</div>
<p>This opens up an terminal session that will remain active even if our SSH session
times out.</p>
<p>Now, let's open up a notepad and prepare our partitions. We’ll be partitioning
the following tables:</p>
<table>
<thead>
<tr>
<th>Table name</th>
<th>Purpose</th>
<th>Data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>history</td>
<td>Stores numeric floating point values</td>
<td></td>
</tr>
<tr>
<td>history_uint</td>
<td>Stores numeric unsigned values</td>
<td></td>
</tr>
<tr>
<td>history_str</td>
<td>Stores text values up to 255 characters</td>
<td></td>
</tr>
<tr>
<td>history_text</td>
<td>Stores text values values up to 64kB</td>
<td></td>
</tr>
<tr>
<td>history_log</td>
<td>Stores text values up to 64kB with additional log related properties like timestamp</td>
<td></td>
</tr>
<tr>
<td>history_bin</td>
<td>Stores binary image data</td>
<td></td>
</tr>
<tr>
<td>trends</td>
<td>Stores the min/avg/max/count trends of numeric floating point data</td>
<td></td>
</tr>
<tr>
<td>trends_uint</td>
<td>Stores the min/avg/max/count trends of numeric unsigned data</td>
<td></td>
</tr>
</tbody>
</table>
<p>We first will have first have to determine how long we want to store the information
per table. MariaDB partitioning will take over the history and trend storage periods
as usually configured in the Zabbix frontend. We will configure these retention
periods later in the perl script.</p>
<p>Let's say I want to store my history tables for <code>31 days</code> and my trend data for
<code>15 months</code>. This allows me to troubleshoot in depth for a month and also audit
my data for little over a year.</p>
<p>Now this is where I open up a notepad and prepare my partitioning commands. Our
history tables will be partitioned by day and our trends tables will be
partitioned by month.</p>
<p>So, let’s start with our history_uint table:</p>
<div class="admonition info">
<p class="admonition-title">Prepare history partitioning (assuming today is May 10th 2025)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>ALTER TABLE history_uint PARTITION BY RANGE ( clock)
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>(PARTITION p2025_03_26 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-03-27 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>PARTITION p2025_03_27 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-03-28 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>PARTITION p2025_03_28 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-03-29 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>PARTITION p2025_03_29 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-03-30 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>PARTITION p2025_03_30 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>PARTITION p2025_04_01 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-02 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>PARTITION p2025_04_02 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-03 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>PARTITION p2025_04_03 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-04 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>PARTITION p2025_04_04 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-05 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>PARTITION p2025_04_05 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-06 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>PARTITION p2025_04_06 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-07 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>PARTITION p2025_04_07 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-08 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>PARTITION p2025_04_08 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-09 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>PARTITION p2025_04_09 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-10 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>PARTITION p2025_04_10 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-11 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>PARTITION p2025_04_11 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-12 00:00:00&quot;)) ENGINE = InnoDB);
</span></code></pre></div>
</div>
<p>As you can see, I only created <code>16</code> partitions here. I could have created <code>31</code>,
which would have been better perhaps. <code>MariaDB</code> will now add all my older than 2025-03-26
data in that single partition. No problem, but it will take longer for my disk space to
free up this bigger partitioning, after which is will only keep 1 day worth of data
from that point.</p>
<p>I also created a partition in the future, just to have it. The script will handle
creating new partitions later for us.</p>
<ul>
<li>Creating less than 31 partitions: End up with 1 big partition until it is deleted</li>
<li>Creating exactly 31 partitions: End up with the ideal set-up immediately, but more
  to create.</li>
</ul>
<p>Now, create this <code>ALTER TABLE</code> commands with the partitions for all history tables.
We then do the same for the trends tables:</p>
<div class="admonition info">
<p class="admonition-title">Prepare trends partitioning (assuming today is May 10th 2025)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>ALTER TABLE trends_uint PARTITION BY RANGE ( clock)
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>(PARTITION p2024_12 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-01-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>PARTITION p2025_01 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-02-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>PARTITION p2025_02 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-03-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>PARTITION p2025_03 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-04-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>PARTITION p2025_04 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-05-01 00:00:00&quot;)) ENGINE = InnoDB,
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>PARTITION p2025_05 VALUES LESS THAN (UNIX_TIMESTAMP(&quot;2025-06-01 00:00:00&quot;)) ENGINE = InnoDB);
</span></code></pre></div>
</div>
<p>As you can see, here we are partitioning by month instead of by day. Once again,
I can create all partitions for 15 months, or less. That's up to us to decide.
Prepared this command for all trends tables.</p>
<p>Then it is time to login to MariaDB and start the partitioning. Please do not forget
to use the <code>tmux</code> command as we mentioned earlier.</p>
<div class="admonition info">
<p class="admonition-title">Login to MariaDB</p>
<p><code>mariadb -u root -p</code></p>
</div>
<p>Execute the history and trends partitioning commands you prepared in your notepad
one by one and make sure to wait for each to finish. As mentioned with large database,
be patient. With a clean Zabbix database, this process should be near instant.</p>
<h2 id="setting-up-the-perl-script">Setting up the Perl script</h2>
<p>With the partitioning done, we still need to maintain the partitioned setup. MariaDB
will not create new and delete old partitions for us automatically, we need to
use a <code>perl</code> script for this. Years ago, an honorable Zabbix community member wrote
a <code>perl</code> script to maintain the partitioning and the people at <code>Opensource ICT Solutions</code>
have been maintaining it. You can find it on their GitHub repository:</p>
<p><a href="https://github.com/OpensourceICTSolutions/zabbix-mysql-partitioning-perl">https://github.com/OpensourceICTSolutions/zabbix-mysql-partitioning-perl</a></p>
<p>Download the script from their GitHub and save it on your Zabbix database server(s)
in the following folder:</p>
<div class="admonition info">
<p class="admonition-title">Script folder (create the folder if it doesn't exist)</p>
<p><code>/usr/lib/zabbix/</code></p>
</div>
<p>Then make the script executable, so we can create a cronjob later to execute it.</p>
<div class="admonition info">
<p class="admonition-title">Make the script executable</p>
<p><code>chmod 750 /usr/lib/zabbix/mysql_zbx_part.pl</code></p>
</div>
<p>Now, let's make sure all the settings in the script are set-up correctly. Edit the
script with your favourite editor (yes, nano is also an option).</p>
<div class="admonition info">
<p class="admonition-title">Edit the script</p>
<p><code>vim /usr/lib/zabbix/mysql_zbx_part.pl</code></p>
</div>
<p>There are a few lines here we need to edit to make sure the script works. Let's start
with our MariaDB login details.</p>
<div class="admonition info">
<p class="admonition-title">Add login details to the script</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>my $dsn = &#39;DBI:mysql:&#39;.$db_schema.&#39;:mysql_socket=/var/lib/mysql/mysql.sock&#39;;
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>my $db_user_name = &#39;zabbix&#39;;
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>my $db_password = &#39;password&#39;;
</span></code></pre></div>
</div>
<p>Make sure to modify the credentials and socket path to reflect your own Zabbix database
setup. The MariaDB username and password can, for instance, match those defined in
your Zabbix server configuration file. You can also create a different user for
this if preferred.</p>
<p>Also, keep in mind that the MariaDB socket file can vary depending on your distribution.
If the default path (/var/lib/mysql/mysql.sock) doesn't apply, update it accordingly.
For example, on Ubuntu systems, the socket is often located at /var/run/mysqld/mysql.sock.</p>
<p>Next up, we should edit the settings related to how long we want our data to be stored.
We define that in the following block.</p>
<div class="admonition info">
<p class="admonition-title">Add login details to the script</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>my $tables = {  &#39;history&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>                &#39;history_log&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>                &#39;history_str&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>                &#39;history_text&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>                &#39;history_uint&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>                &#39;history_bin&#39; =&gt; { &#39;period&#39; =&gt; &#39;day&#39;, &#39;keep_history&#39; =&gt; &#39;31&#39;},
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>                &#39;trends&#39; =&gt; { &#39;period&#39; =&gt; &#39;month&#39;, &#39;keep_history&#39; =&gt; &#39;15&#39;},
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>                &#39;trends_uint&#39; =&gt; { &#39;period&#39; =&gt; &#39;month&#39;, &#39;keep_history&#39; =&gt; &#39;15&#39;},
</span></code></pre></div>
</div>
<p>Keep in mind that <code>history</code> is defined by day here and <code>trends</code> are defined by month.</p>
<p>We also need to change the timezone to match the timezone configured on our Zabbix
database server. As this was written in the the Netherlands, I will use <code>Europe/Amsterdam</code>.</p>
<div class="admonition info">
<p class="admonition-title">Add correct timezone</p>
<p><code>my $curr_tz = 'Europe/Amsterdam';</code></p>
</div>
<p>Then the last important step is to make sure that we comment or uncomment some lines
in the script. The script works for both <code>MariaDB</code> and <code>MySQL</code>, as well as for older
versions. It is however not smart enough to detect what to use automatically, but
feel free to open up that pull request!</p>
<p>The script is already out of the box configured for <code>MariaDB</code>, so we don't need
to do anything.</p>
<p>For the <code>MySQL 8.x</code> users comment the following <code>MariaDB</code> lines.</p>
<div class="admonition info">
<p class="admonition-title">Comment MariaDB</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a># MySQL 5.6 + MariaDB
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    #my $sth = $dbh-&gt;prepare(qq{SELECT plugin_status FROM information_schema.plugins
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    WHERE plugin_name = &#39;partition&#39;});
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    #$sth-&gt;execute();
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    #my $row = $sth-&gt;fetchrow_array();
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    #$sth-&gt;finish();
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>    #    return 1 if $row eq &#39;ACTIVE&#39;;
</span></code></pre></div>
</div>
<p>And uncomment the <code>MySQL 8.x</code> lines.</p>
<div class="admonition info">
<p class="admonition-title">Uncomment MySQL 8.x</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a># MySQL 8.x (NOT MariaDB!)
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    my $sth = $dbh-&gt;prepare(qq{select version();});
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    $sth-&gt;execute();
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    my $row = $sth-&gt;fetchrow_array();
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    $sth-&gt;finish();
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>           return 1 if $row &gt;= 8;
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    # End of MySQL 8.x
</span></code></pre></div>
</div>
<p>Keep in mind, ONLY do this if you are using <code>MySQL 8.x</code> and later. If you are on
<code>MySQL 5.6</code> or <code>MariaDB</code> do NOT change these lines.</p>
<p>For Zabbix 5.4 and OLDER versions also make sure to uncomment the indicated lines.
But do not do this for Zabbix 6.0 and higher though.</p>
<div class="admonition info">
<p class="admonition-title">Uncomment for Zabbix 5.4 and older only</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a># Uncomment the following line for Zabbix 5.4 and earlier
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    # $dbh-&gt;do(&quot;DELETE FROM auditlog_details WHERE NOT EXISTS (SELECT NULL FROM
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    auditlog WHERE auditlog.auditid = auditlog_details.auditid)&quot;);
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>    }
</span></code></pre></div>
</div>
<p>For Zabbix 6.4 and OLDER versions also make sure to comment the following line.
Do not do this for Zabbix 7.0 and higher though:</p>
<div class="admonition info">
<p class="admonition-title">Uncomment for Zabbix 6.4 and older only</p>
<p><code>'history_bin' =&gt; { 'period' =&gt; 'day', 'keep_history' =&gt; '60'},</code></p>
</div>
<p>We also need to install some Perl dependencies to make sure we can execute the script.</p>
<div class="admonition info">
<p class="admonition-title">Install dependencies</p>
<p>Red Hat-Based
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>dnf install perl-DateTime perl-Sys-Syslog
</span></code></pre></div>
Debian-based
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>apt-get install libdatetime-perl liblogger-syslog-perl
</span></code></pre></div></p>
</div>
<p>If perl-DateTime isn't available on your Red Hat 7.x installation make sure to install
the powertools repo.</p>
<div class="admonition info">
<p class="admonition-title">Install correct repository</p>
<p>Red Hat 7 based
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>yum config-manager --set-enabled powertools
</span></code></pre></div></p>
<p>Red Hat 9 based
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>dnf config-manager --enable crb
</span></code></pre></div></p>
<p>Genuine Red Hat
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms
</span></code></pre></div></p>
<p>Oracle Linux
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>dnf config-manager --set-enabled ol8_codeready_builder
</span></code></pre></div></p>
</div>
<p>Then the last step is to add a cronjob to execute the script everyday.</p>
<div class="admonition info">
<p class="admonition-title">Open crontab</p>
<p><code>crontab -e</code></p>
</div>
<p>Add the following line to create the cronjob.</p>
<div class="admonition info">
<p class="admonition-title">Create cronjob</p>
<p><code>55 22 * * * /usr/lib/zabbix/mysql_zbx_part.pl &gt;/dev/null 2&gt;&amp;1</code></p>
</div>
<p>Execute the script manually to test.</p>
<div class="admonition info">
<p class="admonition-title">Manual script execution for testing</p>
<p><code>perl /usr/lib/zabbix/mysql_zbx_part.pl</code></p>
</div>
<p>Then we can check and see if it worked.</p>
<div class="admonition info">
<p class="admonition-title">Check the script log</p>
<p><code>journalctl -t mysql_zbx_part</code></p>
</div>
<p>This will give you back a list of created and deleted partitions if you've done
everything right. Make sure to check this command again tomorrow, to make sure
the cronjob is working as expected.</p>












                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Voltar para o topo
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Stichting The Monitoring Penmasters
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.prune", "navigation.path", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.action.view", "content.tags"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": {"index": "tags.md"}, "translations": {"clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "search.result.more.one": "mais 1 nesta p\u00e1gina", "search.result.more.other": "# mais nesta p\u00e1gina", "search.result.none": "Nenhum documento encontrado", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Digite para iniciar a busca", "search.result.term.missing": "Ausente", "select.version": "Selecione a vers\u00e3o"}, "version": null}</script>
    
    
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../assets/external/cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../javascripts/tags-data-attr.js?v=8e9f1ef305a011bd82d366c3ef82d26bf85e8ea7"></script>
      
    
    
        
            
            
        
		
		
    

  </body>
</html>