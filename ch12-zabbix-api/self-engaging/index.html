
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A free, community driven online resource to master Zabbix: built to give back, sustain the community, and help you become truly empowered with monitoring.">
      
      
        <meta name="author" content="The Monitoring Penmasters">
      
      
        <link rel="canonical" href="https://thezabbixbook.com/ch12-zabbix-api/self-engaging/">
      
      
        <link rel="prev" href="../chapter/">
      
      
        <link rel="next" href="../../ch13-advanced-security/chapter/">
      
      
        
          <link rel="alternate" href="../../fr/ch12-zabbix-api/self-engaging/" hreflang="fr">
        
          <link rel="alternate" href="../../nl/ch12-zabbix-api/self-engaging/" hreflang="nl">
        
          <link rel="alternate" href="../../pt_BR/ch12-zabbix-api/self-engaging/" hreflang="pt_BR">
        
          <link rel="alternate" href="../../ru/ch12-zabbix-api/self-engaging/" hreflang="ru">
        
          <link rel="alternate" href="./" hreflang="en">
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Self-engaging - Zabbix Book</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css?v=514f4d1ef40cb7c1bed03bcbf9a447d4f11fa141">
    
      <link rel="stylesheet" href="../../stylesheets/linewrap.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
    
    

    <meta property="og:title" content="Self-engaging">
    <meta property="og:description" content="A free, community driven online resource to master Zabbix: built to give back, sustain the community, and help you become truly empowered with monitoring.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thezabbixbook.com/ch12-zabbix-api/self-engaging/">
    <meta property="og:image" content="https://www.thezabbixbook.com/assets/social-card.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Self-engaging">
    <meta name="twitter:description" content="A free, community driven online resource to master Zabbix: built to give back, sustain the community, and help you become truly empowered with monitoring.">
    <meta name="twitter:image" content="https://www.thezabbixbook.com/assets/social-card.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="627">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#self-engaging" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
    
    
    
    
    <script>
        const gGMC_SELECT_VERSION = "Select version";
        const gGMC_TRANSLATE_CTA = "Support us and translate!";
        const gGMC_PAGE_LOCALE = "en";
        const gGMC_FILE_LOCALE = "en";
        const gGMC_TRANSLATE_SVG = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.5 12c0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2 0 .37-.03.73-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10C6.47 2 2 6.5 2 12s4.5 10 10 10c.59 0 1.16-.06 1.72-.16A5.9 5.9 0 0 1 13 19c0-.29.03-.57.07-.85-.32.63-.67 1.24-1.07 1.81-.83-1.2-1.5-2.53-1.91-3.96h3.72a5.95 5.95 0 0 1 2.59-2.4c.06-.53.1-1.06.1-1.6M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2zm.82 2H8c.35 1.25.8 2.45 1.4 3.56A8 8 0 0 1 5.08 16M8 8H5.08A7.92 7.92 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m6.34 6H9.66c-.1-.66-.16-1.32-.16-2s.06-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2m.25-9.56c1.84.63 3.37 1.9 4.33 3.56h-2.95a15.7 15.7 0 0 0-1.38-3.56M23 18v2h-3v3h-2v-3h-3v-2h3v-3h2v3z"/></svg>';
    </script>
    
    

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Zabbix Book" class="md-header__button md-logo" aria-label="Zabbix Book" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Zabbix Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Self-engaging
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../fr/ch12-zabbix-api/self-engaging/" hreflang="fr" class="md-select__link">
              Fran√ßais
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../nl/ch12-zabbix-api/self-engaging/" hreflang="nl" class="md-select__link">
              Nederlands
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../pt_BR/ch12-zabbix-api/self-engaging/" hreflang="pt_BR" class="md-select__link">
              Brazillian Portugese
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../ru/ch12-zabbix-api/self-engaging/" hreflang="ru" class="md-select__link">
              Russian
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/penmasters/zabbix-book" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    penmasters
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Zabbix Book" class="md-nav__button md-logo" aria-label="Zabbix Book" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Zabbix Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/penmasters/zabbix-book" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    penmasters
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guidelines
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Book Tags
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Supporters-Contributors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Supporters and contributors
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch00-getting-started/initial-steps/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch01-zabbix-components/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 01 : Zabbix components and installation
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch02-zabbix-installation/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 02 : Zabbix Frontend
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch03-zabbix-proxies/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 03 : Proxies and Webcomponents
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch04-zabbix-collecting-data/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 04 : Collecting data 
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch05-zabbix-triggers/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 05 : Triggers
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch06-zabbix-templates/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 06 : Templates
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch07-zabbix-alerts/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 07 : Alerting
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch08-zabbix-lld/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 08 : LLD
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch09-zabbix-extending/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 09 : Extending Zabbix
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch10-zabbix-discovery/network-host-discovery/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 10 : Discovery
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch11-zabbix-visualisation/graphs/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 11 : Visualisation
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" checked>
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Chapter 12 : Zabbix API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    Chapter 12 : Zabbix API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Zabbix API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Self-engaging
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Self-engaging
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#api-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        API variables
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-api-call" class="md-nav__link">
    <span class="md-ellipsis">
      
        First API call
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#host-group-membership-http-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Host group membership (HTTP agent)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auto-close-problem-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Auto close problem (Webhook)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#self-destructive-host-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Self destructive host (Webhook)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replace-host-visible-name-script-item" class="md-nav__link">
    <span class="md-ellipsis">
      
        Replace host Visible name (Script item)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cleanup-unused-zbx-interfaces-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cleanup unused ZBX interfaces (Webhook)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#read-log-file-from-yyyymmdd-filename-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Read log file from YYYY.MM.DD filename (Script)
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch13-advanced-security/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 13 : Advanced set up and security
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch14-zabbix-maintenance/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 14 : Maintenance
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ch15-zabbix-real-world-examples/chapter/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Chapter 15 : Real world examples
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../print_page/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Print Site
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#api-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        API variables
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-api-call" class="md-nav__link">
    <span class="md-ellipsis">
      
        First API call
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#host-group-membership-http-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Host group membership (HTTP agent)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auto-close-problem-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Auto close problem (Webhook)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#self-destructive-host-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Self destructive host (Webhook)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replace-host-visible-name-script-item" class="md-nav__link">
    <span class="md-ellipsis">
      
        Replace host Visible name (Script item)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cleanup-unused-zbx-interfaces-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cleanup unused ZBX interfaces (Webhook)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#read-log-file-from-yyyymmdd-filename-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Read log file from YYYY.MM.DD filename (Script)
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Welcome
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../chapter/" class="md-path__link">
          
  <span class="md-ellipsis">
    Chapter 12 : Zabbix API
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                


    <a href="../../print_page/" title="Print Site" class="md-content__button md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 3H6v4h12m1 5a1 1 0 0 1-1-1 1 1 0 0 1 1-1 1 1 0 0 1 1 1 1 1 0 0 1-1 1m-3 7H8v-5h8m3-6H5a3 3 0 0 0-3 3v6h4v4h12v-4h4v-6a3 3 0 0 0-3-3"/></svg>
    </a>



                  









  
  
    
      
    
    <a href="https://github.com/penmasters/zabbix-book/raw/main/docs/ch12-zabbix-api/self-engaging.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="self-engaging">Self-engaging</h1>
<p>Welcome to Zabbix API self engaging methods. All upcoming chapters will address
the tools available to allow software to re-engage with itself. It is like
developing a small service(s) which runs on the top of Zabbix and do exactly
the tasks we told to do.
This is like simulating an extra employee in the company.</p>
<h2 id="api-variables">API variables</h2>
<p>To start to engage with Zabbix API:</p>
<p>Create a dedicated service user. Go to <strong>Users</strong> =&gt; <strong>Users</strong>,
click <strong>Create user</strong>, set Username <strong>api</strong>,
install Groups <strong>No access to the frontend</strong>,
Under <strong>Permissions</strong> tab, assign user role <strong>Super admin role</strong>
which will automatically give user type <strong>Super admin</strong>.</p>
<p><img alt="Create API user" src="ch12.01-create-api-user.png" /></p>
<p><em>12.1
Create API user</em></p>
<p>Permissions tab:</p>
<p><img alt="API user permissions" src="ch12.02-api-user-permissions.png" /> </p>
<p><em>12.2
API user role and user type</em></p>
<p>Under <strong>Users</strong> =&gt; <strong>API tokens</strong> press <strong>New API token</strong>,
assign user <strong>api</strong>. We can uncheck <strong>Set expiration date and time</strong>,
press <strong>Add</strong>. Copy macro to clipboard.</p>
<p><img alt="Add token to user object" src="ch12.03-token-added-to-user.png" /> </p>
<p><em>12.3
Add token to user object</em></p>
<p>Visit <strong>Administration</strong> =&gt; <strong>Macros</strong> and install macro.
To simulate all upcoming chapters much faster,
consider running token in plain text.</p>
<p>Token <code>dafa06e74403ca317112cf5ddd3357b2ad2a2c5cb348665f294a53b4058cfbcf</code>
must be placed:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p p-Indicator">{</span><span class="nv">$ZABBIX.API.TOKEN</span><span class="p p-Indicator">}</span>
</span></code></pre></div>
<p>Address <code>https://zabbix.book.the</code> of the frontend server must be used via:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p p-Indicator">{</span><span class="nv">$ZABBIX.URL</span><span class="p p-Indicator">}</span>
</span></code></pre></div>
<p>Later throughout chapters,
we will use a reference on the API endpoint in a format of:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="p p-Indicator">{</span><span class="nv">$ZABBIX.URL</span><span class="p p-Indicator">}</span><span class="l l-Scalar l-Scalar-Plain">/api_jsonrpc.php</span>
</span></code></pre></div>
<p>Now we can take new 2 variables and install globally:</p>
<p><img alt="User macros" src="ch12.04-user-macro-global.png" /></p>
<p><em>12.4
User macros</em></p>
<h2 id="first-api-call">First API call</h2>
<p>If you feel new to Zabbix API,
try this curl example from Zabbix frontend server.</p>
<p>Set bash variables:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nv">ZABBIX_API_TOKEN</span><span class="o">=</span><span class="s2">&quot;dafa06e74403ca317112cf5ddd3357b2ad2a2c5cb348665f294a53b4058cfbcf&quot;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nv">ZABBIX_URL</span><span class="o">=</span><span class="s2">&quot;https://zabbix.book.the/api_jsonrpc.php&quot;</span>
</span></code></pre></div>
<p>This snippet is tested and compatible with version 7.0/7.4:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>curl<span class="w"> </span>--insecure<span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json-rpc&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>--header<span class="w"> </span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="nv">$ZABBIX_API_TOKEN</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>--data<span class="w"> </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;proxy.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;name&quot;]},&quot;id&quot;:1}&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="nv">$ZABBIX_URL</span>
</span></code></pre></div></p>
<p>Setting Bearer token in header is available and recommended since 7.0.</p>
<p>Setting a static token is available since 6.0. In version 6.0,
the token is not in header, but inside JSON body like this:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>curl<span class="w"> </span>--insecure<span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json-rpc&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>--data<span class="w"> </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;proxy.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;host&quot;]},&quot;auth&quot;:&quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$ZABBIX_API_TOKEN</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;,&quot;id&quot;:1}&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nv">$ZABBIX_URL</span>
</span></code></pre></div></p>
<h2 id="host-group-membership-http-agent">Host group membership (HTTP agent)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case</p>
<p>Every time an email arrives
user would love to see all host groups the host belongs.</p>
</div>
<hr />
<div class="admonition info">
<p class="admonition-title">Implementation</p>
<p>Use {HOST.HOST} as an input for the "host.get" API method and find out about
host group membership. Format reply in one line, store it in inventory.</p>
</div>
<hr />
<p>An item type "HTTP agent" is fastest way to run a single Zabbix API call and
retrieve back result. This is possible since Zabbix 6.0 where configuring
a static session token becomes possible.
An upcoming solution is tested and works on version 7.0/7.4</p>
<p>Create new <strong>HTTP agent</strong> item</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Item name</strong></td>
<td style="text-align: left;"><code>host.get</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>HTTP agent</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;"><code>host.get</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information</strong></td>
<td style="text-align: left;"><code>Text</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>URL</strong></td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Request type</strong></td>
<td style="text-align: left;"><code>POST</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Request body type</strong></td>
<td style="text-align: left;"><code>JSON data</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Update interval</strong></td>
<td style="text-align: left;"><code>1d</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Populates host inventory field</strong></td>
<td style="text-align: left;"><code>Site rack location</code></td>
</tr>
</tbody>
</table>
<p>Request body:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;host.get&quot;</span><span class="p">,</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">        </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;hostgroups&quot;</span><span class="p">],</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">        </span><span class="nt">&quot;selectHostGroups&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;extend&quot;</span><span class="p">,</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">        </span><span class="nt">&quot;filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;host&quot;</span><span class="p">:[</span><span class="s2">&quot;{HOST.HOST}&quot;</span><span class="p">]}</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>Headers</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Authorization</strong></td>
<td style="text-align: left;"><code>Bearer {$ZABBIX.API.TOKEN}</code></td>
</tr>
</tbody>
</table>
<p><img alt="User macros" src="ch12.05-host-get.png" /></p>
<p><em>12.5
Host get method via HTTP agent item</em></p>
<p>Preprocessing steps</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">JSONPath</td>
<td style="text-align: left;"><code>$.result[0].hostgroups[*].name</code></td>
</tr>
<tr>
<td style="text-align: left;">JavaScript</td>
<td style="text-align: left;"><code>return JSON.parse(value).join(',');</code></td>
</tr>
</tbody>
</table>
<p><img alt="User macros" src="ch12.06-host-get-preprocessing.png" /></p>
<p><em>12.6
Preprocessing</em></p>
<p>Last step is to store the outcome in the inventory.
Scroll down to the bottom of HTTP agent item and select an inventory field
for example "Site rack location".</p>
<p>To access suggested inventory field, we must use:
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>{INVENTORY.SITE.RACK}
</span></code></pre></div></p>
<p>To include extra information inside the message template follow this lead:</p>
<p><img alt="Inventory fields in media type" src="ch12.07-use-invenotry-field-in-media-type-with-numbers.png" /></p>
<p><em>12.7
Inventory fields in media type</em></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If data collection is done by Zabbix proxy, it is possible the proxy
is incapable to reach Zabbix frontend server due to limitation in firewall.
Use <code>curl -kL "https://zabbix.book.the"</code> to test!</p>
</div>
<hr />
<h2 id="auto-close-problem-webhook">Auto close problem (Webhook)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case</p>
<p>Due to reason of not being able to find a recovery expression for a trigger,
need to close the event automatically after certain time.</p>
</div>
<hr />
<div class="admonition info">
<p class="admonition-title">Implementation</p>
<p>Trigger settings must support <code>Allow manual close</code>. On trigger which needs
to be auto closed there must be a tag <code>auto</code> with a value <code>close</code>.
An action will invoke a webhook which will use Zabbix API to close event.</p>
</div>
<hr />
<p>To implement, visit <strong>Alerts</strong> =&gt; <strong>Scripts</strong>, press <strong>Create script</strong></p>
<p><img alt="Auto close problem" src="ch12.13-zabbix-api-auto-close-problem-webhook.png" /> </p>
<p><em>12.13
Auto close problem</em></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;"><code>Automatically close problem</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Scope</strong></td>
<td style="text-align: left;"><code>Action operation</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>Webhook</code></td>
</tr>
</tbody>
</table>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">eventid</td>
<td style="text-align: left;"><code>{EVENT.ID}</code></td>
</tr>
<tr>
<td style="text-align: left;">msg</td>
<td style="text-align: left;"><code>Auto closed by API</code></td>
</tr>
<tr>
<td style="text-align: left;">token</td>
<td style="text-align: left;"><code>{$ZABBIX.API.TOKEN}</code></td>
</tr>
<tr>
<td style="text-align: left;">url</td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
</tbody>
</table>
<p>Script:
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="p">);</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="kd">var</span><span class="w"> </span><span class="nx">eventAcknowledge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;event.acknowledge&quot;,&quot;params&quot;:{&quot;eventids&quot;:&quot;&#39;</span><span class="o">+</span><span class="nx">params</span><span class="p">.</span><span class="nx">eventid</span><span class="o">+</span><span class="s1">&#39;&quot;,&quot;action&quot;:1,&quot;message&quot;:&quot;&#39;</span><span class="o">+</span><span class="nx">params</span><span class="p">.</span><span class="nx">msg</span><span class="o">+</span><span class="s1">&#39;&quot;},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="p">));</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">eventAcknowledge</span><span class="p">);</span>
</span></code></pre></div></p>
<p>For the triggers which need to be closed automatically, we need to:</p>
<p>1) Set <code>Allow manual close</code> checkbox ON</p>
<p><img alt="Allow manual close" src="ch12.08-trigger-configuration-allow-manual-close.png" /> </p>
<p><em>12.8
Allow manual close</em></p>
<p>2) Install tag <code>auto</code> with value <code>close</code></p>
<p><img alt="Install trigger tags" src="ch12.09-trigger-configuration-install-tags.png" /> </p>
<p><em>12.9
Trigger tags</em></p>
<p>Go to <strong>Alerts</strong> =&gt; <strong>Actions</strong> =&gt; <strong>Trigger actions</strong></p>
<p>Create an action which will be targetable
by using tag name <code>auto</code> with a tag value <code>close</code>.</p>
<p><img alt="Set up conditions for action" src="ch12.10-create-new-action-install-conditions.png" /> </p>
<p><em>12.10
Conditions for action</em></p>
<p>It's important to not create operation step 1, but start operation with step 2:</p>
<p><img alt="A delayed operation" src="ch12.11-create-new-action-install-operations.png" /></p>
<p><em>12.11
A delayed operation</em></p>
<p>The <strong>Default operation step duration</strong> field will serve the purpose
to tell how long the event will be in problem state. </p>
<p><img alt="Default operation step" src="ch12.12-default-operation-step-duration.png" /></p>
<p><em>12.12
Close event later</em></p>
<p>This solution has been tested with 7.0/7.4</p>
<h2 id="self-destructive-host-webhook">Self destructive host (Webhook)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case</p>
<p>On a big infrastructure with thousands of devices there is no human who can
track which devices are deprovisioned.
Need to automatically remove unhealthy devices.</p>
</div>
<hr />
<div class="admonition info">
<p class="admonition-title">Implementation</p>
<p>Problem events such as "Zabbix agent is not available"
or "No SNMP data collection" sitting too long in problem state
will invoke a webhook to delete the host.</p>
</div>
<hr />
<p>To implement, visit <strong>Alerts</strong> =&gt; <strong>Scripts</strong>, press <strong>Create script</strong></p>
<p><img alt="Delete host webhook" src="ch12.14-delete-host-webhook.png" /> </p>
<p><em>12.13
Auto close problem</em></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;"><code>Delete host</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Scope</strong></td>
<td style="text-align: left;"><code>Action operation</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>Webhook</code></td>
</tr>
</tbody>
</table>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">hostid</td>
<td style="text-align: left;"><code>{HOST.ID}</code></td>
</tr>
<tr>
<td style="text-align: left;">token</td>
<td style="text-align: left;"><code>{$ZABBIX.API.TOKEN}</code></td>
</tr>
<tr>
<td style="text-align: left;">url</td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
</tbody>
</table>
<p>Script:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1">// delete host via Zabbix API</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="p">);</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="kd">var</span><span class="w"> </span><span class="nx">hostDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;host.delete&quot;,&quot;params&quot;:[&#39;</span><span class="o">+</span><span class="nx">params</span><span class="p">.</span><span class="nx">hostid</span><span class="o">+</span><span class="s1">&#39;],&quot;id&quot;:1}&#39;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="p">));</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">hostDelete</span><span class="p">);</span>
</span></code></pre></div>
<p>To setup action, the trigger must running a tag <code>delete</code> with value <code>host</code>.
The conditions can be to target tag plus value and trigger severity:</p>
<p><img alt="Delete host action conditions" src="ch12.15-delete-host-action-conditions.png" /> </p>
<p><em>12.15
Delete host target tag and tag value</em></p>
<p>Here we are running a delayed action with a step number 31.
Because default duration is 1d, the host will be deleted after 30 days.</p>
<p><img alt="Delete host action operations" src="ch12.16-delete-host-action-operations.png" /></p>
<p><em>12.16
Delete host operations</em></p>
<h2 id="replace-host-visible-name-script-item">Replace host Visible name (Script item)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case</p>
<p>Replace host "Visible name" with a name which is already stored in inventory</p>
</div>
<hr />
<div class="admonition info">
<p class="admonition-title">Implementation</p>
<p>The "Script" item, will read metadata for all hosts. Will read the <strong>Name</strong>
field stored inside inventory and compare with current <strong>Visible name</strong> of
host. If inventory field is empty, the visible field will not be replaced.</p>
</div>
<hr />
<p>This is maximum efficiency to run a single API call once per day.
If nothing needs to be done, "host.update" API calls will not be wasted.
No SQL UPDATE operations for the Zabbix database :)</p>
<p>Go to <strong>Data collection</strong> =&gt; <strong>Hosts</strong> =&gt; press <strong>Create host</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Host name</strong></td>
<td style="text-align: left;"><code>Update host Visible name</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Host groups</strong></td>
<td style="text-align: left;"><code>Daily Zabbix API calls</code></td>
</tr>
</tbody>
</table>
<p>Go to <strong>Items</strong> and press <strong>Create item</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;"><code>Visible name</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>Script</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;"><code>visible.name</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information</strong></td>
<td style="text-align: left;"><code>Text</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Update interval</strong></td>
<td style="text-align: left;"><code>1d</code></td>
</tr>
</tbody>
</table>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">token</td>
<td style="text-align: left;"><code>{$ZABBIX.API.TOKEN}</code></td>
</tr>
<tr>
<td style="text-align: left;">url</td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
</tbody>
</table>
<p>Script:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">// load all parameters in memory</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1">// new API call</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="kd">var</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="p">);</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="c1">// obtain Bare minimum fields: host &quot;Visible name&quot; and inventory &quot;Name&quot;</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="kd">var</span><span class="w"> </span><span class="nx">hostData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;host.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;hostid&quot;,&quot;inventory&quot;,&quot;name&quot;,&quot;host&quot;],&quot;selectInventory&quot;:[&quot;name&quot;]},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="p">)).</span><span class="nx">result</span><span class="p">;</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">listOfErrors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="kd">var</span><span class="w"> </span><span class="nx">listOfSuccess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="c1">// iterate through host list</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">h</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">hostData</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">h</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">    </span><span class="c1">// validate if inventory &quot;name&quot; element exists</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="w">        </span><span class="c1">// if &quot;name&quot; field is not empty</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="w">            </span><span class="c1">// compare if inventory name is not the same as host visible name</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="w">                </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Host visible name field, host: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; need to reinstall visible name&#39;</span><span class="p">);</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="w">                </span><span class="c1">// formulate payload for easy printing for troubleshoting</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="w">                </span><span class="nx">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;host.update&quot;,&quot;params&quot;:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a><span class="w">                    </span><span class="s1">&#39;hostid&#39;</span><span class="o">:</span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">hostid</span><span class="p">,</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="w">                    </span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">name</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="w">                    </span><span class="p">})</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;,&quot;id&quot;:1}&#39;</span><span class="p">;</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="w">                </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Host visible name field, payload: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">payload</span><span class="p">);</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a><span class="w">                    </span><span class="nx">hostUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">payload</span><span class="p">));</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a><span class="w">                    </span><span class="c1">// save API errors, like name already exists:</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">hostUpdate</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">listOfErrors</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="o">:</span><span class="nx">hostUpdate</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span><span class="s1">&#39;origin&#39;</span><span class="o">:</span><span class="nx">hostData</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">host</span><span class="p">})</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a><span class="w">                    </span><span class="c1">// save successfull operation:</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">hostUpdate</span><span class="p">.</span><span class="nx">result</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">listOfSuccess</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">hostUpdate</span><span class="p">.</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a><span class="w">                </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-50"><a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a><span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="s1">&#39;noo&#39;</span><span class="p">;</span>
</span><span id="__span-10-51"><a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a>
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a>
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a>
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a>
</span><span id="__span-10-59"><a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a><span class="p">}</span>
</span><span id="__span-10-60"><a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a>
</span><span id="__span-10-61"><a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="s1">&#39;listOfSuccess&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">listOfSuccess</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;errors&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">listOfErrors</span><span class="w"> </span><span class="p">});</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The chances of having duplicate host names are still possible. In this case,
the script will continue to parse all hosts and will retry update operation.
Ensure $.listOfErrors in output is an empty list.</p>
</div>
<hr />
<p>All together</p>
<p><img alt="Script item, host Visible name" src="ch12.17-script-item-host-visible-name.png" /></p>
<p><em>12.17
Script item, host Visible name</em></p>
<p>The item will be sit at host level and serve a purpose of cronjob</p>
<p><img alt="Script item ready" src="ch12.18-script-item-ready.png" /></p>
<p><em>12.18
Script item ready</em></p>
<p>This is tested and works with Zabbix 7.0</p>
<h2 id="cleanup-unused-zbx-interfaces-webhook">Cleanup unused ZBX interfaces (Webhook)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case 1</p>
<p>Default "Host availability" widget will print "Unknown" interfaces
if none of Zabbix agent passive checks are using it.
Need to remove interface to get "Unknown" interface number closer to 0</p>
</div>
<hr />
<p><img alt="Unknown ZBX passive interfaces" src="ch12.19-host-availability-unknown-passive-agent-checks.png" /></p>
<p><em>12.19
Unknown ZBX passive interfaces</em></p>
<div class="admonition tip">
<p class="admonition-title">Use case 2</p>
<p>Active checks by design do not require an interface. Having a defined
interface will mislead the team to understand how active checks actually
works.</p>
</div>
<hr />
<div class="admonition tip">
<p class="admonition-title">Use case 3</p>
<p>https://cloud.zabbix.com/ is good for server monitoring with active checks.
While registering new servers, the IP address of host interface is not
relatable to infrastructure.
Remove the interface to make setup look more clean.</p>
</div>
<hr />
<div class="admonition info">
<p class="admonition-title">Implementation</p>
<p>To bring aboard a host, run a webhook to validate if an interface is used
by any passive Zabbix agent items. If it's not used, then remove interface.</p>
</div>
<hr />
<p>To implement, visit <strong>Alerts</strong> =&gt; <strong>Scripts</strong>, press <strong>Create script</strong></p>
<p><img alt="Remove unused ZBX interfaces" src="ch12.20-remove-unused-zbx-hosts.png" /></p>
<p><em>12.20
Remove unused ZBX interfaces</em></p>
<p>Webhook</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;"><code>Remove unused ZBX interfaces</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Scope</strong></td>
<td style="text-align: left;"><code>Action operation</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>Webhook</code></td>
</tr>
</tbody>
</table>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">debug</td>
<td style="text-align: left;"><code>4</code></td>
</tr>
<tr>
<td style="text-align: left;">host</td>
<td style="text-align: left;"><code>{HOST.HOST}</code></td>
</tr>
<tr>
<td style="text-align: left;">token</td>
<td style="text-align: left;"><code>{$ZABBIX.API.TOKEN}</code></td>
</tr>
<tr>
<td style="text-align: left;">url</td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
</tbody>
</table>
<p>Script:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1">// Load all variables</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="p">);</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="c1">// Pick up hostid</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="kd">var</span><span class="w"> </span><span class="nx">hostid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;host.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;hostid&quot;],&quot;filter&quot;:{&quot;host&quot;:[&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">host</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;]}},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="p">)).</span><span class="nx">result</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">hostid</span><span class="p">;</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="c1">// Extract all passive Zabbix agent interfaces</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;hostinterface.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;interfaceid&quot;,&quot;main&quot;],&quot;filter&quot;:{&quot;type&quot;:&quot;1&quot;},&quot;hostids&quot;:&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">hostid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="p">)).</span><span class="nx">result</span><span class="p">;</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="c1">// If any ZBX interface was found then proceed fetching all items because need to find out if any items use an interface</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">allAgentInterfaces</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">    </span><span class="c1">// Fetch all items which are defined at host level and ask which item use passive ZBX agent interface</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">    </span><span class="c1">// Simple check items (like icmpping) also can use zabbix agent interface</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">items_with_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="w">        </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;item.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;type&quot;,&quot;interfaces&quot;],&quot;hostids&quot;:&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">hostid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;,&quot;selectInterfaces&quot;:&quot;query&quot;},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="w">    </span><span class="p">)).</span><span class="nx">result</span><span class="p">;</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="p">}</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="c1">// Define an interface array. This is required if more than one ZBX interface exists on host level</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="kd">var</span><span class="w"> </span><span class="nx">interfacesInUse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="c1">// Iterate through all ZBX interfaces</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">zbx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">zbx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">zbx</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="w">    </span><span class="c1">// Go through all items which is defined at host level</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="kr">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="kr">int</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">items_with_int</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="kr">int</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="w">        </span><span class="c1">// There are many items which does not need interface. Specifically analyze the ones which has an interface defined</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">items_with_int</span><span class="p">[</span><span class="kr">int</span><span class="p">].</span><span class="nx">interfaces</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a><span class="w">            </span><span class="c1">// There is an interface found for the item</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">items_with_int</span><span class="p">[</span><span class="kr">int</span><span class="p">].</span><span class="nx">interfaces</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">interfaceid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">zbx</span><span class="p">].</span><span class="nx">interfaceid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a><span class="w">                </span><span class="c1">// Put this item in list which use an interface</span>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a><span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="w">                </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;itemid&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">items_with_int</span><span class="p">[</span><span class="kr">int</span><span class="p">].</span><span class="nx">itemid</span><span class="p">;</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="w">                </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;interfaceid&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">zbx</span><span class="p">].</span><span class="nx">interfaceid</span><span class="p">;</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a><span class="w">                </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;main&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">zbx</span><span class="p">].</span><span class="nx">main</span><span class="p">;</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="w">                </span><span class="nx">interfacesInUse</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a><span class="p">}</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a>
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a><span class="c1">// Final scan to identify if any interface is wasted</span>
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a><span class="kd">var</span><span class="w"> </span><span class="nx">needToDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a><span class="kd">var</span><span class="w"> </span><span class="nx">evidenceOfDeletedInterfaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a><span class="kd">var</span><span class="w"> </span><span class="nx">mainNotUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">defined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">defined</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">defined</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a>
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a><span class="w">    </span><span class="c1">// Scan all items</span>
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a><span class="w">    </span><span class="nx">needToDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">interfacesInUse</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">used</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">defined</span><span class="p">].</span><span class="nx">interfaceid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">interfacesInUse</span><span class="p">[</span><span class="nx">used</span><span class="p">].</span><span class="nx">interfaceid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a><span class="w">            </span><span class="nx">needToDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a>
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66" href="#__codelineno-11-66"></a><span class="w">    </span><span class="c1">// If flag was not turned off, then no items with this interface were found. No items are using this interface. Safe to delete</span>
</span><span id="__span-11-67"><a id="__codelineno-11-67" name="__codelineno-11-67" href="#__codelineno-11-67"></a><span class="w">    </span><span class="c1">// Delete all slaves first</span>
</span><span id="__span-11-68"><a id="__codelineno-11-68" name="__codelineno-11-68" href="#__codelineno-11-68"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">needToDelete</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">defined</span><span class="p">].</span><span class="nx">main</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-69"><a id="__codelineno-11-69" name="__codelineno-11-69" href="#__codelineno-11-69"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">deleteInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-11-70"><a id="__codelineno-11-70" name="__codelineno-11-70" href="#__codelineno-11-70"></a><span class="w">            </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;hostinterface.delete&quot;,&quot;params&quot;:[&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">defined</span><span class="p">].</span><span class="nx">interfaceid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;],&quot;id&quot;:1}&#39;</span>
</span><span id="__span-11-71"><a id="__codelineno-11-71" name="__codelineno-11-71" href="#__codelineno-11-71"></a><span class="w">        </span><span class="p">));</span>
</span><span id="__span-11-72"><a id="__codelineno-11-72" name="__codelineno-11-72" href="#__codelineno-11-72"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-11-73"><a id="__codelineno-11-73" name="__codelineno-11-73" href="#__codelineno-11-73"></a><span class="w">        </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;deleted&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">deleteInt</span><span class="p">;</span>
</span><span id="__span-11-74"><a id="__codelineno-11-74" name="__codelineno-11-74" href="#__codelineno-11-74"></a><span class="w">        </span><span class="nx">evidenceOfDeletedInterfaces</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</span><span id="__span-11-75"><a id="__codelineno-11-75" name="__codelineno-11-75" href="#__codelineno-11-75"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-76"><a id="__codelineno-11-76" name="__codelineno-11-76" href="#__codelineno-11-76"></a>
</span><span id="__span-11-77"><a id="__codelineno-11-77" name="__codelineno-11-77" href="#__codelineno-11-77"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">needToDelete</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">defined</span><span class="p">].</span><span class="nx">main</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-78"><a id="__codelineno-11-78" name="__codelineno-11-78" href="#__codelineno-11-78"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">mainNotUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">[</span><span class="nx">defined</span><span class="p">].</span><span class="nx">interfaceid</span><span class="p">;</span>
</span><span id="__span-11-79"><a id="__codelineno-11-79" name="__codelineno-11-79" href="#__codelineno-11-79"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-80"><a id="__codelineno-11-80" name="__codelineno-11-80" href="#__codelineno-11-80"></a>
</span><span id="__span-11-81"><a id="__codelineno-11-81" name="__codelineno-11-81" href="#__codelineno-11-81"></a><span class="p">}</span>
</span><span id="__span-11-82"><a id="__codelineno-11-82" name="__codelineno-11-82" href="#__codelineno-11-82"></a>
</span><span id="__span-11-83"><a id="__codelineno-11-83" name="__codelineno-11-83" href="#__codelineno-11-83"></a><span class="c1">// Delete main interface at the end</span>
</span><span id="__span-11-84"><a id="__codelineno-11-84" name="__codelineno-11-84" href="#__codelineno-11-84"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">mainNotUsed</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-85"><a id="__codelineno-11-85" name="__codelineno-11-85" href="#__codelineno-11-85"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">deleteInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-11-86"><a id="__codelineno-11-86" name="__codelineno-11-86" href="#__codelineno-11-86"></a><span class="w">        </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;hostinterface.delete&quot;,&quot;params&quot;:[&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">mainNotUsed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;],&quot;id&quot;:1}&#39;</span>
</span><span id="__span-11-87"><a id="__codelineno-11-87" name="__codelineno-11-87" href="#__codelineno-11-87"></a><span class="w">    </span><span class="p">));</span>
</span><span id="__span-11-88"><a id="__codelineno-11-88" name="__codelineno-11-88" href="#__codelineno-11-88"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-11-89"><a id="__codelineno-11-89" name="__codelineno-11-89" href="#__codelineno-11-89"></a><span class="w">    </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;deleted&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">deleteInt</span><span class="p">;</span>
</span><span id="__span-11-90"><a id="__codelineno-11-90" name="__codelineno-11-90" href="#__codelineno-11-90"></a><span class="w">    </span><span class="nx">evidenceOfDeletedInterfaces</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</span><span id="__span-11-91"><a id="__codelineno-11-91" name="__codelineno-11-91" href="#__codelineno-11-91"></a><span class="p">}</span>
</span><span id="__span-11-92"><a id="__codelineno-11-92" name="__codelineno-11-92" href="#__codelineno-11-92"></a>
</span><span id="__span-11-93"><a id="__codelineno-11-93" name="__codelineno-11-93" href="#__codelineno-11-93"></a><span class="kd">var</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-11-94"><a id="__codelineno-11-94" name="__codelineno-11-94" href="#__codelineno-11-94"></a><span class="w">    </span><span class="s2">&quot;allAgentInterfaces&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">allAgentInterfaces</span><span class="p">,</span>
</span><span id="__span-11-95"><a id="__codelineno-11-95" name="__codelineno-11-95" href="#__codelineno-11-95"></a><span class="w">    </span><span class="s2">&quot;interfacesInUse&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">interfacesInUse</span><span class="p">,</span>
</span><span id="__span-11-96"><a id="__codelineno-11-96" name="__codelineno-11-96" href="#__codelineno-11-96"></a><span class="w">    </span><span class="s2">&quot;evidenceOfDeletedInterfaces&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">evidenceOfDeletedInterfaces</span>
</span><span id="__span-11-97"><a id="__codelineno-11-97" name="__codelineno-11-97" href="#__codelineno-11-97"></a><span class="p">});</span>
</span><span id="__span-11-98"><a id="__codelineno-11-98" name="__codelineno-11-98" href="#__codelineno-11-98"></a>
</span><span id="__span-11-99"><a id="__codelineno-11-99" name="__codelineno-11-99" href="#__codelineno-11-99"></a><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Auto remove unused ZBX agent passive interfaces: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">output</span><span class="p">)</span>
</span><span id="__span-11-100"><a id="__codelineno-11-100" name="__codelineno-11-100" href="#__codelineno-11-100"></a>
</span><span id="__span-11-101"><a id="__codelineno-11-101" name="__codelineno-11-101" href="#__codelineno-11-101"></a><span class="k">return</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span></code></pre></div>
<p>To make webhook in action visit <strong>Alerts</strong> =&gt; <strong>Actions</strong>
=&gt; <strong>Autoregistration actions</strong>. Press <strong>Create action</strong>. For example to auto
register Linux servers, we can target a pattern ".lnx" inside the hostname.</p>
<p><img alt="Conditions for ZBX active checks" src="ch12.21-autoreg-conditions.png" /></p>
<p><em>12.21
Conditions for ZBX active checks</em></p>
<p>The operations will use newly made webhook</p>
<p><img alt="Operations of Zabbix agent autoregistration" src="ch12.22-autoreg-actions.png" /></p>
<p><em>12.22
Operations of Zabbix agent autoregistration</em></p>
<p>The complete picture is</p>
<p><img alt="Zabbix agent autoregistration completed" src="ch12.23-autoreg-completed.png" /></p>
<p><em>12.23
Zabbix agent autoregistration completed</em></p>
<h2 id="read-log-file-from-yyyymmdd-filename-script">Read log file from YYYY.MM.DD filename (Script)</h2>
<div class="admonition tip">
<p class="admonition-title">Use case</p>
<p>Requirement is to read a filename
with today's pattern YYYY.MM.DD or YYYY_MM_DD or YYYYMMDD.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Popular solution 1 - logrt</p>
<p>Using "logrt" item key can be used to cover use case.
However in case hundreds of files in directory, the CPU will have impact.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Popular solution 2 - LLD rule</p>
<p>We Zabbix LLD rule to find the files in directory.
This method do not allow to store all data inside same itemid.
When files are deleted from server, the items in Zabbix will get unsupported.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Alternative solution</p>
<p>We will use Zabbix API to create a global variables YYYY, MM, DD.
Those will be universally available by any host, template.
The "cronjob host" will run at least once per day
and reinstall the date right after the midnight.
Inside template level there will be a single/static item key
which will be able to read today's log.</p>
</div>
<p>Go to <strong>Data collection</strong> =&gt; <strong>Hosts</strong> =&gt; press <strong>Create host</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Host name</strong></td>
<td style="text-align: left;"><code>Dude</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Host groups</strong></td>
<td style="text-align: left;"><code>Cronjob</code></td>
</tr>
</tbody>
</table>
<p>Go to <strong>Items</strong> and press <strong>Create item</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;"><code>Create or update global macro</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type</strong></td>
<td style="text-align: left;"><code>Script</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key</strong></td>
<td style="text-align: left;"><code>create.or.update.global.macro</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Type of information</strong></td>
<td style="text-align: left;"><code>Text</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Update interval</strong></td>
<td style="text-align: left;"><code>0</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Custom intervals: Scheduling</strong></td>
<td style="text-align: left;"><code>h0m1s1</code></td>
</tr>
</tbody>
</table>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1_year</td>
<td style="text-align: left;"><code>{$DATE:arg1.year}</code></td>
</tr>
<tr>
<td style="text-align: left;">2_month</td>
<td style="text-align: left;"><code>{$DATE:arg2.month}</code></td>
</tr>
<tr>
<td style="text-align: left;">3_day</td>
<td style="text-align: left;"><code>{$DATE:arg3.day}</code></td>
</tr>
<tr>
<td style="text-align: left;">4_hour</td>
<td style="text-align: left;"><code>{$DATE:arg4.hour}</code></td>
</tr>
<tr>
<td style="text-align: left;">5_minute</td>
<td style="text-align: left;"><code>{$DATE:arg5.minute}</code></td>
</tr>
<tr>
<td style="text-align: left;">6_second</td>
<td style="text-align: left;"><code>{$DATE:arg6.seconds}</code></td>
</tr>
<tr>
<td style="text-align: left;">token</td>
<td style="text-align: left;"><code>{$ZABBIX.API.TOKEN}</code></td>
</tr>
<tr>
<td style="text-align: left;">url</td>
<td style="text-align: left;"><code>{$ZABBIX.URL}/api_jsonrpc.php</code></td>
</tr>
</tbody>
</table>
<p>The script to create and maintain global variables:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1">// load all variables into memory</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">),</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="c1">// function to always print seconds, minutes, hours as 2 digits, even it its a 1 digit character</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="kd">function</span><span class="w"> </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">length</span><span class="p">,</span><span class="w"> </span><span class="kr">char</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">        </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">char</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="p">}</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="c1">// define macros to check/create without &#39;{$&#39; an &#39;}&#39;</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="kd">var</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">    </span><span class="s1">&#39;DATE:arg1.year&#39;</span><span class="p">,</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="w">    </span><span class="s1">&#39;DATE:arg2.month&#39;</span><span class="p">,</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">    </span><span class="s1">&#39;DATE:arg3.day&#39;</span><span class="p">,</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="w">    </span><span class="s1">&#39;DATE:arg4.hour&#39;</span><span class="p">,</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="w">    </span><span class="s1">&#39;DATE:arg5.minute&#39;</span><span class="p">,</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="w">    </span><span class="s1">&#39;DATE:arg6.seconds&#39;</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="p">];</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="c1">// prepare values for replacement. order is important</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="kd">var</span><span class="w"> </span><span class="nx">valuesToInsert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="w">    </span><span class="nx">now</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">().</span><span class="nx">toString</span><span class="p">(),</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="w">    </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="w">    </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getDate</span><span class="p">(),</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="w">    </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getHours</span><span class="p">(),</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="w">    </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">(),</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="w">    </span><span class="nx">padLeft</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">(),</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="p">];</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a><span class="kd">var</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">HttpRequest</span><span class="p">();</span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="p">);</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a><span class="nx">request</span><span class="p">.</span><span class="nx">addHeader</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a><span class="kd">var</span><span class="w"> </span><span class="nx">allGlobalMacrosBefore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;usermacro.get&quot;,&quot;params&quot;:{&quot;output&quot;:[&quot;globalmacroid&quot;,&quot;macro&quot;,&quot;value&quot;],&quot;globalmacro&quot;:true},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a><span class="p">)).</span><span class="nx">result</span><span class="p">;</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a><span class="c1">// prepare much compact array which holds only necessary values</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a><span class="kd">var</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">allGlobalMacrosBefore</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">a</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a><span class="w">        </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;macro update compare: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">allGlobalMacrosBefore</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; with &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">);</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">allGlobalMacrosBefore</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a><span class="w">            </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;macro update: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">allGlobalMacrosBefore</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; === &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">);</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a><span class="w">            </span><span class="nx">target</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">allGlobalMacrosBefore</span><span class="p">[</span><span class="nx">a</span><span class="p">]);</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a><span class="p">}</span>
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53" href="#__codelineno-12-53"></a>
</span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54" href="#__codelineno-12-54"></a><span class="c1">// check if the amount of macros to maintain match existing macro. this portion will execute if run template for the first time</span>
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55" href="#__codelineno-12-55"></a><span class="kd">var</span><span class="w"> </span><span class="nx">macroExists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-12-56"><a id="__codelineno-12-56" name="__codelineno-12-56" href="#__codelineno-12-56"></a><span class="kd">var</span><span class="w"> </span><span class="nx">allCreateOperation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-12-57"><a id="__codelineno-12-57" name="__codelineno-12-57" href="#__codelineno-12-57"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">macrosToCheck</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-58"><a id="__codelineno-12-58" name="__codelineno-12-58" href="#__codelineno-12-58"></a><span class="w">    </span><span class="c1">// something is missing, need to find what. open every macro which is known by Zabbix</span>
</span><span id="__span-12-59"><a id="__codelineno-12-59" name="__codelineno-12-59" href="#__codelineno-12-59"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-60"><a id="__codelineno-12-60" name="__codelineno-12-60" href="#__codelineno-12-60"></a><span class="w">        </span><span class="c1">// reset the counter, so far macro has not been found</span>
</span><span id="__span-12-61"><a id="__codelineno-12-61" name="__codelineno-12-61" href="#__codelineno-12-61"></a><span class="w">        </span><span class="nx">macroExists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-12-62"><a id="__codelineno-12-62" name="__codelineno-12-62" href="#__codelineno-12-62"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">a</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-63"><a id="__codelineno-12-63" name="__codelineno-12-63" href="#__codelineno-12-63"></a><span class="w">            </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;look for missing macro update: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">target</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; VS {$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">);</span>
</span><span id="__span-12-64"><a id="__codelineno-12-64" name="__codelineno-12-64" href="#__codelineno-12-64"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">target</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-65"><a id="__codelineno-12-65" name="__codelineno-12-65" href="#__codelineno-12-65"></a><span class="w">                </span><span class="nx">macroExists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-12-66"><a id="__codelineno-12-66" name="__codelineno-12-66" href="#__codelineno-12-66"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-12-67"><a id="__codelineno-12-67" name="__codelineno-12-67" href="#__codelineno-12-67"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-68"><a id="__codelineno-12-68" name="__codelineno-12-68" href="#__codelineno-12-68"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-69"><a id="__codelineno-12-69" name="__codelineno-12-69" href="#__codelineno-12-69"></a>
</span><span id="__span-12-70"><a id="__codelineno-12-70" name="__codelineno-12-70" href="#__codelineno-12-70"></a><span class="w">        </span><span class="c1">// if the list was completed and macro was not found then create a new</span>
</span><span id="__span-12-71"><a id="__codelineno-12-71" name="__codelineno-12-71" href="#__codelineno-12-71"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">macroExists</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-72"><a id="__codelineno-12-72" name="__codelineno-12-72" href="#__codelineno-12-72"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">createNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-12-73"><a id="__codelineno-12-73" name="__codelineno-12-73" href="#__codelineno-12-73"></a><span class="w">                </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;usermacro.createglobal&quot;,&quot;params&quot;:{&quot;macro&quot;:&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;,&quot;value&quot;:&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">valuesToInsert</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;},&quot;id&quot;:1}&#39;</span>
</span><span id="__span-12-74"><a id="__codelineno-12-74" name="__codelineno-12-74" href="#__codelineno-12-74"></a><span class="w">            </span><span class="p">));</span>
</span><span id="__span-12-75"><a id="__codelineno-12-75" name="__codelineno-12-75" href="#__codelineno-12-75"></a><span class="w">            </span><span class="nx">allCreateOperation</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">createNew</span><span class="p">);</span>
</span><span id="__span-12-76"><a id="__codelineno-12-76" name="__codelineno-12-76" href="#__codelineno-12-76"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-77"><a id="__codelineno-12-77" name="__codelineno-12-77" href="#__codelineno-12-77"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-78"><a id="__codelineno-12-78" name="__codelineno-12-78" href="#__codelineno-12-78"></a><span class="p">}</span>
</span><span id="__span-12-79"><a id="__codelineno-12-79" name="__codelineno-12-79" href="#__codelineno-12-79"></a>
</span><span id="__span-12-80"><a id="__codelineno-12-80" name="__codelineno-12-80" href="#__codelineno-12-80"></a><span class="c1">// prepare payload what needs to be updated</span>
</span><span id="__span-12-81"><a id="__codelineno-12-81" name="__codelineno-12-81" href="#__codelineno-12-81"></a><span class="kd">var</span><span class="w"> </span><span class="nx">dataForUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-12-82"><a id="__codelineno-12-82" name="__codelineno-12-82" href="#__codelineno-12-82"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">m</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-83"><a id="__codelineno-12-83" name="__codelineno-12-83" href="#__codelineno-12-83"></a><span class="w">    </span><span class="c1">// iterate through importand macro names</span>
</span><span id="__span-12-84"><a id="__codelineno-12-84" name="__codelineno-12-84" href="#__codelineno-12-84"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">n</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-85"><a id="__codelineno-12-85" name="__codelineno-12-85" href="#__codelineno-12-85"></a><span class="w">        </span><span class="c1">// compare the macro name</span>
</span><span id="__span-12-86"><a id="__codelineno-12-86" name="__codelineno-12-86" href="#__codelineno-12-86"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">target</span><span class="p">[</span><span class="nx">m</span><span class="p">].</span><span class="nx">macro</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;{$&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">macrosToCheck</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-87"><a id="__codelineno-12-87" name="__codelineno-12-87" href="#__codelineno-12-87"></a><span class="w">            </span><span class="c1">// if value is not correct at the moment</span>
</span><span id="__span-12-88"><a id="__codelineno-12-88" name="__codelineno-12-88" href="#__codelineno-12-88"></a><span class="w">            </span><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;about to macro update: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">target</span><span class="p">[</span><span class="nx">m</span><span class="p">].</span><span class="nx">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; VS &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">valuesToInsert</span><span class="p">[</span><span class="nx">n</span><span class="p">]);</span>
</span><span id="__span-12-89"><a id="__codelineno-12-89" name="__codelineno-12-89" href="#__codelineno-12-89"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Number</span><span class="p">(</span><span class="nx">target</span><span class="p">[</span><span class="nx">m</span><span class="p">].</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">valuesToInsert</span><span class="p">[</span><span class="nx">n</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-90"><a id="__codelineno-12-90" name="__codelineno-12-90" href="#__codelineno-12-90"></a><span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-12-91"><a id="__codelineno-12-91" name="__codelineno-12-91" href="#__codelineno-12-91"></a><span class="w">                </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;globalmacroid&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">[</span><span class="nx">m</span><span class="p">].</span><span class="nx">globalmacroid</span><span class="p">;</span>
</span><span id="__span-12-92"><a id="__codelineno-12-92" name="__codelineno-12-92" href="#__codelineno-12-92"></a><span class="w">                </span><span class="nx">row</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">valuesToInsert</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span>
</span><span id="__span-12-93"><a id="__codelineno-12-93" name="__codelineno-12-93" href="#__codelineno-12-93"></a><span class="w">                </span><span class="nx">dataForUpdate</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</span><span id="__span-12-94"><a id="__codelineno-12-94" name="__codelineno-12-94" href="#__codelineno-12-94"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-95"><a id="__codelineno-12-95" name="__codelineno-12-95" href="#__codelineno-12-95"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-96"><a id="__codelineno-12-96" name="__codelineno-12-96" href="#__codelineno-12-96"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-97"><a id="__codelineno-12-97" name="__codelineno-12-97" href="#__codelineno-12-97"></a><span class="p">}</span>
</span><span id="__span-12-98"><a id="__codelineno-12-98" name="__codelineno-12-98" href="#__codelineno-12-98"></a>
</span><span id="__span-12-99"><a id="__codelineno-12-99" name="__codelineno-12-99" href="#__codelineno-12-99"></a><span class="nx">Zabbix</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;about to macro update: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">dataForUpdate</span><span class="p">));</span>
</span><span id="__span-12-100"><a id="__codelineno-12-100" name="__codelineno-12-100" href="#__codelineno-12-100"></a>
</span><span id="__span-12-101"><a id="__codelineno-12-101" name="__codelineno-12-101" href="#__codelineno-12-101"></a>
</span><span id="__span-12-102"><a id="__codelineno-12-102" name="__codelineno-12-102" href="#__codelineno-12-102"></a><span class="c1">// if there is anything to update (usually seconds has been changed)</span>
</span><span id="__span-12-103"><a id="__codelineno-12-103" name="__codelineno-12-103" href="#__codelineno-12-103"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dataForUpdate</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-104"><a id="__codelineno-12-104" name="__codelineno-12-104" href="#__codelineno-12-104"></a><span class="kd">var</span><span class="w"> </span><span class="nx">allUpdateOperations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span id="__span-12-105"><a id="__codelineno-12-105" name="__codelineno-12-105" href="#__codelineno-12-105"></a><span class="w">    </span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;usermacro.updateglobal&quot;,&quot;params&quot;:&#39;</span><span class="o">+</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">dataForUpdate</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="s1">&#39;,&quot;id&quot;:1}&#39;</span>
</span><span id="__span-12-106"><a id="__codelineno-12-106" name="__codelineno-12-106" href="#__codelineno-12-106"></a><span class="p">));</span>
</span><span id="__span-12-107"><a id="__codelineno-12-107" name="__codelineno-12-107" href="#__codelineno-12-107"></a><span class="p">}</span>
</span><span id="__span-12-108"><a id="__codelineno-12-108" name="__codelineno-12-108" href="#__codelineno-12-108"></a>
</span><span id="__span-12-109"><a id="__codelineno-12-109" name="__codelineno-12-109" href="#__codelineno-12-109"></a>
</span><span id="__span-12-110"><a id="__codelineno-12-110" name="__codelineno-12-110" href="#__codelineno-12-110"></a><span class="c1">// output</span>
</span><span id="__span-12-111"><a id="__codelineno-12-111" name="__codelineno-12-111" href="#__codelineno-12-111"></a><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span id="__span-12-112"><a id="__codelineno-12-112" name="__codelineno-12-112" href="#__codelineno-12-112"></a><span class="w">    </span><span class="s1">&#39;allCreateOperation&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">allCreateOperation</span><span class="p">,</span>
</span><span id="__span-12-113"><a id="__codelineno-12-113" name="__codelineno-12-113" href="#__codelineno-12-113"></a><span class="w">    </span><span class="s1">&#39;allUpdateOperations&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">allUpdateOperations</span>
</span><span id="__span-12-114"><a id="__codelineno-12-114" name="__codelineno-12-114" href="#__codelineno-12-114"></a><span class="p">})</span>
</span></code></pre></div>
<p><img alt="Reinstall YYYY-MM-DD" src="ch12.24-yyyy-mm-dd.png" /></p>
<p><em>12.24
Create or reinstall global macros</em></p>
<p>After running a script now, there are global variables available:</p>
<p><img alt="Reinstall YYYY-MM-DD" src="ch12.25-yyyy-mm-dd-result.png" /></p>
<p><em>12.24
Global YYYY, MM, DD macros</em></p>
<p>For log item monitoring we can use native log item key:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>log[/var/log/zabbix/backup_{$DATE:arg1.year}.{$DATE:arg2.month}.{$DATE:arg3.day}.log]
</span></code></pre></div>
<p>In case need to analyze a single summary where file size is less than 16 MB, then can use:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>vfs.file.contents[/var/log/backup/summary_{$DATE:arg1.year}.{$DATE:arg2.month}.{$DATE:arg3.day}.txt]
</span></code></pre></div>












                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Stichting The Monitoring Penmasters
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.tags", "navigation.expand", "navigation.prune", "navigation.path", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.action.view", "content.tags"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": {"index": "tags.md"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../assets/external/cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../javascripts/tags-data-attr.js?v=514f4d1ef40cb7c1bed03bcbf9a447d4f11fa141"></script>
      
    
    
        
            
            
        
		
		
    

  </body>
</html>